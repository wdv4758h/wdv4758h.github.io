var NewsTemplateCommonClient=Class.create();Object.extend(NewsTemplateCommonClient.prototype,{server:{getCMSNewsShowtimeInfo:function(b,a){return Mtime.Component.Ajax.crossDomainCallBack(siteLibraryServiceUrl,"Mtime.Library.Services","GetCMSNewsShowtimeInfoResult",[b],a,"/CMS.api","get","60000")},addCmsNewsComment:function(e,f,c,d,i,j,h,b,g,a){return Mtime.Component.Ajax.crossDomainCallBack(siteLibraryServiceUrl,"Mtime.Library.Services","AddOrEditCmsNewsComment",[e,f,-1,d,i,j,h,0],a,"/CMS.api","get","60000",g)},GetMovieRatingByMovieIds:function(b,a,c){return Mtime.Component.Ajax.crossDomainCallBack(siteLibraryServiceUrl,"Mtime.Library.Services","GetMovieRatingByMovieIds",[b],a,"/Movie.api","get","60000",null)},GetPersonRatingByPersonIds:function(b,a,c){return Mtime.Component.Ajax.crossDomainCallBack(siteLibraryServiceUrl,"Mtime.Library.Services","GetPersonRatingByPersonIds",[b],a,"/Person.api","post","20000",c)}},options:{},setOptions:function(a){Object.extend(Object.extend(this,this.options),a)},initialize:function(a){this.setOptions(a);this.initializeServerData();this.initializeDOM();this.initializeEvent();this.load();this.initializeControl()},initializeServerData:function(){},initializeDOM:function(){this.relatedInfos=$("relatedInfos");this.showMoreRelatedInfos=$("showMoreRelatedInfos");this.commentBoxArea=$("commentBoxArea");this.userArea=$("userArea");this.pageNavigator=$("PageNavigator");this.newsPageTitle=$("newsPageTitle");this.newsContent=$("newsContent")},destroyDOM:function(){this.relatedInfos=null;this.showMoreRelatedInfos=null;this.commentBoxArea=null;this.userArea=null;this.pageNavigator=null;this.newsPageTitle=null;this.newsContent=null},initializeEvent:function(){this.onClickShowMoreRelatedInfosHandler=this.onClickShowMoreRelatedInfos.bind(this);this.showMoreRelatedInfos&&this.showMoreRelatedInfos.observe("click",this.onClickShowMoreRelatedInfosHandler);this.pageNavigatorOverHandler=this.pageNavigatorOver.bind(this);this.pageNavigator&&this.pageNavigator.observe("mouseover",this.pageNavigatorOverHandler);this.onClickNewsContentHandler=this.onClickNewsContent.bind(this);this.newsContent&&this.newsContent.observe("click",this.onClickNewsContentHandler);Event.observe(window,"unload",this.close.bind(this));Event.observe(window,"resize",this.changeResolution.bind(this))},destroyEvent:function(){this.loadingBtn&&this.loadingBtn.stopObserving("click",this.onClickLoadingBtnHandler);this.pageNavigator&&this.pageNavigator.stopObserving("mouseover",this.pageNavigatorOverHandler);this.newsContent&&this.newsContent.stopObserving("click",this.onClickNewsContentHandler)},initializeControl:function(){if(typeof RightFloatToolsControl!="undefined"&&RightFloatToolsControl!=null){var d=siteMcUrl+"/member/signin";var b=this.currentImageID==0?this.newsID:this.currentImageID;var c=this.currentImageID==0?5101:5102;var a=51;this.shareCtrl=new RightFloatToolsControl({editorComment:"commentConTextArea",shareRelatedObjType:c,relatedId:b,isLogin:false,signInUrl:d,relatedObjId:this.newsID,relatedObjType:a,hasFavorited:false})}},destroyControl:function(){if(this.shareCtrl){this.shareCtrl.close();this.shareCtrl=null}},load:function(){var h=document.location.href.split("#")[0];this.newsID=h.substring(h.lastIndexOf("/")+1,h.length).split(".")[0].split("-")[0];this.currentImageID=0;var u=$$(".newstime");if(u){for(var j=0;j<u.length;j++){u[j].show()}}Mtime.Component.Statistic.Service.Log(51,this.newsID);window.setTimeout(function(){if(this.pageNavigator){this.pageNavigatorOver(null,$$("#PageNavigator .on")[0])}}.bind(this),2000);if($("newsContent")){new Widgets.CallOutVideo({slidesRegion:"newsContent"});if(typeof Card!="undefined"){new Card({mytimeContentRegion:"newsContent"})}var m=$("newsContent").getElementsByTagName("img");for(var j=0;j<m.length;j++){var k=m[j],l;var a=$(k).up("div");if(a){if(a.hasAttribute("method")&&a.readAttribute("method")=="imgtool"){l=document.createElement("img");l.onload=(function(i,v){return function(){if(v.width==620){i.up("div").up("div").style.height=parseInt(v.height/2,10)+7+"px"}else{i.up("div").up("div").style.height=parseInt(v.height*310/v.width,10)+7+"px"}i.up("div").up("div").removeClassName("none");window.setTimeout(function(){if(this.pageNavigator){this.pageNavigatorOver(null,$$("#PageNavigator .on")[0])}}.bind(this),2000)}})(k,l).bind(this);l.src=k.src}}}if(typeof SwfToMp4Video!="undefined"){new SwfToMp4Video({contentRegion:"newsContent"})}else{$loadSubJs(["/js/2014/SwfToMp4Video.js"],function(){new SwfToMp4Video({contentRegion:"newsContent"})}.bind(this))}}if($("mixAlbumSlidesRegion")){var m=$("mixAlbumRegion").getElementsByTagName("img");for(var j=0;j<m.length;j++){var k=m[j],l;var b=$(k).up("span");if(b){l=document.createElement("img");l.onload=(function(i,v){return function(){i.up("span").style.marginTop=parseInt(590-v.height,10)/2+"px"}})(k,l).bind(this);l.src=k.src}}new Widgets.CallOutVideo({slidesRegion:"mixAlbumSlidesRegion"});this.changeResolution();new NewsWidgets.SimpleSwitchControl({cover:"mixAlbumCover",content:"mixAlbumContent",region:"mixAlbumRegion",slidesRegion:"mixAlbumSlidesRegion",prev:"mixAlbumPrev",next:"mixAlbumNext",page:"mixAlbumPage",jumpFirst:"jumpMixAlbumFirst",showThumbnail:"showThumbnail",thumbnails:"thumbnails",itemWidth:1000,duration:0.5,logRelatedType:51,logRelatedID:this.newsID,hashName:"feature"})}if($("dialogueCover")){var e=$("commentRightRegion");if(e){if(e.innerHTML.Trim().length==0){e.up().removeClassName("linksbox")}}new Widgets.CallOutVideo({slidesRegion:"dialogueCover"});this.changeResolution()}if($("dialogueRegion")){new NewsWidgets.SimpleSwitchControl({cover:"dialogueCover",content:"dialogueContent",region:"dialogueRegion",slidesRegion:"dialogueSlidesRegion",prev:"dialoguePrev",next:"dialogueNext",page:"dialoguePage",jumpFirst:"jumpDialogueFirst",itemWidth:1000,duration:0.5,logRelatedType:51,logRelatedID:this.newsID,hashName:"page"})}if($("db_videobox")){this.playNewsVideoList()}if($("pixSlidesRegion")){if(typeof galleryImages!="undefined"&&galleryImages.length>0){var g=location.hash;var r=1;var f=0;if(g.indexOf("#p")>-1){r=parseInt(g.replace(/#p/,""),10);if(r>0){f=r-1}}else{if(g.indexOf("#/image/")>-1){if(/^#\/image\/(\d+)$/.test(g)){imageID=parseInt(g.replace(/^#\/image\/(\d+)$/,"$1"),10)}for(var j=0;j<galleryImages.length;j++){if(galleryImages[j].ImageID==imageID){f=j}}}}this.currentImageID=galleryImages[f].ImageID;var o=new NewsWidgets.NewsPixSlidesControl({slidesRegion:"pixSlidesRegion",page:"pixPage",currentIndex:f,prev:"pixPrev",next:"pixNext",showThumbnail:"showPixThumbnail",showOriginal:"showPixOriginal",thumbnailRegion:"pixThumbnailRegion",commendRegion:"pixCommendRegion",replay:"pixReplay",duration:0.6,showLength:1,pixItems:galleryImages,autoTimeout:null,type:"detail",itemWidth:1000,pixTemplate:'<dd><img src="#{MiddlePicUrl}" alt="#{Title}" /></dd>',thumbnailTemplate:'<dd><a href="javascript:void(0);" Title="#{Title}"><img src="#{SmallPicUrl}" alt="#{Title}"></a></dd>',logRelatedType:51,logRelatedID:this.newsID,callback:this.getCurrentIndex.bind(this)})}}if($("storySlidesRegion")){var m=$("storyRegion").getElementsByTagName("img");for(var j=0;j<m.length;j++){var k=m[j],l;var b=$(k).up("span");if(b){l=document.createElement("img");l.onload=(function(i,v){return function(){i.up("span").style.marginTop=parseInt(590-v.height,10)/2+"px"}})(k,l).bind(this);l.src=k.src}}new Widgets.CallOutVideo({slidesRegion:"storySlidesRegion"});this.changeResolution();new NewsWidgets.StorySwitchControl({content:"storyContent",region:"storyRegion",slidesRegion:"storySlidesRegion",prev:"storyPrev",next:"storyNext",page:"storyPage",showThumbnail:"showThumbnail",thumbnails:"thumbnails",itemWidth:1000,duration:0.5,logRelatedType:51,logRelatedID:this.newsID,hashName:"story"})}if($("PageNavigator")){var d=$("PageNavigator").childNodes;for(var j=0;j<d.length;j++){var c=d[j];if($(c).hasAttribute("href")){if($(c).href.indexOf("-")>-1){$(c).href=$(c).href+"#content"}}}}if(this.commentBoxArea){$loadSubJs(["/js/CommentControl2014.js"],function(){this.commentControl=new CommentControl2014({commentObjId:this.newsID,cmsRelatedObjType:0,commentRegion:"commentRegion",allowAnonymousComment:allowAnonymousComment,isDetailPage:true,hasSynTwitterCheckbox:true,isStaticComment:true,moreCommentUrl:moreCommentUrl,addCommentCallback:this.server.addCmsNewsComment});if(synTwitter){$("synTwitterCheckbox").setAttribute("checked","checked")}var x=$("totalComments");var i=$("commentCount");var v=$("commentCount2");if(x){var w=parseInt(x.innerHTML,10);if(v){v.innerHTML=w;if(w==0){v.up().addClassName("none")}}}}.bind(this))}this.showTimeInfo=$("showTimeInfo");if(this.showTimeInfo){var s=this.showTimeInfo.getAttribute("pictype");if(!s){s="w"}this.server.getCMSNewsShowtimeInfo(this.newsID,function(x){if(x&&x.value&&x.value.Price){if(x.value.MovieShowStatus==1||x.value.MovieShowStatus==2){var i=new StringBuilder();var v=x.value.ButtonHref;var w="在线选座";if(x.value.MovieShowStatus==2){w="超前预售";v=x.value.movieshowtimepage}if(s=="w"){i.append(String.format('<a title="{0}/{1}" target="_blank" href="{2}"><img width="160" alt="{0}/{1}" src="{3}"></a>',x.value.TitleCn,x.value.TitleEn,x.value.CoverUrl,x.value.MovieCoverW160));i.append(String.format('<div class="price"><strong>{0}</strong><p>元起</p></div>',x.value.Price));i.append(String.format('<a class="ticket" target="_blank" href="{0}">{1}</a>',v,w))}else{i.append(String.format('<a title="{0}/{1}" target="_blank" href="{2}"><img alt="{0}/{1}" src="{3}"></a>',x.value.TitleCn,x.value.TitleEn,x.value.CoverUrl,x.value.MovieCoverW96));i.append(String.format('<h4><a href="{0}" target="_blank">{1}</a></h4>',x.value.CoverUrl,x.value.Title));if(x.value.Genres.length>0){i.append(String.format('<p class="mt9">类型：{0}</p>',x.value.Genres))}i.append(String.format('<div class="price">￥<strong>{0}</strong> 元起</div>',x.value.Price));i.append(String.format('<p class="mt9"><a href="{0}" target="_blank" class="ticket">{1}</a></p>',v,w))}this.showTimeInfo.innerHTML=i.toString();if(x.value.MovieShowStatus==2){this.showTimeInfo.addClassName("before")}this.showTimeInfo.removeClassName("none");if($("showTimeInfoBotton")){$("showTimeInfoBotton").show()}}}})}if(typeof newsRelatedMovieIds!="undefined"){var p;this.server.GetMovieRatingByMovieIds(newsRelatedMovieIds,function(i){if(i&&i.value){$A(i.value).each(function(v){p=$("newsRelatedMovieId_"+v.movieId);if(p){p.innerHTML=v.ratingFinal.toFixed(1);if(p.up()){var w=p.up();if(parseFloat(v.ratingFinal)>0){w.removeClassName("none")}else{w.addClassName("none")}}}})}}.bind(this))}if(typeof newsRelatedPersonIds!="undefined"){var q;this.server.GetPersonRatingByPersonIds(newsRelatedPersonIds,function(i){if(i&&i.value){$A(i.value).each(function(w){q=$("newsRelatedPersonId_"+w.personId);if(q){q.innerHTML="<i></i>"+parseFloat(w.ratingFinal.toFixed(1))*10+"%";if(q.up()){var v=q.up();if(parseFloat(w.ratingFinal)>0&&w.ratingCount>=10){v.removeClassName("none")}else{v.addClassName("none")}}}})}}.bind(this))}var t=$("storyRegion");if(t){if(window.GoodsPriceControl==undefined){$loadSubJs("/js/2014/GoodsPriceControl.js",function(){this.goodsPriceControl=new GoodsPriceControl({goodsRegionId:"goodsRegion",showTag:true,priceTemplate:"￥{0}",tagTemplate:'<i class="i_sg">{0}</i>'})}.bind(this))}else{this.goodsPriceControl=new GoodsPriceControl({goodsRegionId:"goodsRegion",showTag:true,priceTemplate:"￥{0}",tagTemplate:'<i class="i_sg">{0}</i>'})}}var n=$("newsECommerceInfo");if(n){$loadSubJs(["/ECommerce/GoodsAndFeatureCtrl.js"],function(){this.goodsAndFeatureCtrl=new GoodsAndFeatureCtrl({showRegionId:"newsECommerceInfo",relatedObjType:51,relatedId:this.newsID,showCount:5,onlyShowFeature:(typeof onlyShowFeature=="undefined")?false:onlyShowFeature})}.bind(this))}this.showMoreGoods=$("showMoreGoods");if(this.showMoreGoods){this.onClickShowMoreGoodsHandler=this.onClickShowMoreGoods.bind(this);this.showMoreGoods&&this.showMoreGoods.observe("click",this.onClickShowMoreGoodsHandler)}},onClickShowMoreGoods:function(a){var b=$("showMoreGoods");b.up().previous().style.height="";b.hide()},getCurrentIndex:function(a){location.href="#p"+(a+1);this.currentImageID=galleryImages[a].ImageID;if(typeof(this.shareCtrl.shareControlManager)!="undefined"&&this.shareCtrl.shareControlManager!=null&&this.shareCtrl.shareControlManager.length>0&&this.shareCtrl.shareControlManager[0].imageId){this.shareCtrl.shareControlManager[0].imageId=galleryImages[a].ImageID}},changeResolution:function(){var a=$("jumpDialogueFirst");if(!a){a=$("jumpMixAlbumFirst")}if(a){if(document.documentElement.clientWidth<=1024){a.style.right="0px"}else{a.style.right=""}}},onClickNewsContent:function(b){var a=Event.element(b);if(a!=document&&a.up("div").hasAttribute("method")){var g=a.up("div").readAttribute("method");if(g=="imgtool"){var c=a;if(a.tagName=="EM"){c=a.previous();if(c.tagName!="IMG"){c=c.down("img")}}if(!c.up("div").up("div").hasClassName("divopen")){c.style.width="620px";var f=c.up("div").up("div");f.addClassName("divopen");f.style.zIndex=10;var h=f.next("p");var d=c.up("div").down("div");var e=d.down("p");if(d){if(Mtime.browser.ie===0||Mtime.browser.ie>9){d.show()}window.setTimeout(function(){if(e&&h){e.innerHTML=h.innerHTML}d.style.opacity=1;if(Mtime.browser.ie<0||Mtime.browser.ie<=9){d.show()}},400)}}else{c.style.width="310px";var f=c.up("div").up("div");f.removeClassName("divopen");f.style.zIndex=2;var d=c.up("div").down("div");if(d){d.style.opacity=0;d.hide()}}}}},pageNavigatorOver:function(d,a){var b=d?Event.element(d):a;if(b.hasClassName("on")||b.hasClassName("num")){var c=this.getXY(b);if(this.newsPageTitle&&pageTitles){this.newsPageTitle.style.top=(c.y-42)+"px";this.newsPageTitle.style.left=(c.x-294)+"px";var e=b.text||b.innerHTML;if(pageTitles[e]){this.newsPageTitle.innerHTML=pageTitles[e]+'<i class="pagenavtag"></i>';this.newsPageTitle.show()}}}if(d){Event.stop(d)}},onClickShowMoreRelatedInfos:function(){if(this.relatedInfos){this.relatedInfos.getElementsBySelector("dd").each(function(a){a.show()})}if(this.showMoreRelatedInfos){this.showMoreRelatedInfos.remove()}},playNewsVideoList:function(){var a=new NewsWidgets.NewsVideoListTopVideoControl({container:"db_videobox",topVideoContainer:"db_videoinner",playBtn:"playbtn",topVideoList:"topvideolist",playerContainer:"playercontainer",isNewsVideo:true})},close:function(){this.destroyControl();this.destroyEvent();this.destroyDOM()},getXY:function(e){var f=0,g=0;if(e.getBoundingClientRect){var c=e.getBoundingClientRect();var d=document.documentElement;f=c.left+Math.max(d.scrollLeft,document.body.scrollLeft)-d.clientLeft;g=c.top+Math.max(d.scrollTop,document.body.scrollTop)-d.clientTop}else{for(;e!=document.body;f+=e.offsetLeft,g+=e.offsetTop,e=e.offsetParent){}}return{x:f,y:g}}});