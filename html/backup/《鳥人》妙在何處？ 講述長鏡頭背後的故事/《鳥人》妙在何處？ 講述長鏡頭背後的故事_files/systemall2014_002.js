var Prototype={Version:"1.5.1.1",Description:"Prototype JavaScript framework, version 1.5.1.1 (c) 2005-2007 Sam Stephenson,Prototype is freely distributable under the terms of an MIT-style license.For details, see the Prototype web site: http://www.prototypejs.org/",Browser:{IE:!!(window.attachEvent&&!window.opera),Opera:!!window.opera,WebKit:navigator.userAgent.indexOf("AppleWebKit/")>-1,iPhone:navigator.userAgent.indexOf("iPhone")>-1,iPad:navigator.userAgent.indexOf("iPad")>-1,iPod:navigator.userAgent.indexOf("iPod")>-1,Gecko:navigator.userAgent.indexOf("Gecko")>-1&&navigator.userAgent.indexOf("KHTML")==-1},BrowserFeatures:{XPath:!!document.evaluate,ElementExtensions:!!window.HTMLElement,SpecificElementExtensions:(document.createElement("div").__proto__!==document.createElement("form").__proto__)},ScriptFragment:"<script[^>]*>([\\S\\s]*?)</script>",JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(b){return b}};var Class={create:function(){return function(){this.initialize.apply(this,arguments)}}};var Abstract=new Object();Object.extend=function(d,g){for(var f in g){d[f]=g[f]}return d};Object.extend(Object,{inspect:function(d){try{if(d===undefined){return"undefined"}if(d===null){return"null"}return d.inspect?d.inspect():d.toString()}catch(c){if(c instanceof RangeError){return"..."}throw c}},toJSON:function(g){var k=typeof g;switch(k){case"undefined":case"function":case"unknown":return;case"boolean":return g.toString()}if(g===null){return"null"}if(g.toJSON){return g.toJSON()}if(g.ownerDocument===document){return}var j=[];for(var h in g){var l=Object.toJSON(g[h]);if(l!==undefined){j.push(h.toJSON()+": "+l)}}return"{"+j.join(", ")+"}"},keys:function(f){var d=[];for(var g in f){d.push(g)}return d},values:function(d){var g=[];for(var f in d){g.push(d[f])}return g},clone:function(b){return Object.extend({},b)}});Function.prototype.bind=function(){var d=this,f=$A(arguments),g=f.shift();return function(){return d.apply(g,f.concat($A(arguments)))}};Function.prototype.bindAsEventListener=function(g){var d=this,f=$A(arguments),g=f.shift();return function(a){return d.apply(g,[a||window.event].concat(f))}};Object.extend(Number.prototype,{toColorPart:function(){return this.toPaddedString(2,16)},succ:function(){return this+1},times:function(b){$R(0,this,true).each(b);return this},toPaddedString:function(d,f){var g=this.toString(f||10);return"0".times(d-g.length)+g},toJSON:function(){return isFinite(this)?this.toString():"null"}});Date.prototype.toJSON=function(){return'"'+this.getFullYear()+"-"+(this.getMonth()+1).toPaddedString(2)+"-"+this.getDate().toPaddedString(2)+"T"+this.getHours().toPaddedString(2)+":"+this.getMinutes().toPaddedString(2)+":"+this.getSeconds().toPaddedString(2)+'"'};var Try={these:function(){var l;for(var h=0,k=arguments.length;h<k;h++){var j=arguments[h];try{l=j();break}catch(g){}}return l}};var PeriodicalExecuter=Class.create();PeriodicalExecuter.prototype={initialize:function(c,d){this.callback=c;this.frequency=d;this.currentlyExecuting=false;this.registerCallback()},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),this.frequency*1000)},stop:function(){if(!this.timer){return}clearInterval(this.timer);this.timer=null},onTimerEvent:function(){if(!this.currentlyExecuting){try{this.currentlyExecuting=true;this.callback(this)}finally{this.currentlyExecuting=false}}}};Object.extend(String,{interpret:function(b){return b==null?"":String(b)},specialChar:{"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","\\":"\\\\"}});Object.extend(String.prototype,{gsub:function(h,j){var k="",l=this,g;j=arguments.callee.prepareReplacement(j);while(l.length>0){if(g=l.match(h)){k+=l.slice(0,g.index);k+=String.interpret(j(g));l=l.slice(g.index+g[0].length)}else{k+=l,l=""}}return k},sub:function(f,g,d){g=this.gsub.prepareReplacement(g);d=d===undefined?1:d;return this.gsub(f,function(a){if(--d<0){return a[0]}return g(a)})},scan:function(d,c){this.gsub(d,c);return this},truncate:function(c,d){c=c||30;d=d===undefined?"...":d;return this.length>c?this.slice(0,c-d.length)+d:this},strip:function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")},stripTags:function(){return this.replace(/<\/?[^>]+>/gi,"")},stripScripts:function(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")},extractScripts:function(){var c=new RegExp(Prototype.ScriptFragment,"img");var d=new RegExp(Prototype.ScriptFragment,"im");return(this.match(c)||[]).map(function(a){return(a.match(d)||["",""])[1]})},evalScripts:function(){return this.extractScripts().map(function(script){return eval(script)})},escapeHTML:function(){var b=arguments.callee;b.text.data=this;return b.div.innerHTML},unescapeHTML:function(){var b=document.createElement("div");b.innerHTML=this.stripTags();return b.childNodes[0]?(b.childNodes.length>1?$A(b.childNodes).inject("",function(a,d){return a+d.nodeValue}):b.childNodes[0].nodeValue):""},toQueryParams:function(d){var c=this.strip().match(/([^?#]*)(#.*)?$/);if(!c){return{}}return c[1].split(d||"&").inject({},function(a,h){if((h=h.split("="))[0]){var b=decodeURIComponent(h.shift());var j=h.length>1?h.join("="):h[0];if(j!=undefined){j=decodeURIComponent(j)}if(b in a){if(a[b].constructor!=Array){a[b]=[a[b]]}a[b].push(j)}else{a[b]=j}}return a})},toArray:function(){return this.split("")},succ:function(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)},times:function(d){var g="";for(var f=0;f<d;f++){g+=this}return g},camelize:function(){var j=this.split("-"),h=j.length;if(h==1){return j[0]}var f=this.charAt(0)=="-"?j[0].charAt(0).toUpperCase()+j[0].substring(1):j[0];for(var g=1;g<h;g++){f+=j[g].charAt(0).toUpperCase()+j[g].substring(1)}return f},capitalize:function(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()},underscore:function(){return this.gsub(/::/,"/").gsub(/([A-Z]+)([A-Z][a-z])/,"#{1}_#{2}").gsub(/([a-z\d])([A-Z])/,"#{1}_#{2}").gsub(/-/,"_").toLowerCase()},dasherize:function(){return this.gsub(/_/,"-")},inspect:function(d){var c=this.gsub(/[\x00-\x1f\\]/,function(b){var a=String.specialChar[b[0]];return a?a:"\\u00"+b[0].charCodeAt().toPaddedString(2,16)});if(d){return'"'+c.replace(/"/g,'\\"')+'"'}return"'"+c.replace(/'/g,"\\'")+"'"},toJSON:function(){return this.inspect(true)},unfilterJSON:function(b){return this.sub(b||Prototype.JSONFilter,"#{1}")},isJSON:function(){var b=this.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"/g,"");return(/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/).test(b)},evalJSON:function(sanitize){var json=this.unfilterJSON();try{if(!sanitize||json.isJSON()){return eval("("+json+")")}}catch(e){}throw new SyntaxError("Badly formed JSON string: "+this.inspect())},include:function(b){return this.indexOf(b)>-1},startsWith:function(b){return this.indexOf(b)===0},endsWith:function(d){var c=this.length-d.length;return c>=0&&this.lastIndexOf(d)===c},empty:function(){return this==""},blank:function(){return/^\s*$/.test(this)}});String.prototype.gsub.prepareReplacement=function(c){if(typeof c=="function"){return c}var d=new Template(c);return function(a){return d.evaluate(a)}};String.prototype.parseQuery=String.prototype.toQueryParams;Object.extend(String.prototype.escapeHTML,{div:document.createElement("div"),text:document.createTextNode("")});with(String.prototype.escapeHTML){div.appendChild(text)}var Template=Class.create();Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;Template.prototype={initialize:function(d,c){this.template=d.toString();this.pattern=c||Template.Pattern},evaluate:function(b){return this.template.gsub(this.pattern,function(d){var a=d[1];if(a=="\\"){return d[2]}return a+String.interpret(b[d[3]])})}};var $break={},$continue=new Error('"throw $continue" is deprecated, use "return" instead');var Enumerable={each:function(g){var f=0;try{this._each(function(a){g(a,f++)})}catch(d){if(d!=$break){throw d}}return this},eachSlice:function(k,j){var h=-k,l=[],g=this.toArray();while((h+=k)<g.length){l.push(g.slice(h,h+k))}return l.map(j)},all:function(c){var d=true;this.each(function(b,a){d=d&&!!(c||Prototype.K)(b,a);if(!d){throw $break}});return d},any:function(c){var d=false;this.each(function(b,a){if(d=!!(c||Prototype.K)(b,a)){throw $break}});return d},collect:function(c){var d=[];this.each(function(b,a){d.push((c||Prototype.K)(b,a))});return d},detect:function(c){var d;this.each(function(b,a){if(c(b,a)){d=b;throw $break}});return d},findAll:function(c){var d=[];this.each(function(b,a){if(c(b,a)){d.push(b)}});return d},grep:function(f,d){var g=[];this.each(function(c,a){var b=c.toString();if(b.match(f)){g.push((d||Prototype.K)(c,a))}});return g},include:function(d){var c=false;this.each(function(a){if(a==d){c=true;throw $break}});return c},inGroupsOf:function(d,c){c=c===undefined?null:c;return this.eachSlice(d,function(a){while(a.length<d){a.push(c)}return a})},inject:function(d,c){this.each(function(b,a){d=c(d,b,a)});return d},invoke:function(d){var c=$A(arguments).slice(1);return this.map(function(a){return a[d].apply(a,c)})},max:function(c){var d;this.each(function(b,a){b=(c||Prototype.K)(b,a);if(d==undefined||b>=d){d=b}});return d},min:function(c){var d;this.each(function(b,a){b=(c||Prototype.K)(b,a);if(d==undefined||b<d){d=b}});return d},partition:function(f){var g=[],d=[];this.each(function(b,a){((f||Prototype.K)(b,a)?g:d).push(b)});return[g,d]},pluck:function(c){var d=[];this.each(function(b,a){d.push(b[c])});return d},reject:function(c){var d=[];this.each(function(b,a){if(!c(b,a)){d.push(b)}});return d},sortBy:function(b){return this.map(function(d,a){return{value:d,criteria:b(d,a)}}).sort(function(j,k){var a=j.criteria,h=k.criteria;return a<h?-1:a>h?1:0}).pluck("value")},toArray:function(){return this.map()},zip:function(){var g=Prototype.K,d=$A(arguments);if(typeof d.last()=="function"){g=d.pop()}var f=[this].concat(d).map($A);return this.map(function(b,a){return g(f.pluck(a))})},size:function(){return this.toArray().length},inspect:function(){return"#<Enumerable:"+this.toArray().inspect()+">"}};Object.extend(Enumerable,{map:Enumerable.collect,find:Enumerable.detect,select:Enumerable.findAll,member:Enumerable.include,entries:Enumerable.toArray});var $A=Array.from=function(g){if(!g){return[]}if(g.toArray){return g.toArray()}else{var j=[];for(var f=0,h=g.length;f<h;f++){j.push(g[f])}return j}};if(Prototype.Browser.WebKit){$A=Array.from=function(g){if(!g){return[]}if(!(typeof g=="function"&&g=="[object NodeList]")&&g.toArray){return g.toArray()}else{var j=[];for(var f=0,h=g.length;f<h;f++){j.push(g[f])}return j}}}Object.extend(Array.prototype,Enumerable);if(!Array.prototype._reverse){Array.prototype._reverse=Array.prototype.reverse}Object.extend(Array.prototype,{_each:function(f){for(var d=0,g=this.length;d<g;d++){f(this[d])}},clear:function(){this.length=0;return this},first:function(){return this[0]},last:function(){return this[this.length-1]},compact:function(){return this.select(function(b){return b!=null})},flatten:function(){return this.inject([],function(c,d){return c.concat(d&&d.constructor==Array?d.flatten():[d])})},without:function(){var b=$A(arguments);return this.select(function(a){return !b.include(a)})},indexOf:function(g){for(var d=0,f=this.length;d<f;d++){if(this[d]==g){return d}}return -1},reverse:function(b){return(b!==false?this:this.toArray())._reverse()},reduce:function(){return this.length>1?this:this[0]},uniq:function(b){return this.inject([],function(a,g,f){if(0==f||(b?a.last()!=g:!a.include(g))){a.push(g)}return a})},clone:function(){return[].concat(this)},size:function(){return this.length},inspect:function(){return"["+this.map(Object.inspect).join(", ")+"]"},toJSON:function(){var b=[];this.each(function(a){var d=Object.toJSON(a);if(d!==undefined){b.push(d)}});return"["+b.join(", ")+"]"}});Array.prototype.toArray=Array.prototype.clone;function $w(b){b=b.strip();return b?b.split(/\s+/):[]}if(Prototype.Browser.Opera){Array.prototype.concat=function(){var g=[];for(var j=0,l=this.length;j<l;j++){g.push(this[j])}for(var j=0,l=arguments.length;j<l;j++){if(arguments[j].constructor==Array){for(var k=0,h=arguments[j].length;k<h;k++){g.push(arguments[j][k])}}else{g.push(arguments[j])}}return g}}var Hash=function(b){if(b instanceof Hash){this.merge(b)}else{Object.extend(this,b||{})}};Object.extend(Hash,{toQueryString:function(c){var d=[];d.add=arguments.callee.addPair;this.prototype._each.call(c,function(a){if(!a.key){return}var b=a.value;if(b&&typeof b=="object"){if(b.constructor==Array){b.each(function(g){d.add(a.key,g)})}return}d.add(a.key,b)});return d.join("&")},toJSON:function(c){var d=[];this.prototype._each.call(c,function(a){var b=Object.toJSON(a.value);if(b!==undefined){d.push(a.key.toJSON()+": "+b)}});return"{"+d.join(", ")+"}"}});Hash.toQueryString.addPair=function(d,g,f){d=encodeURIComponent(d);if(g===undefined){this.push(d)}else{this.push(d+"="+(g==null?"":encodeURIComponent(g)))}};Object.extend(Hash.prototype,Enumerable);Object.extend(Hash.prototype,{_each:function(f){for(var g in this){var j=this[g];if(j&&j==Hash.prototype[g]){continue}var h=[g,j];h.key=g;h.value=j;f(h)}},keys:function(){return this.pluck("key")},values:function(){return this.pluck("value")},merge:function(b){return $H(b).inject(this,function(a,d){a[d.key]=d.value;return a})},remove:function(){var h;for(var f=0,g=arguments.length;f<g;f++){var j=this[arguments[f]];if(j!==undefined){if(h===undefined){h=j}else{if(h.constructor!=Array){h=[h]}h.push(j)}}delete this[arguments[f]]}return h},toQueryString:function(){return Hash.toQueryString(this)},inspect:function(){return"#<Hash:{"+this.map(function(b){return b.map(Object.inspect).join(": ")}).join(", ")+"}>"},toJSON:function(){return Hash.toJSON(this)}});function $H(b){if(b instanceof Hash){return b}return new Hash(b)}if(function(){var d=0,g=function(a){this.key=a};g.prototype.key="foo";for(var f in new g("bar")){d++}return d>1}()){Hash.prototype._each=function(h){var g=[];for(var j in this){var l=this[j];if((l&&l==Hash.prototype[j])||g.include(j)){continue}g.push(j);var k=[j,l];k.key=j;k.value=l;h(k)}}}ObjectRange=Class.create();Object.extend(ObjectRange.prototype,Enumerable);Object.extend(ObjectRange.prototype,{initialize:function(g,d,f){this.start=g;this.end=d;this.exclusive=f},_each:function(c){var d=this.start;while(this.include(d)){c(d);d=d.succ()}},include:function(b){if(b<this.start){return false}if(this.exclusive){return b<this.end}return b<=this.end}});var $R=function(g,d,f){return new ObjectRange(g,d,f)};var Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||false},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(b){this.responders._each(b)},register:function(b){if(!this.include(b)){this.responders.push(b)}},unregister:function(b){this.responders=this.responders.without(b)},dispatch:function(f,h,j,g){this.each(function(b){if(typeof b[f]=="function"){try{b[f].apply(b,[h,j,g])}catch(a){}}})}};Object.extend(Ajax.Responders,Enumerable);Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}});Ajax.Base=function(){};Ajax.Base.prototype={setOptions:function(b){this.options={Origin:"mtime.com",method:"post",asynchronous:true,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:""};Object.extend(this.options,b||{});this.options.method=this.options.method.toLowerCase();if(typeof this.options.parameters=="string"){this.options.parameters=this.options.parameters.toQueryParams()}}};Ajax.Request=Class.create();Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];Ajax.Request.prototype=Object.extend(new Ajax.Base(),{_complete:false,initialize:function(d,c){this.transport=Ajax.getTransport();this.setOptions(c);this.request(d)},request:function(g){this.url=g;this.method=this.options.method;var f=Object.clone(this.options.parameters);if(!["get","post"].include(this.method)){f._method=this.method;this.method="post"}this.parameters=f;if(f=Hash.toQueryString(f)){if(this.method=="get"){this.url+=(this.url.include("?")?"&":"?")+f}else{if(/Konqueror|Safari|KHTML/.test(navigator.userAgent)){f+="&_="}}}try{if(this.options.onCreate){this.options.onCreate(this.transport)}Ajax.Responders.dispatch("onCreate",this,this.transport);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.asynchronous){setTimeout(function(){this.respondToReadyState(1)}.bind(this),10)}this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=this.method=="post"?(this.options.postBody||f):null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType){this.onStateChange()}}catch(d){this.dispatchException(d)}},onStateChange:function(){var b=this.transport.readyState;if(b>1&&!((b==4)&&this._complete)){this.respondToReadyState(this.transport.readyState)}},setRequestHeaders:function(){var h={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":Prototype.Version,Accept:"text/javascript, text/html, application/xml, text/xml, */*"};if(this.method=="post"){h["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:"");if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005){h.Connection="close"}}if(typeof this.options.requestHeaders=="object"){var g=this.options.requestHeaders;if(typeof g.push=="function"){for(var j=0,k=g.length;j<k;j+=2){h[g[j]]=g[j+1]}}else{$H(g).each(function(a){h[a.key]=a.value})}}for(var l in h){this.transport.setRequestHeader(l,h[l])}},success:function(){return !this.transport.status||(this.transport.status>=200&&this.transport.status<300)},respondToReadyState:function(j){var k=Ajax.Request.Events[j];var l=this.transport,h=this.evalJSON();if(k=="Complete"){try{this._complete=true;(this.options["on"+this.transport.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(l,h)}catch(g){this.dispatchException(g)}}try{(this.options["on"+k]||Prototype.emptyFunction)(l,h,this.options);Ajax.Responders.dispatch("on"+k,this,l,h)}catch(g){this.dispatchException(g)}if(k=="Complete"){this.transport.onreadystatechange=Prototype.emptyFunction}},getHeader:function(d){try{return this.transport.getResponseHeader(d)}catch(c){return null}},evalJSON:function(){try{var d=this.getHeader("X-JSON");return d?d.evalJSON():null}catch(c){return null}},evalResponse:function(){try{return eval((this.transport.responseText||"").unfilterJSON())}catch(e){this.dispatchException(e)}},dispatchException:function(b){(this.options.onException||Prototype.emptyFunction)(this,b);Ajax.Responders.dispatch("onException",this,b)}});function $(f){if(arguments.length>1){for(var h=0,g=[],j=arguments.length;h<j;h++){g.push($(arguments[h]))}return g}if(typeof f=="string"){f=document.getElementById(f)}return Element.extend(f)}if(!window.Element){var Element={}}Element.extend=function(l){var m=Prototype.BrowserFeatures;if(!l||!l.tagName||l.nodeType==3||l._extended||m.SpecificElementExtensions||l==window){return l}var n={},q=l.tagName,k=Element.extend.cache,p=Element.Methods.ByTag;if(!m.ElementExtensions){Object.extend(n,Element.Methods),Object.extend(n,Element.Methods.Simulated)}if(p[q]){Object.extend(n,p[q])}for(var o in n){var r=n[o];if(typeof r=="function"&&!(o in l)){l[o]=k.findOrStore(r)}}l._extended=Prototype.emptyFunction;return l};Element.extend.cache={findOrStore:function(b){return this[b]=this[b]||function(){return b.apply(null,[this].concat($A(arguments)))}}};Element.Methods={visible:function(b){return $(b).style.display!="none"},toggle:function(b){b=$(b);Element[Element.visible(b)?"hide":"show"](b);return b},hide:function(b){$(b).style.display="none";return b},show:function(b){$(b).style.display="";return b},remove:function(b){b=$(b);b.parentNode.removeChild(b);return b},update:function(c,d){d=typeof d=="undefined"?"":d.toString();$(c).innerHTML=d.stripScripts();setTimeout(function(){d.evalScripts()},10);return c},replace:function(d,f){d=$(d);f=typeof f=="undefined"?"":f.toString();if(d.outerHTML){d.outerHTML=f.stripScripts()}else{var g=d.ownerDocument.createRange();g.selectNodeContents(d);d.parentNode.replaceChild(g.createContextualFragment(f.stripScripts()),d)}setTimeout(function(){f.evalScripts()},10);return d},inspect:function(c){c=$(c);var d="<"+c.tagName.toLowerCase();$H({id:"id",className:"class"}).each(function(b){var h=b.first(),a=b.last();var j=(c[h]||"").toString();if(j){d+=" "+a+"="+j.inspect(true)}});return d+">"},recursivelyCollect:function(d,g){d=$(d);var f=[];while(d=d[g]){if(d.nodeType==1){f.push(Element.extend(d))}}return f},ancestors:function(b){return $(b).recursivelyCollect("parentNode")},descendants:function(b){return $A($(b).getElementsByTagName("*")).each(Element.extend)},firstDescendant:function(b){b=$(b).firstChild;while(b&&b.nodeType!=1){b=b.nextSibling}return $(b)},immediateDescendants:function(b){if(!(b=$(b).firstChild)){return[]}while(b&&b.nodeType!=1){b=b.nextSibling}if(b){return[b].concat($(b).nextSiblings())}return[]},previousSiblings:function(b){return $(b).recursivelyCollect("previousSibling")},nextSiblings:function(b){return $(b).recursivelyCollect("nextSibling")},siblings:function(b){b=$(b);return b.previousSiblings().reverse().concat(b.nextSiblings())},match:function(c,d){if(typeof d=="string"){d=new Selector(d)}return d.match($(c))},up:function(g,h,j){g=$(g);if(arguments.length==1){return $(g.parentNode)}var f=g.ancestors();return h?Selector.findElement(f,h,j):f[j||0]},down:function(g,h,j){g=$(g);if(arguments.length==1){return g.firstDescendant()}var f=g.descendants();return h?Selector.findElement(f,h,j):f[j||0]},previous:function(f,g,h){f=$(f);if(arguments.length==1){return $(Selector.handlers.previousElementSibling(f))}var j=f.previousSiblings();return g?Selector.findElement(j,g,h):j[h||0]},next:function(f,g,h){f=$(f);if(arguments.length==1){return $(Selector.handlers.nextElementSibling(f))}var j=f.nextSiblings();return g?Selector.findElement(j,g,h):j[h||0]},getElementsBySelector:function(){var c=$A(arguments),d=$(c.shift());return Selector.findChildElements(d,c)},readAttribute:function(g,h){g=$(g);if(Prototype.Browser.IE){if(!g.attributes){return null}var j=Element._attributeTranslations;if(j.values[h]){return j.values[h](g,h)}if(j.names[h]){h=j.names[h]}var f=g.attributes[h];return f?f.nodeValue:null}return g.getAttribute(h)},getHeight:function(b){return $(b).getDimensions().height},getWidth:function(b){return $(b).getDimensions().width},classNames:function(b){return new Element.ClassNames(b)},hasClassName:function(f,d){if(!(f=$(f))){return}var g=f.className;if(g.length==0){return false}if(g==d||g.match(new RegExp("(^|\\s)"+d+"(\\s|$)"))){return true}return false},addClassName:function(d,c){if(!(d=$(d))){return}Element.classNames(d).add(c);return d},removeClassName:function(d,c){if(!(d=$(d))){return}Element.classNames(d).remove(c);return d},toggleClassName:function(d,c){if(!(d=$(d))){return}Element.classNames(d)[d.hasClassName(c)?"remove":"add"](c);return d},observe:function(){Event.observe.apply(Event,arguments);return $A(arguments).first()},stopObserving:function(){Event.stopObserving.apply(Event,arguments);return $A(arguments).first()},cleanWhitespace:function(d){d=$(d);var g=d.firstChild;while(g){var f=g.nextSibling;if(g.nodeType==3&&!/\S/.test(g.nodeValue)){d.removeChild(g)}g=f}return d},empty:function(b){return $(b).innerHTML.blank()},descendantOf:function(d,c){d=$(d),c=$(c);while(d=d.parentNode){if(d==c){return true}}return false},scrollTo:function(c){c=$(c);var d=Position.cumulativeOffset(c);window.scrollTo(d[0],d[1]);return c},getStyle:function(g,h){g=$(g);h=h=="float"?"cssFloat":h.camelize();var j=g.style[h];if(!j){var f=document.defaultView.getComputedStyle(g,null);j=f?f[h]:null}if(h=="opacity"){return j?parseFloat(j):1}return j=="auto"?null:j},getOpacity:function(b){return $(b).getStyle("opacity")},setStyle:function(h,l,g){h=$(h);var j=h.style;for(var k in l){if(k=="opacity"){h.setOpacity(l[k])}else{j[(k=="float"||k=="cssFloat")?(j.styleFloat===undefined?"cssFloat":"styleFloat"):(g?k:k.camelize())]=l[k]}}return h},setOpacity:function(c,d){c=$(c);c.style.opacity=(d==1||d==="")?"":(d<1e-05)?0:d;return c},getDimensions:function(l){l=$(l);var k=$(l).getStyle("display");if(k!="none"&&k!=null){return{width:l.offsetWidth,height:l.offsetHeight}}var m=l.style;var q=m.visibility;var p=m.position;var n=m.display;m.visibility="hidden";m.position="absolute";m.display="block";var r=l.clientWidth;var o=l.clientHeight;m.display=n;m.position=p;m.visibility=q;return{width:r,height:o}},makePositioned:function(c){c=$(c);var d=Element.getStyle(c,"position");if(d=="static"||!d){c._madePositioned=true;c.style.position="relative";if(window.opera){c.style.top=0;c.style.left=0}}return c},undoPositioned:function(b){b=$(b);if(b._madePositioned){b._madePositioned=undefined;b.style.position=b.style.top=b.style.left=b.style.bottom=b.style.right=""}return b},makeClipping:function(b){b=$(b);if(b._overflow){return b}b._overflow=b.style.overflow||"auto";if((Element.getStyle(b,"overflow")||"visible")!="hidden"){b.style.overflow="hidden"}return b},undoClipping:function(b){b=$(b);if(!b._overflow){return b}b.style.overflow=b._overflow=="auto"?"":b._overflow;b._overflow=null;return b}};Object.extend(Element.Methods,{childOf:Element.Methods.descendantOf,childElements:Element.Methods.immediateDescendants});if(Prototype.BrowserFeatures.XPath){document._getElementsByXPath=function(h,l){var n=[];var m=document.evaluate(h,$(l)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(var j=0,k=m.snapshotLength;j<k;j++){n.push(m.snapshotItem(j))}return n}}if(!document.getElementsByClassName){if(Prototype.BrowserFeatures.XPath){document.getElementsByClassName=function(d,f){var g=".//*[contains(concat(' ', @class, ' '), ' "+d+" ')]";return document._getElementsByXPath(g,f)}}else{document.getElementsByClassName=function(n,s){var m=($(s)||document.body).getElementsByTagName("*");var p=[],l,t=new RegExp("(^|\\s)"+n+"(\\s|$)");for(var q=0,r=m.length;q<r;q++){l=m[q];var o=l.className;if(o.length==0){continue}if(o==n||o.match(t)){p.push(Element.extend(l))}}return p}}Object.extend(Element.Methods,{getElementsByClassName:function(d,c){return document.getElementsByClassName(c,d)}})}if(Prototype.Browser.Opera){Element.Methods._getStyle=Element.Methods.getStyle;Element.Methods.getStyle=function(c,d){switch(d){case"left":case"top":case"right":case"bottom":if(Element._getStyle(c,"position")=="static"){return null}default:return Element._getStyle(c,d)}}}else{if(Prototype.Browser.IE){Element.Methods.getStyle=function(d,f){d=$(d);f=(f=="float"||f=="cssFloat")?"styleFloat":f.camelize();var g=d.style[f];if(!g&&d.currentStyle){g=d.currentStyle[f]}if(f=="opacity"){if(g=(d.getStyle("filter")||"").match(/alpha\(opacity=(.*)\)/)){if(g[1]){return parseFloat(g[1])/100}}return 1}if(g=="auto"){if((f=="width"||f=="height")&&(d.getStyle("display")!="none")){return d["offset"+f.capitalize()]+"px"}return null}return g};Element.Methods.setOpacity=function(f,j){f=$(f);var g=f.getStyle("filter"),h=f.style;if(j==1||j===""){h.filter=g.replace(/alpha\([^\)]*\)/gi,"");return f}else{if(j<1e-05){j=0}}h.filter=g.replace(/alpha\([^\)]*\)/gi,"")+"alpha(opacity="+(j*100)+")";return f};Element.Methods.update=function(g,h){g=$(g);h=typeof h=="undefined"?"":h.toString();var j=g.tagName.toUpperCase();if(["THEAD","TBODY","TR","TD"].include(j)){var f=document.createElement("div");switch(j){case"THEAD":case"TBODY":f.innerHTML="<table><tbody>"+h.stripScripts()+"</tbody></table>";depth=2;break;case"TR":f.innerHTML="<table><tbody><tr>"+h.stripScripts()+"</tr></tbody></table>";depth=3;break;case"TD":f.innerHTML="<table><tbody><tr><td>"+h.stripScripts()+"</td></tr></tbody></table>";depth=4}$A(g.childNodes).each(function(a){g.removeChild(a)});depth.times(function(){f=f.firstChild});$A(f.childNodes).each(function(a){g.appendChild(a)})}else{g.innerHTML=h.stripScripts()}setTimeout(function(){h.evalScripts()},10);return g}}else{if(Prototype.Browser.Gecko){Element.Methods.setOpacity=function(c,d){c=$(c);c.style.opacity=(d==1)?0.999999:(d==="")?"":(d<1e-05)?0:d;return c}}}}Element._attributeTranslations={names:{colspan:"colSpan",rowspan:"rowSpan",valign:"vAlign",datetime:"dateTime",accesskey:"accessKey",tabindex:"tabIndex",enctype:"encType",maxlength:"maxLength",readonly:"readOnly",longdesc:"longDesc"},values:{_getAttr:function(d,c){return d.getAttribute(c,2)},_flag:function(d,c){return $(d).hasAttribute(c)?c:null},style:function(b){return b.style.cssText.toLowerCase()},title:function(c){var d=c.getAttributeNode("title");return d.specified?d.nodeValue:null}}};(function(){Object.extend(this,{href:this._getAttr,src:this._getAttr,type:this._getAttr,disabled:this._flag,checked:this._flag,readonly:this._flag,multiple:this._flag})}).call(Element._attributeTranslations.values);Element.Methods.Simulated={hasAttribute:function(g,f){var j=Element._attributeTranslations,h;f=j.names[f]||f;h=$(g).getAttributeNode(f);return h&&h.specified}};Element.Methods.ByTag={};Object.extend(Element,Element.Methods);if(!Prototype.BrowserFeatures.ElementExtensions&&document.createElement("div").__proto__){window.HTMLElement={};window.HTMLElement.prototype=document.createElement("div").__proto__;Prototype.BrowserFeatures.ElementExtensions=true}Element.hasAttribute=function(d,c){if(d.hasAttribute){return d.hasAttribute(c)}return Element.Methods.Simulated.hasAttribute(d,c)};Element.addMethods=function(q){var n=Prototype.BrowserFeatures,r=Element.Methods.ByTag;if(!q){Object.extend(Form,Form.Methods);Object.extend(Form.Element,Form.Element.Methods);Object.extend(Element.Methods.ByTag,{FORM:Object.clone(Form.Methods),INPUT:Object.clone(Form.Element.Methods),SELECT:Object.clone(Form.Element.Methods),TEXTAREA:Object.clone(Form.Element.Methods)})}if(arguments.length==2){var t=q;q=arguments[1]}if(!t){Object.extend(Element.Methods,q||{})}else{if(t.constructor==Array){t.each(m)}else{m(t)}}function m(a){a=a.toUpperCase();if(!Element.Methods.ByTag[a]){Element.Methods.ByTag[a]={}}Object.extend(Element.Methods.ByTag[a],q)}function l(c,b,d){d=d||false;var a=Element.extend.cache;for(var f in c){var g=c[f];if(!d||!(f in b)){b[f]=a.findOrStore(g)}}}function o(b){var a;var c={OPTGROUP:"OptGroup",TEXTAREA:"TextArea",P:"Paragraph",FIELDSET:"FieldSet",UL:"UList",OL:"OList",DL:"DList",DIR:"Directory",H1:"Heading",H2:"Heading",H3:"Heading",H4:"Heading",H5:"Heading",H6:"Heading",Q:"Quote",INS:"Mod",DEL:"Mod",A:"Anchor",IMG:"Image",CAPTION:"TableCaption",COL:"TableCol",COLGROUP:"TableCol",THEAD:"TableSection",TFOOT:"TableSection",TBODY:"TableSection",TR:"TableRow",TH:"TableCell",TD:"TableCell",FRAMESET:"FrameSet",IFRAME:"IFrame"};if(c[b]){a="HTML"+c[b]+"Element"}if(window[a]){return window[a]}a="HTML"+b+"Element";if(window[a]){return window[a]}a="HTML"+b.capitalize()+"Element";if(window[a]){return window[a]}window[a]={};window[a].prototype=document.createElement(b).__proto__;return window[a]}if(n.ElementExtensions){l(Element.Methods,HTMLElement.prototype);l(Element.Methods.Simulated,HTMLElement.prototype,true)}if(n.SpecificElementExtensions){for(var s in Element.Methods.ByTag){var p=o(s);if(typeof p=="undefined"){continue}l(r[s],p.prototype)}}Object.extend(Element,Element.Methods);delete Element.ByTag};var Toggle={display:Element.toggle};Abstract.Insertion=function(b){this.adjacency=b};Abstract.Insertion.prototype={initialize:function(h,f){this.element=$(h);this.content=f.stripScripts();if(this.adjacency&&this.element.insertAdjacentHTML){try{this.element.insertAdjacentHTML(this.adjacency,this.content)}catch(g){var j=this.element.tagName.toUpperCase();if(["TBODY","TR"].include(j)){this.insertContent(this.contentFromAnonymousTable())}else{throw g}}}else{this.range=this.element.ownerDocument.createRange();if(this.initializeRange){this.initializeRange()}this.insertContent([this.range.createContextualFragment(this.content)])}setTimeout(function(){f.evalScripts()},10)},contentFromAnonymousTable:function(){var b=document.createElement("div");b.innerHTML="<table><tbody>"+this.content+"</tbody></table>";return $A(b.childNodes[0].childNodes[0].childNodes)}};var Insertion=new Object();Insertion.Before=Class.create();Insertion.Before.prototype=Object.extend(new Abstract.Insertion("beforeBegin"),{initializeRange:function(){this.range.setStartBefore(this.element)},insertContent:function(b){b.each((function(a){this.element.parentNode.insertBefore(a,this.element)}).bind(this))}});Insertion.Top=Class.create();Insertion.Top.prototype=Object.extend(new Abstract.Insertion("afterBegin"),{initializeRange:function(){this.range.selectNodeContents(this.element);this.range.collapse(true)},insertContent:function(b){b.reverse(false).each((function(a){this.element.insertBefore(a,this.element.firstChild)}).bind(this))}});Insertion.Bottom=Class.create();Insertion.Bottom.prototype=Object.extend(new Abstract.Insertion("beforeEnd"),{initializeRange:function(){this.range.selectNodeContents(this.element);this.range.collapse(this.element)},insertContent:function(b){b.each((function(a){this.element.appendChild(a)}).bind(this))}});Insertion.After=Class.create();Insertion.After.prototype=Object.extend(new Abstract.Insertion("afterEnd"),{initializeRange:function(){this.range.setStartAfter(this.element)},insertContent:function(b){b.each((function(a){this.element.parentNode.insertBefore(a,this.element.nextSibling)}).bind(this))}});Element.ClassNames=Class.create();Element.ClassNames.prototype={initialize:function(b){this.element=$(b)},_each:function(b){this.element.className.split(/\s+/).select(function(a){return a.length>0})._each(b)},set:function(b){this.element.className=b},add:function(b){if(this.include(b)){return}this.set($A(this).concat(b).join(" "))},remove:function(b){if(!this.include(b)){return}this.set($A(this).without(b).join(" "))},toString:function(){return $A(this).join(" ")}};Object.extend(Element.ClassNames.prototype,Enumerable);var Selector=Class.create();Selector.prototype={initialize:function(b){this.expression=b.strip();this.compileMatcher()},compileMatcher:function(){if(Prototype.BrowserFeatures.XPath&&!(/\[[\w-]*?:/).test(this.expression)){return this.compileXPathMatcher()}var e=this.expression,ps=Selector.patterns,h=Selector.handlers,c=Selector.criteria,le,p,m;if(Selector._cache[e]){this.matcher=Selector._cache[e];return}this.matcher=["this.matcher = function(root) {","var r = root, h = Selector.handlers, c = false, n;"];while(e&&le!=e&&(/\S/).test(e)){le=e;for(var i in ps){p=ps[i];if(m=e.match(p)){this.matcher.push(typeof c[i]=="function"?c[i](m):new Template(c[i]).evaluate(m));e=e.replace(m[0],"");break}}}this.matcher.push("return h.unique(n);\n}");eval(this.matcher.join("\n"));Selector._cache[this.expression]=this.matcher},compileXPathMatcher:function(){var h=this.expression,m=Selector.patterns,n=Selector.xpath,k,l;if(Selector._cache[h]){this.xpath=Selector._cache[h];return}this.matcher=[".//*"];while(h&&k!=h&&(/\S/).test(h)){k=h;for(var j in m){if(l=h.match(m[j])){this.matcher.push(typeof n[j]=="function"?n[j](l):new Template(n[j]).evaluate(l));h=h.replace(l[0],"");break}}}this.xpath=this.matcher.join("");Selector._cache[this.expression]=this.xpath},findElements:function(b){b=b||document;if(this.xpath){return document._getElementsByXPath(this.xpath,b)}return this.matcher(b)},match:function(b){return this.findElements(document).include(b)},toString:function(){return this.expression},inspect:function(){return"#<Selector:"+this.expression.inspect()+">"}};Object.extend(Selector,{_cache:{},xpath:{descendant:"//*",child:"/*",adjacent:"/following-sibling::*[1]",laterSibling:"/following-sibling::*",tagName:function(b){if(b[1]=="*"){return""}return"[local-name()='"+b[1].toLowerCase()+"' or local-name()='"+b[1].toUpperCase()+"']"},className:"[contains(concat(' ', @class, ' '), ' #{1} ')]",id:"[@id='#{1}']",attrPresence:"[@#{1}]",attr:function(b){b[3]=b[5]||b[6];return new Template(Selector.xpath.operators[b[2]]).evaluate(b)},pseudo:function(d){var c=Selector.xpath.pseudos[d[1]];if(!c){return""}if(typeof c==="function"){return c(d)}return new Template(Selector.xpath.pseudos[d[1]]).evaluate(d)},operators:{"=":"[@#{1}='#{3}']","!=":"[@#{1}!='#{3}']","^=":"[starts-with(@#{1}, '#{3}')]","$=":"[substring(@#{1}, (string-length(@#{1}) - string-length('#{3}') + 1))='#{3}']","*=":"[contains(@#{1}, '#{3}')]","~=":"[contains(concat(' ', @#{1}, ' '), ' #{3} ')]","|=":"[contains(concat('-', @#{1}, '-'), '-#{3}-')]"},pseudos:{"first-child":"[not(preceding-sibling::*)]","last-child":"[not(following-sibling::*)]","only-child":"[not(preceding-sibling::* or following-sibling::*)]",empty:"[count(*) = 0 and (count(text()) = 0 or translate(text(), ' \t\r\n', '') = '')]",checked:"[@checked]",disabled:"[@disabled]",enabled:"[not(@disabled)]",not:function(o){var k=o[6],p=Selector.patterns,r=Selector.xpath,n,o,q;var l=[];while(k&&n!=k&&(/\S/).test(k)){n=k;for(var m in p){if(o=k.match(p[m])){q=typeof r[m]=="function"?r[m](o):new Template(r[m]).evaluate(o);l.push("("+q.substring(1,q.length-1)+")");k=k.replace(o[0],"");break}}}return"[not("+l.join(" and ")+")]"},"nth-child":function(b){return Selector.xpath.pseudos.nth("(count(./preceding-sibling::*) + 1) ",b)},"nth-last-child":function(b){return Selector.xpath.pseudos.nth("(count(./following-sibling::*) + 1) ",b)},"nth-of-type":function(b){return Selector.xpath.pseudos.nth("position() ",b)},"nth-last-of-type":function(b){return Selector.xpath.pseudos.nth("(last() + 1 - position()) ",b)},"first-of-type":function(b){b[6]="1";return Selector.xpath.pseudos["nth-of-type"](b)},"last-of-type":function(b){b[6]="1";return Selector.xpath.pseudos["nth-last-of-type"](b)},"only-of-type":function(c){var d=Selector.xpath.pseudos;return d["first-of-type"](c)+d["last-of-type"](c)},nth:function(m,n){var o,l=n[6],p;if(l=="even"){l="2n+0"}if(l=="odd"){l="2n+1"}if(o=l.match(/^(\d+)$/)){return"["+m+"= "+o[1]+"]"}if(o=l.match(/^(-?\d*)?n(([+-])(\d+))?/)){if(o[1]=="-"){o[1]=-1}var a=o[1]?Number(o[1]):1;var b=o[2]?Number(o[2]):0;p="[((#{fragment} - #{b}) mod #{a} = 0) and ((#{fragment} - #{b}) div #{a} >= 0)]";return new Template(p).evaluate({fragment:m,a:a,b:b})}}}},criteria:{tagName:'n = h.tagName(n, r, "#{1}", c);   c = false;',className:'n = h.className(n, r, "#{1}", c); c = false;',id:'n = h.id(n, r, "#{1}", c);        c = false;',attrPresence:'n = h.attrPresence(n, r, "#{1}"); c = false;',attr:function(b){b[3]=(b[5]||b[6]);return new Template('n = h.attr(n, r, "#{1}", "#{3}", "#{2}"); c = false;').evaluate(b)},pseudo:function(b){if(b[6]){b[6]=b[6].replace(/"/g,'\\"')}return new Template('n = h.pseudo(n, "#{1}", "#{6}", r, c); c = false;').evaluate(b)},descendant:'c = "descendant";',child:'c = "child";',adjacent:'c = "adjacent";',laterSibling:'c = "laterSibling";'},patterns:{laterSibling:/^\s*~\s*/,child:/^\s*>\s*/,adjacent:/^\s*\+\s*/,descendant:/^\s/,tagName:/^\s*(\*|[\w\-]+)(\b|$)?/,id:/^#([\w\-\*]+)(\b|$)/,className:/^\.([\w\-\*]+)(\b|$)/,pseudo:/^:((first|last|nth|nth-last|only)(-child|-of-type)|empty|checked|(en|dis)abled|not)(\((.*?)\))?(\b|$|\s|(?=:))/,attrPresence:/^\[([\w]+)\]/,attr:/\[((?:[\w-]*:)?[\w-]+)\s*(?:([!^$*~|]?=)\s*((['"])([^\]]*?)\4|([^'"][^\]]*?)))?\]/},handlers:{concat:function(a,b){for(var h=0,j;j=b[h];h++){a.push(j)}return a},mark:function(g){for(var d=0,f;f=g[d];d++){f._counted=true}return g},unmark:function(g){for(var d=0,f;f=g[d];d++){f._counted=undefined}return g},index:function(m,n,l){m._counted=true;if(n){for(var k=m.childNodes,h=k.length-1,j=1;h>=0;h--){node=k[h];if(node.nodeType==1&&(!l||node._counted)){node.nodeIndex=j++}}}else{for(var h=0,j=1,k=m.childNodes;node=k[h];h++){if(node.nodeType==1&&(!l||node._counted)){node.nodeIndex=j++}}}},unique:function(k){if(k.length==0){return k}var l=[],j;for(var g=0,h=k.length;g<h;g++){if(!(j=k[g])._counted){j._counted=true;l.push(Element.extend(j))}}return Selector.handlers.unmark(l)},descendant:function(k){var g=Selector.handlers;for(var h=0,l=[],j;j=k[h];h++){g.concat(l,j.getElementsByTagName("*"))}return l},child:function(q){var m=Selector.handlers;for(var n=0,r=[],p;p=q[n];n++){for(var o=0,j=[],h;h=p.childNodes[o];o++){if(h.nodeType==1&&h.tagName!="!"){r.push(h)}}}return r},adjacent:function(k){for(var g=0,l=[],j;j=k[g];g++){var h=this.nextElementSibling(j);if(h){l.push(h)}}return l},laterSibling:function(k){var g=Selector.handlers;for(var h=0,l=[],j;j=k[h];h++){g.concat(l,Element.nextSiblings(j))}return l},nextElementSibling:function(b){while(b=b.nextSibling){if(b.nodeType==1){return b}}return null},previousElementSibling:function(b){while(b=b.previousSibling){if(b.nodeType==1){return b}}return null},tagName:function(o,q,r,h){r=r.toUpperCase();var p=[],l=Selector.handlers;if(o){if(h){if(h=="descendant"){for(var m=0,n;n=o[m];m++){l.concat(p,n.getElementsByTagName(r))}return p}else{o=this[h](o)}if(r=="*"){return o}}for(var m=0,n;n=o[m];m++){if(n.tagName.toUpperCase()==r){p.push(n)}}return p}else{return q.getElementsByTagName(r)}},id:function(p,q,n,h){var r=$(n),l=Selector.handlers;if(!p&&q==document){return r?[r]:[]}if(p){if(h){if(h=="child"){for(var m=0,o;o=p[m];m++){if(r.parentNode==o){return[r]}}}else{if(h=="descendant"){for(var m=0,o;o=p[m];m++){if(Element.descendantOf(r,o)){return[r]}}}else{if(h=="adjacent"){for(var m=0,o;o=p[m];m++){if(Selector.handlers.previousElementSibling(r)==o){return[r]}}}else{p=l[h](p)}}}}for(var m=0,o;o=p[m];m++){if(o==r){return[r]}}return[]}return(r&&Element.descendantOf(r,q))?[r]:[]},className:function(h,j,f,g){if(h&&g){h=this[g](h)}return Selector.handlers.byClassName(h,j,f)},byClassName:function(p,r,k){if(!p){p=Selector.handlers.descendant([r])}var m=" "+k+" ";for(var l=0,q=[],n,o;n=p[l];l++){o=n.className;if(o.length==0){continue}if(o==k||(" "+o+" ").include(m)){q.push(n)}}return q},attrPresence:function(l,n,h){var m=[];for(var j=0,k;k=l[j];j++){if(Element.hasAttribute(k,h)){m.push(k)}}return m},attr:function(q,u,m,v,s){if(!q){q=u.getElementsByTagName("*")}var n=Selector.operators[s],t=[];for(var o=0,p;p=q[o];o++){var r=Element.readAttribute(p,m);if(r===null){continue}if(n(r,v)){t.push(p)}}return t},pseudo:function(j,h,l,k,g){if(j&&g){j=this[g](j)}if(!j){j=k.getElementsByTagName("*")}return Selector.pseudos[h](j,l,k)}},pseudos:{"first-child":function(k,n,m){for(var h=0,l=[],j;j=k[h];h++){if(Selector.handlers.previousElementSibling(j)){continue}l.push(j)}return l},"last-child":function(k,n,m){for(var h=0,l=[],j;j=k[h];h++){if(Selector.handlers.nextElementSibling(j)){continue}l.push(j)}return l},"only-child":function(m,p,o){var h=Selector.handlers;for(var k=0,n=[],l;l=m[k];k++){if(!h.previousElementSibling(l)&&!h.nextElementSibling(l)){n.push(l)}}return n},"nth-child":function(f,d,g){return Selector.pseudos.nth(f,d,g)},"nth-last-child":function(f,d,g){return Selector.pseudos.nth(f,d,g,true)},"nth-of-type":function(f,d,g){return Selector.pseudos.nth(f,d,g,false,true)},"nth-last-of-type":function(f,d,g){return Selector.pseudos.nth(f,d,g,true,true)},"first-of-type":function(f,d,g){return Selector.pseudos.nth(f,"1",g,false,true)},"last-of-type":function(f,d,g){return Selector.pseudos.nth(f,"1",g,true,true)},"only-of-type":function(g,f,j){var h=Selector.pseudos;return h["last-of-type"](h["first-of-type"](g,f,j),f,j)},getIndices:function(a,b,g){if(a==0){return b>0?[b]:[]}return $R(1,g).inject([],function(d,c){if(0==(c-b)%a&&(c-b)/a>=0){d.push(c)}return d})},nth:function(D,h,H,G,E){if(D.length==0){return[]}if(h=="even"){h="2n+0"}if(h=="odd"){h="2n+1"}var j=Selector.handlers,F=[],m=[],B;j.mark(D);for(var l=0,C;C=D[l];l++){if(!C.parentNode._counted){j.index(C.parentNode,G,E);m.push(C.parentNode)}}if(h.match(/^\d+$/)){h=Number(h);for(var l=0,C;C=D[l];l++){if(C.nodeIndex==h){F.push(C)}}}else{if(B=h.match(/^(-?\d*)?n(([+-])(\d+))?/)){if(B[1]=="-"){B[1]=-1}var a=B[1]?Number(B[1]):1;var b=B[2]?Number(B[2]):0;var y=Selector.pseudos.getIndices(a,b,D.length);for(var l=0,C,A=y.length;C=D[l];l++){for(var z=0;z<A;z++){if(C.nodeIndex==y[z]){F.push(C)}}}}}j.unmark(D);j.unmark(m);return F},empty:function(k,n,m){for(var h=0,l=[],j;j=k[h];h++){if(j.tagName=="!"||(j.firstChild&&!j.innerHTML.match(/^\s*$/))){continue}l.push(j)}return l},not:function(r,u,t){var m=Selector.handlers,v,p;var h=new Selector(u).findElements(t);m.mark(h);for(var o=0,s=[],q;q=r[o];o++){if(!q._counted){s.push(q)}}m.unmark(h);return s},enabled:function(k,n,m){for(var h=0,l=[],j;j=k[h];h++){if(!j.disabled){l.push(j)}}return l},disabled:function(k,n,m){for(var h=0,l=[],j;j=k[h];h++){if(j.disabled){l.push(j)}}return l},checked:function(k,n,m){for(var h=0,l=[],j;j=k[h];h++){if(j.checked){l.push(j)}}return l}},operators:{"=":function(c,d){return c==d},"!=":function(c,d){return c!=d},"^=":function(c,d){return c.startsWith(d)},"$=":function(c,d){return c.endsWith(d)},"*=":function(c,d){return c.include(d)},"~=":function(c,d){return(" "+c+" ").include(" "+d+" ")},"|=":function(c,d){return("-"+c.toUpperCase()+"-").include("-"+d.toUpperCase()+"-")}},matchElements:function(k,l){var o=new Selector(l).findElements(),m=Selector.handlers;m.mark(o);for(var n=0,p=[],h;h=k[n];n++){if(h._counted){p.push(h)}}m.unmark(o);return p},findElement:function(d,f,g){if(typeof f=="number"){g=f;f=false}return Selector.matchElements(d,f||"*")[g||0]},findChildElements:function(h,l){var m=l.join(","),l=[];m.scan(/(([\w#:.~>+()\s-]+|\*|\[.*?\])+)\s*(,|$)/,function(a){l.push(a[1].strip())});var q=[],n=Selector.handlers;for(var o=0,p=l.length,r;o<p;o++){r=new Selector(l[o].strip());n.concat(q,r.findElements(h))}return(p>1)?n.unique(q):q}});function $$(){return Selector.findChildElements(document,$A(arguments))}var Form={reset:function(b){$(b).reset();return b},serializeElements:function(f,g){var d=f.inject({},function(c,a){if(!a.disabled&&a.name){var b=a.name,j=$(a).getValue();if(j!=null){if(b in c){if(c[b].constructor!=Array){c[b]=[c[b]]}c[b].push(j)}else{c[b]=j}}}return c});return g?d:Hash.toQueryString(d)}};Form.Methods={serialize:function(c,d){return Form.serializeElements(Form.getElements(c),d)},getElements:function(b){return $A($(b).getElementsByTagName("*")).inject([],function(d,a){if(Form.Element.Serializers[a.tagName.toLowerCase()]){d.push(Element.extend(a))}return d})},getInputs:function(k,r,q){k=$(k);var n=k.getElementsByTagName("input");if(!r&&!q){return $A(n).map(Element.extend)}for(var l=0,p=[],o=n.length;l<o;l++){var m=n[l];if((r&&m.type!=r)||(q&&m.name!=q)){continue}p.push(Element.extend(m))}return p},disable:function(b){b=$(b);Form.getElements(b).invoke("disable");return b},enable:function(b){b=$(b);Form.getElements(b).invoke("enable");return b},findFirstElement:function(b){return $(b).getElements().find(function(a){return a.type!="hidden"&&!a.disabled&&["input","select","textarea"].include(a.tagName.toLowerCase())})},focusFirstElement:function(b){b=$(b);b.findFirstElement().activate();return b},request:function(d,f){d=$(d),f=Object.clone(f||{});var g=f.parameters;f.parameters=d.serialize(true);if(g){if(typeof g=="string"){g=g.toQueryParams()}Object.extend(f.parameters,g)}if(d.hasAttribute("method")&&!f.method){f.method=d.method}return new Ajax.Request(d.readAttribute("action"),f)}};Form.Element={focus:function(b){$(b).focus();return b},select:function(b){$(b).select();return b}};Form.Element.Methods={serialize:function(d){d=$(d);if(!d.disabled&&d.name){var g=d.getValue();if(g!=undefined){var f={};f[d.name]=g;return Hash.toQueryString(f)}}return""},getValue:function(c){c=$(c);var d=c.tagName.toLowerCase();return Form.Element.Serializers[d](c)},clear:function(b){$(b).value="";return b},present:function(b){return $(b).value!=""},activate:function(d){d=$(d);try{d.focus();if(d.select&&(d.tagName.toLowerCase()!="input"||!["button","reset","submit"].include(d.type))){d.select()}}catch(c){}return d},disable:function(b){b=$(b);b.blur();b.disabled=true;return b},enable:function(b){b=$(b);b.disabled=false;return b}};var Field=Form.Element;var $F=Form.Element.Methods.getValue;Form.Element.Serializers={input:function(b){switch(b.type.toLowerCase()){case"checkbox":case"radio":return Form.Element.Serializers.inputSelector(b);default:return Form.Element.Serializers.textarea(b)}},inputSelector:function(b){return b.checked?b.value:null},textarea:function(b){return b.value},select:function(b){return this[b.type=="select-one"?"selectOne":"selectMany"](b)},selectOne:function(c){var d=c.selectedIndex;return d>=0?this.optionValue(c.options[d]):null},selectMany:function(g){var l,j=g.length;if(!j){return null}for(var h=0,l=[];h<j;h++){var k=g.options[h];if(k.selected){l.push(this.optionValue(k))}}return l},optionValue:function(b){return Element.extend(b).hasAttribute("value")?b.value:b.text}};Abstract.TimedObserver=function(){};Abstract.TimedObserver.prototype={initialize:function(f,g,d){this.frequency=g;this.element=$(f);this.callback=d;this.lastValue=this.getValue();this.registerCallback()},registerCallback:function(){setInterval(this.onTimerEvent.bind(this),this.frequency*1000)},onTimerEvent:function(){var d=this.getValue();var c=("string"==typeof this.lastValue&&"string"==typeof d?this.lastValue!=d:String(this.lastValue)!=String(d));if(c){this.callback(this.element,d);this.lastValue=d}}};Form.Element.Observer=Class.create();Form.Element.Observer.prototype=Object.extend(new Abstract.TimedObserver(),{getValue:function(){return Form.Element.getValue(this.element)}});Form.Observer=Class.create();Form.Observer.prototype=Object.extend(new Abstract.TimedObserver(),{getValue:function(){return Form.serialize(this.element)}});Abstract.EventObserver=function(){};Abstract.EventObserver.prototype={initialize:function(d,c){this.element=$(d);this.callback=c;this.lastValue=this.getValue();if(this.element.tagName.toLowerCase()=="form"){this.registerFormCallbacks()}else{this.registerCallback(this.element)}},onElementEvent:function(){var b=this.getValue();if(this.lastValue!=b){this.callback(this.element,b);this.lastValue=b}},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback.bind(this))},registerCallback:function(b){if(b.type){switch(b.type.toLowerCase()){case"checkbox":case"radio":Event.observe(b,"click",this.onElementEvent.bind(this));break;default:Event.observe(b,"change",this.onElementEvent.bind(this));break}}}};Form.Element.EventObserver=Class.create();Form.Element.EventObserver.prototype=Object.extend(new Abstract.EventObserver(),{getValue:function(){return Form.Element.getValue(this.element)}});Form.EventObserver=Class.create();Form.EventObserver.prototype=Object.extend(new Abstract.EventObserver(),{getValue:function(){return Form.serialize(this.element)}});if(!window.Event){var Event=new Object()}Object.extend(Event,{KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,element:function(b){return $(b.target||b.srcElement)},isLeftClick:function(b){return(((b.which)&&(b.which==1))||((b.button)&&(b.button==1)))},pointerX:function(b){return b.pageX||(b.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft))},pointerY:function(b){return b.pageY||(b.clientY+(document.documentElement.scrollTop||document.body.scrollTop))},stop:function(b){if(b.preventDefault){b.preventDefault();b.stopPropagation()}else{b.returnValue=false;b.cancelBubble=true}},findElement:function(f,g){var d=Event.element(f);while(d.parentNode&&(!d.tagName||(d.tagName.toUpperCase()!=g.toUpperCase()))){d=d.parentNode}return d},observers:false,_observeAndCache:function(f,g,h,j){if(!this.observers){this.observers=[]}if(f.addEventListener){this.observers.push([f,g,h,j]);f.addEventListener(g,h,j)}else{if(f.attachEvent){this.observers.push([f,g,h,j]);f.attachEvent("on"+g,h)}}},unloadCache:function(){if(!Event.observers){return}for(var c=0,d=Event.observers.length;c<d;c++){Event.stopObserving.apply(this,Event.observers[c]);Event.observers[c][0]=null}Event.observers=false},observe:function(f,g,h,j){f=$(f);j=j||false;if(g=="keypress"&&(Prototype.Browser.WebKit||f.attachEvent)){g="keydown"}Event._observeAndCache(f,g,h,j)},stopObserving:function(h,j,k,l){h=$(h);l=l||false;if(j=="keypress"&&(Prototype.Browser.WebKit||h.attachEvent)){j="keydown"}if(h.removeEventListener){h.removeEventListener(j,k,l)}else{if(h.detachEvent){try{h.detachEvent("on"+j,k)}catch(g){}}}}});if(Prototype.Browser.IE){Event.observe(window,"unload",Event.unloadCache,false)}var Position={includeScrollOffsets:false,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;this.deltaY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},realOffset:function(d){var g=0,f=0;do{g+=d.scrollTop||0;f+=d.scrollLeft||0;d=d.parentNode}while(d);return[f,g]},cumulativeOffset:function(d){var g=0,f=0;do{g+=d.offsetTop||0;f+=d.offsetLeft||0;d=d.offsetParent}while(d);return[f,g]},positionedOffset:function(f){var j=0,h=0;do{j+=f.offsetTop||0;h+=f.offsetLeft||0;f=f.offsetParent;if(f){if(f.tagName=="BODY"){break}var g=Element.getStyle(f,"position");if(g=="relative"||g=="absolute"){break}}}while(f);return[h,j]},offsetParent:function(b){if(b.offsetParent){return b.offsetParent}if(b==document.body){return b}while((b=b.parentNode)&&b!=document.body){if(Element.getStyle(b,"position")!="static"){return b}}return document.body},within:function(d,f,g){if(this.includeScrollOffsets){return this.withinIncludingScrolloffsets(d,f,g)}this.xcomp=f;this.ycomp=g;this.offset=this.cumulativeOffset(d);return(g>=this.offset[1]&&g<this.offset[1]+d.offsetHeight&&f>=this.offset[0]&&f<this.offset[0]+d.offsetWidth)},withinIncludingScrolloffsets:function(f,h,j){var g=this.realOffset(f);this.xcomp=h+g[0]-this.deltaX;this.ycomp=j+g[1]-this.deltaY;this.offset=this.cumulativeOffset(f);return(this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+f.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+f.offsetWidth)},overlap:function(d,c){if(!d){return 0}if(d=="vertical"){return((this.offset[1]+c.offsetHeight)-this.ycomp)/c.offsetHeight}if(d=="horizontal"){return((this.offset[0]+c.offsetWidth)-this.xcomp)/c.offsetWidth}},page:function(g){var j=0,h=0;var f=g;do{j+=f.offsetTop||0;h+=f.offsetLeft||0;if(f.offsetParent==document.body){if(Element.getStyle(f,"position")=="absolute"){break}}}while(f=f.offsetParent);f=g;do{if(!window.opera||f.tagName=="BODY"){j-=f.scrollTop||0;h-=f.scrollLeft||0}}while(f=f.parentNode);return[h,j]},clone:function(m,n){var j=Object.extend({setLeft:true,setTop:true,setWidth:true,setHeight:true,offsetTop:0,offsetLeft:0},arguments[2]||{});m=$(m);var k=Position.page(m);n=$(n);var h=[0,0];var l=null;if(Element.getStyle(n,"position")=="absolute"){l=Position.offsetParent(n);h=Position.page(l)}if(l==document.body){h[0]-=document.body.offsetLeft;h[1]-=document.body.offsetTop}if(j.setLeft){n.style.left=(k[0]-h[0]+j.offsetLeft)+"px"}if(j.setTop){n.style.top=(k[1]-h[1]+j.offsetTop)+"px"}if(j.setWidth){n.style.width=m.offsetWidth+"px"}if(j.setHeight){n.style.height=m.offsetHeight+"px"}},absolutize:function(h){h=$(h);if(h.style.position=="absolute"){return}Position.prepare();var l=Position.positionedOffset(h);var m=l[1];var k=l[0];var n=h.clientWidth;var j=h.clientHeight;h._originalLeft=k-parseFloat(h.style.left||0);h._originalTop=m-parseFloat(h.style.top||0);h._originalWidth=h.style.width;h._originalHeight=h.style.height;h.style.position="absolute";h.style.top=m+"px";h.style.left=k+"px";h.style.width=n+"px";h.style.height=j+"px"},relativize:function(d){d=$(d);if(d.style.position=="relative"){return}Position.prepare();d.style.position="relative";var g=parseFloat(d.style.top||0)-(d._originalTop||0);var f=parseFloat(d.style.left||0)-(d._originalLeft||0);d.style.top=g+"px";d.style.left=f+"px";d.style.height=d._originalHeight;d.style.width=d._originalWidth}};if(Prototype.Browser.WebKit){Position.cumulativeOffset=function(d){var g=0,f=0;do{g+=d.offsetTop||0;f+=d.offsetLeft||0;if(d.offsetParent==document.body){if(Element.getStyle(d,"position")=="absolute"){break}}d=d.offsetParent}while(d);return[f,g]}}Element.addMethods();function $$(d,f,g){return Selector.findChildElements(f,[d])}Function.prototype.bind=function(){var d=this,f=$A(arguments),g=f.shift();return function(){if(typeof $A=="function"){return d.apply(g,f.concat($A(arguments)))}}};Function.prototype.bindAsEventListener=function(g){var d=this,f=$A(arguments),g=f.shift();return function(a){if(typeof $A=="function"){return d.apply(g,[a||window.event].concat(f))}}};Object.extend(Event,{onDOMReady:function(b){Ready.onIdReady("contentEnd",b)},onReady:function(b){Ready.onDOMReady(b)},onDone:function(b){Ready.onDOMDone(b)},onIdReady:function(d,c){Ready.onIdReady(d,c)},findElement:function(f,g){var d=Event.element(f);while(d.parentNode&&(!d.tagName||(d.tagName.toUpperCase()!=g.toUpperCase()))){d=d.parentNode}if(d&&d!=null){Element.extend(d)}return d},stopAllObserving:function(d,g){if(!Event.observers){return}d=$(d);for(var f=0;f<Event.observers.length;f++){if(Event.observers[f][0]==d){if((g==null)||(Event.observers[f][1]==g)){Event.stopObserving.apply(Event,Event.observers[f])}}}}});Element.Methods.readAttribute=function(g,h){g=$(g);if(IE){if(!g.attributes){return null}var f=g[h];if(typeof f!="undefined"&&f!=null){return f}var j=Element._attributeTranslations;if(j.values[h]){return j.values[h](g,h)}if(j.names[h]){h=j.names[h]}f=g.attributes[h];return f?f.nodeValue:null}return g.getAttribute(h)};Element.Methods.remove=function(c){c=$(c);if(IE){if(c&&c.tagName!="BODY"){var d=document.createElement("div");d.appendChild(c);d.innerHTML=""}}else{if(c&&c.parentNode&&c.tagName!="BODY"){c.parentNode.removeChild(c)}}return c};var GlobalResponder={loadingElement:$("globalLoading"),callInProgress:function(b){switch(b.readyState){case 1:case 2:case 3:return true;break;default:return false;break}},onCreate:function(b){GlobalResponder.beginWaiting();b.timeoutId=window.setTimeout(function(){if(GlobalResponder.callInProgress(b.transport)){GlobalResponder.endWaiting();b.transport.abort();if(b.options.onFailure){b.options.onFailure(b.transport,b.json)}}},b.options.timeout)},onComplete:function(b){GlobalResponder.endWaiting();if(b.timeoutId){window.clearTimeout(b.timeoutId)}},onException:function(d,c){GlobalResponder.endWaiting();if(d.timeoutId){window.clearTimeout(d.timeoutId)}if(c&&typeof c.message=="string"){if(c.message.indexOf("Component returned failure code: 0x80040111")!=0){if(debug){alert("Exception:"+c.message)}}}},beginWaiting:function(){var b=this._getLoadingElement();if(b&&!b.visible()){b.show()}},endWaiting:function(){var b=this._getLoadingElement();if(b&&b.visible()){b.hide()}},_getLoadingElement:function(){if(this.loadingElement===null){this.loadingElement=$("globalLoading")}return this.loadingElement}};Ajax.Responders.register(GlobalResponder);Object.extend(Template.prototype,{initialize:function(d,c){d=d.toString();this.template=d;this.pattern=c||Template.Pattern},eval:function(b){return this.evaluate(b)}});var Fx={};Fx.Base=Class.create();Fx.Base.prototype={initialize:function(c,d){this.element=$(c);this.options=d||{};this.duration=(this.options.duration||1)*1000;this.fps=this.options.fps||24;this.steps=Math.floor(this.duration/this.fps);this.maxSteps=this.steps;this.timer=null;if(this.options.delay){FunctionExt.defer(this.start,this.options.delay*1000,this)}else{this.start()}},start:function(){this.setup(this);(this.options.onStart||Prototype.emptyFunction)(this);this.timer=setInterval(this.run.bind(this),this.fps)},run:function(){if(this.isFinished()){clearInterval(this.timer);this.end(this);return(this.options.onComplete||Prototype.emptyFunction)(this)}this.duration-=this.fps;this.steps--;var b=1-this.steps/this.maxSteps;this.loop(this,b);(this.options.onUpdate||Prototype.emptyFunction)(this,b)},isFinished:function(){return this.steps<=0},setup:function(b){},loop:function(c,d){this.update(c,d)},end:function(b){}};Fx.Slide=Class.create();Object.extend(Object.extend(Fx.Slide.prototype,Fx.Base.prototype),{setup:function(c){var d;if(this.options.dimensions){d=this.options.dimensions}else{d=this.element.getDimensions()}this.originalHeight=d.height;this.originalWidth=d.width;this.factor=1;this.slideType=c.options.slideType||"down";if(this.slideType=="down"){this.element.setStyle({height:"0px"}).show()}},update:function(k,m){var d=this.factor*m;var n=this.originalWidth*d;var l=this.originalHeight*d;var j={};if(k.options.scaleX){j.width=Math.round(n)+"px"}if(k.options.scaleY){j.height=Math.round(l)+"px"}this.element.setStyle(j)},end:function(b){if(this.slideType=="up"){this.element.hide()}if(b.options.callback){b.options.callback()}}});if(!String.prototype.trim){var TRIM_REG=/^\s+|\s+$/g;String.prototype.trim=function(){return this.replace(TRIM_REG,"")}}String.prototype.Trim=String.prototype.trim;String.prototype.bytelength=function(){var b=this.match(/[^\x00-\xff]/ig);return this.length+(b==null?0:b.length)};String.prototype.bytelength2=function(){var b=this.match(/[^\x00-\x7f]/ig);return this.length+(b==null?0:b.length)};String.prototype.cut=function(){var j=arguments[0]*2;var f=this.bytelength();if(j>f){return this}var g=0,h=0;for(g=0;g<this.length;g++){if(this.charCodeAt(g)>255){h+=2}else{h++}if(h>j){break}}return this.substr(0,g)+"..."};String.prototype.Cut=String.prototype.cut;String.prototype.empty=function(){return this.trim().length===0};String.prototype.extract=function(){var j=arguments,m=this,l=j[0],o=j[1];var k=m.indexOf(l)+l.length;var n=m.indexOf(o);var p="";if(n>k){p=m.substr(k,n-k)}return p};String.prototype.formatWithWBR=function(){var m=arguments,t=10;if(m.length>0){var n=parseInt(m[0],10);if(!isNaN(n)&&n>0){t=n}}var v=this,r=[],u=0,s=0,q;for(var p=1,o=v.length;p<o;p++){q=v.charAt(p);if(/\s/.test(q)){s=p}else{if((p-s)==t){r.push(v.substring(u,p));r.push("<wbr>");u=s=p}}}r.push(v.substr(u));return r.join("")};String.prototype.isNumber=function(){var g=this;if(g.length===0){return false}for(var f=0,d=g.length;f<d;f++){if(isNaN(parseInt(g.charAt(f),10))){return false}}return true};Date.prototype.toString=function(){var g=this;var l=g.getMonth();l=(l+1).toString().length==2?l+1:"0"+(l+1);var h=g.getDate();h=h.toString().length==2?h:"0"+h;var j=g.getHours();j=j.toString().length==2?j:"0"+j;var k=g.getMinutes();k=k.toString().length==2?k:"0"+k;return g.getFullYear()+"-"+l+"-"+h+" "+j+":"+k};Number.prototype.NaN0=function(){var b=this;return isNaN(b)?0:b};if(typeof debug!=="boolean"){debug=false}if(typeof version==="undefined"){version="1.0.js"}if(typeof cssVersion==="undefined"){cssVersion="1.0.css"}if(typeof mtimeCookieDomain==="undefined"){mtimeCookieDomain="mtime.com"}if(typeof siteType==="undefined"){siteType="mtime"}if(typeof enable08==="undefined"){enable08="true"}if(typeof crossDomainUpload==="undefined"){crossDomainUpload="http://upload3.mtime.com/Upload.ashx"}if(typeof jsServer==="undefined"){if(window.location.protocol==="https:"){jsServer="https://static2.mtime.cn/static/"}else{jsServer="http://static1.mtime.cn/static/"}}if(typeof cssServer==="undefined"){cssServer=""}if(typeof subJsServer==="undefined"){subJsServer=""}if(typeof siteUrl==="undefined"){siteUrl="http://www.mtime.com"}if(typeof siteMcUrl==="undefined"){siteMcUrl="http://my.mtime.com"}if(typeof siteApiUrl==="undefined"){siteApiUrl="http://api.mtime.com"}if(typeof siteLogUrl==="undefined"){siteLogUrl="http://log.mtime.cn"}if(typeof siteGroupUrl==="undefined"){siteGroupUrl="http://group.mtime.com"}if(typeof siteBlogUrl==="undefined"){siteBlogUrl="http://i.mtime.com"}if(typeof siteMovieUrl==="undefined"){siteMovieUrl="http://movie.mtime.com"}if(typeof siteAwardUrl==="undefined"){siteAwardUrl="http://award.mtime.com"}if(typeof sitePeopleUrl==="undefined"){sitePeopleUrl="http://people.mtime.com"}if(typeof siteNewsUrl==="undefined"){siteNewsUrl="http://news.mtime.com"}if(typeof siteServiceUrl==="undefined"){siteServiceUrl="http://service.mtime.com"}if(typeof siteSearchUrl==="undefined"){siteSearchUrl="http://search.mtime.com"}if(typeof theaterService==="undefined"){theaterService="http://service.theater.mtime.com"}if(typeof siteFunUrl==="undefined"){siteFunUrl="http://fun.mtime.com"}var Mtime={version:"0.1",emptyFunction:function(){},K:function(b){return b},RELATED_OBJ_TYPE_MOVIE:1,RELATED_OBJ_TYPE_PERSON:2,RELATED_OBJ_TYPE_MOVIE_IMAGE:11,RELATED_OBJ_TYPE_PERSON_IMAGE:21,RELATED_OBJ_TYPE_TOPIC:10,RELATED_OBJ_TYPE_GROUP:9,RELATED_OBJ_TYPE_USER:4,RELATED_OBJ_TYPE_PHOTO:5,RELATED_OBJ_TYPE_BLOG:6,RELATED_OBJ_TYPE_THEATER:33,RELATED_OBJ_TYPE_VIDEO:41,RELATED_OBJ_TYPE_BLOGINLIBRARY:2006,RELATED_OBJ_TYPE_LIVE:338,namespace:function(){var a=arguments,l=null,j,k,d;for(j=0;j<a.length;j=j+1){d=a[j].split(".");l=Mtime;for(k=(d[0]=="Mtime")?1:0;k<d.length;k=k+1){l[d[k]]=l[d[k]]||{};l=l[d[k]]}}return l},extend:function(d,g){for(var f in g){d[f]=g[f]}return d},extendIf:function(d,g){if(extend&&g){for(var f in g){if(typeof d[f]=="undefined"){d[f]=g[f]}}}return d},augmentObject:function(m,n){if(!n||!m){throw new Error("Absorb failed, verify dependencies.")}var a=arguments,j,l,k=a[2];if(k&&k!==true){for(j=2;j<a.length;j=j+1){m[a[j]]=n[a[j]]}}else{for(l in n){if(k||!(l in m)){m[l]=n[l]}}Mtime._IEEnumFix(m,n)}},merge:function(){var j={},a=arguments;for(var g=0,h=a.length;g<h;g=g+1){Mtime.augmentObject(j,a[g],true)}return j},isArray:function(b){if(b){return Mtime.isNumber(b.length)&&Mtime.isFunction(b.splice)}return false},isBoolean:function(b){return typeof b==="boolean"},isFunction:function(b){return typeof b==="function"},isNull:function(b){return b===null},isNumber:function(b){return typeof b==="number"&&isFinite(b)},isObject:function(b){return(b&&(typeof b==="object"||Mtime.isFunction(b)))||false},isString:function(b){return typeof b==="string"},isUndefined:function(b){return typeof b==="undefined"},isValue:function(b){return(Mtime.isObject(b)||Mtime.isString(b)||Mtime.isNumber(b)||Mtime.isBoolean(b))},isEmpty:function(d,c){return Mtime.isNull(d)||Mtime.isUndefined(d)||(!c?d==="":false)},parseDate:function(d){if(d&&typeof d==="string"){var c=d.match(/^ *(\d{4})-(\d{1,2})-(\d{1,2}) +(\d{1,2}):(\d{1,2}):(\d{1,2}) *$/);if(c&&c.length>6){return new Date(parseInt(c[1],10),parseInt(c[2],10)-1,parseInt(c[3],10),parseInt(c[4],10),parseInt(c[5],10),parseInt(c[6],10))}}return null},dateToFormatedString:function(d){var q=new Date();var s=q.getTime()-d.getTime();if(s>0){var m=Math.floor(s/(1000*60*60*24));var o=Math.floor(s/(1000*3600))-(m*24);var p=Math.floor(s/(1000*60))-(m*24*60)-(o*60);var r=Math.floor(s/(1000))-(m*24*60*60)-(o*60*60)-(p*60);if(m>0){var n=new Date();n.setDate(n.getDate()-1);var t=new Date(n.getFullYear(),n.getMonth(),n.getDate());if(m===1&&d>=t){return String.format("<span></span><span>{0}</span>",Mtime.dateFormat(d,"hh:mm"))}return String.format("<span>{0}</span><span>{1}</span>",Mtime.dateFormat(d,"MM - dd"),Mtime.dateFormat(d,"hh:mm"))}if(o>0){return String.format("<span>{0}</span>",o)}if(p>0){return String.format("<span>{0}</span>",p)}return String.format("<span>{0}</span>",r)}return String.format("<span>{0}</span><span>{1}</span>",Mtime.dateFormat(d,"MM - dd"),Mtime.dateFormat(d,"hh:mm"))},dateToFormatedStringNoTag:function(d){var q=new Date();var s=q.getTime()-d.getTime();if(s>0){var m=Math.floor(s/(1000*60*60*24));var o=Math.floor(s/(1000*3600))-(m*24);var p=Math.floor(s/(1000*60))-(m*24*60)-(o*60);var r=Math.floor(s/(1000))-(m*24*60*60)-(o*60*60)-(p*60);if(m>0){var n=new Date();n.setDate(n.getDate()-1);var t=new Date(n.getFullYear(),n.getMonth(),n.getDate());if(m===1&&d>=t){return String.format(" {0}",Mtime.dateFormat(d,"hh:mm"))}return String.format("{0}-{1} {2}",d.getFullYear(),Mtime.dateFormat(d,"MM-dd"),Mtime.dateFormat(d,"hh:mm:ss"))}if(o>0){return String.format("{0}",o)}if(p>0){return String.format("{0}",p)}return String.format("{0}",r)}return String.format("{0} {1}",Mtime.dateFormat(d,"MM - dd"),Mtime.dateFormat(d,"hh:mm"))},dateFormat:function(f,g){var j={"M+":f.getMonth()+1,"d+":f.getDate(),"h+":f.getHours(),"m+":f.getMinutes(),"s+":f.getSeconds(),"q+":Math.floor((f.getMonth()+3)/3),S:f.getMilliseconds()};if(/(y+)/.test(g)){g=g.replace(RegExp.$1,(f.getFullYear()+"").substr(4-RegExp.$1.length))}for(var h in j){if(new RegExp("("+h+")").test(g)){g=g.replace(RegExp.$1,RegExp.$1.length==1?j[h]:("00"+j[h]).substr((""+j[h]).length))}}return g},later:function(t,q,o,f,r){t=t||0;q=q||{};var p=o,d=f,m,s;if(Mtime.isString(o)){p=q[o]}if(!p){throw new TypeError("method undefined")}if(!Mtime.isArray(d)){d=[f]}m=function(){p.apply(q,d)};s=(r)?setInterval(m,t):setTimeout(m,t);return{interval:r,cancel:function(){if(this.interval){clearInterval(s)}else{clearTimeout(s)}}}},log:function(f,d,g){alert(f)}};Mtime.namespace("Mtime.Component","Mtime.Control","Mtime.Page","Mtime.Utility");Mtime.browser=function(){var f={ie:0,opera:0,gecko:0,webkit:0};var g=navigator.userAgent,d;if((/KHTML/).test(g)){f.webkit=1}d=g.match(/AppleWebKit\/([^\s]*)/);if(d&&d[1]){f.webkit=parseFloat(d[1])}if(!f.webkit){d=g.match(/Opera[\s\/]([^\s]*)/);if(d&&d[1]){f.opera=parseFloat(d[1])}else{d=g.match(/MSIE\s([^;]*)/);if(d&&d[1]){f.ie=parseFloat(d[1])}else{d=g.match(/Gecko\/([^\s]*)/);if(d){f.gecko=1;d=g.match(/rv:([^\s\)]*)/);if(d&&d[1]){f.gecko=parseFloat(d[1])}}}}}return f}();if(Object.prototype.hasOwnProperty){Mtime.hasOwnProperty=function(c,d){return c&&c.hasOwnProperty(d)}}else{Mtime.hasOwnProperty=function(c,d){return !Mtime.isUndefined(c[d])&&c.constructor.prototype[d]!==c[d]}}var browser=Mtime.browser;if(browser.ie){var ADD=["toString","valueOf"];Mtime._IEEnumFix=function(k,l){for(var j=0;j<ADD.length;j=j+1){var h=ADD[j],f=l[h];if(Mtime.isFunction(f)&&f!=Object.prototype[h]){k[h]=f}}}}else{Mtime._IEEnumFix=Mtime.emptyFunction}if(browser.ie&&browser.ie<7){try{document.execCommand("BackgroundImageCache",false,true)}catch(e){}window.attachEvent("onunload",function(){var f=document.getElementsByTagName("OBJECT");for(var d=f.length-1;d>=0;d--){f[d].style.display="none";for(var g in f[d]){if(typeof f[d][g]=="function"){f[d][g]=Mtime.emptyFunction}}}})}Mtime.Utility.JSON={toObject:function(text){var o=null;if(typeof JSON==="object"&&typeof JSON.parse==="function"){try{o=JSON.parse(text)}catch(e){o=null}}if(o===null){if(browser.gecko){o=new Function("return "+text)()}else{o=eval("("+text+")")}}return o}};Mtime.loader=function(){var K={},J=0,H=0,I=false,L=Mtime.browser;var A=function(h,c,b){var a=b||window,d=a.document,g=d.createElement(h);for(var f in c){if(c[f]&&Mtime.hasOwnProperty(c,f)){g.setAttribute(f,c[f])}}return g};var y=function(c,d,b){var a=b||"utf-8";return A("link",{id:"__core_"+(H++),type:"text/css",charset:a,rel:"stylesheet",href:c},d)};var E=function(c,d,b){var a=b||"utf-8";return A("script",{id:"__core_"+(H++),type:"text/javascript",charset:a,src:c,async:true},d)};var D=function(b,a){return{tId:b.tId,win:b.win,data:b.data,nodes:b.nodes,msg:a,purge:function(){B(this.tId)}}};var x=function(b,d){var c=K[d],a=(Mtime.isString(b))?c.win.document.getElementById(b):b;if(!a){v(d,"target node not found: "+b)}return a};var v=function(a,b){Mtime.log("get failure: "+b,"warn","Get");var c=K[a];if(c.onFailure){var d=c.scope||c.win;c.onFailure.call(d,D(c,b))}};var w=function(a){var c=K[a];c.finished=true;if(c.aborted){var b="transaction "+a+" was aborted";v(a,b);return}if(c.onSuccess){var d=c.scope||c.win;c.onSuccess.call(d,D(c))}};var F=function(a){Mtime.log("Timeout "+a,"info","get");var b=K[a];if(b.onTimeout){var c=b.context||b;b.onTimeout.call(c,D(b))}};var z=function(l,m){var c=K[l];if(c.timer){c.timer.cancel()}if(c.aborted){var a="transaction "+l+" was aborted";v(l,a);return}if(m){c.url.shift();if(c.varName){c.varName.shift()}}else{c.url=(Mtime.isString(c.url))?[c.url]:c.url;if(c.varName){c.varName=(Mtime.isString(c.varName))?[c.varName]:c.varName}}var g=c.win,h=g.document,k=h.getElementsByTagName("head")[0],b;if(c.url.length===0){if(c.type==="script"&&Mtime.browser.webkit&&Mtime.browser.webkit<420&&!c.finalpass&&!c.varName){var j=E(null,c.win,c.charset);j.innerHTML='Mtime.loader._finalize("'+l+'");';c.nodes.push(j);k.appendChild(j)}else{w(l)}return}var f=c.url[0];if(!f){c.url.shift();return z(l)}if(c.timeout){c.timer=Mtime.later(c.timeout,c,F,l)}if(c.type==="script"){b=E(f,g,c.charset)}else{b=y(f,g,c.charset)}G(c.type,b,l,f,g,c.url.length);c.nodes.push(b);if(c.insertBefore){var d=x(c.insertBefore,l);if(d){d.parentNode.insertBefore(b,d)}}else{k.appendChild(b)}if((Mtime.browser.webkit||Mtime.browser.gecko)&&c.type==="css"){z(l,f)}};var u=function(){if(I){return}I=true;for(var a in K){var b=K[a];if(b.autopurge&&b.finished){B(b.tId);delete K[a]}}I=false};var B=function(b){var j=K[b];if(j){var h=j.nodes,g=h.length,c=j.win.document,d=c.getElementsByTagName("head")[0];if(j.insertBefore){var a=x(j.insertBefore,b);if(a){d=a.parentNode}}for(var f=0;f<g;f=f+1){d.removeChild(h[f])}j.nodes=[]}};var C=function(d,f,b){var a="q"+(J++);b=b||{};if(J%Mtime.loader.PURGE_THRESH===0){u()}K[a]=Mtime.merge(b,{tId:a,type:d,url:f,finished:false,aborted:false,nodes:[]});var c=K[a];c.win=c.win||window;c.scope=c.scope||c.win;c.autopurge=("autopurge" in c)?c.autopurge:(d==="script")?true:false;Mtime.later(0,c,z,a);return{tId:a}};var G=function(b,j,h,c,d,l,a){var f=a||z;if(L.ie){j.onreadystatechange=function(){var m=this.readyState;if("loaded"===m||"complete"===m){j.onreadystatechange=null;f(h,c)}}}else{if(Mtime.browser.webkit){if(b==="script"){if(Mtime.browser.webkit>=420){j.addEventListener("load",function(){f(h,c)})}else{var k=K[h];if(k.varName){var g=Mtime.loader.POLL_FREQ;k.maxattempts=YAHOO.util.Get.TIMEOUT/g;k.attempts=0;k._cache=k.varName[0].split(".");k.timer=Mtime.later(g,k,function(q){var m=this._cache,o=m.length,r=this.win,n;for(n=0;n<o;n=n+1){r=r[m[n]];if(!r){this.attempts++;if(this.attempts++>this.maxattempts){var p="Over retry limit, giving up";k.timer.cancel();v(h,p)}else{Mtime.log(m[n]+" failed, retrying")}return}}k.timer.cancel();f(h,c)},null,true)}else{Mtime.later(Mtime.loader.POLL_FREQ,null,f,[h,c])}}}}else{j.onload=function(){f(h,c)}}}};return{POLL_FREQ:20,PURGE_THRESH:30,TIMEOUT:30000,_finalize:function(a){Mtime.later(0,null,w,a)},abort:function(b){var a=(Mtime.isString(b))?b:b.tId;var c=K[a];if(c){c.aborted=true}},script:function(b,a){return C("script",b,a)},css:function(b,a){return C("css",b,a)}}}();$get=function(f,d,g){$defer(function(b,a,c){return Mtime.loader.script(b,{onSuccess:function(k){var l=window["result_"+k.data];a(l)},data:c})},this,[f,d,g])};$loadJs=function(g,d,f){$defer(function(n,a,m){m=m||0;if(!m){if(Mtime.isString(n)){n=n.indexOf("http")!==0?jsServer+n:n}else{if(Mtime.isArray(n)&&n.length>0){var o=[],p="";for(var c=0,b=n.length;c<b;c++){p=n[c];o.push(p.indexOf("http")!==0?(jsServer+p):p)}n=o}}}return Mtime.loader.script(n,{onSuccess:a,onFailure:function(){return Mtime.loader.script(n,{onSuccess:a})},onTimeout:function(){return Mtime.loader.script(n,{onSuccess:a})}})},this,[g,d,f])};$loadSubJs=function(g,d,f){$defer(function(n,a,m){m=m||0;if(!m){if(Mtime.isString(n)){n=n.indexOf("http")!==0?subJsServer+n:n}else{if(Mtime.isArray(n)&&n.length>0){var o=[],p="";for(var c=0,b=n.length;c<b;c++){p=n[c];o.push(p.indexOf("http")!==0?(subJsServer+p):p)}n=o}}}return Mtime.loader.script(n,{onSuccess:a})},this,[g,d,f])};$loadAppJs=function(g,d,f){$defer(function(n,a,m){m=m||0;if(!m){if(Mtime.isString(n)){n=n.indexOf("http")!==0?appJsServer+n:n}else{if(Mtime.isArray(n)&&n.length>0){var o=[],p="";for(var c=0,b=n.length;c<b;c++){p=n[c];o.push(p.indexOf("http")!==0?(appJsServer+p):p)}n=o}}}return Mtime.loader.script(n,{onSuccess:a})},this,[g,d,f])};$loadCss=function(d,c){$defer(function(b,a){b=b.indexOf("http")!==0?cssServer+b:b;return Mtime.loader.css(b,{onSuccess:a,onFailure:function(){return Mtime.loader.css(b,{onSuccess:a,onFailure:a,onTimeout:a})},onTimeout:function(){return Mtime.loader.css(b,{onSuccess:a,onFailure:a,onTimeout:a})}})},this,[d,c])};var CrossdomainAjax={getTransport:function(){return Try.these(function(){return new CrossXHR()},function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||false},activeRequestCount:0};var CallbackAjax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||false},activeRequestCount:0};Mtime.Component.Ajax={MAX_REREQUEST_COUNT:2,_requestKeys:[],_requestErrorCounts:[],requestQueue:[],_lock:false,get:function(o,n,k,l,r,m,q,p){this.request(siteServiceUrl,o,n,k,l,r,m,q,p)},request:function(v,u,t,o,q,z,r,x,w){var y=this.getToken();z=this.getRequestUrl(v,u,t,o,z,y);var s=null;if(this.isValid(w)){s=this.addOverlay(w)}var p=function(a){if(this.isValid(w)&&s){this.removeOverlay(w,s)}if(!this._lock&&a&&a.ddos){this._lock=true;new Dialog({windowClassName:"w445",content:a.html})}else{if(this._lock){return}else{if(q){q(a)}}}}.bind(this);$get(z,p,y)},getRequestUrl:function(n,m,l,j,p,o){var k=new StringBuilder();if(p.indexOf("Ajax_CallBack=true")<0){k.append("Ajax_CallBack=true&")}k.append("Ajax_CallBackType=");k.append(m);k.append("&Ajax_CallBackMethod=");k.append(l);k.append("&Ajax_CrossDomain=1");k.append("&Ajax_RequestUrl=");k.append(encodeURIComponent(location.href));k.append("&t=");k.append(o);k.append(this.toQueryString(j));p=p.indexOf("http")!==0?n+p:p;if("https:"==document.location.protocol){if(!p.startsWith("https://")){p=p.replace("http://","https://")}}if(p.indexOf("?")>0){p+="&"+k.toString()}else{p+="?"+k.toString()}return p},crossDomainCallBack:function(t,s,r,n,o,x,p,v,u){var w=this.getToken();var q=this.getRequestUrl(t,s,r,n,x,w);if(q.length>2048){Ajax.getTransport=CrossdomainAjax.getTransport;this._callBack(s,r,n,o,t+x,p,v,u)}else{this.request(t,s,r,n,o,x,p,v,u)}},getCrossDomain:function(o,n,k,l,r,m,q,p){this.crossDomainCallBack(siteServiceUrl,o,n,k,l,r,m,q,p)},callBack:function(o,n,k,l,r,m,q,p){Ajax.getTransport=CallbackAjax.getTransport;this._callBack(o,n,k,l,r,m,q,p)},_callBack:function(y,x,p,r,B,t,A,z){var u=null;if(this.isValid(z)){u=this.addOverlay(z)}A=A||20000;A=A*10;var q=true;if(!r||r==null){q=false}if(q){var v={serverType:y,serverMethod:x,clientCallBack:r,args:p,url:B,submitButton:z,overlay:u};if(this.inQueue(v)){return}this.requestQueue.push(v)}var s=new StringBuilder();if(B.indexOf("Ajax_CallBack=true")<0){s.append("Ajax_CallBack=true&")}s.append("Ajax_CallBackType=");s.append(y);s.append("&Ajax_CallBackMethod=");s.append(x);s.append("&Ajax_RequestUrl=");var w=encodeURIComponent(location.href);s.append(w);s.append(this.toQueryString(p));t=t||"post";new Ajax.Request(this.attachTokenToUrl(B),{parameters:s.toString(),requestObj:v,method:t,timeout:A,onComplete:this.onComplete.bind(this)})},SERVICE_URL:"/callbackServices.m?Ajax_CallBack=true",callBack08:function(C,B,r,t,u,w,E,y,D){var x=null;if(this.isValid(D)){x=this.addOverlay(D)}E=E||20000;var s=true;if(!t||t==null){s=false}if(s){var z={serverType:C,serverMethod:B,clientCallBack:t,args:r,url:u,submitButton:D,overlay:x};if(this.inQueue(z)){return}this.requestQueue.push(z)}y=(typeof y==="undefined"||y.length===0)?"":("&"+y);var A=encodeURIComponent(location.href);var v=new StringBuilder();v.append("Ajax_CallBackType=");v.append(C);v.append("&Ajax_CallBackMethod=");v.append(B);v.append("&Ajax_RequestUrl=");v.append(A);v.append("&Ajax_Command=");v.append(u);v.append(this.toQueryString(r));w=w||"post";var F=this.SERVICE_URL+y;new Ajax.Request(this.attachTokenToUrl(F),{parameters:v.toString(),requestObj:z,method:w,timeout:E,onComplete:this.onComplete.bind(this)})},attachTokenToUrl:function(b){if(b.indexOf("?")>0){b+="&t="+this.getToken()}else{b+="?t="+this.getToken()}return b},getToken:function(){var d=new Date(),c=[];c.push(d.getFullYear());c.push(d.getMonth()+1);c.push(d.getDate());c.push(d.getHours());c.push(d.getMinutes());c.push(d.getSeconds());c.push(parseInt(Math.random()*100000,10));return c.join("")},toQueryString:function(g){var l="";if(g){var k=[];for(var j=0,h=g.length;j<h;j++){k.push("&Ajax_CallBackArgument");k.push(j);k.push("=");k.push(encodeURIComponent(g[j]))}l=k.join("")}return l},inQueue:function(k){if(this.requestQueue.length>0){var l=this.requestQueue,j=null;for(var h=0,g=l.length;h<g;h++){j=l[h];if(j==k){return true}else{if(this.equal(j,k)){return true}}}}return false},dequeue:function(m){if(this.requestQueue.length>0){var n=this.requestQueue,l=null,k=-1;for(var j=0,h=n.length;j<h;j++){l=n[j];if(l==m){k=j;break}else{if(this.equal(l,m)){k=j;break}}}if(k>=0){n.splice(k,1)}}},equal:function(c,d){if(c.url==d.url&&c.serverType==d.serverType&&c.serverMethod==d.serverMethod&&c.args==d.args){return true}return false},onComplete:function(n,h,j){var l=null;if(!Mtime.isEmpty(n.responseText)){l=Mtime.Utility.JSON.toObject(n.responseText)}var k=j.requestObj;this.dequeue(k);FunctionExt.defer(k.clientCallBack,1,null,[l]);k.clientCallBack=null;delete k.clientCallBack;var m=k.submitButton;if(this.isValid(m)&&k.overlay){this.removeOverlay(m,k.overlay)}k.overlay=null;k=null;delete k;j.requestObj=null;delete j.requestObj},isValid:function(b){if(!Mtime.isUndefined(b)&&!Mtime.isNull(b)&&!Mtime.isString(b)){return true}return false},addOverlay:function(k){if(typeof k==="undefined"||k===null){return}var l=new Date().getTime();var j="submitOverlay_"+l;var g=k.parentNode;var h=Element.extend(document.createElement("div"));h.id=j;h.className="submiting";this.getContainer().appendChild(h);Position.clone(k,h);return h},removeOverlay:function(d,c){if(typeof d==="undefined"||d===null){return}if(c){FunctionExt.defer(function(b,a){this.getContainer().removeChild(a)},1000,this,[d,c])}},getContainer:function(){var b=$("contentEnd");if(typeof b==="undefined"||b===null){b=document.getElementsByTagName("body")[0]}return b}};Mtime.Component.Statistic=Class.create();Mtime.Component.Statistic.Service={Log:function(j,h,g,f){return Mtime.Component.Ajax.request(siteLogUrl,"Mtime.Analytics.Web.Log.Pages.StatisticService","Log",[j,h,g,this.getUserId()],f,"/Log/StatisticService.m?Ajax_CallBack=true","get","20000")},QueryLog:function(h,m,n,k,l,j){return Mtime.Component.Ajax.request(siteLogUrl,"Mtime.Analytics.Web.Log.Pages.SearchService","Query",[h,m,n,this.getUserId(),k,l],j,"/Log/SearchService.m?Ajax_CallBack=true","get","20000")},ClickLog:function(g,l,k,j,h){return Mtime.Component.Ajax.request(siteLogUrl,"Mtime.Analytics.Web.Log.Pages.SearchService","Click",[g,l,k,j],h,"/Log/SearchService.m?Ajax_CallBack=true","get","20000")},SuggestQueryAndClick:function(k,q,r,m,p,o,n,l){return Mtime.Component.Ajax.request(siteLogUrl,"Mtime.Analytics.Web.Log.Pages.SearchService","SuggestQueryAndClick",[k,q,r,this.getUserId(),m,p,o,n],l,"/Log/SearchService.m?Ajax_CallBack=true","get","20000")},GetImageCounts:function(d,c){return Mtime.Component.Ajax.callBack("Mtime.Community.Controls.CommunityPages.StatisticService","GetImageCounts",[d],c,"/Utility/StatisticService.m?Ajax_CallBack=true","get","20000")},GetUserPhotoCounts:function(d,c){return Mtime.Component.Ajax.callBack("Mtime.Community.Controls.CommunityPages.StatisticService","GetUserPhotoCounts",[d],c,"/Utility/StatisticService.m?Ajax_CallBack=true","get","20000")},GetBlogCategoryCounts:function(g,d,f){return Mtime.Component.Ajax.callBack("Mtime.Community.Controls.CommunityPages.StatisticService","GetBlogCategoryCounts",[g,d],f,"/Utility/StatisticService.m?Ajax_CallBack=true","get","20000")},GetBlogCommentCount:function(d,c){return Mtime.Component.Ajax.callBack("Mtime.Community.Controls.CommunityPages.StatisticService","GetBlogCommentCount",[d],c,"/Utility/StatisticService.m?Ajax_CallBack=true","get","20000")},GetBlogs:function(d,c){return Mtime.Component.Ajax.callBack("Mtime.Community.Controls.CommunityPages.StatisticService","GetBlogs",[d],c,"/Utility/StatisticService.m?Ajax_CallBack=true","get","20000")},AddSearchFeedback:function(k,n,h,l,m,j){return Mtime.Component.Ajax.request(siteLogUrl,"Mtime.Analytics.Web.Log.Pages.SearchService","AddSearchFeedback",[k,n,h,this.getUserId(),l,m],j,"/Log/SearchService.m?Ajax_CallBack=true","get","20000")},getUserId:function(){var b=getCookie("_mi_");if(b&&b.length>0){return b}return""}};Mtime.Component.Statistic.prototype={BehaviorType_ClickExternalRecommendVideo:50001,initialize:function(){this.relatedObjTypes=[];this.relatedIds=[]},viewTheater:function(b){this.add(Mtime.RELATED_OBJ_TYPE_THEATER,b)},viewMovie:function(b){this.add(Mtime.RELATED_OBJ_TYPE_MOVIE,b)},viewPerson:function(b){this.add(Mtime.RELATED_OBJ_TYPE_PERSON,b)},viewMovieImage:function(b){this.add(Mtime.RELATED_OBJ_TYPE_MOVIE_IMAGE,b)},viewPersonImage:function(b){this.add(Mtime.RELATED_OBJ_TYPE_PERSON_IMAGE,b)},viewGroup:function(b){this.add(Mtime.RELATED_OBJ_TYPE_GROUP,b)},viewUser:function(b){this.add(Mtime.RELATED_OBJ_TYPE_USER,b)},viewPhoto:function(b){this.add(Mtime.RELATED_OBJ_TYPE_PHOTO,b)},viewBlog:function(b){this.add(Mtime.RELATED_OBJ_TYPE_BLOG,b)},viewBlogs:function(b){this.addRange(Mtime.RELATED_OBJ_TYPE_BLOG,b)},viewVideo:function(b){this.add(Mtime.RELATED_OBJ_TYPE_VIDEO,b)},clickExternalRecommendVideo:function(b){this.add(this.BehaviorType_ClickExternalRecommendVideo,b)},viewBlogInLibrary:function(b){this.add(Mtime.RELATED_OBJ_TYPE_BLOGINLIBRARY,b)},viewLive:function(b){this.add(Mtime.RELATED_OBJ_TYPE_LIVE,b)},add:function(d,c){this.relatedObjTypes.push(d);this.relatedIds.push(c);this.log()},addRange:function(l,k){var j=k.split("|");if(j.length>0){for(var h=0,g=j.length;h<g;h++){if(j[h].length>0){this.relatedObjTypes.push(l);this.relatedIds.push(j[h])}}this.log()}},isLogged:false,log:function(){var h=this.relatedIds;var k=this.relatedObjTypes;if(typeof(h)!="undefined"&&h&&h.length>0){var g="";if(typeof(requestUserId)!="undefined"){g=requestUserId}var l=this.relatedObjTypes.join("|");var j=this.relatedIds.join("|");Mtime.Component.Statistic.Service.Log(l,j,g,function(){}.bind(this));this.relatedObjTypes.clear();this.relatedIds.clear()}}};var FunctionExt=Mtime.Component.FunctionExt;FunctionExt={createCallback:function(f){var d=arguments;var g=f;return function(){return g.apply(window,d)}},createDelegate:function(j,l,h,g){var k=j;return function(){var b=h||arguments;if(g===true){b=Array.prototype.slice.call(arguments,0);b=b.concat(h)}else{if(typeof g=="number"){b=Array.prototype.slice.call(arguments,0);var a=[g,0].concat(h);Array.prototype.splice.apply(b,a)}}return k.apply(l||window,b)}},defer:function(l,m,n,j,h){var k=this.createDelegate(l,n,j,h);if(m){return setTimeout(k,m)}k();return 0}};var Ready=Mtime.Component.Ready;Ready={timePassed:0,lastTimerInterval:0,finalTimeout:20,timerInterval:1000,intervalId:0,isDOMDone:0,isDOMReady:0,runReadyCallbacking:0,onFunctionReadyCallbacks:{},onDOMReadyCallbacks:[],onDOMDoneCallbacks:[],onIdReadyCallbacks:{},isRun:0,onFunctionReady:function(g,d){if(!Ready._checkFunctionReady(g)){var f=Ready.onFunctionReadyCallbacks[g];if(!f){f=[]}f.push(d);Ready.onFunctionReadyCallbacks[g]=f;Ready.start()}else{$defer(d)}},onDOMReady:function(b){if(Ready._checkDOMReady()){$defer(b)}else{Ready.onDOMReadyCallbacks.push(b);Ready.start()}},onDOMDone:function(b){if(Ready._checkDOMDone()){$defer(b)}else{Ready.onDOMDoneCallbacks.push(b);Ready.start()}},onIdReady:function(j,f){if(Ready._checkDOMReady()){var h=document.getElementById(j);if(h){$defer(f,this,[$(h)]);return}}var g=Ready.onIdReadyCallbacks[j];if(!g){g=[]}g.push(f);Ready.onIdReadyCallbacks[j]=g;Ready.start()},runFunctionCallbacks:function(){var f=true;for(var h in Ready.onFunctionReadyCallbacks){if(Ready.onFunctionReadyCallbacks.hasOwnProperty(h)){if(Ready._checkFunctionReady(h)){var g=Ready.onFunctionReadyCallbacks[h];for(var j=0;j<g.length;j++){$defer(g[j])}delete Ready.onFunctionReadyCallbacks[h];delete g}else{if(f){f=false}}}}return f},runDOMReadyCallbacks:function(){for(var b=0;b<Ready.onDOMReadyCallbacks.length;b++){$defer(Ready.onDOMReadyCallbacks[b])}Ready.onDOMReadyCallbacks=[]},runDOMDoneCallbacks:function(){for(var b=0;b<Ready.onDOMDoneCallbacks.length;b++){$defer(Ready.onDOMDoneCallbacks[b])}Ready.onDOMDoneCallbacks=[]},runIdCallbacks:function(){var g=true;for(var l in Ready.onIdReadyCallbacks){if(Ready.onIdReadyCallbacks.hasOwnProperty(l)){var j=document.getElementById(l);if(typeof j!="undefined"&&j!=null){var h=Ready.onIdReadyCallbacks[l];for(var k=0;k<h.length;k++){$defer(h[k],this,[$(j)])}delete Ready.onIdReadyCallbacks[l];delete h}else{if(g){g=false}}}}return g},runReadyCallbacks:function(){if(Ready.runReadyCallbacking){return}Ready.runReadyCallbacking=1;var g=true;if(Ready._checkDOMReady()){Ready.runDOMReadyCallbacks();var f=Ready.runIdCallbacks();if(!f){g=false}}else{g=false}if(Ready._checkDOMDone()){Ready.runDOMDoneCallbacks()}else{g=false}var d=Ready.runFunctionCallbacks();if(!d){g=false}if(g){Ready.stop()}else{Ready.timePassed+=Ready.lastTimerInterval;if((Ready.timePassed/Ready.timerInterval)>=Ready.finalTimeout){Ready.stop()}}Ready.runReadyCallbacking=0},start:function(){if(!Ready.isRun){if(debug){alert(",Ready.start")}Ready.isRun=1;if(document.addEventListener){document.addEventListener("DOMContentLoaded",function(){Ready.isDOMDone=1},false)}Ready.lastTimerInterval=Ready.timerInterval;Ready.intervalId=setInterval(Ready.runReadyCallbacks,Ready.timerInterval)}},stop:function(){if(Ready.isRun){Ready.isRun=0;Ready.isDOMReady=0;Ready.isDOMDone=0;Ready.onDOMReadyCallbacks=[];Ready.onDOMDoneCallbacks=[];Ready.onIdReadyCallbacks={};Ready.timePassed=0;Ready.onFunctionReadyCallbacks={};if(Ready.intervalId){clearInterval(Ready.intervalId);Ready.intervalId=null}}},reset:function(){Ready.stop();Ready.start()},runCallbacks:function(){Ready.runReadyCallbacks()},_checkFunctionReady:function(m){var h=Ready._checkObjectReady;if(m.indexOf(",")<=0){return h(m)}else{var l=m.split(",");for(var n=0,j=l.length;n<j;n++){var k=l[n];if(!h(k)){return false}}return true}},_checkObjectReady:function(b){b=b.trim();if(typeof(this[b])!=="undefined"&&this[b]!==null){return true}return false},_checkDOMReady:function(){if(Ready.isDOMReady){return Ready.isDOMReady}if(typeof document.getElementsByTagName!=="undefined"&&typeof document.getElementById!=="undefined"&&(document.getElementsByTagName("body")[0]!==null||document.body!==null)){Ready.isDOMReady=1}return Ready.isDOMReady},_checkDOMDone:function(){if(document.readyState&&document.readyState==="complete"){return 1}return Ready.isDOMDone}};var Pay=Mtime.Component.Pay;Pay={ConvertCentToYuan:function(b){return(b/100).toFixed(2)},ConvertYuanToCent:function(b){return b*100}};var MovieRatingHelper=Mtime.Component.MovieRatingHelper;MovieRatingHelper={getRating:function(f){var d=Math.floor(f+0.01);var g=Math.floor(Math.abs(f-d)*10+0.01);return{big:d>0?d:0,small:d>=10?"":("."+g)}},getRatingString:function(c){var d=MovieRatingHelper.getRating(c);return d.big+d.small},calcTotalRating:function(j,h,n,l,m,k){if(j==10&&h==10&&n==10&&l==10&&m==10&&k==10){return 10}return j*0.2307+h*0.2364+n*0.1912+l*0.1182+m*0.174+k*0.0495},getUserRatingDescription:function(b){if(b>0){if(b<3){return""}if(b<6){return""}if(b<=7.5){return""}if(b<9){return""}return""}return""},getUserParticularRatingDescription:function(b){if(b>0){if(b<=4){return""}if(b<=7){return""}if(b<=9){return""}return""}return""},setMovieCommentRegion:function(j,g,h,f){j.innerHTML="";j.appendChild(Builder.build('<span class="ele_inline_block myquot mr3">&nbsp;</span>'));j.appendChild(Builder.node("a",{href:h,target:"_blank"},[g.truncate(f,"...").toString()]));j.appendChild(Builder.build('<span class="ele_inline_block myquot_r ml3">&nbsp;</span>'))}};function $FuncReady(d,c){Ready.onFunctionReady(d,c)}function $DOMReady(b){Ready.onDOMReady(b)}function $IdReady(d,c){Ready.onIdReady(d,c)}$onId=$IdReady;$onDOM=$DOMReady;$onFunc=$FuncReady;function $visible(b){b=$(b);return !b.hasClassName("none")&&b.visible()}function $hide(b){b=$(b);b.addClassName("none");b.hide()}function $show(b){b=$(b);b.removeClassName("none");b.show()}function $defer(k,l,h,g){try{return FunctionExt.defer(k,0.1,l,h,g)}catch(j){alert(j)}}function $Redirect(n){if(IE){var m=["object","embed","applet"],k,l;for(k=0;k<m.length;k++){var j=document.getElementsByTagName(m[k]);for(l=0;l<j.length;l++){try{$(j[l]).innerHTML=""}catch(h){}}}}location.href=n}var $redirect=$Redirect;function StringBuilder(){this.strings=[]}StringBuilder.prototype.append=function(b){this.strings.push(b)};StringBuilder.prototype.add=function(b){this.strings.push(b)};StringBuilder.prototype.toString=function(){if(arguments.length==0){return this.strings.join("")}else{return this.strings.join(arguments[0])}};StringBuilder.prototype.clear=function(){this.strings.clear()};StringBuilder.prototype.backspace=function(){this.strings.pop()};var $urlPrefix=("https:"==document.location.protocol)?" https://":" http://";var Builder={NODEMAP:{AREA:"map",CAPTION:"table",COL:"table",COLGROUP:"table",LEGEND:"fieldset",OPTGROUP:"select",OPTION:"select",PARAM:"object",TBODY:"table",TD:"table",TFOOT:"table",TH:"table",THEAD:"table",TR:"table"},node:function(l){l=l.toUpperCase();var n=this.NODEMAP[l]||"div";var m=document.createElement(n);try{m.innerHTML="<"+l+"></"+l+">"}catch(j){}var k=m.firstChild||null;if(k&&(k.tagName.toUpperCase()!=l)){k=k.getElementsByTagName(l)[0]}if(!k){k=document.createElement(l)}if(!k){return}if(arguments[1]){if(this._isStringOrNumber(arguments[1])||(arguments[1] instanceof Array)||arguments[1].tagName){this._children(k,arguments[1])}else{var h=this._attributes(arguments[1]);if(h.length){try{m.innerHTML="<"+l+" "+h+"></"+l+">"}catch(j){}k=m.firstChild||null;if(!k){k=document.createElement(l);for(attr in arguments[1]){k[attr=="class"?"className":attr]=arguments[1][attr]}}if(k.tagName.toUpperCase()!=l){k=m.getElementsByTagName(l)[0]}}}}if(arguments[2]){this._children(k,arguments[2])}return $(k)},_text:function(b){return document.createTextNode(b)},ATTR_MAP:{className:"class",htmlFor:"for"},_attributes:function(f){var g=[];for(var d in f){g.push((d in this.ATTR_MAP?this.ATTR_MAP[d]:d)+'="'+f[d].toString().escapeHTML()+'"')}return g.join(" ")},_children:function(d,c){if(c.tagName){d.appendChild(c);return}if(typeof c=="object"){c.flatten().each(function(a){if(typeof a=="object"){d.appendChild(a)}else{if(Builder._isStringOrNumber(a)){d.appendChild(Builder._text(a))}}})}else{if(Builder._isStringOrNumber(c)){d.appendChild(Builder._text(c))}}},_isStringOrNumber:function(b){return(typeof b=="string"||typeof b=="number")},build:function(d){var c=this.node("div");$(c).update(d.strip());return c.down()},dump:function(c){if(typeof c!="object"&&typeof c!="function"){c=window}var d=("A ABBR ACRONYM ADDRESS APPLET AREA B BASE BASEFONT BDO BIG BLOCKQUOTE BODY BR BUTTON CAPTION CENTER CITE CODE COL COLGROUP DD DEL DFN DIR DIV DL DT EM FIELDSET FONT FORM FRAME FRAMESET H1 H2 H3 H4 H5 H6 HEAD HR HTML I IFRAME IMG INPUT INS ISINDEX KBD LABEL LEGEND LI LINK MAP MENU META NOFRAMES NOSCRIPT OBJECT OL OPTGROUP OPTION P PARAM PRE Q S SAMP SCRIPT SELECT SMALL SPAN STRIKE STRONG STYLE SUB SUP TABLE TBODY TD TEXTAREA TFOOT TH THEAD TITLE TR TT U UL VAR").split(/\s+/);d.each(function(a){c[a]=function(){return Builder.node.apply(Builder,[a].concat($A(arguments)))}})}};var FlashHttpRequest_ready;var FlashHttpRequest_objects;var FlashHttpRequest_counter;if(typeof(FlashHttpRequest_counter)=="undefined"){FlashHttpRequest_objects=new Object();FlashHttpRequest_counter=0;function FlashHttpRequest_(d){this.parent=d;this.id=FlashHttpRequest_counter;FlashHttpRequest_counter++;FlashHttpRequest_objects[this.id]=this;var c;this.open=function(a,b){c=document.getElementById("flashCallback");c.create(this.id,a,b)};this.send=function(a){c.send(this.id,a)};this.handler=function(j,a){var h=this.parent?d:this;h.readyState=4;h.responseText=a;h.status=j;var b=this.id;setTimeout(function(){c.finished(b);h.onreadystatechange.apply(h)},10)}}function FlashHttpRequest_handler(f,g,d){FlashHttpRequest_objects[f].handler(g,d.replace(/%22/g,'"').replace(/%5c/g,"\\").replace(/%26/g,"&").replace(/%25/g,"%"))}function CrossXHR(){var j;var k=new Array();var h=100;var g=document.getElementById("flashCallback");if(g&&g.create){if(typeof(FlashHttpRequest_ready)!="undefined"){j=new FlashHttpRequest_(this)}}if(!j){var l=this;k.push(function(){j=new FlashHttpRequest_(l)});setTimeout(function(){l._process_queue()},100)}this.open=function(a,b){if(j){j.open(a,b)}else{k.push(function(){j.open(a,b)})}};this.send=function(a){if(j){j.send(a)}else{k.push(function(){j.send(a)})}};this.abort=function(){};this.setRequestHeader=function(a,b){};this.getResponseHeader=function(a,b){return null};this._process_queue=function(){g=document.getElementById("flashCallback");var a=j?true:false;if(!a){if(g&&g.create){if(typeof(FlashHttpRequest_ready)!="undefined"){a=true}}}if(!a){if(h>0){h--;setTimeout(function(){l._process_queue()},100)}}else{while(k.length>0){var b=k.shift();b.apply(this)}}}}var FlashCallbackClient=Class.create();Object.extend(FlashCallbackClient.prototype,{name:"FlashCallbackClient",initialize:function(){this.load()},load:function(){this.addFlash()},addFlash:function(){var m="flashCallback",k=cssServer+"/flash/MtimeCallback.swf?rnd="+Math.floor(Math.random()*999999999),n="1",l="1",j=new StringBuilder();if(Mtime.browser.ie){j.append("<object id='"+m+"' codebase='http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,29,0' classid='clsid:D27CDB6E-AE6D-11cf-96B8-444553540000' width='"+n+"' height='"+l+"'>");j.append("<param name='movie' value='"+k+"'/>");j.append("<param name='quality' value='high' />");j.append("<param name='menu' value='false' />");j.append("<param name='allowFullScreen' value='false' />");j.append("<param name='allowScriptAccess' value='always' />");j.append("<param name='wmode' value='transparent' />");j.append("</object>")}else{j.append("<embed type='application/x-shockwave-flash' src='"+k+"' width='"+n+"' height='"+l+"' id='"+m+"' name='"+m+"' quality='high' menu='false' allowFullScreen='false'  allowScriptAccess='always' wmode='transparent'/>")}var h=this.getContainer();h.appendChild(Builder.build(j.toString()))},getContainer:function(){var b=$("contentEnd");if(typeof b==="undefined"||b===null){b=document.getElementsByTagName("body")[0]}return b},onFlashReady:function(c){var d=this.getFlash("flashCallback");if(d&&d.create){clearTimeout(this.checkIfLoadedInterval);c(d)}else{this.checkIfLoadedInterval=setTimeout(this.onFlashReady.bind(this,c),500)}},getFlash:function(b){if(navigator.appName.indexOf("Microsoft")!=-1){return window[b]}else{return document[b]}}});new FlashCallbackClient()}var OriginalPagerBuilder={build:function(G,H,J,A){var k;var w=1,y=10,z;var v=0;var j=[2,5,2];var x;if(!G||G<1){throw"pageIndex must > 0"}if(!H||H<1){throw"pageSize must > 0"}if(A&&(!(A instanceof Array)||A.length!=3)){throw"displayArray must like [2, 5, 2]"}w=parseInt(G,10);y=parseInt(H,10);z=parseInt(J,10);if(A){j=A}x=[];v=Math.ceil(z/y);k=Builder.node("div",{className:"pagenav tc"});if(v<2){return k}if(w>1){x.push(Builder.node("a",{className:"mr10 next",href:"#",pageindex:w-1},[""]))}var F=(w==1?2:0);var I=(w==v?2:0);j[0]+=F;j[2]+=I;if(v<=j[0]+j[1]+j[2]){for(var C=1;C<=v;++C){x.push(OriginalPagerBuilder.addPager(C,w))}}else{var D=1;while(D<=j[0]){x.push(OriginalPagerBuilder.addPager(D,w));D++}var B=Math.floor(j[1]/2);if(D<w-B){x.push(OriginalPagerBuilder.addPager(-1,w));D=Math.min(w-B,v-j[1]-j[2]+1)}while(D<=Math.max(j[0]+j[1],w+B)&&D<=v){x.push(OriginalPagerBuilder.addPager(D,w));D++}if(D<v-j[2]+1){x.push(OriginalPagerBuilder.addPager(-1,w));D=v-j[2]+1}while(D<=v){x.push(OriginalPagerBuilder.addPager(D,w));D++}}if(w<v){x.push(Builder.node("a",{className:"mr10 next",href:"#",pageindex:w+1},[""]))}for(var E=0;E<x.length;++E){k.appendChild(x[E])}return k},addPager:function(d,c){if(d<1){return Builder.node("span",["..."])}else{if(c==d){return Builder.node("a",{className:"on",href:"###"},[d])}else{return Builder.node("a",{href:"#",pageindex:d},[d])}}}};var port=window.location.port;var AppPath=window.location.protocol+"//"+window.location.host;var Globals={SiteUrl:"http://test.com",UrlParamsCacheKey:"Global-UrlParamsCacheKey",getSiteUrl:function(b){alert("URL");return this.SiteUrl+b},isDefined:function(b){return typeof(b)!="undefined"&&b!=null},isNullOrEmpty:function(b){if(!this.isDefined(b)){return true}if(this.isDefined(b.length)&&b.length==0){return true}if(b.toString()=="null"){return true}return false},getParam:function(c){var d=this._getParams();if(!this.isDefined(d)){return""}return d[c]},_getParams:function(){var l={};var n=document.location.search.substr(1).split("&");if(Globals.isNullOrEmpty(n)){return null}for(var k=0,h=n.length;k<h;k++){try{var m=n[k].split("=");if(m.length<2){continue}l[m[0]]=m[1].Trim()}catch(j){}}return l},copyToClipboard:function(t){if(window.clipboardData){window.clipboardData.setData("Text",t)}else{if(Opera){window.location=t}else{if(Prototype.Browser.WebKit){var p=document.createElement("input");p.type="text";p.value=t;document.body.appendChild(p);FunctionExt.defer(function(){p.select();document.execCommand("copy",false,null);document.body.removeChild(p)},100)}else{if(window.netscape){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect")}catch(o){alert("firefox: about:config signed.applets.codebase_principal_supporttrue");return false}var l=Components.classes["@mozilla.org/widget/clipboard;1"].createInstance(Components.interfaces.nsIClipboard);if(!l){return false}var s=Components.classes["@mozilla.org/widget/transferable;1"].createInstance(Components.interfaces.nsITransferable);if(!s){return false}s.addDataFlavor("text/unicode");var q={};var r=Components.classes["@mozilla.org/supports-string;1"].createInstance(Components.interfaces.nsISupportsString);var n=t;r.data=n;s.setTransferData("text/unicode",r,n.length*2);var m=Components.interfaces.nsIClipboard;if(!l){return false}l.setData(s,null,m.kGlobalClipboard)}}}}return true},addCSSStyle:function(f,h){if(!f){return}var j=document.getElementsByTagName("head")[0];var g=document.createElement("style");g.type="text/css";if(h){g.media="screen"}if(g.styleSheet){g.styleSheet.cssText=f}else{g.appendChild(document.createTextNode(f))}j.appendChild(g)},hideSelect:function(){if(IE){var g=document.getElementsByTagName("SELECT");for(var f=0,d=g.length;f<d;f++){g[f].style.visibility="hidden"}}},showSelect:function(){if(IE){var g=document.getElementsByTagName("SELECT");for(var f=0,d=g.length;f<d;f++){g[f].style.visibility="visible"}}}};var IE=document.all?true:false;var _ieVersion=navigator.appVersion.match(/MSIE (.\..)/);var IE6=IE&&(_ieVersion&&_ieVersion[1]==6);var FireFox=document.getElementById&&!document.all;var Safari=/webkit/.test(navigator.userAgent.toLowerCase());var Opera=navigator.userAgent.indexOf("Opera")!=-1?true:false;var disappearDelay=500;var isTouchPad=false;var touchPadUas=["iphone","ipod","ipad","android"],ua=navigator.userAgent.toLowerCase();for(var i=0,count=touchPadUas.length;i<count;++i){if(ua.indexOf(touchPadUas[i])>0){isTouchPad=true;break}}function getCookie(h){var f=""+document.cookie;var j=f.indexOf(h);if(f==""||j==-1){return""}var g=f.indexOf(";",j);if(g==-1){g=f.length}return unescape(f.substring(j+h.length+1,g))}function setCookie(f,g,d){setCookieForever(f,g)}function setCookieForever(f,g,d){setCookieTerminable(f,g,60,d)}function setCookieTerminable(k,l,h,j){var g=new Date();g.setTime(g.getTime()+h*24*60*60*1000);if(!j){j="/"}document.cookie=k+"="+escape(l)+";path="+j+";expires="+g.toUTCString()+";domain="+mtimeCookieDomain+";"}function setLocalCookie(k,l,h,j){h=h||1;var g=new Date();g.setTime(g.getTime()+h*24*60*60*1000);if(!j){j="/"}document.cookie=k+"="+escape(l)+";path="+j+";expires="+g.toUTCString()+";"}function Random(b){return Math.floor(Math.random()*100000)%b}function showHTMLContent(){}function $Name(b){return $A(document.getElementsByName(b))}function $SelectOne(g){var j=document.getElementsByName(g);if(j&&j.length){for(var h=0,f=j.length;h<f;h++){if(j[h].checked){return $(j[h])}}}return null}function $Value(j){var n=[];var k=$Name(j);if(k&&k.length>0){for(var l=0,h=k.length;l<h;l++){var m=k[l].value;if(m.length>0){n[l]=m}}}return n}var Utility={};Utility.Dom={nextElement:function(b){b=$(b);while(b=b.nextSibling){if(b.nodeType==1){return $(b)}}return null},previousElement:function(b){b=$(b);while(b=b.previousSibling){if(b.nodeType==1){return $(b)}}return null},remove:function(b){return $(b).parentNode.removeChild(b)},insertAfter:function(c,d){return $(c).previousSibling.inserBefore(d)},replaceElement:function(c,d){$(c).parentNode.replaceChild(d,c);return d},setSelectedValue:function(j,n,m){m=$(m);var k=document.getElementsByName(j);for(var l=0,h=k.length;l<h;l++){if(k[l].value==n){if(m){if(k[l].parentNode==m){k[l].checked=true}}else{k[l].checked=true}}else{k[l].checked=false}}},getSelectedValues:function(g,j){var l=[];var k=$Name(g);if(Globals.isNullOrEmpty(k)){return l}j=j||k.length;var h=0;k.each(function(a){if(a.checked){if(h<j){l[h++]=a.value}}});if(j==1){if(l.length==1){return l[0]}else{return 0}}return l},collapse:function(q,r,p,l,o,k){var m=$(q);var n=$(r);if(!m||!n){return}p=p||"/images/m_down.gif";l=l||"/images/m_up.gif";o=o||"";k=k||"";if(!m.visible()){m.show();if(n){n.src=l;n.title=k}}else{m.hide();if(n){n.src=p;n.title=o}}},getInt:function(b){return parseInt(b.replace(/[^ \d.-]/g,""))}};String.Format=function(){var h=arguments,j=h.length;if(j==0){return""}if(j==1){return h[0]}var k=/{(\d+)?}/g,g,l;if(h[1] instanceof Array){g=h[1];l=h[0].replace(k,function(a,b){return g[parseInt(b)]})}else{g=h;l=h[0].replace(k,function(a,b){return g[parseInt(b)+1]})}return l};String.format=String.Format;Object.extend(Event,{stopB:function(b){if(b.preventDefault){b.preventDefault()}else{b.returnValue=false}}});if(typeof(stat)=="undefined"){stat=new Mtime.Component.Statistic()}function loadTg(p){if(!p||typeof p!=="object"){p=window.mtimeStufs}if(typeof p!=="undefined"){siteType=typeof siteType==="undefined"?"mtime":siteType;var n=null,q=null,r="";var o=$H({});for(var m=0,k=p.length;m<k;m++){n=p[m];if(n.type.length===0){continue}o[n.id]=n}var l=o.values();for(var m=0,k=l.length;m<k;m++){n=l[m];r=getTagMapId(n.id);q=$(r);if(q&&n.content.trim().length>0&&!q.handle){q.handle=true;q.update(n.content);if(typeof tracker!=="undefined"&&typeof tracker.trackAdView!=="undefined"){tracker.trackAdView(q,r);tracker.observeAdClick(q,r)}}}}}function getTagMapId(j){if(typeof tgMaps!=="undefined"){var h=null;for(var g=0,f=tgMaps.length;g<f;++g){h=tgMaps[g];if(h.name.toLowerCase()==j.toLowerCase()){j=h.regionId;break}}}return j}setTimeout(loadTg,2000);Event.observe(window,"unload",function(){Ready.stop()});function $innerHTML(h,f){var j=document.createElement("div"),g=document.createDocumentFragment();j.innerHTML=h;(function(){if(j.firstChild){g.appendChild(j.firstChild);setTimeout(arguments.callee,0)}else{f(g)}})()}function $css(g){var f=document.getElementsByTagName("head")[0];var d=document.createElement("style");d.type="text/css";d.media="screen";if(d.styleSheet){d.styleSheet.cssText=g}else{d.appendChild(document.createTextNode(g))}f.appendChild(d)}function $encodePassword(h){if(h.length<6){return h}var j=h.substr(0,1);if(j=="*"){var f=parseInt(h.substr(h.length-2,2),10);if(f==h.length){return h}}var g=_encode64(h);var f=g.length+1+2;if(f<10){f="0"+f}return"*"+g+f}function _encode64(v){var w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var x="";var n,o,p="";var q,r,s,t="";var u=0;do{n=v.charCodeAt(u++);o=v.charCodeAt(u++);p=v.charCodeAt(u++);q=n>>2;r=((n&3)<<4)|(o>>4);s=((o&15)<<2)|(p>>6);t=p&63;if(isNaN(o)){s=t=64}else{if(isNaN(p)){t=64}}x=x+w.charAt(q)+w.charAt(r)+w.charAt(s)+w.charAt(t);n=o=p="";q=r=s=t=""}while(u<v.length);return x}var Validator={Require:/.+/,Email:/\w+([-+.\w]+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/i,Url:/^http:\/\/[A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@[\]\':+!]*([^<>\"\"])*$/,Number:/^\d+$/,Password:/^\S{6,20}$/,NickName:/^[0-9a-zA-Z\u4e00-\u9fa5_-]*$/,Int:/^[-\+]?\d+$/,Double:/^[-\+]?\d+(\.\d+)?$/,English:/^[A-Za-z]+$/,Chinese:/^[\u0391-\uFFE5]+$/,Tag:/[\\\/\<\>\`\~\'\"\\!\@\#\$\%\^\&\*\{\}\?\(\)\\\\\-\:]/,DateTime:/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2}) (\d{1,2}):(\d{1,2})$/,IdCard:/^(\d{18,18}|\d{15,15}|\d{17,17}[x|X])$/,MobilePhone:/^(13|14|15|18)[0-9]{9}$/,MobilePhone2:/^1[0-9]{10}$/,Postcode:/^[1-9][0-9]{5}$/,testRegExp:function(c,d){return c.test(d)},validateUrl:function(b){return this.testRegExp(this.Url,b)},validateEmail:function(b){return this.testRegExp(this.Email,b)},validatePassword:function(b){return this.testRegExp(this.Password,b)},validateNickName:function(d){if(!d){return false}var c=this.getChineseStringLength(d);if(c>=4&&c<=20){return this.testRegExp(this.NickName,d)}return false},validateRequireElement:function(c){var d=$F(c);return validateRequire(d)},validateRequire:function(b){return this.testRegExp(this.Require,b.Trim())},validateDatetime:function(b){return this.testRegExp(this.DateTime,b.Trim())},validatePostcode:function(b){return this.testRegExp(this.Postcode,b.Trim())},filterTagToArray:function(n){var m=[];var l=n.Trim().replace(/[\s]+/g," ").split(" ");if(l.length==0){return m}for(var j=0,k=0,h=l.length;j<h;j++){if(!this.Tag.test(l[j])){m[k++]=this.getChineseSubString(l[j],10)}}if(m.length==0){return m}if(m.length==1){return m}else{return m.uniq()}},filterMovieTagToArray:function(n){var m=[];var l=n.Trim().replace(/[\s]+/g," ").split(" ");if(l.length==0){return m}for(var j=0,k=0,h=l.length;j<h;j++){if(!this.Tag.test(l[j])){m[k++]=l[j]}}if(m.length==0){return m}if(m.length==1){return m}else{return m.uniq()}},isChinese:function(d){var c=/[u00-uFF]/;return !c.test(d)},getChineseStringLength:function(h){var j=0;for(var g=0,f=h.length;g<f;g++){if(this.isChinese(h.charAt(g))){j=j+2}else{j=j+1}}return j},getChineseSubString:function(n,k,j){j=(typeof j=="undefined"||j==null)?"":j;var o=k*2;if(o>=this.getChineseStringLength(n)){return n}else{o-=j.length;var p=new StringBuilder();for(var l=0,k=n.length;l<k;l++){var m=n.charAt(l);p.append(m);if(this.isChinese(m)){o-=2;if(o<0){p.backspace();break}}else{o--}if(o==0){break}}return p.toString()+j}}};var Windows={windows:[],maxZIndex:100,register:function(b){this.windows.push(b);this.maxZIndex+=10},unregister:function(b){this.windows=this.windows.reject(function(a){return a==b})},closeAll:function(){if(this.count()>0){this.windows.each(function(b){b.close()})}},count:function(){return this.windows.length},getZIndex:function(){return this.maxZIndex}};var Window=Mtime.Control.Window;Window=Class.create();Window.prototype={fixTopHeight:30,zIndex:100,createIframe:false,isToggleTroubleElement:false,isFocus:true,windowElement:null,overlay:null,createOverlay:true,closed:false,dimensions:{cruft:null,container:null,viewport:{height:null,width:null,offsetTop:null,offsetLeft:null}},pagePosition:{x:0,y:0},pageDimensions:{width:null,height:null},options:{},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.uniqueId=new Date().getTime();this.setOptions(b);this.initializeWindow();this.addDOM();this.initializeWindowElement();this.initializeDOM();this.initializeEvent();this.load();this.render();Event.observe(window,"unload",this.close.bind(this))},initializeWindow:function(){},initializeWindowElement:function(){var b=this.getContainer();b.appendChild(this.windowElement);this.windowElement=$(this.windowElement)},destroyWindowElement:function(){if(this.windowElement!==null){var b=this.getContainer();b.removeChild(this.windowElement);this.windowElement=null}},addDOM:function(){},removeDOM:function(){},initializeDOM:function(){},initializeEvent:function(){},load:function(){},render:function(){},addOverlay:function(){if(typeof this.uniqueId=="undefined"){this.uniqueId=new Date().getTime()}var g="overlay"+this.uniqueId;this.overlay=$(g);if(!this.overlay){var d=this.getContainer();var f=Element.extend(document.createElement("div"));f.id=g;f.setStyle({background:"#000",filter:"alpha(opacity=60)",opacity:0.6,zoom:1,zIndex:Windows.getZIndex(),position:Mtime.browser.ie===6?"absolute":"fixed",margin:"0px",padding:"0px",top:"0px",left:"0px",width:Mtime.browser.ie===6?this.pageDimensions.width+"px":"100%",height:Mtime.browser.ie===6?this.pageDimensions.height+"px":"100%"});d.appendChild(f);this.overlay=f}},removeOverlay:function(){if(this.overlay){var b=this.getContainer();this.overlay.setStyle({top:"0px",left:"0px",width:"0px",height:"0px"});b.removeChild(this.overlay);this.overlay=null;delete this.overlay}},getContainer:function(){var b=$("contentEnd");if(typeof b==="undefined"||b===null){b=document.getElementsByTagName("body")[0]}return b},open:function(){this.windowId=this.windowElement.id;if(this.windowId.length===0){this.windowId="window_"+new Date().getTime()}Windows.register(this);this.getScroll();this.getPageDimensions();this.browserDimensions();if(this.createOverlay){this.addOverlay()}this.showWindow();this.setupDimensions();this.prepareIE(true);this.checkIEOverlapping()},visible:function(){return this.windowElement.visible()},close:function(){if(!this.closed){this.closed=true;Windows.unregister(this);this.prepareIE(false);this.hideDimensions();this.hideWindow();if(this.createOverlay){this.removeOverlay()}if(this.iefix){Element.remove(this.iefix)}this.dispose();this.destroyWindowElement()}},getScroll:function(){if(typeof(window.pageYOffset)=="number"){this.pagePosition.x=window.pageXOffset;this.pagePosition.y=window.pageYOffset}else{if(document.body&&(document.body.scrollLeft||document.body.scrollTop)){this.pagePosition.x=document.body.scrollLeft;this.pagePosition.y=document.body.scrollTop}else{if(document.documentElement){this.pagePosition.x=document.documentElement.scrollLeft;this.pagePosition.y=document.documentElement.scrollTop}}}},getPageDimensions:function(){var h,j;if(window.innerHeight&&window.scrollMaxY){h=document.body.scrollWidth;j=window.innerHeight+window.scrollMaxY}else{if(document.body.scrollHeight>document.body.offsetHeight){h=document.body.scrollWidth;j=document.body.scrollHeight}else{h=document.body.offsetWidth;j=document.body.offsetHeight}}var g,f;if(self.innerHeight){g=self.innerWidth;f=self.innerHeight}else{if(document.documentElement&&document.documentElement.clientHeight){g=document.documentElement.clientWidth;f=document.documentElement.clientHeight}else{if(document.body){g=document.body.clientWidth;f=document.body.clientHeight}}}if(j<f){this.pageDimensions.height=f}else{this.pageDimensions.height=j}if(h<g){this.pageDimensions.width=g}else{this.pageDimensions.width=h}},browserDimensions:function(){if(Prototype.Browser.IE){this.dimensions.viewport.height=document.documentElement.clientHeight;this.dimensions.viewport.width=document.documentElement.clientWidth}else{this.dimensions.viewport.height=window.innerHeight;this.dimensions.viewport.width=document.width||document.body.offsetWidth}},setupDimensions:function(){var h=this.dimensions.viewport.height/2+this.pagePosition.y;var j=this.dimensions.viewport.width/2+this.pagePosition.x;var m=this.windowElement.getDimensions();var n=m.width,l=m.height;var k=(h-parseFloat(l)/2);if(k<=0){k=this.fixTopHeight}this.windowElement.setStyle({position:"absolute",top:k+"px",left:(j-parseFloat(n)/2)+"px",zIndex:this.overlay?parseInt(this.overlay.getStyle("zIndex"),10)+1:Windows.getZIndex()})},hideDimensions:function(){this.windowElement.setStyle({position:"absolute",top:"0px",left:"0px",zIndex:0})},prepareIE:function(n){if(Prototype.Browser.IE){var j,l,m;if(n){j="100%"}else{j="auto"}var h=document.getElementsByTagName("body")[0];var k=document.getElementsByTagName("html")[0];k.style.height=h.style.height=j}},toggleTroubleElements:function(r){var q=document.getElementsByTagName("select");for(var m=0;m<q.length;m++){var p=q[m];if(p.style.visibility!=r&&!Element.descendantOf(p,this.windowElement)){p.style.visibility=r}}var n=document.getElementsByTagName("object");for(m=0;m!=n.length;m++){var o=n[m];if(o.style.visibility!=r&&!Element.descendantOf(o,this.windowElement)){o.style.visibility=r}}var l=document.getElementsByTagName("embed");for(m=0;m!=l.length;m++){var k=l[m];if(k.style.visibility!=r&&!Element.descendantOf(k,this.windowElement)){k.style.visibility=r}}},checkIEOverlapping:function(){if(this.createIframe){if(!this.iefix&&IE){new Insertion.After(this.windowElement,'<iframe id="'+this.windowId+'_iefix" style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" src="javascript:false;" frameborder="0" scrolling="no"></iframe>');this.iefix=$(this.windowId+"_iefix")}if(this.iefix){setTimeout(this.fixIEOverlapping.bind(this),1)}}},fixIEOverlapping:function(){if(this.createIframe){if(this.windowElement){Position.clone(this.windowElement,this.iefix);if(this.iefix.getStyle("width")==="0px"){var d=this.windowElement.getDimensions();var c=d.height+30;this.iefix.setStyle({width:d.width+"px",height:c+"px"})}this.iefix.style.zIndex=parseInt(this.windowElement.style.zIndex,10)-1;this.iefix.show()}}},setScroll:function(c,d){window.scrollTo(c,d)},setLocation:function(d,c){this.windowElement.setStyle({top:d+"px",left:c+"px"})},showWindow:function(){this.onWindowResizeHandler=this.onWindowResize.bind(this);Event.observe(window,"resize",this.onWindowResizeHandler);this.onDocumentKeydownHandler=this.onDocumentKeydown.bindAsEventListener(this);Event.observe(document,"keydown",this.onDocumentKeydownHandler);if(this.createOverlay){this.overlay.show()}if(this.createOverlay||this.isToggleTroubleElement){this.toggleTroubleElements("hidden")}this.showWindowElement();if(this.iefix){this.iefix.show()}},hideWindow:function(){Event.stopObserving(window,"resize",this.onWindowResizeHandler);Event.stopObserving(document,"keydown",this.onDocumentKeydownHandler);if(this.createOverlay){this.overlay.hide()}if(this.createOverlay||this.isToggleTroubleElement){this.toggleTroubleElements("visible")}this.hideWindowElement();if(this.iefix){this.iefix.hide()}},showWindowElement:function(){this.windowElement.show()},hideWindowElement:function(){this.windowElement.hide()},getEl:function(l){if(this.windowElement&&this.windowElement!==null){var p=this.windowElement.descendants();if(p&&p.length>0){var o=null;var m=[],q=typeof l=="string";for(var n=0,k=p.length;n<k;n++){o=p[n];if(o.id.length===0){continue}if(q){if(o.id==l){return o}}else{var r=l.indexOf(o.id);if(r>=0){m.push(o)}}}if(m.length>0){return m}}}return null},dispose:function(){},onWindowResize:function(){if(this.closed){return}this.getScroll();this.getPageDimensions();this.browserDimensions();this.setupDimensions()},onDocumentKeydown:function(){}};var Textbox=Mtime.Control.Textbox;Textbox=Class.create();Object.extend(Textbox.prototype,{options:{text:null,value:"",watermarkText:"",focusClassName:"c_000",blurClassName:"c_a5",onKeypressCallback:null,onKeyupCallback:null,onKeydownCallback:null,onClickCallback:null,onFocusCallback:null,onBlurCallback:null,readonly:false},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.initializeEvent();this.load()},initializeField:function(){this.box=null},initializeDOM:function(){this.text=$(this.text)},destroyDOM:function(){this.text.value="";this.text=null},initializeEvent:function(){this.onFocusTextHandler=this.onFocusText.bindAsEventListener(this);this.text.observe("focus",this.onFocusTextHandler);this.onBlurTextHandler=this.onBlurText.bindAsEventListener(this);this.text.observe("blur",this.onBlurTextHandler);if(this.onKeydownCallback!==null){this.onKeydownTextHandler=this.onKeydownText.bindAsEventListener(this);this.text.observe("keydown",this.onKeydownTextHandler)}if(this.onKeypressCallback!==null){this.onKeypressTextHandler=this.onKeypressText.bindAsEventListener(this);this.text.observe("keypress",this.onKeypressTextHandler)}if(this.onKeyupCallback!==null){this.onKeyupTextHandler=this.onKeyupText.bindAsEventListener(this);this.text.observe("keyup",this.onKeyupTextHandler)}if(this.onClickCallback!==null){this.onClickTextHandler=this.onClickText.bindAsEventListener(this);this.text.observe("click",this.onClickTextHandler)}Event.observe(window,"unload",this.close.bind(this))},destroyEvent:function(){this.text.stopObserving("focus",this.onFocusTextHandler);this.text.stopObserving("blur",this.onBlurTextHandler);if(this.onKeydownCallback!==null){this.text.stopObserving("keydown",this.onKeydownTextHandler)}if(this.onKeypressCallback!==null){this.text.stopObserving("keypress",this.onKeypressTextHandler)}if(this.onKeyupCallback!==null){this.text.stopObserving("keyup",this.onKeyupTextHandler)}if(this.onClickCallback!==null){this.text.stopObserving("click",this.onClickTextHandler)}},load:function(){if(this.value.length>0){this.setValue(this.value)}this.initializeWatermarkText()},initializeWatermarkText:function(){if(this.text.value.length===0){this.text.value=this.watermarkText;this.setBlurTextClass()}else{if(this.text.value==this.watermarkText){this.setBlurTextClass()}else{this.setFocusTextClass()}}},setWatermarkText:function(b){this.watermarkText=b;this.initializeWatermarkText()},onFocusText:function(b){if(this.text.value==this.watermarkText){this.text.value=""}this.setFocusTextClass();if(this.onFocusCallback!==null){this.onFocusCallback(this.getValue(),b)}},setFocusTextClass:function(){if(this.focusClassName.length!==0){if(!this.text.hasClassName(this.focusClassName)){this.text.addClassName(this.focusClassName)}}if(this.blurClassName.length!==0){if(this.text.hasClassName(this.blurClassName)){this.text.removeClassName(this.blurClassName)}}},onBlurText:function(b){if(this.text.value.length===0){this.text.value=this.watermarkText}this.setBlurTextClass();if(this.onBlurCallback!==null){this.onBlurCallback(this.getValue(),b)}},setBlurTextClass:function(){if(this.text.value==this.watermarkText){if(this.focusClassName.length!==0){if(this.text.hasClassName(this.focusClassName)){this.text.removeClassName(this.focusClassName)}}if(this.blurClassName.length!==0){if(!this.text.hasClassName(this.blurClassName)){this.text.addClassName(this.blurClassName)}}}},onKeydownText:function(b){this.onKeydownCallback(b)},onKeyupText:function(b){this.onKeyupCallback(b)},onKeypressText:function(b){this.onKeypressCallback(b)},onClickText:function(b){this.onClickCallback(b)},getValue:function(){var b=this.text.value;if(b==this.watermarkText){b=""}return b.trim()},setValue:function(b){this.text.value=b},trim:function(){var b=this.text.value.trim();if(b.length>0){this.setValue(b)}},clear:function(){this.setValue("");this.initializeWatermarkText()},isClosed:false,close:function(){if(!this.isClosed){this.isClosed=true;this.destroyEvent();this.destroyDOM()}}});var MenuBase=Class.create();MenuBase.prototype={SlideTypePrev:0,SlideTypeNext:1,options:{menuRegion:null,contentRegion:null,initializeMenuIndex:0,menuTagName:"",overTimeout:1},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.initializeEvent();this.initializeMenu();this.load();this.render()},initializeField:function(){this.outMenuTimer=null;this.overMenuTimer=null},initializeDOM:function(){this.initializeMenuDOM();if(this.contentRegion){this.contentRegion=$(this.contentRegion);this.contents=this.contentRegion.immediateDescendants()}},initializeMenuDOM:function(){this.menuRegion=$(this.menuRegion);this.menus=this.menuRegion.immediateDescendants()},destroyDOM:function(){this.menus.clear();this.menus=null;if(typeof this.contents!="undefined"){this.contents.clear();this.contents=null}},initializeEvent:function(){this.onOverMenuHandler=this.onOverMenu.bindAsEventListener(this);this.menuRegion.observe("mouseover",this.onOverMenuHandler);this.onOutMenuHandler=this.onOutMenu.bindAsEventListener(this);this.menuRegion.observe("mouseout",this.onOutMenuHandler);this.onClickMenuHandler=this.onClickMenu.bindAsEventListener(this);this.menuRegion.observe("click",this.onClickMenuHandler);Event.observe(window,"unload",this.close.bind(this))},destroyEvent:function(){this.menuRegion.stopObserving("mouseover",this.onOverMenuHandler);this.menuRegion.stopObserving("mouseout",this.onOutMenuHandler);this.menuRegion.stopObserving("click",this.onClickMenuHandler)},initializeMenu:function(){},destroyMenu:function(){},load:function(){if(this.menuTagName.length===0&&this.menus&&this.menus.length>0){this.menuTagName=this.menus[0].tagName.toLowerCase()}},render:function(){if(this.menus!==null&&this.menus.length>0&&this.initializeMenuIndex>=0&&this.initializeMenuIndex<this.menus.length){this.setMenuOn(this.menus[this.initializeMenuIndex])}},onOverMenu:function(f){this.handleOverMenuTimer();var d=Event.findElement(f,this.menuTagName);if(d!==null){this.handleOutMenuTimer(d);var g=FunctionExt.defer(function(a){this.setMenuOver(a)},this.overTimeout,this,[d]);this.overMenuTimer={menu:d,timeout:g}}},handleOverMenuTimer:function(){if(this.overMenuTimer!==null&&this.overMenuTimer.timeout!==null){clearTimeout(this.overMenuTimer.timeout);this.overMenuTimer=null}},handleOutMenuTimer:function(b){if(this.outMenuTimer!==null&&this.outMenuTimer.menu!==null&&this.outMenuTimer.menu==b){clearTimeout(this.outMenuTimer.timeout);this.outMenuTimer=null}},onOutMenu:function(f){this.handleOverMenuTimer();var d=Event.findElement(f,this.menuTagName);if(d!==null){this.handleOutMenuTimer(d);var g=FunctionExt.defer(function(a){this.setMenuOut(a)},1,this,[d]);this.outMenuTimer={menu:d,timeout:g}}},onClickMenu:function(h){var g=Event.findElement(h,this.menuTagName);if(g!==null){var j=this.indexOf(g);if(j>=0){var f=Event.element(h);if(this.onClickMenuCallback){this.onClickMenuCallback(g,j,f)}}}},setMenuOn:function(d){var c=this.indexOf(d);if(c>=0){if(this.onMenuActiveCallback){this.onMenuActiveCallback(d,c)}}},setMenuOff:function(d){var c=this.menus.indexOf(d);if(c>=0){if(this.onMenuInactiveCallback){this.onMenuInactiveCallback(d,c)}}},setMenuOver:function(d){var c=this.menus.indexOf(d);if(c>=0){if(this.onMenuOverCallback){this.onMenuOverCallback(d,c)}}},setMenuOut:function(d){var c=this.menus.indexOf(d);if(c>=0){if(this.onMenuOutCallback){this.onMenuOutCallback(d,c)}}},indexOf:function(k){if(k&&k!==null){var l=this.menus,j=null;for(var h=0,g=l.length;h<g;h++){j=l[h];if(j==k){return h}}}return -1},closed:false,close:function(){if(!this.closed){this.closed=true;this.destroyMenu();this.destroyEvent();this.destroyDOM()}}};var Observer=Class.create();Observer.prototype={options:{sourceElement:null,targetElement:null,timeout:1},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.initializeEvent();this.initializeMenu();this.load();this.render()},initializeField:function(){this.outSourceTimer={};this.overSourceTimer={};this.outTargetTimer={};this.overTargetTimer={}},initializeDOM:function(){this.sourceElement=$(this.sourceElement);this.targetElement=$(this.targetElement)},destroyDOM:function(){this.sourceElement=null;this.targetElement=null},initializeEvent:function(){this.onOverSourceHandler=this.onOverSource.bindAsEventListener(this);this.sourceElement.observe("mouseover",this.onOverSourceHandler);this.onOutSourceHandler=this.onOutSource.bindAsEventListener(this);this.sourceElement.observe("mouseout",this.onOutSourceHandler);this.onClickSourceHandler=this.onClickSource.bindAsEventListener(this);this.sourceElement.observe("click",this.onClickSourceHandler);if(this.targetElement){this.initializeTargetEvent()}Event.observe(window,"unload",this.close.bind(this))},initializeTargetEvent:function(){this.onOverTargetHandler=this.onOverTarget.bindAsEventListener(this);this.targetElement.observe("mouseover",this.onOverTargetHandler);this.onOutTargetHandler=this.onOutTarget.bindAsEventListener(this);this.targetElement.observe("mouseout",this.onOutTargetHandler)},destroyEvent:function(){this.sourceElement.stopObserving("mouseover",this.onOverSourceHandler);this.sourceElement.stopObserving("mouseout",this.onOutSourceHandler);this.sourceElement.stopObserving("click",this.onClickSourceHandler);if(this.targetElement){this.destroyTargetEvent()}},destroyTargetEvent:function(){this.targetElement.stopObserving("mouseover",this.onOverTargetHandler);this.targetElement.stopObserving("mouseout",this.onOutTargetHandler)},initializeMenu:function(){},destroyMenu:function(){},load:function(){},render:function(){},handleOverSourceTimer:function(){if(this.overSourceTimer!==null){clearTimeout(this.overSourceTimer.timeout);this.overSourceTimer=null}this.handleOutTargetTimer()},handleOutSourceTimer:function(){if(this.outSourceTimer!==null){clearTimeout(this.outSourceTimer.timeout);this.outSourceTimer=null}if(this.outTargetTimer!==null){clearTimeout(this.outTargetTimer.timeout);this.outTargetTimer=null}},handleOverTargetTimer:function(){if(this.overTargetTimer!==null){clearTimeout(this.overTargetTimer.timeout);this.overTargetTimer=null}this.handleOutSourceTimer()},handleOutTargetTimer:function(){if(this.outTargetTimer!==null){clearTimeout(this.outTargetTimer.timeout);this.outTargetTimer=null}if(this.outSourceTimer!==null){clearTimeout(this.outSourceTimer.timeout);this.outSourceTimer=null}},onOverSource:function(f){this.handleOverSourceTimer();this.handleOutSourceTimer();var d=Event.element(f);if(d!==null){var g=FunctionExt.defer(function(a){if(this.onOverSourceCallback){this.onOverSourceCallback(a)}},this.timeout,this,[d]);this.overSourceTimer={menu:d,timeout:g}}},onOutSource:function(f){this.handleOverSourceTimer();this.handleOutSourceTimer();var d=Event.element(f);if(d!==null){var g=FunctionExt.defer(function(a){if(this.onOutSourceCallback){this.onOutSourceCallback(a)}},this.timeout,this,[d]);this.outSourceTimer={menu:d,timeout:g}}},onClickSource:function(d){var c=Event.element(d);if(c!==null){if(this.onClickSourceCallback){this.onClickSourceCallback(c)}}},onOverTarget:function(f){this.handleOverTargetTimer();this.handleOutTargetTimer();var d=Event.element(f);if(d!==null){var g=FunctionExt.defer(function(a){if(this.onOverTargetCallback){this.onOverTargetCallback(a)}},this.timeout,this,[d]);this.overTargetTimer={menu:d,timeout:g}}},onOutTarget:function(f){this.handleOverTargetTimer();this.handleOutTargetTimer();var d=Event.element(f);if(d!==null){var g=FunctionExt.defer(function(a){if(this.onOutTargetCallback){this.onOutTargetCallback(a)}},this.timeout,this,[d]);this.outTargetTimer={menu:d,timeout:g}}},closed:false,close:function(){if(!this.closed){this.closed=true;this.destroyMenu();this.destroyEvent();this.destroyDOM()}}};var TabPanel=Class.create();Object.extend(Object.extend(TabPanel.prototype,MenuBase.prototype),{initializeMenu:function(){this.overTimeout=300;this.menuOn=null},destroyMenu:function(){this.menuOn=null},setTab:function(b){this.setMenuOn(this.menus[b])},onMenuActiveCallback:function(d,c){if(this.menuOn!=d){this.on(d,c)}},onMenuOverCallback:function(d,c){this.onClickMenuCallback(d,c)},onClickMenuCallback:function(d,c){if(this.menuOn!=d){this.on(d,c)}},beforeOn:function(d,c){if(this.menuOn&&this.menuOn!=null){this.off(this.menuOn,this.menuOn.index)}this.menuOn=d;this.menuOn.index=c},on:function(d,c){this.beforeOn(d,c);d.addClassName("on");this.showMenuContent(c)},onShowMenuComplete:function(){this.isActive=false},off:function(d,c){if(d.className!=""){d.removeClassName("on");this.hideMenuContent(c)}},showMenuContent:function(c){var d=this.contents[c];if(!$visible(d)){$show(d);if(this.onShowContentCallback){this.onShowContentCallback(c)}}},hideMenuContent:function(c){var d=this.contents[c];if($visible(d)){$hide(d)}}});var AccordionPanel=Class.create();Object.extend(Object.extend(AccordionPanel.prototype,MenuBase.prototype),{initializeMenu:function(){this.menuOn=null;var l=this.menus,k=null,n=[],m=null;for(var j=0,h=this.menus.length;j<h;j++){k=l[j];m=k.down("div");n.push(m)}this.subMenus=n;this.overTimeout=2;this.isActive=false},destroyMenu:function(){this.menuOn=null},onMenuActiveCallback:function(d,c){if(this.menuOn!=d){this.on(d,c)}},onMenuOverCallback:function(d,c){if(this.menuOn!=d){this.on(d,c)}},beforeOn:function(d,c){if(this.menuOn&&this.menuOn!=null){this.off(this.menuOn,this.menuOn.index)}this.menuOn=d;this.menuOn.index=c},on:function(d,c){this.beforeOn(d,c);d.addClassName("on");this.showMenuContent(c)},onShowMenuComplete:function(){this.isActive=false},off:function(d,c){if(d.className!=""){d.removeClassName("on");this.hideMenuContent(c)}},showMenuContent:function(c){var d=this.subMenus[c];if(!$visible(d)){$show(d)}},hideMenuContent:function(c){var d=this.subMenus[c];if($visible(d)){$hide(d)}}});var DropDownList=Mtime.Control.DropDownList;DropDownList=Class.create();Object.extend(DropDownList.prototype,{options:{selectRegion:null,selectDefaultOption:null,selectButton:null,listRegion:null,itemTemplate:'<a href="#" onclick="return false;" value="#{id}">#{text}</a>',selectDatas:null,idFieldName:"",titleFieldName:"",width:-1,height:-1,showCount:8,onChangeCallback:null},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.initializeEvent();this.load();this.render()},initializeField:function(){this.itemTemplate=new Template(this.itemTemplate);this.reset()},reset:function(){this.selectIndex=-1;this.selectedValue=null;this.scrollTop=-1;this.usedDataIds=[];this.active=false;this.listIndex=0},initializeDOM:function(){this.selectRegion=$(this.selectRegion);this.selectDefaultOption=$(this.selectDefaultOption);this.selectDefaultOption._text=this.selectDefaultOption.innerHTML;this.selectButton=$(this.selectButton);this.listRegion=$(this.listRegion)},destroyDOM:function(){this.listRegion=null;this.selectRegion=null;this.selectDefaultOption=null;this.selectButton=null},initializeEvent:function(){this.onClickDefaultOptionHandler=this.onClickDefaultOption.bindAsEventListener(this);this.selectDefaultOption.observe("click",this.onClickDefaultOptionHandler);this.onClickSelectButtonHandler=this.onClickSelectButton.bindAsEventListener(this);this.selectButton.observe("click",this.onClickSelectButtonHandler);this.onClickListRegionHandler=this.onClickListRegion.bindAsEventListener(this);this.listRegion.observe("click",this.onClickListRegionHandler);this.onScrollListRegionHandler=this.onScrollListRegion.bindAsEventListener(this);this.listRegion.observe("scroll",this.onScrollListRegionHandler);this.onClickHandler=this.onClick.bindAsEventListener(this);Event.observe(document.body,"click",this.onClickHandler);Event.observe(window,"unload",this.close.bind(this))},destroyEvent:function(){this.selectDefaultOption.stopObserving("click",this.onClickDefaultOptionHandler);this.selectButton.stopObserving("click",this.onClickSelectButtonHandler);this.listRegion.stopObserving("click",this.onClickListRegionHandler);this.listRegion.stopObserving("scroll",this.onScrollListRegionHandler);Event.stopObserving(document.body,"click",this.onClickHandler)},load:function(){if(this.selectDatas==null||this.selectDatas.length==0){return}this.setSelectedValue(this.selectDatas[0])},show:function(){if(!this.selectRegion.visible()){this.selectRegion.show()}},hide:function(){if(this.selectRegion.visible()){this.selectRegion.hide()}},onClickDefaultOption:function(){this.showSelectList()},onClickSelectButton:function(){this.showSelectList()},onClickListRegion:function(g){var f=Event.findElement(g,"a");if(f&&f.readAttribute){var h=f.readAttribute("value");var j=this.getOption(h);this.setValue(j)}},onScrollListRegion:function(c){var d=this.getScrollTop();if(d>=this.scrollTop){if(!this.active){this.active=true;this.scrollTop=d;this.render();this.active=false}}},render:function(){var b=this.getMoreLists();if(b&&b.length>0){b.each(function(a){this.listRegion.appendChild(a)}.bind(this))}},setValue:function(b){this.setSelectedValue(b);this.hideSelectList()},setValueById:function(b){this.setValue(this.getOption(b))},setData:function(b){this.reset();this.listRegion.innerHTML="";this.selectDefaultOption.innerHTML=this.selectDefaultOption._text;this.selectDatas=b;this.render()},getMoreLists:function(){if(this.selectDatas==null||this.selectDatas.length==0){return""}var t=this.showCount,s=this.selectDatas,r=null,q=[],p=0,o=this.itemTemplate;for(var m=this.listIndex,l=s.length;m<l&&p<t;m++){r=s[m];var n=r[this.idFieldName];if(!this.usedDataIds.include(n)){this.usedDataIds.push(n);q.push(Builder.build(this.createListItem(r)));p++;this.listIndex=m}}this.listIndex++;return q},createListItem:function(b){return this.itemTemplate.evaluate(b)},onClick:function(d){var c=Event.element(d);if(!this.contain(c)){this.hideSelectList()}},showSelectList:function(){if(!this.listRegion.visible()){this.listRegion.show();this.scrollTop=this.getScrollTop()}else{this.hideSelectList()}},hideSelectList:function(){if(this.listRegion.visible()){this.listRegion.hide()}},setSelectedValue:function(b){if(b!=null){if(this.selectedValue==null||this.selectedValue[this.idFieldName]!=b[this.idFieldName]){this.selectDefaultOption.innerHTML=b[this.titleFieldName];this.selectedValue=b;if(this.onChangeCallback&&this.onChangeCallback!=null){this.onChangeCallback(b)}}}},contain:function(b){return b.descendantOf(this.selectRegion)},getValue:function(){return this.selectedValue},getOption:function(d){var g=null;var f=this.idFieldName;this.selectDatas.each(function(a){if(a[f]==d){g=a;throw $break}});return g},getScrollTop:function(){return Position.realOffset(this.listRegion)[1]},isClosed:false,close:function(){if(!this.isClosed){this.isClosed=true;if(this.selectDatas!=null&&this.selectDatas!=""){this.selectDatas.clear()}this.hideSelectList();this.destroyEvent();this.destroyDOM()}}});var DropDownMenu=Mtime.Control.DropDownList;DropDownMenu=Class.create();Object.extend(DropDownMenu.prototype,{name:"DropDownMenu",visible:false,menuButton:null,menuContent:null,canHide:null,onClickMenuButtonHandler:null,onClickDocumentHandler:null,options:{menuButton:"",menuContent:"",canHide:null},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeDOM();this.initializeEvent()},initializeDOM:function(){this.menuButton=$(this.menuButton);this.menuContent=$(this.menuContent)},destroyDOM:function(){this.menuButton=this.menuContent=null},initializeEvent:function(){this.onClickMenuButtonHandler=this.onClickMenuButton.bindAsEventListener(this);this.menuButton.observe("click",this.onClickMenuButtonHandler);this.onClickMenuContentHandler=this.onClickMenuContent.bindAsEventListener(this);this.menuContent.observe("click",this.onClickMenuContentHandler);this.onClickDocumentHandler=this.onClickDocument.bindAsEventListener(this);Event.observe(document,"click",this.onClickDocumentHandler)},destroyEvent:function(){Event.stopObserving(document,"click",this.onClickDocumentHandler);this.onClickDocumentHandler=null;this.menuButton.stopObserving("click",this.onClickMenuButtonHandler);this.onClickMenuButtonHandler=null;this.menuContent.stopObserving("click",this.onClickMenuContentHandler);this.onClickMenuContentHandler=null},onClickMenuButton:function(b){this.visible=!this.menuContent.visible()},onClickMenuContent:function(b){this.visible=this.menuContent.visible()},onClickDocument:function(d){if(this.visible){this.menuContent.show()}else{var c=true;if(this.canHide){c=this.canHide()}if(c){this.menuContent.hide()}}this.visible=false},close:function(){this.destroyEvent();this.destroyDOM()}});var AutoCompleteBase=Mtime.Control.AutoCompleteBase;AutoCompleteBase=Class.create();Object.extend(AutoCompleteBase.prototype,{options:{text:null,textWatermarkText:"",listRegion:null,itemTemplate:"",searchDatas:null,defaultSearchDatas:null,idFieldName:"id",titleFieldName:"title",choiceCount:8,frequency:0.1,minChars:1,isMatch:null,isShowMoreResult:true,isAlwayShowList:true,isEnable:true,onChangeInputCallback:null,onChangeCallback:null,isAutoMatchSuggest:false,onEnterCallback:null,searchType:0},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},baseInitialize:function(b){this.setOptions(b);this.baseInitializeField();this.initializeField();this.baseInitializeDOM();this.initializeDOM();this.baseInitializeEvent();this.initializeEvent();this.initializeControl();this.load()},baseInitializeField:function(){this.itemTemplate=new Template(this.itemTemplate);this.selectedValue=null;this.scrollTop=-1;this.active=false;this.searchIndex=0;this.hasFocus=false;this.changed=false;this.index=-1;this.entryCount=0;this.observer=null;this.keyword=""},initializeField:function(){},baseInitializeDOM:function(){this.text=$(this.text);this.text.setAttribute("autocomplete","off");this.listRegion=$(this.listRegion)},initializeDOM:function(){},baseDestroyDOM:function(){this.listRegion=null;this.text=null},destroyDOM:function(){},baseInitializeEvent:function(){this.onScrollListRegionHandler=this.onScrollListRegion.bindAsEventListener(this);this.listRegion&&this.listRegion.observe("scroll",this.onScrollListRegionHandler);this.onClickListRegionHandler=this.onClickListRegion.bindAsEventListener(this);this.listRegion&&this.listRegion.observe("click",this.onClickListRegionHandler);this.onClickHandler=this.onClick.bindAsEventListener(this);Event.observe(document.body,"click",this.onClickHandler);Event.observe(window,"unload",this.close.bind(this))},initializeEvent:function(){},baseDestroyEvent:function(){this.listRegion&&this.listRegion.stopObserving("scroll",this.onScrollListRegionHandler);this.listRegion&&this.listRegion.stopObserving("click",this.onClickListRegionHandler);Event.stopObserving(document.body,"click",this.onClickHandler)},destroyEvent:function(){},changeWaterMarkText:function(b){this.textbox.watermarkText=b},initializeControl:function(){this.textbox=new Textbox({text:this.text,value:this.text.value,watermarkText:this.textWatermarkText,focusClassName:"c_000",blurClassName:"c_a5",onFocusCallback:this.onFocusText.bind(this),onBlurCallback:this.onBlurText.bind(this),onKeydownCallback:this.onKeydownText.bind(this),onKeyupCallback:this.onKeydownText.bind(this),onClickCallback:this.onClickText.bind(this)})},destroyControl:function(){this.textbox.close()},load:function(){},onBlurText:function(d,c){this.active=false;this.hasFocus=false;if(d!==""&&!this.listRegion.visible()){this.search()}setTimeout(this.hide.bind(this),250)},onFocusText:function(b){this.hasFocus=true;this.active=true},onKeydownText:function(b){if(this.handled){this.handled=false;return}this.handled=true;switch(b.keyCode){case Event.KEY_TAB:case Event.KEY_RETURN:this.onEnterText();Event.stop(b);return;case Event.KEY_ESC:this.hide();Event.stop(b);return;case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:this.markPrevious();Event.stop(b);return;case Event.KEY_DOWN:this.markNext();Event.stop(b);return;default:this.addObserver();this.onChangeInput();break}},onEnterText:function(){this.search();if(this.onEnterCallback){this.onEnterCallback(this.getValue())}},onClickText:function(){this.render()},onClick:function(d){var c=Event.element(d);if(c!=this.text&&!this.contain(c)){this.hide()}},onClickListRegion:function(d){var c=Event.findElement(d,"a");if(c){this.removeObserver();this.selectedEntry(c);if(this.onEnterCallback){this.onEnterCallback(this.getValue())}}},onScrollListRegion:function(c){var d=this.getScrollTop();if(d>=this.scrollTop){if(!this.active){this.active=true;this.scrollTop=d;this.render();this.active=false}}},reset:function(){this.selectedValue=null;this.index=-1;this.searchIndex=0;this.entryCount=0},render:function(){if(this.searchDatas===null&&this.getSearchDataCallback!==null){this.getSearchDataCallback(function(b){this.searchDatas=b;this.doRender()}.bind(this))}else{this.doRender()}},doRender:function(){if(this.isEnable){if(this.changed){this.reset()}var c=this.getSearchKeyword();if(c.length==0){this.removeObserver();this.renderDefaultList()}else{var d=this.getMoreLists();if(this.isAlwayShowList||this.entryCount>0){this.renderTip(c,this.entryCount);this.renderList(this.changed,d);this.showSelectList()}else{this.hideSelectList()}}}},renderDefaultList:function(){if(this.defaultSearchDatas){var k=this.choiceCount,r=this.defaultSearchDatas,q=null,p=[],n=new StringBuilder(),o=0;for(var m=0,l=r.length;m<l&&o<k;m++){q=r[m];n.append(this.createListItem(q));o++}this.entryCount=o;this.renderTip("",0);this.renderList(true,n.toString());this.showSelectList()}else{this.hideSelectList()}},renderTip:function(c,d){},renderList:function(c,d){if(!c){this.listRegion.innerHTML+=d}else{this.listRegion.innerHTML=d}},getMoreLists:function(){var v=this.getSearchKeyword(),w=v.length,q=this.choiceCount,B=this.searchDatas,A=null,z=[],x=new StringBuilder(),y=0,u=this.idFieldName,D=this.titleFieldName;for(var s=this.searchIndex,r=B.length;s<r&&y<q;s++){A=B[s];var C=A[D],t=A[u];if(w==0){x.append(this.createListItem(A));y++}else{if(this.match(v,A)){x.append(this.createListItem(A));y++}}}this.entryCount+=y;return x.toString()},onChangeInput:function(){this.changed=true;if(this.onChangeInputCallback!=null){if(this.onChangeInputTimer){clearTimeout(this.onChangeInputTimer)}this.onChangeInputTimer=setTimeout(function(){this.onChangeInputCallback()}.bind(this),10)}},addObserver:function(){this.removeObserver();this.observer=setInterval(this.onObserverEvent.bind(this),this.frequency*1000)},removeObserver:function(){if(this.observer){clearInterval(this.observer)}},onObserverEvent:function(){var b=this.getSearchKeyword();if(b.length>=this.minChars){if(b!=this.keyword){this.keyword=b;this.render()}}else{this.keyword="";this.active=false;this.hideSelectList()}},markPrevious:function(){this.setEntryOff(this.index);if(this.index>0){this.index--}else{this.index=this.entryCount-1}this.setEntryOn(this.index)},markNext:function(){this.setEntryOff(this.index);if(this.index<this.entryCount-1){this.index++}else{this.index=0}this.setEntryOn(this.index)},setEntryOn:function(d){var c=this.getEntry(this.index);if(c&&c!=null){c.className="on"}},setEntryOff:function(d){var c=this.getEntry(this.index);if(c&&c!=null){c.className=""}},getCurrentEntry:function(){return this.getEntry(this.index)},getEntry:function(b){return this.listRegion.childNodes[b+1]},selectEntry:function(){this.active=false;var b=this.getCurrentEntry();if(b){this.removeObserver();this.selectedEntry(b.down("a"))}},selectedEntry:function(d){if(d&&d.readAttribute){var g=d.readAttribute("value");if(g&&g.length>0){var f=this.getOption(g);this.setValue(f)}}},search:function(){if(this.index===-1){if(this.isAutoMatchSuggest){this.render();this.index=0}}this.selectEntry()},setValue:function(b){this.setSelectedValue(b);this.hideSelectList()},match:function(f,g){var d=g[this.titleFieldName].toLowerCase().indexOf(f);if(d==0){return true}return false},createListItem:function(b){return this.itemTemplate.evaluate(b)},show:function(){this.showSelectList()},showSelectList:function(){if(this.listRegion!=null&&!this.listRegion.visible()){this.listRegion.show();this.scrollTop=this.getScrollTop()}},hideSelectList:function(){if(this.listRegion!=null){if(this.listRegion.visible()){this.listRegion.hide()}}},hide:function(){this.hideSelectList()},setSelectedValue:function(b){if(b!=null){if(this.selectedValue===null||this.selectedValue[this.idFieldName]!=b[this.idFieldName]){this.textbox.setValue(b[this.titleFieldName]);this.selectedValue=b;if(this.onChangeCallback&&this.onChangeCallback!=null){this.onChangeCallback(b)}}}},getValue:function(){return this.selectedValue},getOption:function(d){var g=null;var f=this.idFieldName;this.searchDatas.each(function(a){if(a[f]==d){g=a;throw $break}});return g},getSearchKeyword:function(){return this.textbox.getValue()},getScrollTop:function(){return Position.realOffset(this.listRegion)[1]},contain:function(b){return b.descendantOf(this.listRegion)},setEnable:function(b){this.isEnable=b},isClosed:false,close:function(){if(!this.isClosed){this.isClosed=true;if(this.observer){clearTimeout(this.observer)}if(this.searchDatas!=null){this.searchDatas=null}this.destroyControl();this.hideSelectList();this.baseDestroyEvent();this.destroyEvent();this.baseDestroyDOM();this.destroyDOM()}}});var KeywordAutoComplete=Class.create();Object.extend(Object.extend(KeywordAutoComplete.prototype,AutoCompleteBase.prototype),{initialize:function(b){this.type=typeof b.type==="undefined"?"all":b.type;this.baseInitialize(b)},initializeField:function(){this.isAlwayShowList=false;this.isShowMoreResult=false},initializeDOM:function(){},destroyDOM:function(){},initializeEvent:function(){},destroyEvent:function(){},getEntry:function(d){var c=this.listRegion.childNodes.length;if(c>d&&d>=0){return $(this.listRegion.childNodes[d])}return null},selectEntry:function(){this.active=false;var b=this.getCurrentEntry();this.selectedEntry(b)},getOption:function(d){var g=null;var f=this.idFieldName;this.searchDatas[d.charAt(0).toLowerCase()].each(function(a){if(a[f]==d){g=a;throw $break}});return g},getMoreLists:function(){var w=this.getSearchKeyword(),x=w.length,r=this.choiceCount,D=this.searchDatas,C=null,B=[],z=new StringBuilder(),A=0,v=this.idFieldName,F=this.titleFieldName;var y=x===0?D[0]:D[w.charAt(0).toLowerCase()];if(y){for(var t=this.searchIndex,s=y.length;t<s&&A<r;t++){C=y[t];var E=C[F],u=C[v];if(this.match(w,C)){if(C.count>0){C.display=""}else{C.display='style="display:none;"'}z.append(this.createListItem(C));A++}this.searchIndex=t}this.entryCount+=A}return z.toString()},match:function(f,g){if(this.type!=="all"){if(this.type==="movie"){if(g.type!==1){return false}}if(this.type==="person"){if(g.type!==2){return false}}}var d=g[this.titleFieldName].toLowerCase().indexOf(f.toLowerCase());if(d==0){return true}return false},renderTip:function(c,d){},renderList:function(c,d){this.listRegion.innerHTML=d},setType:function(b){this.type=b},equal:function(c,d){if(this.type!=="all"){if(this.type==="movie"){if(d.type!==1){return false}}if(this.type==="person"){if(d.type!==2){return false}}}if(d[this.titleFieldName]==c){return true}else{return false}},isIntern:function(n){var m=this.searchDatas;var k=this.idFieldName;if(n.length===0){return true}else{var l=m[n.charAt(0).toLowerCase()];if(l){for(var j=0,h=l.length;j<h;j++){if(this.equal(n,l[j])){return true}}}return false}}});var Search=Class.create();Object.extend(Search.prototype,{options:{textbox:"",textboxSuggestRegion:"",searchButton:"",selectTypeRegion:"",selectTypeDefaultOption:"",selectTypeButton:"",selectTypeListRegion:"",selectTypeDatas:null,itemTemplate:'<a href="#" onclick="return false;" value="#{id}">#{text}</a>',watermark:"",actionUrl:"/search/",isMini:false},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.initializeEvent();this.initializeControl()},initializeField:function(){this.type=""},initializeDOM:function(){this.textbox=$(this.textbox);this.searchButton=$(this.searchButton);this.selectTypeRegion=$(this.selectTypeRegion);if(this.isMini){this.currentTypeElement=$("all")}},destroyDOM:function(){this.textbox=null;this.searchButton=null;this.selectTypeRegion=null;if(this.isMini){this.currentTypeElement=null}},initializeEvent:function(){this.onClickSearchButtonHandler=this.onClickSearchButton.bindAsEventListener(this);this.searchButton.observe("click",this.onClickSearchButtonHandler);if(this.selectTypeRegion){if(this.isMini){this.onClickSelectTypeRegionHandler=this.onClickSelectTypeRegion.bindAsEventListener(this);this.selectTypeRegion.observe("click",this.onClickSelectTypeRegionHandler)}}Event.observe(window,"unload",this.close.bind(this))},destroyEvent:function(){this.searchButton.stopObserving("click",this.onClickSearchButtonHandler);if(this.selectTypeRegion){if(this.isMini){this.selectTypeRegion.stopObserving("click",this.onClickSelectTypeRegionHandler)}}},initializeControl:function(){if(this.selectTypeRegion){if(!this.isMini){this.typeDropDownList=new DropDownList({selectRegion:this.selectTypeRegion,selectDefaultOption:this.selectTypeDefaultOption,selectButton:this.selectTypeButton,listRegion:this.selectTypeListRegion,itemTemplate:'<a href="#" onclick="return false;" value="#{id}">#{text}</a>',selectDatas:this.selectTypeDatas,idFieldName:"id",titleFieldName:"text",showCount:6,onChangeCallback:this.onChangeTypeCallback.bind(this)})}}this.keywordAutoComplete=new KeywordAutoComplete({text:this.textbox,textWatermarkText:this.watermark,listRegion:this.textboxSuggestRegion,itemTemplate:'<a href="#" value="#{word}"><em #{display}> #{count} </em>#{word}</a>',idFieldName:"word",titleFieldName:"word",searchDatas:null,getSearchDataCallback:function(b){$loadJs("/Utility/Data/SearchKeywordData.m",function(){b(searchKeywordData)})}.bind(this),choiceCount:8,onChangeInputCallback:null,onChangeCallback:null,onEnterCallback:this.onEnter.bind(this)})},destroyControl:function(){if(this.keywordAutoComplete){this.keywordAutoComplete.close()}if(this.typeDropDownList){this.typeDropDownList.close()}},load:function(){},onClickSearchButton:function(){var b=this.getKeyword();this.search(b)},onClickSelectTypeRegion:function(c){var d=Event.findElement(c,"li");if(d&&d.id){this.type=d.id;if(this.currentTypeElement){this.currentTypeElement.className=""}d.className="current";this.currentTypeElement=d;if(this.keywordAutoComplete){if(this.type=="all"||this.type=="movie"||this.type=="person"){this.keywordAutoComplete.setType(this.type);this.keywordAutoComplete.setEnable(true)}else{this.keywordAutoComplete.setEnable(false)}}}},onChangeTypeCallback:function(b){this.type=b.id;if(this.keywordAutoComplete){if(this.type=="all"||this.type=="movie"||this.type=="person"){this.keywordAutoComplete.setType(this.type);this.keywordAutoComplete.setEnable(true)}else{this.keywordAutoComplete.setEnable(false)}}},onEnter:function(d){var c="";if(!d){c=this.getKeyword()}else{c=d.word}this.search(c)},search:function(c){if((this.type=="all"||this.type=="movie"||this.type=="person")&&!this.keywordAutoComplete.isIntern(c)){setCookie("searchPrompt",c)}if(c.length>0){var d=siteUrl+this.actionUrl+(this.type==="all"?"":this.type)+"?"+encodeURIComponent(c).replace(/'/g,"%27");$redirect(d)}},getKeyword:function(){var b="";if(this.keywordAutoComplete){b=this.keywordAutoComplete.getSearchKeyword()}else{b=this.textbox.value}return b},isClosed:false,close:function(){if(!this.isClosed){this.isClosed=true;this.destroyControl();this.destroyEvent();this.destroyDOM()}}});function $fetchMovieRating(q,r){var n=r||'<span class="total">#{integer}</span><span class="total2">.#{decimals}</span>',l=$(q),k=l.getElementsBySelector('[data_rating_movie_id!=""]'),o={},p=[];k.each(function(a){var b=a.readAttribute("data_rating_movie_id");if(o[b]){o[b].push(a)}else{o[b]=[a];p.push(b)}});p=p.join("|");function m(a){if(a&&a.value){a.value.each(function(c){var b=o[c.movieId],f,d;if(b&&c.rating>0){b.each(function(g){f=new Template(g.readAttribute("data_rating_movie_template")||n);d=c.rating.toFixed(1).split(".");g.innerHTML=f.evaluate({integer:d[0],decimals:d[1]})})}else{b&&b.each(function(g){g.innerHTML=""})}});o=null;p=null;k=null;l=null}}Mtime.Component.Ajax.get("Mtime.Service.Pages.MovieService","GetRatingsByMovieIds",[p],m,"/Service/Movie.msi","get","40000")}function $fetchMoviePeopleRating(y,z){var r=z||'<span class="total">#{integer}</span><span class="total2">.#{decimals}</span>',p=$(y),o=p.getElementsBySelector('[data_rating_id!=""]'),t={},u=[],w={},x=[];o.each(function(a){var c=a.readAttribute("data_rating_id"),f=a.readAttribute("data_rating_type"),b,d;if(f==1){b=t;d=u}else{b=w;d=x}if(b[c]){b[c].push(a)}else{b[c]=[a];d.push(c)}});o=null;p=null;function q(b,a){if(b&&b.value){b.value.each(function(g){var d=a===1?t:w,f=a===1?g.movieId:g.peopleId,c=d[f],j,h;if(c&&g.rating>0){c.each(function(k){j=new Template(k.readAttribute("data_rating_template")||r);h=g.rating.toFixed(1).split(".");k.innerHTML=j.evaluate({integer:h[0],decimals:h[1]})})}else{c&&c.each(function(k){k.innerHTML=""})}})}}function s(a){q(a,1);t=null;u=null}function v(a){q(a,2);w=null;x=null}Mtime.Component.Ajax.get("Mtime.Service.Pages.MovieService","GetRatingsByMovieIds",[u.join("|")],s,"/Service/Movie.msi","get","40000")}var ShowtimeCityAutoComplete=Class.create();Object.extend(Object.extend(ShowtimeCityAutoComplete.prototype,AutoCompleteBase.prototype),{initialize:function(b){this.baseInitialize(b)},initializeField:function(){this.firstRender=true;this.isShowMoreResult=false;this.isAutoMatchSuggest=true},initializeDOM:function(){this.listTipText=$(this.listTipText);this.listContentRegion=$(this.listContentRegion)},destroyDOM:function(){this.listTipText=null;this.listContentRegion=null},initializeEvent:function(){},destroyEvent:function(){},getEntry:function(d){var c=this.listContentRegion.childNodes.length;if(c>d&&d>=0){return $(this.listContentRegion.childNodes[d])}return null},match:function(c,d){if((d.NameCn.toLowerCase().indexOf(c)===0)||(d.NameEn.toLowerCase().indexOf(c)===0)){return true}return false},renderTip:function(c,d){if(this.firstRender||c===""){this.firstRender=false;this.listTipText.innerHTML="/&uarr;&darr;"}else{if(d>0){this.listTipText.innerHTML=c.stripTags()+""}else{this.listTipText.innerHTML=""+c.stripTags()}}},renderList:function(c,d){this.listContentRegion.innerHTML=d}});var defaultCityIds=[290,292,365,366,561,880];var ShowtimeHelper={getDefaultCitys:function(o){var m=[];for(var n=0,l=defaultCityIds.length;n<l;n++){var k=defaultCityIds[n];var j=this.getCity(o,k);if(j!==null){m.push(j)}}if(m.length<defaultCityIds.length){var p=defaultCityIds.length-m.length;for(var n=0,l=o.length;n<l;n++){if(p===0){break}if(!defaultCityIds.include(o[n].Id)){m.push(o[n]);p--}}}return m},getCity:function(j,f){for(var g=0,h=j.length;g<h;g++){if(f==j[g].Id){return j[g]}}return null},getDistricts:function(n){var k=n.Districts.List;if(k){var q=[];q.push({Id:0,NameCn:""});var m="",l=[];for(var r=0,o=k.length;r<o;r++){var p=k[r];if(p.MovieIds){m+=p.MovieIds}if(p.Cinemas.List){p.Cinemas.List.each(function(a){l.push(a)})}q.push(p)}if(m.length>0){q[0].MovieIds=m}if(l.length>0){q[0].Cinemas={List:l}}return q}return k},getDistrict:function(g,j){var k=g.Districts.List;for(var l=0,h=k.length;l<h;l++){if(j==k[l].Id){return k[l]}}return null}};var HeaderTheaterSearchBox=Class.create();HeaderTheaterSearchBox.prototype={server:{getData:function(b){$loadJs("/Utility/Data/TheaterSearchBoxData.m",b)},getLocation:function(b){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.UserService","GetLocation",[],b,"/Service/User.m?Ajax_CallBack=true","get","25000")},search:function(f,h,j,g){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.UserService","SearchShowtime",[f,h,j],g,"/Service/User.m?Ajax_CallBack=true","get","25000")}},options:{searchCityText:"",cityListRegion:"",cityListTipText:"",cityListContentRegion:"",selectMovieRegion:"",selectMovieListContainerRegion:"t_movieListContainerRegion",selectMovieListRegion:"",searchShowtimeButton:""},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);if(typeof threaterSearchBoxData==="undefined"){this.server.getData(function(){this.initializeThreaterSearchBoxData()}.bind(this))}else{this.initializeThreaterSearchBoxData()}},initializeThreaterSearchBoxData:function(){this.data=threaterSearchBoxData;this.initializeField();this.initializeData();this.initializeDOM();this.initializeEvent();this.initializeControl();this.render()},initializeField:function(){this.defaultCityIds=defaultCityIds},initializeData:function(){if(this.data.locations){this.locations=this.data.locations.List;this.defaultCityDatas=ShowtimeHelper.getDefaultCitys(this.locations);this.movies=this.data.movies}},initializeDOM:function(){this.searchCityText=$(this.searchCityText);this.cityListRegion=$(this.cityListRegion);this.cityListTipText=$(this.cityListTipText);this.cityListContentRegion=$(this.cityListContentRegion);this.selectMovieRegion=$(this.selectMovieRegion);this.selectMovieListContainerRegion=$(this.selectMovieListContainerRegion);this.selectMovieListRegion=$(this.selectMovieListRegion);this.searchShowtimeButton=$(this.searchShowtimeButton)},destroyDOM:function(){this.searchCityText=null;this.cityListRegion=null;this.cityListTipText=null;this.cityListContentRegion=null;this.selectMovieRegion=null;this.selectMovieListContainerRegion=null;this.selectMovieListRegion=null;this.searchShowtimeButton=null},initializeEvent:function(){this.onClickSearchButtonHandler=this.onClickSearchButton.bindAsEventListener(this);this.searchShowtimeButton.observe("click",this.onClickSearchButtonHandler);this.onClickSelectMovieListRegionHandler=this.onClickSelectMovieListRegion.bindAsEventListener(this);this.selectMovieListRegion.observe("click",this.onClickSelectMovieListRegionHandler);Event.observe(window,"unload",this.close.bind(this))},destroyEvent:function(){this.searchShowtimeButton.stopObserving("click",this.onClickSearchButtonHandler);this.selectMovieListRegion.stopObserving("click",this.onClickSelectMovieListRegionHandler)},initializeControl:function(){this.cityAutoComplete=new ShowtimeCityAutoComplete({text:this.searchCityText,textWatermarkText:"",listRegion:this.cityListRegion,listTipText:this.cityListTipText,listContentRegion:this.cityListContentRegion,itemTemplate:'<a href="#" onclick="return false;" value="#{Id}"><span class="fr">#{NameCn}</span>#{NameEn}</a>',idFieldName:"Id",titleFieldName:"NameCn",searchDatas:this.locations,defaultSearchDatas:this.defaultCityDatas,choiceCount:8,onChangeInputCallback:this.onChangeCityInputCallback.bind(this),onChangeCallback:this.onChangeCityCallback.bind(this)});this.server.getLocation(function(){var b=getLocationResult;if(b&&b.value){this.initializeCityLocation(b.value)}}.bind(this));this.observer=new Observer({sourceElement:this.selectMovieRegion,onOverSourceCallback:function(){if(this.menuTimeout){clearTimeout(this.menuTimeout);this.menuTimeout=null}if(!this.selectMovieListContainerRegion.visible()){this.selectMovieListContainerRegion.show()}}.bind(this),onOutSourceCallback:function(){this.menuTimeout=setTimeout(function(){if(this.selectMovieListContainerRegion.visible()){this.selectMovieListContainerRegion.hide()}}.bind(this),100)}.bind(this)})},destroyControl:function(){if(this.cityAutoComplete){this.cityAutoComplete.close()}if(this.observer){this.observer.close()}},initializeCityLocation:function(g){var f=g.cityId;if(f>0){var d=this.getCity(f);if(d!==null){this.city=d;this.cityAutoComplete.setValue(d)}}else{this.setMovieList(this.movies)}},render:function(){},onChangeCityInputCallback:function(){if(this.cityAutoComplete.getSearchKeyword().length===0){this.setMovieList(this.movies)}else{this.setMovieList(null)}},onChangeCityCallback:function(h){var j=[];if(h.MovieIds){var n=h.MovieIds.split("|");for(var l=0,k=n.length;l<k;l++){var m=this.getMovie(n[l]);if(m!==null){j.push(m)}}}else{j=this.movies}this.setMovieList(j)},onClickSearchButton:function(){var f=this.cityAutoComplete.getValue();if(f&&f!==null){var g=f.Id,h=0,j=0;this.server.search(g,h,j,this.onSearchCallback.bind(this))}},onSearchCallback:function(){var b=searchShowtimeResult;if(b&&b.value&&b.value.length>0){$redirect(b.value)}},onClickSelectMovieListRegion:function(m){var l=Event.findElement(m,"a");if(l){var n=l.readAttribute("movieid");if(n&&n.length>0){var h=this.cityAutoComplete.getValue();if(h&&h!==null){var j=h.Id,k=0;this.server.search(j,k,n,this.onSearchCallback.bind(this))}else{$redirect(siteUrl+"/showtime/"+n+"/")}}}},setMovieList:function(d){var c=this.buildMovieList(d);this.selectMovieListRegion.innerHTML=c},buildMovieList:function(l){if(l!==null&&l.length>0){var g=new StringBuilder(),k=null;for(var j=0,h=l.length;j<h;j++){k=l[j];g.append(String.format('<a href="#" onclick="return false;" movieid="{2}"><span class="fr">{0}</span>{1}</a>',(parseInt(k.Third,10)>0?k.Third:""),k.Second,k.First))}return g.toString()}return""},getCity:function(d){for(var f=0,g=this.locations.length;f<g;f++){if(d==this.locations[f].Id){return this.locations[f]}}return null},getDistrict:function(g,j){var k=g.Districts.List;for(var l=0,h=k.length;l<h;l++){if(j==k[l].Id){return k[l]}}return null},getMovie:function(g){for(var f=0,d=this.movies.length;f<d;f++){if(g==this.movies[f].First){return this.movies[f]}}return null},isClosed:false,close:function(){if(!this.isClosed){this.isClosed=true;this.destroyControl();this.destroyEvent();this.destroyDOM()}}};var PageSearchControl=Class.create();Object.extend(PageSearchControl.prototype,{server:{getSuggestions:function(d,c){return Mtime.Component.Ajax.request(siteServiceUrl,"Mtime.Service.Pages.UtilityService","GetSuggestionKeywords",[d],c,"/service/utility.msi","get","20000")},GetSuggestObjs:function(f,g,d){this.cityId=getCookie("DefaultCity-CookieKey");if(!this.cityId){this.cityId=290}return Mtime.Component.Ajax.crossDomainCallBack(siteChannelServiceUrl,"Mtime.Channel.Services","GetSuggestObjs",[f,this.cityId,g],d,"/Search.api","get","60000")}},options:{searchRegion:"",suggestRegion:"",watermark:"",text:"",actionUrl:siteSearchUrl+"/search/",timer:0.1,type:"all",showCount:5,goodsActionUrl:"",searchType:0,watermarks:["","","","",""],typeRegion:"",typeListRegion:""},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.initializeEvent();this.load()},initializeField:function(){this.searchRegion=$(this.searchRegion);this.suggestRegion=$(this.suggestRegion)},initializeDOM:function(){this.textBox=this.searchRegion.down("input.text");this.submitButton=this.searchRegion.down("input.button")},initializeEvent:function(){this.onButtonClickHandler=this.onButtonClick.bind(this);this.submitButton&&Event.observe(this.submitButton,"click",this.onButtonClickHandler);Event.observe(window,"unload",this.close.bind(this));this.onTypeRegionClickHandler=this.onClickTypeRegion.bind(this);this.typeRegion&&Event.observe(this.typeRegion,"click",this.onTypeRegionClickHandler);$A(this.typeListRegion.down("ul").childNodes).each(function(f){var g=f.getAttribute("searchtype");var d=f.innerHTML;Event.observe(f,"click",function(){this.searchType=parseInt(g);this.typeRegion.down("strong").innerHTML=d;this.typeListRegion.hide();var b=this.textBox.value;var a=false;$A(this.watermarks).each(function(c){if(b==c){a=true}});this.keywordAutoComplete.searchType=this.searchType;this.keywordAutoComplete.changeWaterMarkText(this.watermarks[this.searchType]);if(a){this.textBox.value=this.watermarks[this.searchType]}}.bind(this))}.bind(this));this.onClickPageHandler=this.onClickPage.bindAsEventListener(this);Event.observe(document.body,"click",this.onClickPageHandler)},destroyEvent:function(){this.submitButton&&Event.stopObserving(this.submitButton,"click",this.onButtonClickHandler);this.onWindowClickHandler&&Event.stopObserving(document,"click",this.onWindowClickHandler);this.submitButton&&this.submitButton.stopObserving("mouseover",this.searchBtnMouseOverHandler);this.submitButton&&this.submitButton.stopObserving("mouseout",this.searchBtnMouseOutHandler);this.typeRegion&&this.typeRegion.stopObserving("click",this.onTypeRegionClickHandler)},destroyDOM:function(){this.keywordAutoComplete&&this.keywordAutoComplete.close();this.textBox=null;this.submitButton=null},closed:function(){this.destroyEvent();this.destroyDOM()},close:function(){this.destroyEvent();this.destroyDOM()},onClickPage:function(d){var f=Event.pointerX(d);var g=Event.pointerY(d);if(!Position.within(this.typeRegion,f,g)&&!Position.within(this.typeListRegion,f,g)){if(this.typeListRegion.style.display!="none"){this.typeListRegion.hide()}}},onClickTypeRegion:function(){if(this.typeListRegion){if(this.typeListRegion.visible()){this.typeListRegion.hide()}else{this.typeListRegion.show()}}},load:function(){this.typeRegion.down("strong").innerHTML=this.typeListRegion.down("li[searchtype='"+this.searchType+"']").innerHTML;this.watermark=this.text!=""?"":this.watermarks[this.searchType];this.textBox.value=this.text!=""?this.text:"";this.keywordAutoComplete=new SearchAutoComplete2014({text:this.textBox,textWatermarkText:this.watermark,listRegion:this.suggestRegion,itemTemplate:"",idFieldName:"id",searchDatas:null,getSearchDataCallback:function(b){clearTimeout(this.timeout);this.timeout=setTimeout(this.getSuggestionsByServer.bind(this,this.keywordAutoComplete.keyword,this.searchType,b),this.timer*1000)}.bind(this),choiceCount:this.showCount,onChangeInputCallback:this.changeInputCheck.bind(this),onChangeCallback:null,onEnterCallback:this.onEnter.bind(this),searchType:this.searchType});this.observBtnMouseEvent()},getSuggestionsByServer:function(g,f,d){if(g!==""){this.server.GetSuggestObjs(g,f,function(a){if(a&&a.value){if(a.value.objs.length>0){this.trackId=a.value.trackid;this.actionId=a.value.actionid;d(a.value.objs,this.trackId,this.actionId)}}else{}}.bind(this))}},changeInputCheck:function(){if(this.textBox.value==""){this.keywordAutoComplete.hideSelectList();this.keywordAutoComplete.renderDefaultList()}},onButtonClick:function(c){var d=this.getKeyword();this.search(d)},onEnter:function(p,k){var l="";if(this.keywordAutoComplete.isSearchHistoryKeyWord){l=this.keywordAutoComplete.historyKeyWord;if(l==null){this.keywordAutoComplete.delCookie();this.keywordAutoComplete.isSearchHistoryKeyWord=false;return}}else{if(!p){l=this.getKeyword()}else{if(typeof this.trackId!="undefined"&&typeof this.actionId!="undefined"){var j=navigator.userAgent;var n=this.getRelatedOjbType(p.type);var m=p.id;var o=this.getKeyword();Mtime.Component.Statistic.Service.SuggestQueryAndClick(this.actionId,o,this.trackId,j,n,m,k++,function(){})}switch(p.type){case 1:$redirect(siteMovieUrl+"/"+p.id);break;case 2:$redirect(p.url);break;case 3:$redirect(sitePeopleUrl+"/"+p.id);break;case 4:$redirect(p.url);break}}}this.search(l)},getRelatedOjbType:function(d){var c=0;switch(d){case 1:c=1;break;case 2:c=33;break;case 3:c=2;break;default:break}return c},search:function(g){if(!this.type){this.type="all"}if(g.length>0){var j=this.actionUrl+"?q="+encodeURIComponent(g).replace(/'/g,"%27");if(this.searchType>0&&this.searchType<4){j+="&t="+this.searchType}if(this.searchType==4){var h="http://list.mall.mtime.com/";if(typeof siteGoodsListUrl!="undefined"){h=siteGoodsListUrl}j=h+"?q="+encodeURIComponent(g).replace(/'/g,"%27")}this.addHistoryData(g);if(typeof this.trackId!="undefined"&&typeof this.actionId!="undefined"){var f=navigator.userAgent;Mtime.Component.Statistic.Service.QueryLog(this.actionId,g,this.trackId,f,1,function(){})}$redirect(j)}},getKeyword:function(){var b="";if(this.keywordAutoComplete){b=this.keywordAutoComplete.getSearchKeyword()}else{b=this.textBox.value}return b},getOjbIds:function(f){if(f!=null){var j=[];for(var g=0;g<f.length;g++){var h=f[g];j.push(h.id+"|"+h.type)}return j.toString()}return null},addHistoryData:function(l){l=this.strShort(l,15);var j=getCookie("searchHistoryCookie");var g=window.location.hostname.split(".")[1]+"."+window.location.hostname.split(".")[2];if(typeof j!="undefined"&&j!=""){j=j.split(",");var h=Math.max(j.length-this.showCount,0);for(var k=j.length-1;k>=h;k--){if(l==j[k]){j.splice(k,1)}}j.push(l);if(j.length>this.showCount){j.shift()}setCookie("searchHistoryCookie",j.toString(),g)}else{var j=[];j.push(l);setCookie("searchHistoryCookie",j.toString(),g)}},strShort:function(o,n){var m=0,j=o.split(""),p=[];n=(n||12)*2;var l=j.length;for(var k=0;k<l;++k){if(j[k].charCodeAt(0)<299){m++;if(m<n-1){p.push(j[k])}}else{m+=2;if(m<n-2){p.push(j[k])}}}return p.join("")},observBtnMouseEvent:function(){this.searchBtnMouseOverHandler=this.btnMouseOver.bind(this);this.submitButton&&this.submitButton.observe("mouseover",this.searchBtnMouseOverHandler);this.searchBtnMouseOutHandler=this.btnMouseOut.bind(this);this.submitButton&&this.submitButton.observe("mouseout",this.searchBtnMouseOutHandler)},btnMouseOver:function(){if(this.getKeyword()!=""){var b=this.textBox.up("div");if(typeof b!="undefined"){if(!b.hasAttribute("searcurr")){b.addClassName("searcurr")}}}},btnMouseOut:function(){if(!this.keywordAutoComplete.hasFocus){var b=this.textBox.up("div");if(typeof b!="undefined"){b.removeClassName("searcurr")}}}});var SearchAutoComplete2014=Class.create();Object.extend(Object.extend(SearchAutoComplete2014.prototype,AutoCompleteBase.prototype),{initialize:function(b){this.baseInitialize(b)},initializeField:function(){this.isAlwayShowList=false;this.isShowMoreResult=false},selectEntry:function(){this.active=false;var b=this.getCurrentEntry();this.selectedEntry(b)},selectedEntry:function(d){if(this.isHistoryData(d)){this.isSearchHistoryKeyWord=true;this.historyKeyWord=d.readAttribute("_value")}else{if(d&&d.readAttribute){var g=d.readAttribute("_value");if(g&&g.length>0){var f=this.getOption(g);this.setValue(f)}}}},getCurrentEntry:function(){return this.getEntry(this.index)},isHistoryData:function(c){if(typeof c!="undefined"&&c!=null){var d=c.up("ul.history");if(typeof d!="undefined"&&this.listRegion.visible()){return true}}return false},getEntry:function(c){var d=null;if(c>=0&&this.listRegion){d=$(this.listRegion.down("div").down("ul").childNodes[c])}return d},setEntryOn:function(d){var c=this.getEntry(this.index);if(typeof c!="undefined"&&c!=null){c.addClassName&&c.addClassName("mdbg")}},setAllResultEntryOn:function(d){if(typeof this.listRegion!="undefined"&&this.listRegion!=null){var c=this.listRegion.down("div.more");if(c){if(d){c.addClassName("mdbg")}else{c.removeClassName("mdbg")}}}},setEntryOff:function(d){var c=this.getEntry(this.index);if(typeof c!="undefined"&&c!=null){c.removeClassName&&c.removeClassName("mdbg")}},markPrevious:function(){this.setEntryOff(this.index);if(this.index>0){this.index--}else{this.index=this.entryCount-1}this.setEntryOn(this.index)},markNext:function(){this.setEntryOff(this.index);if(this.index<this.entryCount-1){this.index++;this.setEntryOn(this.index)}else{if(this.isSearchHistoryKeyWord){this.index--;this.setAllResultEntryOn(true)}else{this.index=0;this.setEntryOn(this.index)}}},getOption:function(d){var g=null;var f=this.idFieldName;if(typeof this.searchDatas!="undefined"&&this.searchDatas!=null){this.searchDatas.each(function(a){if(a[f]==d){g=a;throw $break}})}return g},setSelectedValue:function(b){if(b!=null){if(this.selectedValue===null||this.selectedValue[this.idFieldName]!=b[this.idFieldName]){this.selectedValue=b;if(this.onChangeCallback&&this.onChangeCallback!=null){this.onChangeCallback(b)}}}},onClickListRegion:function(j){var g=Event.findElement(j,"li");if(g){if(g.readAttribute("data-selector")=="search"){var k=g.readAttribute("_value");var l=siteSearchUrl+"/search/?q="+encodeURIComponent(k).replace(/'/g,"%27");if(typeof this.trackId!="undefined"&&typeof this.actionId!="undefined"){var h=navigator.userAgent;Mtime.Component.Statistic.Service.QueryLog(this.actionId,k,this.trackId,h,1,function(){})}$redirect(l)}else{if(g.readAttribute("data-selector")!="delcookie"){this.removeObserver();this.selectedEntry(g);if(this.onEnterCallback){this.onEnterCallback(this.getValue(),this.index)}}else{this.delCookie()}}}},render:function(){if(this.getSearchDataCallback!==null){this.getSearchDataCallback(function(f,g,d){this.searchDatas=f;this.trackId=g;this.actionId=d;this.doRender()}.bind(this))}else{this.doRender()}},doRender:function(){if(this.isEnable){if(this.changed){this.reset()}var c=this.getSearchKeyword();if(c.length==0){this.removeObserver();this.renderDefaultList();this.observeMouseEvent()}else{var d=this.getMoreLists();if(this.isAlwayShowList||this.entryCount>0){this.renderTip(c,this.entryCount);this.renderList(this.changed,d);this.showSelectList();this.observeMouseEvent()}else{this.hideSelectList()}}}},addObserver:function(){this.removeObserver();this.observer=setInterval(this.onObserverEvent.bind(this),this.frequency*1000)},removeObserver:function(){if(this.observer){clearInterval(this.observer)}},onObserverEvent:function(){var b=this.getSearchKeyword();if(b==""){this.removeObserver()}if(b.length>=this.minChars){if(b!=this.keyword){this.keyword=b;this.render()}}else{this.keyword="";this.active=false;this.hideSelectList()}},getMoreLists:function(){var n=this.searchDatas,m=null,k=new StringBuilder(),l=0;for(var j=0,h=Math.min(n.length,this.choiceCount);j<h;j++){m=n[j];k.append(this.createListItem(m));l++;this.searchIndex=j}this.entryCount=this.entryCount+l+1;return k.toString()},renderList:function(h,j){if(this.listRegion){var g=new StringBuilder();g.append('<div class="mdsearch"><ul class="moviename moviefilm">');g.append(j);if(j!=""){var k=siteSearchUrl+"/search/";if(this.searchType==4){if(typeof siteGoodsListUrl!="undefined"){k=siteGoodsListUrl}else{k="http://list.mall.mtime.com/"}}var l="";switch(this.searchType){case 1:l="";break;case 2:l="";break;case 3:l="";break;case 4:l="";break}g.append('<li class="more"><a href="'+k+"?q="+encodeURIComponent(this.getSearchKeyword()).replace(/'/g,"%27")+"&t="+this.searchType+'" target="_self"><b class="song"></b>'+this.encodeHtml(this.getSearchKeyword())+'<b class="song"></b>'+l+'</a><span class="song">&gt;</span></li>')}g.append("</ul>");g.append("</div>");this.listRegion.innerHTML=g.toString()}},onClickText:function(){this.render()},createListItem:function(b){switch(b.type){case 1:return this.movieRender(b);case 2:return this.cinemaRender(b);case 3:return this.personRender(b);case 4:return this.goodsRender(b);default:return""}},onBlurText:function(g,d){this.active=false;this.hasFocus=false;var f=this.text.up("div");if(typeof f!="undefined"){f.removeClassName("searcurr")}},onFocusText:function(d){this.hasFocus=true;this.active=true;if(this.text){var c=this.text.up("div");if(typeof c!="undefined"){c.addClassName("searcurr")}}if(d==""){this.hideSelectList();this.renderDefaultList()}},movieRender:function(f){var d=new StringBuilder();d.append(String.format('<li class="" _value="{0}">',f.id));d.append(String.format('<a href="{0}" target="_blank" class="pic" onclick="return false;"><img src="{1}" width="45" height="60" alt="{2}"></a>',f.moviepage,f.cover,f.titlecn+" "+f.titleen));d.append('<div class="txt">');var g=f.year!=""?"("+f.year+")":"";d.append(String.format('<h2><a href="{0}" target="_blank" onclick="return false;">{1} {2}</a></h2>',f.moviepage,f.titlecn,g));d.append(String.format("<h3>{0}</h3>",f.titleen));if(f.director!=""){d.append(String.format("<p>{0}</p>",f.director))}d.append("</div>");if(this.searchType==0){d.append('<div class="cate">  </div>')}d.append("</li>");return d.toString()},personRender:function(d){var c=new StringBuilder();c.append(String.format('<li class="" _value="{0}">',d.id));c.append(String.format('<a href="{0}" target="_blank" class="pic" onclick="return false;"><img src="{1}" width="45" height="60" alt="{2}"></a>',d.personpage,d.cover,d.titlecn+" "+d.titlecn));c.append('<div class="txt">');c.append(String.format('<h2><a href="{0}" target="_blank" onclick="return false;">{1}  {2}</a></h2>',d.personpage,d.titlecn,d.titleen));c.append(String.format("<p>{0}</p>",d.country));c.append("</div>");if(this.searchType==0){c.append('<div class="cate">  </div>')}c.append("</li>");return c.toString()},cinemaRender:function(d){var c=new StringBuilder();c.append(String.format('<li class="" _value="{0}"><div class="icobox"><i class="ico_map">&nbsp;</i>',d.id));c.append('</div><div class="txt">');c.append(String.format('<h2><a target="_blank" href="{1}" onclick="return false;">{0}</a>',d.name,d.url));if(d.favorite){c.append('<a class="ico_stat currstar" href="#" onclick="return false;"></a>')}c.append("</h2><p>");if(d.district){c.append(String.format('<span class="pr6">[{0}]</span>',d.district))}if(d.business){c.append(String.format('<span class="pr6">[{0}]</span>',d.business))}c.append(String.format("</p>",d.district,d.business));c.append(String.format("<p>{0}</p>",d.address));c.append("</div>");if(this.searchType==0){c.append('<div class="cate">  </div>')}c.append("</li>");return c.toString()},goodsRender:function(d){var c=new StringBuilder();c.append(String.format('<li class="" _value="{0}">',d.id));c.append(String.format('<a href="{0}" target="_blank" class="pic" onclick="return false;"><img src="{1}" width="45" height="45" alt="{2}"></a>',d.url,d.image,d.name));c.append('<div class="txt">');c.append(String.format('<h2><a href="{0}" target="_blank" onclick="return false;">{1}</a></h2>',d.url,d.name));c.append('<p class="price">');c.append(String.format("<strong>{0}</strong>",d.minprice));c.append(String.format("<span>{0}</span>",d.marketprice));c.append("</p>");c.append("</div>");if(this.searchType==0){c.append('<div class="cate">  </div>')}c.append("</li>");return c.toString()},renderDefaultList:function(){if(this.searchType==0){var g=getCookie("searchHistoryCookie");if(g!=""&&this.listRegion){g=g.split(",");var h=new StringBuilder();h.append('<div class="mdsearch"><ul class="history">');h.append('<li class="first" data-selector="delcookie"><a href="javascript:void(0)" target="_blank" onclick="return false;"></a></li>');var f=Math.max(g.length-this.choiceCount,0);for(var j=g.length-1;j>=f;j--){h.append(String.format('<li _value="{0}" data-selector="search">{0}</li>',this.encodeHtml(g[j])))}h.append("</ul></div>");this.listRegion.innerHTML=h.toString();this.listRegion.show();this.observeMouseEvent();this.entryCount=g.length+1}}else{this.hide()}},hide:function(){this.hasFocus=false;this.hideSelectList()},hideSelectList:function(){if(this.listRegion!=null){if(this.listRegion.visible()&&!this.hasFocus){clearTimeout(this.hideTimeout);this.hideTimeout=setTimeout(function(){this.listRegion.hide();this.stopObservingMouseEvent()}.bind(this),200)}}},stopObservingMouseEvent:function(){this.listRegion&&this.listRegion.stopObserving("mouseover",this.mouseOverHandler);this.listRegion&&this.listRegion.stopObserving("mouseout",this.mouseOutHandler)},observeMouseEvent:function(){if(typeof this.listRegion!="undefined"&&this.listRegion!=null){if(this.listRegion.visible()){this.mouseOverHandler=this.mouseOver.bind(this);this.listRegion&&this.listRegion.observe("mouseover",this.mouseOverHandler);this.mouseOutHandler=this.mouseOut.bind(this);this.listRegion&&this.listRegion.observe("mouseout",this.mouseOutHandler)}}},mouseOver:function(d){var c=Event.findElement(d,"li");if(c&&c.readAttribute&&c.tagName=="LI"){if(this.isHistoryData(c)){this.isSearchHistoryKeyWord=true;this.historyKeyWord=c.readAttribute("_value")}this.addBgCls(c)}},mouseOut:function(d){var c=Event.findElement(d,"li");if(c&&c.readAttribute&&c.tagName=="LI"){if(c.hasClassName("mdbg")){c.removeClassName("mdbg");this.index=-1;this.isSearchHistoryKeyWord=false;this.historyKeyWord=""}}},addBgCls:function(f){if(typeof this.listRegion!="undefined"&&this.listRegion!=null){var j=$A($$("li",$(this.listRegion)));for(var g=0;g<j.length;g++){var h=j[g];if(f==h){this.index=g;if(!h.hasClassName("mdbg")){h.addClassName("mdbg")}}else{h.removeClassName("mdbg")}}}},observDelCookie:function(){if(this.listRegion){this.delCookieDom=this.listRegion.getElementsBySelector('a[data-selector="delcookie"]')[0];if(typeof this.delCookieDom!="undefined"&&typeof this.onClickDelCookieHandler=="undefined"){this.onClickDelCookieHandler=this.delCookie.bind(this);this.delCookieDom.observe("click",this.onClickDelCookieHandler)}}},delCookie:function(){setCookie("searchHistoryCookie","");this.listRegion&&this.listRegion.hide()},checkMouseOut:function(c,d){if(this.getEvent(c).type=="mouseout"){if(typeof this.getEvent(c).relatedTarget!="undefined"){return this.contains(d,this.getEvent(c).relatedTarget)}else{if(typeof this.getEvent(c).toElement!="undefined"){return this.contains(d,this.getEvent(c).toElement)}else{return false}}}else{return false}},getEvent:function(b){return b||window.event},contains:function(d,c){if(d.contains){return d!=c&&d.contains(c)}else{return !!(d.compareDocumentPosition(c)&16)}},encodeHtml:function(d){var c=/"|&|'|<|>|[\x00-\x20]|[\x7F-\xFF]|[\u0100-\u2700]/g;return(typeof d!="string")?d:d.replace(c,function(a){var b=a.charCodeAt(0),h=["&#"];b=(b==32)?160:b;h.push(b);h.push(";");return h.join("")})}});var BaseWindow=Class.create();Object.extend(Object.extend(BaseWindow.prototype,Window.prototype),{options:{hideBorder:false,windowClassName:"",windowStyle:"",windowContentStyle:"",onClickCloseCallback:null,readyCallback:null,closeCallback:null,closePan:""},initializeWindow:function(){var b=this.uniqueId;this.id="window14_"+b;this.closeButtonId="window14_closeButton_"+b;this.titleBarId="window14_titleBar_"+b;this.initializeWindowCallback()},initializeWindowCallback:function(){},addDOM:function(){this.windowClassName=this.windowClassName||"";this.windowStyle=this.windowStyle||"";this.windowContentStyle=this.windowContentStyle||"";var b=Builder.node("a",{id:this.closeButtonId,className:"i_pop_close",title:"",href:"javascript:void(0)"},[" "]);if(this.closePan&&this.closePan!=""){b=Builder.node("a",{id:this.closeButtonId,className:"i_pop_close __r_c_",pan:this.closePan,title:"",href:"javascript:void(0)"},[" "])}this.windowElement=Builder.node("div",{className:"my_layer "+this.windowClassName,style:this.windowStyle},[b,Builder.node("div",{className:"inner "+this.windowClassName,style:this.windowStyle},[Builder.node("div",{id:this.titleBarId,className:"innertit",style:"cursor: move"},[this.addTitleDOM()]),this.addContentDOM()])])},addTitleDOM:function(){},addContentDOM:function(){},initializeDOM:function(){this.closeButton=$(this.closeButtonId);this.titleBar=$(this.titleBarId);this.initializeDOMCallback()},initializeDOMCallback:function(){},destroyDOM:function(){this.closeButton=null;this.titleBar=null;this.destroyDOMCallback()},destroyDOMCallback:function(){},initializeEvent:function(){this.onClickCloseButtonHandler=this.onClickCloseButton.bind(this);this.closeButton.observe("click",this.onClickCloseButtonHandler);this.onMousedownTitleBarHandler=this.onMousedownTitleBar.bindAsEventListener(this);this.titleBar.observe("mousedown",this.onMousedownTitleBarHandler);this.onMouseupTitleBarHandler=this.onMouseupTitleBar.bindAsEventListener(this);Event.observe(document,"mouseup",this.onMouseupTitleBarHandler);this.onMousemoveTitleBarHandler=this.onMousemoveTitleBar.bindAsEventListener(this);Event.observe(document,"mousemove",this.onMousemoveTitleBarHandler);this.initializeEventCallback()},initializeEventCallback:function(){},destroyEvent:function(){this.closeButton.stopObserving("click",this.onClickCloseButtonHandler);this.titleBar.stopObserving("mousedown",this.onMousedownTitleBarHandler);Event.stopObserving(document,"mouseup",this.onMouseupTitleBarHandler);Event.stopObserving(document,"mousemove",this.onMousemoveTitleBarHandler);this.destroyEventCallback()},destroyEventCallback:function(){},load:function(){if(this.readyCallback&&this.readyCallback!==null){this.readyCallback(this)}this.titleBar.ondrag=function(){return false};this.titleBar.onselectstart=function(){return false}},onClickCloseButton:function(){if(this.onClickCloseCallback&&this.onClickCloseCallback!==null){this.onClickCloseCallback(this)}this.close()},onMouseupTitleBar:function(){if(!this.isDragging){return}this.isDragging=false},onMousedownTitleBar:function(j){var g=parseInt(this.windowElement.getStyle("left"),10);var h=parseInt(this.windowElement.getStyle("top"),10);var k=Event.pointerX(j);var l=Event.pointerY(j);this.offsetX=k-g;this.offsetY=l-h;this.isDragging=true},onMousemoveTitleBar:function(d){if(!this.isDragging){return}var f=Event.pointerX(d)-this.offsetX;var g=Event.pointerY(d)-this.offsetY;this.setLocation(g,f)},dispose:function(){if(this.closeCallback&&this.closeCallback!==null){this.closeCallback(this)}this.disposeCallback();this.destroyEvent();this.destroyDOM()},disposeCallback:function(){}});var Dialog=Class.create();Object.extend(Object.extend(Dialog.prototype,BaseWindow.prototype),{options:{title:"",content:"",containerClassName:"",containerStyle:"",isDirectOpen:true,buttonRegionClass:"",buttons:null,closeTimeout:-1},initializeWindowCallback:function(){this.buttonNodes=[];this.buttonHandlers=[];this.keyCodeButtons=[];var b=this.uniqueId;this.buttonRegionId="dialogButtonRegion_"+b},addContentDOM:function(){var b;if(!this.title){b="border: none"}else{b=""}this.containerClassName=this.containerClassName||"popmid";this.buttonRegionClass=this.buttonRegionClass||"tip_btnbox";return Builder.node("div",{className:this.containerClassName,style:this.containerStyle},[typeof this.content=="string"?Builder.build(this.content):this.content,Builder.node("div",{id:this.buttonRegionId,className:this.buttonRegionClass})])},addTitleDOM:function(){this.title=this.title||"";var b=null;if(typeof this.title==="string"){if(this.title.length>0){b=Builder.build(this.title);if(b===null){b=this.title}}else{b=Builder._text("")}}else{b=this.title}return Builder.node("h2",{},[b])},initializeDOMCallback:function(){this.buttonRegion=$(this.buttonRegionId);if(this.buttons&&this.buttons!==null){for(var d=0,c=this.buttons.length;d<c;d++){this.addButton(this.buttons[d])}}},destroyDOMCallback:function(){this.buttonRegion=null;this.removeButtons()},initializeEventCallback:function(){},destroyEventCallback:function(){},render:function(){if(this.isDirectOpen){this.open();if(this.closeTimeout>0){this.timerId=setTimeout(this.autoClose.bind(this),this.closeTimeout*1000)}}},autoClose:function(){if(this.timerId){clearTimeout(this.timerId)}this.onClickCloseButton()},disposeCallback:function(){},addButton:function(h){var l=h.onmouseover||"";var k=h.onmouseout||"";var g=Element.extend(Builder.node("a",{href:"javascript:void(0)",className:h.buttonStyle,onmouseover:l,onmouseout:k},[h.title]));if(h.pan&&h.pan!=""){g=Element.extend(Builder.node("a",{href:"javascript:void(0)",className:h.buttonStyle,onmouseover:l,onmouseout:k,pan:h.pan},[h.title]))}var j=function(){h.callback(this,g)}.bind(this);g.observe("click",j);this.buttonRegion.appendChild(g);this.buttonNodes.push(g);this.buttonHandlers.push(j);if(h.keyCode){this.keyCodeButtons.push({keyCode:h.keyCode,button:g,handler:j})}},removeButtons:function(){if(this.buttonNodes&&this.buttonHandlers&&this.buttonNodes.length==this.buttonHandlers.length){for(var d=0,c=this.buttonNodes.length;d<c;d++){this.buttonNodes[d].stopObserving("click",this.buttonHandlers[d])}}if(this.keyCodeButtons.length>0){this.keyCodeButtons.clear()}},getButtonByKey:function(l){if(this.keyCodeButtons.length>0){var h=this.keyCodeButtons,g=null;for(var k=0,j=h.length;k<j;k++){g=h[k];if(g.keyCode==l){return g}}}return null},onDocumentKeydown:function(d){var c=this.getButtonByKey(d.keyCode);if(c!==null){c.handler();Event.stop(d)}if(d.keyCode==Event.KEY_ESC){this.onClickCloseButton()}},setupDimensions:function(){var h=this.dimensions.viewport.height/2+this.pagePosition.y;var j=this.dimensions.viewport.width/2+this.pagePosition.x;var m=this.windowElement.down(1).getDimensions();var n=m.width,l=m.height;var k=(h-parseFloat(l)/2);if(k<=0){k=this.fixTopHeight}this.windowElement.setStyle({position:"absolute",top:k+"px",left:(j-parseFloat(n)/2)+"px",zIndex:this.overlay?parseInt(this.overlay.getStyle("zIndex"),10)+1:Windows.getZIndex()})}});function $alert(h,j,f,g){new Dialog({windowClassName:"w295",content:'<div class="tc mt25 mb30 px20 lh15">'+h+"</div>",buttonRegionClass:"tc pb12 pt15",buttons:[{title:"",keyCode:Event.KEY_RETURN,buttonStyle:"btn_blue mr15",callback:function(a){if(j){j(a)}a.close()}.bind(this)}],onClickCloseCallback:f||Prototype.emptyFunction,closeTimeout:g||-1})}function $tip(d,c){$alert(d,null,null,c)}function $confirm(h,j,f,g){new Dialog({windowClassName:"w295",content:'<div class="tc px16"  style="padding:30px;">'+h+"</div>",buttonRegionClass:"tc pb12 pt15",buttons:[{title:"",keyCode:Event.KEY_RETURN,buttonStyle:"btn_square_hover mr15",callback:function(a){if(j){j(a)}a.close()}.bind(this)},{title:"",buttonStyle:"btn_square",callback:function(a){if(f){f(a)}a.close()}.bind(this)}],onClickCloseCallback:g||Prototype.emptyFunction})}var DialogBoxs={dialogs:[],unregister:function(b){this.dialogs=this.dialogs.reject(function(a){return a==b})},register:function(b){if(!this.dialogs.include(b)){this.dialogs.push(b)}},isRegistered:function(b){return this.dialogs.include(b)}};var DialogBox=Class.create();Object.extend(Object.extend(DialogBox.prototype,Window.prototype),{options:{title:"",content:"",width:"",element:null,isInOverflowContainer:false,buttons:null,readyCallback:null,closeCallback:null,isToggleTroubleElement:false,isAutoClose:true,positionType:0,arrowNew:false},initialize:function(c){this.setOptions(c);if(DialogBoxs.isRegistered(this.element)){return}DialogBoxs.register(this.element);var d=new Date().getTime();this.id="dialogBox_"+d;this.titleId="dialogBoxTitle_"+d;this.contentId="dialogBoxContent_"+d;this.buttonRegionId="dialogBoxButtonRegion_"+d;this.createOverlay=false;this.buttonNodes=[];this.buttonHandlers=[];this.getPosition();this.initializeDOM();this.initializeEvent();this.open();if(this.readyCallback!==null){this.readyCallback(this)}},addDOM:function(){var c="";if(this.arrowNew){switch(this.positionType){case 0:c="tl_arrow";break;case 1:c="tr_arrow";break;case 2:c="bl_arrow";break;case 3:c="br_arrow";break;default:c="tl_arrow";break}this.windowElement=Builder.node("div",{id:this.id,className:"my_layer"},[Builder.node("em",{className:c}),this.content!==""?(typeof this.content==="string"?Builder.build(this.content):this.content):"",Builder.node("div",{id:this.buttonRegionId},[])])}else{switch(this.positionType){case 0:c="directiontl";break;case 1:c="directiontr";break;case 2:c="directionbl";break;case 3:c="directionbr";break;default:c="directiontl";break}var d="";if(this.width&&this.width.length!==0){d="width:"+this.width}this.windowElement=Builder.node("div",{id:this.id,className:"eject_outer",style:("display:none;"+d)},[Builder.node("div",{className:"eject"},[Builder.node("p",{className:c}),this.content!==""?(typeof this.content==="string"?Builder.build(this.content):this.content):"",Builder.node("p",{id:this.buttonRegionId,className:"mt15"},[])])])}this.indicationStyle=c;this.initializeWindowElement()},initializeWindowElement:function(){var b=this.getContainer();b.appendChild(this.windowElement);this.windowElement=$(this.windowElement);this.cardId=$(this.id)},destroyWindowElement:function(){if(this.windowElement!==null){var b=this.getContainer();b.removeChild(this.windowElement);this.windowElement=null}},getPosition:function(){if(this.element){var n=this.element;Position.prepare();var o=Position.cumulativeOffset(n);var s=n.getDimensions();var t=o[0],u=o[1];if(this.isInOverflowContainer){var p=Position.realOffset(n);var q=p[0],r=p[1];t=t-q+Position.deltaX;u=u-r+Position.deltaY}this.elementWidth=s.width;this.elementHeight=s.height;this.getScroll();this.getPageDimensions();this.browserDimensions();var w=this.dimensions.viewport.width/2+this.pagePosition.x;var x=this.dimensions.viewport.height/2+this.pagePosition.y;var v=null;if(t<=w&&u<=x){this.positionType=0}else{if(t>=w&&u<=x){this.positionType=1}else{if(t<=w&&u>=x){this.positionType=2}else{if(t>=w&&u>=x){this.positionType=3}}}}this.elementX=t;this.elementY=u}},setupDimensions:function(){var u=0,v=0;var x=this.windowElement.getDimensions();var y=x.width;var w=x.height;var s=this.elementX+this.elementWidth/2;var t=this.elementY;var q=s;var r=t+this.elementHeight;if(this.arrowNew){var p=this.cardId.down("em."+this.indicationStyle)}else{var p=this.cardId.down("p."+this.indicationStyle)}var o;if(p===undefined||p===null){o=17}else{o=p.getHeight()}switch(this.positionType){case 0:u=q-47;v=r+o;break;case 1:u=q-(y-47);v=r+o;break;case 2:u=s-47;v=t-o-w;break;case 3:u=s-(y-47);v=t-o-w;break;default:u=q-47;v=r+o;break}var z=0;if(this.overlay){z=parseInt(this.overlay.getStyle("zIndex"),10)+1}else{z=Windows.getZIndex()+1}this.windowElement.setStyle({position:"absolute",top:v+"px",left:u+"px",zIndex:z})},removeDOM:function(){this.title=null;this.buttonRegion=null;this.removeButtons();this.destroyWindowElement()},initializeDOM:function(){this.addDOM();this.windowElement=$(this.windowElement);this.title=$(this.titleId);this.buttonRegion=$(this.buttonRegionId);if(this.arrowNew&&this.buttons){this.buttonRegion.addClassName("mt15 tc")}if(this.buttons){for(var d=0,c=this.buttons.length;d<c;d++){this.addButton(this.buttons[d])}}},addButton:function(j){var n=j.parameters||{};var m=j.onmouseover||"";var l=j.onmouseout||"";var h=Element.extend(Builder.node("input",{type:"button",value:j.title,className:j.buttonStyle,onmouseover:m,onmouseout:l},[]));var k=function(){j.callback(this,h,n)}.bind(this);h.observe("click",k);this.buttonRegion.appendChild(h);this.buttonNodes.push(h);this.buttonHandlers.push(k)},removeButtons:function(){if(this.buttonNodes&&this.buttonHandlers&&this.buttonNodes.length==this.buttonHandlers.length){for(var d=0,c=this.buttonNodes.length;d<c;d++){this.buttonNodes[d].stopObserving("click",this.buttonHandlers[d])}}},initializeEvent:function(){if(this.isAutoClose){this.onClickHandler=this.onClick.bindAsEventListener(this);Event.observe(document.body,"click",this.onClickHandler)}},destroyEvent:function(){Event.stopObserving(document.body,"click",this.onClickHandler);if(this.closeCallback!==null){this.closeCallback(this)}},onClick:function(g){var h=Event.pointerX(g);var j=Event.pointerY(g);var f=Event.element(g);if(f!=this.element&&!f.descendantOf(this.element)&&!f.descendantOf(this.windowElement)&&!Position.within(this.windowElement,h,j)){this.close()}},dispose:function(){DialogBoxs.unregister(this.element);this.destroyEvent();this.removeDOM();this.buttonNodes.clear();this.buttonNodes=null;this.buttonHandlers.clear();this.buttonHandlers=null}});var ToggleDialog=Class.create();Object.extend(Object.extend(ToggleDialog.prototype,Dialog.prototype),{options:Object.extend(Object.extend({},Dialog.prototype.options),{element:null,hideBorder:true,createOverlay:false,isToggleTroubleElement:false,isAutoClose:true}),getPosition:function(){if(this.element){var k=this.element;Position.prepare();var l=Position.cumulativeOffset(k);var p=k.getDimensions();var q=l[0],r=l[1];if(this.isInOverflowContainer){var m=Position.realOffset(k);var n=m[0],o=m[1];q=q-n+Position.deltaX;r=r-o+Position.deltaY}this.elementWidth=p.width;this.elementHeight=p.height;this.getScroll();this.getPageDimensions();this.browserDimensions();this.elementX=q;this.elementY=r}},setupDimensions:function(){this.getPosition();var l=this.windowElement.down(1).getDimensions();var m=l.width,k=l.height;var h=0,j=0;h=this.elementX+this.elementWidth-m+2;j=this.elementY+1;var n=0;if(this.overlay){n=parseInt(this.overlay.getStyle("zIndex"),10)+1}else{n=Windows.getZIndex()+1}this.windowElement.setStyle({position:"absolute",top:j+"px",left:h+"px",zIndex:n})},initializeEventCallback:function(){if(this.isAutoClose){this.onClickHandler=this.onClick.bindAsEventListener(this);Event.observe(document.body,"click",this.onClickHandler)}},destroyEventCallback:function(){Event.stopObserving(document.body,"click",this.onClickHandler)},onClick:function(g){var h=Event.pointerX(g);var j=Event.pointerY(g);var f=Event.element(g);if(f!=this.element&&!f.descendantOf(this.element)&&!f.descendantOf(this.windowElement)&&!Position.within(this.windowElement,h,j)){this.close()}}});if(typeof(Widgets)=="undefined"){var Widgets=Class.create()}Widgets.Dialog=Class.create();Object.extend(Widgets.Dialog.prototype,{options:{},initialize:function(b){this.setOptions(b);this.initializeDom()},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},setCursor:function(j,h,f){h=(h==null?j.value.length:h);f=(f==null?0:f);j.focus();if(j.createTextRange){var g=j.createTextRange();g.move("character",h);g.moveEnd("character",f);g.select()}else{j.setSelectionRange(h,h+f)}},initializeDom:function(){},onReady:function(b){},initializeEvent:function(){},onSubmit:function(){this.callback&&this.callback();this.close()},close:function(){this.dialog&&this.dialog.close();this.destroyEvent();this.destroyDOM();this.destroyField()},destroyField:function(){},destroyEvent:function(){},destroyDOM:function(){}});var UserLoginDialog=Class.create();Object.extend(Object.extend(UserLoginDialog.prototype,Widgets.Dialog.prototype),{server:{getUser:function(b){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.ManagerService","GetUserInfo2",[],b,"/utility/managerservice.m","get","10000")},signIn:function(k,n,m,l,p,o,j){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.ManagerService","SignIn",[k,n,m,l,p,o],j,"/utility/managerservice.m","get","10000")},refreshVcode:function(b){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.ManagerService","RefreshVcode",[],b,"/utility/managerservice.m","get","10000")}},options:{callback:null,dialogTemplate:'<div class="sharemid"><div class="loginpopbox"><dl class="logintool"><dt></dt><dd class="userlogin"><ul><li class=""><label class="name"data-login="account-label"></label><input type="text"name="account"value=""class="tip"><i class="ico_false">&nbsp;</i></li><li class=""><label class="password"></label>{0}<i class="ico_false">&nbsp;</i></li><li class=""style="width:200px;float:left; display: none;"data-login="vcode-input-ctn"><label class="code"></label><input type="text"name="vcode"value=""class="tip"style="width:100px "><i class="ico_false">&nbsp;</i></li><li class="codetxt"style="float:left;display: none;"data-login="vcode-image-ctn"><span id="img_vcode"><img width="120"height="60"alt=""src=""style="cursor:pointer"class="v_m mr6"data-login="vcode-image"></span><a href="#"onclick="return false;"data-login="vcode-refresh-btn"></a></li></ul><p class="usertip"><a href="http://my.mtime.com/member/forget_password/"target="_blank"class="fr"></a><i class="ico_m_check"data-login="auto">&nbsp;</i></p><div class="btn"><input type="submit"data-selector="submit"value=""class="btn_login"><input type="button"value=""data-login="signup"class="btn_regist"></div></dd></dl><dl class="otherlogin"><dt></dt><dd style="margin-left: 45px;"><a href="http://passport.mtime.com/unitelogin/dispatch/weibo/web/" title="" class="o_sina"></a><a href="http://passport.mtime.com/unitelogin/dispatch/qq/web/" title="QQ" class="o_qq"></a></dd></dl></div></div>'},initialize:function(b){this.setOptions(b);this.initializeUser()},initializeUser:function(){this.server.getUser(function(){if(typeof getUserInfoResult!=="undefined"&&Mtime.isValue(getUserInfoResult)){var b=getUserInfoResult.value;this.user={id:b.userId,nickname:b.nickName,homeUrl:b.homeUrl,headSrc:b.headSrc,isSaveEmail:b.isSaveEmail,isAutoExit:b.isAutoExit,email:b.email,enableMobileLogin:b.enableMobileLogin||false,customizeMenus:typeof b.CustomizeMenus==="undefined"?null:b.CustomizeMenus}}this.initializeDom()}.bind(this))},initializeDom:function(){var b;if(Mtime.browser.ie===0||Mtime.browser.ie>8){b='<input value=""class="tip" name="password">'}else{b='<input value="" class="tip" name="password" type="password">'}this.dialog=new Dialog({title:"",windowClassName:"w500",content:String.format(this.dialogTemplate,[b]),readyCallback:this.onReady.bind(this)})},onReady:function(f){var g=f.windowElement;this.emailLabel=g.down('label[data-login="account-label"]');this.emailInput=g.down('input[name="account"]');this.passInput=g.down('input[name="password"]');this.isAutoSign=g.down('i[data-login="auto"]');this.signInBtn=g.down('input[data-selector="submit"]');this.signUpBtn=g.down('input[data-login="signup"]');this.vcodeInputCtn=g.down('li[data-login="vcode-input-ctn"]');this.vcodeInput=g.down('input[name="vcode"]');this.vcodeImageCtn=g.down('li[data-login="vcode-image-ctn"]');this.vcodeImage=g.down('img[data-login="vcode-image"]');this.vcodeRefreshBtn=g.down('a[data-login="vcode-refresh-btn"]');this.form=g.down(".sharemid");f.buttonRegion.hide();var d=this.emailInput;if(this.user){if(this.user.isSaveEmail){this.emailInput.value=this.user.email;d=this.passInput}}setTimeout(function(){this.setCursor(d)}.bind(this),500);this.initializeEvent()},initializeEvent:function(){this.signinHandler=this.signin.bind(this);Event.observe(this.signInBtn,"click",this.signinHandler);document.onkeydown=function(){var b=window.event;if(b.keyCode===13){this.signin(b)}}.bind(this);this.signupHandler=this.signup.bind(this);Event.observe(this.signUpBtn,"click",this.signupHandler);this.checkAccountHandler=this.checkAccount.bind(this);Event.observe(this.emailInput,"change",this.checkAccountHandler);this.checkPasswordHandler=this.checkPassword.bind(this);Event.observe(this.passInput,"change",this.checkPasswordHandler);this.refreshVcodeHandler=this.refreshVcode.bind(this);Event.observe(this.vcodeRefreshBtn,"click",this.refreshVcodeHandler);this.checkIsAutoSignHandler=this.checkIsAutoSign.bind(this);Event.observe(this.isAutoSign,"click",this.checkIsAutoSignHandler);this.blurAccountHandler=this.blurAccount.bind(this);Event.observe(this.emailInput,"blur",this.blurAccountHandler);Event.observe(this.passInput,"blur",this.blurAccountHandler);Event.observe(this.vcodeInput,"blur",this.blurAccountHandler);this.focusAccountHandler=this.focusAccount.bind(this);Event.observe(this.emailInput,"mouseup",this.focusAccountHandler);Event.observe(this.emailInput,"focus",this.focusAccountHandler);Event.observe(this.passInput,"mouseup",this.focusAccountHandler);Event.observe(this.passInput,"focus",this.focusAccountHandler);Event.observe(this.vcodeInput,"mouseup",this.focusAccountHandler);Event.observe(this.vcodeInput,"focus",this.focusAccountHandler)},refreshVcode:function(b){this.server.refreshVcode(function(a){if(a&&a.value&&a.value.id){this.vcodeImageCtn.show();this.vcodeInput.value="";this.vcodeInput.focus();this.vcodeId=a.value.id;this.vcodeImage.src=a.value.src}}.bind(this))},checkAccount:function(){var d=this.emailInput.value.trim(),f=this.emailInput.up(),g=true;if(this.user&&this.user.enableMobileLogin){if(!Validator.Email.test(d)&&!Validator.MobilePhone.test(d)){f.addClassName("false");g=false}else{f.removeClassName("false")}}else{if(!Validator.Email.test(d)){f.addClassName("false");g=false}else{f.removeClassName("false")}}return g},blurAccount:function(h){var g=Event.element(h),f=g.value.trim();if(f===""){if(g===this.emailInput){g.value=""}else{if(g===this.passInput){g.removeAttribute("type");g.value=""}else{if(g===this.vcodeInput){g.value=""}}}var j=g.up();if(j&&j.hasClassName("false")){j.removeClassName("false")}}},focusAccount:function(g){var f=Event.element(g),d=f.value.trim();if(d===""){f.value=""}else{if(d===""){f.value="";f.setAttribute("type","password")}else{if(d===""){f.value=""}}}},checkPassword:function(){var f=this.passInput.value,d=this.passInput.up(),g=true;if(!Validator.Password.test(f)){d.addClassName("false");g=false}else{d.removeClassName("false")}return g},checkVcode:function(){var g=this.vcodeInput.value.trim(),d=this.vcodeInput.up(),f=true;if(!g){d.addClassName("false");f=false}else{d.removeClassName("false")}return f},checkIsAutoSign:function(b){if(this.isAutoSign.hasClassName("ico_m_currcheck")){this.isAutoSign.removeClassName("ico_m_currcheck")}else{this.isAutoSign.addClassName("ico_m_currcheck")}},signup:function(){if(typeof sitePassportUrl==="undefined"){sitePassportUrl="http://passport.mtime.com"}var b=sitePassportUrl+"/member/signin/?redirectUrl="+encodeURIComponent(location.href);location.href=b},signin:function(f){Event.stop(f);var d=this.emailInput.value;var g=$encodePassword(this.passInput.value);if(this.checkAccount()&&this.checkPassword()&&(!this.vcodeId||this.checkVcode())&&!this.lock){this.lock=true;this.signInBtn.setAttribute("disabled","disabled");this.server.signIn(d,g,true,false,this.vcodeId||"",this.vcodeId?this.vcodeInput.value:"",function(a){this.lock=false;this.signInBtn.removeAttribute("disabled");if(a&&a.value){if(a.value.success){this.close();this.callback&&this.callback(a.value)}else{if(a.value.isShieldStatus){this.close();this.showSecurityRiskDialog(a.value.shieldTip)}else{if(a.value.needResetPassword){this.close();this.showResetPwdDialog(a.value.resetPasswordUrl)}else{if(a.value.redirect){$redirect(a.value.message)}else{if(a.value.isRobot){this.vcodeInputCtn.show();if(!a.value.vcodeValid){this.vcodeInput.up().addClassName("false")}this.refreshVcode();return}else{this.vcodeInputCtn.hide();this.vcodeImageCtn.hide();this.vcodeId=null}this.emailInput.up().addClassName("false");this.passInput.up().addClassName("false")}}}}}}.bind(this))}},showSecurityRiskDialog:function(b){this.securityRiskDialog=new Dialog({title:"",windowClassName:"w375",content:'<div class="yahei px14 tc bold">'+b+"</div>",buttonRegionClass:"tip_btnbox",buttons:[{title:"",keyCode:Event.KEY_RETURN,buttonStyle:"t_btn_blue_i bold",callback:function(a){a.close()}.bind(this)}]})},showResetPwdDialog:function(b){this.needResetPwdDialog=new Dialog({title:"",windowClassName:"w375",content:'<div class="yahei px14 tc bold"><p></p><p class="mt5"></p></div>',buttonRegionClass:"tip_btnbox",buttons:[{title:"",keyCode:Event.KEY_RETURN,buttonStyle:"t_btn_blue_i bold",callback:function(a){location.href=b}.bind(this)}]})},onCancel:function(){this.close()},destroyEvent:function(){Event.stopObserving(this.form,"submit",this.signinHandler);Event.stopObserving(this.signUpBtn,"click",this.signupHandler);Event.stopObserving(this.emailInput,"change",this.checkAccountHandler);Event.stopObserving(this.passInput,"change",this.checkPasswordHandler);Event.stopObserving(this.vcodeRefreshBtn,"click",this.refreshVcodeHandler)},destroyDOM:function(){},destroyField:function(){}});var BoxBase=Class.create();Object.extend(BoxBase.prototype,{options:{boxRegion:null,closeButton:null,timeout:0,onClickCloseCallback:null,offsetX:0,offsetY:0},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.timeoutId=null;this.setOptions(b);this.initializeDOM();this.initializeEvent();this.initializeBox();this.timeout=this.timeout*1000},initializeDOM:function(){this.boxRegion=$(this.boxRegion);this.closeButton=$(this.closeButton)},destroyDOM:function(){this.boxRegion=null;this.closeButton=null},initializeBox:function(){},destroyBox:function(){},initializeEvent:function(){if(this.closeButton){this.onClickCloseButtonHandler=this.onClickCloseButton.bindAsEventListener(this);this.closeButton.observe("click",this.onClickCloseButtonHandler)}Event.observe(window,"unload",this.close.bind(this))},destroyEvent:function(){if(this.closeButton){this.closeButton.stopObserving("click",this.onClickCloseButtonHandler)}},onClickCloseButton:function(){if(this.onClickCloseCallback){this.onClickCloseCallback(this)}this.hide()},show:function(){if(!this.boxRegion.visible()){this.boxRegion.show()}this._handleTimeout()},hide:function(){if(this.boxRegion.visible()){this.boxRegion.hide()}},_handleTimeout:function(){if(this.boxRegion.visible()&&this.timeout>0){clearTimeout(this.timeoutId);this.timeoutId=setTimeout(this.hide.bind(this),this.timeout)}},closed:false,close:function(){if(!this.closed){this.closed=true;if(this.timeoutId!==null){clearTimeout(this.timeoutId)}this.hide();this.destroyBox();this.destroyEvent();this.destroyDOM()}}});var HintBox=Class.create();Object.extend(Object.extend(HintBox.prototype,BoxBase.prototype),{initializeBox:function(){this.hint=$(this.hint)},destroyBox:function(){this.hint=null},set:function(b){this.hint.innerHTML=b;this.show();this.boxRegion.scrollTo()}});var FloatHintBox=Class.create();Object.extend(Object.extend(FloatHintBox.prototype,BoxBase.prototype),{getContainer:function(){var b=$("contentEnd");if(typeof b==="undefined"||b===null){b=document.getElementsByTagName("body")[0]}return b},initializeBox:function(){Windows.register(this);this.element=$(this.element);this.boxRegion=Element.extend(Builder.node("div",{className:"bubble",style:"display:none;"},[Builder.node("div",{className:"bubble_inner"},[Builder.node("p",{className:"bubble_g"}),Builder.node("p",{className:"c_a5"},[this.message])])]));this.hint=Element.extend(this.boxRegion.getElementsByTagName("p")[1]);var h=Position.cumulativeOffset(this.element);var j=this.element.getDimensions();var k=h[0],l=h[1];var m=this.offsetX||0;var n=this.offsetY||0;this.boxRegion.setStyle({position:"absolute",left:(k+j.width+20)+m+"px",top:l+n+"px",zIndex:Windows.getZIndex()});this.getContainer().appendChild(this.boxRegion)},destroyBox:function(){Windows.unregister(this);this.element=null;this.getContainer().removeChild(this.boxRegion)},set:function(c,d){this.hint.innerHTML=d;this.hint.className=c;if(d.length===0){this.hide()}else{this.show()}}});var Tooltips={tooltips:[],unregister:function(b){this.tooltips=this.tooltips.reject(function(a){return a==b})},register:function(b){if(!this.tooltips.include(b)){this.tooltips.push(b)}},isRegistered:function(b){return this.tooltips.include(b)}};Window.TooltipWindow=Class.create();Object.extend(Object.extend(Window.TooltipWindow.prototype,Window.prototype),{isOpen:false,isObserveMouse:true,observeCloseEvent:false,options:{element:null,isInOverflowContainer:false},initialize:function(c){this.setOptions(c);if(!Tooltips.isRegistered(this.element)){Tooltips.register(this.element);var d=new Date().getTime();this.id="tooltipWindow_"+d;this.isFocus=false;this.createOverlay=false;this.isObserveMouse=this.element.tagName.toLowerCase()!=="input";this.initializeDOM();this.initializeControl();this.initializeEvent()}},addDOM:function(){},removeDOM:function(){this.wrapElement.removeChild(this.windowElement);var b=this.getContainer();b.removeChild(this.wrapElement);this.wrapElement=null;this.windowElement=null;this.element=null},initializeDOM:function(){this.addDOM();this.windowElement=$(this.windowElement);this.element=$(this.element);this.wrapElement=Element.extend(Builder.node("div",{},[""]));this.wrapElement.appendChild(this.windowElement);var b=this.getContainer();b.appendChild(this.wrapElement);this.wrapElement.setStyle({zoom:1})},initializeEvent:function(){Event.observe(window,"unload",this.close.bind(this))},destroyEvent:function(){},initializeControl:function(){this.observer=new Observer({sourceElement:this.element,onOverSourceCallback:this.show.bind(this),onOutSourceCallback:this.hide.bind(this),onOverTargetCallback:this.show.bind(this),onOutTargetCallback:this.hide.bind(this)})},destroyControl:function(){this.observer.close()},setupDimensions:function(){var K=0,L=0,w=this.element,P=this.zIndex;Position.prepare();var A=Position.cumulativeOffset(w);var I=A[0],J=A[1];if(this.isInOverflowContainer){var B=Position.realOffset(w);var C=B[0],D=B[1];I=I-C+Position.deltaX;J=J-D+Position.deltaY}var E=w.getDimensions();var H=E.width;var z=E.height;var N=this.windowElement.getDimensions();var O=N.width;var M=N.height;var F=I+H/2;var G=J;var x=F;var y=G+z;K=F-30;L=G-17-M;if(this.overlay){P=parseInt(this.overlay.getStyle("zIndex"))+1}else{P++}this.windowElement.setStyle({position:"absolute",top:L+"px",left:K+"px",zIndex:P});this.elementX=I;this.elementY=J;this.elementWidth=H;this.elementHeight=z;this.windowX=L;this.windowY=K;this.windowWidth=O;this.windowHeight=M},show:function(){if(!this.isOpen){this.isOpen=true;this.open();this.observer.targetElement=this.windowElement;this.observer.initializeTargetEvent()}else{this.setupDimensions();this.showWindow()}},hide:function(){this.hideWindow()},dispose:function(){Tooltips.unregister(this.element);this.hide();this.destroyControl();this.destroyEvent();this.removeDOM()}});var TheaterCityMenu=Class.create();Object.extend(TheaterCityMenu.prototype,{server:{getData:function(b){if(typeof threaterListBoxData!=="undefined"&&threaterListBoxData.locations){b&&b()}else{$loadJs("/Utility/Data/TheaterListBoxData.m",b)}},getTheaterCityHomeURL:function(c,d){if(typeof theaterService==="undefined"){return Mtime.Component.Ajax.callBack("Mtime.Showtime.Pages.ShowtimeService","GetTheaterCityHomeURL",[c],d,"/service/showtime.ms","get","25000")}else{return Mtime.Component.Ajax.request(theaterService,"Mtime.Showtime.Pages.ShowtimeService","GetTheaterCityHomeURL",[c],d,"/service/showtime.ms","get","25000")}}},options:{items:[],hotSearchItems:[290,292,293,365,974,366,561,880,791],HOTROWSIZE:10,order:"",container:"",optionTS:"<li><a value=#{Id}>#{NameCn}</a></li>",content:{regRxpAG:["A","B","C","D","E","F","G"],regRxpHL:["H","I","J","K","L"],regRxpMT:["M","N","O","P","Q","R","S","T"],regRxpWZ:["U","V","W","X","Y","Z"]}},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.optionTemplate=new Template(this.optionTS);this.initializeDOM();this.initializeEvent();this.getItems()},initializeDOM:function(){this.headPanel=$(this.container);this.closeNode=Builder.node("span",{className:"btn_close fr"},[""]);this.contentBox=Builder.node("div");this.searchCityText=Builder.node("input",{type:"text",className:"c_a5"});this.tab=Builder.node("span",{className:"cityletter"},[Builder.node("a",{href:"#",onclick:"return false;",className:"on"},[""]),Builder.node("a",{href:"#",onclick:"return false;"},["A-G"]),Builder.node("a",{href:"#",onclick:"return false;"},["H-L"]),Builder.node("a",{href:"#",onclick:"return false;"},["M-T"]),Builder.node("a",{href:"#",onclick:"return false;"},["W-Z"])]);this.span=Builder.node("span",{className:"fl w30 bold mt5"});this.bodyPanel=$(Builder.node("div",{id:"showtime_tip",className:"showtime_tip",style:"width: 750px; position: absolute; top: 49px; left: 0px;display:none;"},[Builder.node("div",{className:"share_tit clearfix"},[this.closeNode,this.searchCityText,this.tab]),Builder.node("div",{className:"p15"},[this.contentBox])]));this.headPanel.parentNode.insertBefore(this.bodyPanel,this.headPanel);var c=this.tab.childNodes;for(var d=0;d<c.length;d++){Event.observe(c[d],"click",function(b){var a=b.target||b.srcElement;if(a.innerHTML!==this.order){$A(this.tab.childNodes).each(function(g){g.className=""});a.className="on";this.order=a.innerHTML;this.reload(a.innerHTML)}}.bind(this))}},initializeEvent:function(){this.ononSearchCityTextFocusHandler=this.onSearchCityTextFocus.bind(this);this.onSearchCityTextBlurHandler=this.onSearchCityTextBlur.bind(this);this.onHeadPanelClickHandler=this.onHeadPanelClick.bind(this);this.onCloseHandler=this.hide.bind(this);Event.observe(this.searchCityText,"focus",this.ononSearchCityTextFocusHandler);Event.observe(this.searchCityText,"blur",this.onSearchCityTextBlurHandler);Event.observe(this.headPanel,"click",this.onHeadPanelClickHandler);Event.observe(this.closeNode,"click",this.onCloseHandler)},destroyEvent:function(){this.ononSearchCityTextFocusHandler&&Event.stopObserving(this.searchCityText,"focus",this.ononSearchCityTextFocusHandler);this.onSearchCityTextBlurHandler&&Event.stopObserving(this.searchCityText,"blur",this.onSearchCityTextBlurHandler);this.onHeadPanelClickHandler&&Event.stopObserving(this.headPanel,"click",this.onHeadPanelClickHandler);this.onCloseHandler&&Event.stopObserving(this.closeNode,"click",this.onCloseHandler)},destroyPanel:function(){this.closeNode=null;this.contentBox=null;this.searchCityText=null;this.tab=null;this.span=null;this.bodyPanel=null;this.headPanel=null},close:function(){this.destroyEvent();this.destroyPanel()},getHotItems:function(){if(!this.hotItems){this.hotItems=this.items.sortBy(function(b){return -b.OTicketCinemaCount}).slice(0,40).sortBy(function(b){return -b.VisitedTimes}).collect(function(b){return b.Id})}return this.hotItems},reload:function(l){this.contentBox.update();var g=null;switch(l){case"":if(!this.content.HOT){this.content.HOT=this.createOptions(this.getCitys(this.items,this.getHotItems())," ",true)}this.contentBox.update(this.content.HOT);break;case"A-G":if(!this.content.AG){g=this.items.findAll(function(a){var b=/[A-G]/.test(a.initial);return b});this.content.AG=this.makeNodes(g,this.content.regRxpAG)}this.contentBox.update(this.content.AG);break;case"H-L":if(!this.content.HL){g=this.items.findAll(function(a){var b=/[H-L]/.test(a.initial);return b});this.content.HL=this.makeNodes(g,this.content.regRxpHL)}this.contentBox.update(this.content.HL);break;case"M-T":if(!this.content.MT){g=this.items.findAll(function(a){var b=/[M-T]/.test(a.initial);return b});this.content.MT=this.makeNodes(g,this.content.regRxpMT)}this.contentBox.update(this.content.MT);break;case"W-Z":if(!this.content.WZ){g=this.items.findAll(function(a){var b=/[M-Z]/.test(a.initial);return b});this.content.WZ=this.makeNodes(g,this.content.regRxpWZ)}this.contentBox.update(this.content.WZ);break;default:break}var k=this.contentBox.getElementsByTagName("li");for(var j=0,h=k.length;j<h;j++){Event.observe(k[j],"click",function(b){var a=b.target||b.srcElement;this.command(a.getAttribute("value"))}.bind(this))}},makeNodes:function(j,l){var p=new StringBuilder();for(var m=0,k=l.length;m<k;m++){var o=l[m];var n=j.findAll(function(a){return a.initial===o}).sortBy(function(a){return -a.VisitedTimes});if(n.length>0){p.append(this.createOptions(n,o))}}return p.toString()},getItems:function(){this.locations=[];this.server.getData(function(){if(typeof threaterListBoxData!=="undefined"&&threaterListBoxData.locations){this.locations=threaterListBoxData.locations.List}this.items=[];this.locations.each(function(c){var d={Id:c.Id,NameCn:c.NameCn,NameEn:c.NameEn,initial:c.NameEn.charAt(0).toLocaleUpperCase(),PinyinShort:c.PinyinShort||"",VisitedTimes:c.VisitedTimes,OTicketCinemaCount:c.OTicketCinemaCount};this.items.push(d)}.bind(this));this.reload("");this.cityAutoComplete=new CityAutoComplete({text:this.searchCityText,textWatermarkText:"",listRegion:this.contentBox,itemTemplate:'<li value="#{Id}"><span class="fl">#{NameEn}</span><span class="fr">#{NameCn}</span></li>',idFieldName:"Id",titleFieldName:"NameCn",searchDatas:this.items,defaultSearchDatas:this.getCitys(this.items,this.hotSearchItems),choiceCount:9,doCommand:this.command.bind(this),onEnterCallback:function(g){var j=this.contentBox.getElementsByTagName("li");for(var h=0,f=j.length;h<f;h++){if(j[h].className==="on"){this.command(j[h].getAttribute("value"));break}}}.bind(this)})}.bind(this))},createOptions:function(l,j,k){var m=Builder.node("div");var n=new StringBuilder();n.append('<div class="city_list2 clearfix">');n.append('<span class="fl w30 bold mt5">'+j+"</span>");n.append("<ul>");for(var h=0;h<l.length;h++){if(k&&h!==0&&(h%this.HOTROWSIZE===0)){n.append('</ul><span class="fl w30 bold mt5"> </span><ul>')}n.append(this.optionTemplate.evaluate(l[h]))}n.append("</ul>");n.append("</div>");return n.toString()},onSearchCityTextFocus:function(){$A(this.tab.childNodes).each(function(b){b.className=""})},onSearchCityTextBlur:function(b){this.order=null},onHeadPanelClick:function(b){b&&Event.stop(b);this.isShowing()?this.hide():this.show()},isShowing:function(){return(this.bodyPanel.style.display!="none")},show:function(){this.bodyPanel.show()},hide:function(){this.bodyPanel.hide()},command:function(j){if(j!==null){var l="http://theater."+mtimeCookieDomain+"/[^/]+";var n=["/","/cinema/","/movie/","/ecoupon/","/ticket/","/card/","/movie/\\d+/","/discount/","/discount/information/","/discount/coupon/","/movie/lastday/"];var m=null;var k=n.find(function(a){var b=new RegExp(("^"+l+"("+a+")$").replace(/\//g,"\\/"));m=(location.protocol+"//"+location.host+location.pathname).match(b);return m&&m.length==2});var h;if(!k){h=this.commandCallback&&this.commandCallback(j)}this.server.getTheaterCityHomeURL(j,function(a){if(a&&a.value){setCookie("DefaultCity-CookieKey",j);if(k){$redirect(a.value.replace(/\/$/,"")+m[1])}else{if(h){$redirect(h)}else{$redirect(a.value)}}}})}},getCitys:function(p,m){var n=[];for(var o=0;o<m.length;o++){var l=m[o];var k=this.getCity(p,l);if(k!==null){n.push(k)}}if(n.length<m.length){var r=m.length-n.length;for(var q=0;q<p.length;q++){if(r===0){break}if(!m.include(p[q].Id)){n.push(p[q]);r--}}}return n},getCity:function(j,f){for(var g=0,h=j.length;g<h;g++){if(f==j[g].Id){return j[g]}}return null}});var CityAutoComplete=Class.create();Object.extend(Object.extend(CityAutoComplete.prototype,AutoCompleteBase.prototype),{initialize:function(b){this.baseInitialize(b)},initializeField:function(){this.firstRender=true;this.isShowMoreResult=false;this.isAutoMatchSuggest=true},initializeDOM:function(){},destroyDOM:function(){this.listTipText=null},initializeEvent:function(){},destroyEvent:function(){},baseInitializeEvent:function(){},getEntry:function(f){this.active=false;var g=this.listRegion.getElementsByTagName("li");var d=g.length;if(d>f&&f>=0){return $(g[f])}return null},onEnterText:function(){if(this.onEnterCallback){this.onEnterCallback()}},onObserverEvent:function(){var b=this.getSearchKeyword();if(b.length>=this.minChars){if(b!=this.keyword){this.keyword=b;this.render()}}else{this.keyword="";this.active=false;this.render()}},onBlurText:function(d,c){this.active=false;this.hasFocus=false;this.removeObserver()},reset:function(){this.selectedValue=null;this.index=0;this.searchIndex=0;this.entryCount=0},onClick:function(){},onClickText:function(){},onFocusText:function(b){this.hasFocus=true;this.active=true;this.render()},match:function(c,d){if((d.PinyinShort.toLowerCase().indexOf(c.toLowerCase())===0)){return true}else{if((d.NameCn.toLowerCase().indexOf(c.toLowerCase())===0)||(d.NameEn.toLowerCase().indexOf(c.toLowerCase())===0)){return true}}return false},onKeydownText:function(b){if(this.handled){this.handled=false;return}this.handled=true;switch(b.keyCode){case Event.KEY_RETURN:this.onEnterText();Event.stop(b);return;case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:this.markPrevious();Event.stop(b);return;case Event.KEY_DOWN:this.markNext();Event.stop(b);return;default:this.addObserver();this.onChangeInput();break}},doRender:function(){if(this.isEnable){if(this.changed){this.reset()}var c=this.getSearchKeyword();if(c.length===0){this.removeObserver();this.renderDefaultList();if(Prototype.Browser.Gecko&&this.hasFocus){setTimeout(function(){var a=this.getSearchKeyword();if(a!=this.keyword){var b=this.getMoreLists();if(this.isAlwayShowList||this.entryCount>0){this.renderTip(a,this.entryCount);this.renderList(this.changed,b)}}}.bind(this),1000)}}else{var d=this.getMoreLists();if(this.isAlwayShowList||this.entryCount>0){this.renderTip(c,this.entryCount);this.renderList(this.changed,d);this.showSelectList()}else{this.hideSelectList()}}}},renderTip:function(c,d){if(this.firstRender||c===""){this.firstRender=false;this.listTipText="/&uarr;&darr;"}else{if(d>0){this.listTipText=c+""}else{this.listTipText=""+c}}},renderList:function(m,p){var k='<div class="sou_window"><div class="sou_note">'+this.listTipText+'</div><div class="sou_city"><ul>'+p+"</ul></div></div>";this.listRegion.update(k);var o=this.listRegion.getElementsByTagName("li");for(var l=0,j=o.length;l<j;l++){var n=o[l];n.style.cursor="pointer";Event.observe(n,"click",function(b){var a=b.target||b.srcElement;if(a.nodeName=="SPAN"){a=a.parentNode}this.doCommand(a.getAttribute("value"))}.bind(this));Event.observe(n,"mouseover",function(b){var c=this;if(Prototype.Browser.IE){var a=b.target||b.srcElement;if(a.nodeName=="SPAN"){c=a.parentNode}else{c=a}}$A(c.parentNode.childNodes).each(function(d){d.className=""});c.className="on"});Event.observe(n,"mouseout",function(b){var c=this;if(Prototype.Browser.IE){var a=b.target||b.srcElement;if(a.nodeName=="SPAN"){c=a.parentNode}else{c=a}}c.className=""})}if(o.length>0){o[0].className="on"}}});var TheaterSearch=Class.create();Object.extend(TheaterSearch.prototype,{server:{getUser:function(b){return Mtime.Component.Ajax.get("Mtime.Service.Pages.ManagerService","GetUserInfo2",[],b,"/Service/Manager.msi","get","10000")},getFavorite:function(d,c){return Mtime.Component.Ajax.request(theaterService,"Mtime.Theater.Pages.ShowtimeService","GetFavCinemas",d,c,"/service/showtime.ms","get","20000")},search:function(d,c){return Mtime.Component.Ajax.request(theaterService,"Mtime.Theater.Pages.ShowtimeService","SearchCinemaByCinemaName",d,c,"/service/showtime.ms","get","20000")}},options:{textInput:"",searchBtn:"",watermarkText:"",resultRegion:"",cityId:null,districtId:null,callback:null,itemTemplate:'<dd value="#{Id}"><h3>#{NameCn}</h3><p class="c_666">#{DistrictNameCn}</p></dd>'},initialize:function(b){this.setOptions(b);this.initializeUser()},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initializeUser:function(){this.server.getUser();this.initializeField();this.initializeControl();this.initializeEvent()},initializeControl:function(){this.autoComplete=new SearchAutoComplete({text:this.textInput,textWatermarkText:(this.watermarkText||""),listRegion:this.resultRegion,itemTemplate:this.itemTemplate,idFieldName:"Id",titleFieldName:"NameCn",searchDatas:null,getSearchDataCallback:function(b){this.timeout&&clearTimeout(this.timeout);this.timeout=setTimeout(this.searchTheater.bind(this,b),500)}.bind(this),choiceCount:7,isAlwayShowList:true,onChangeInputCallback:null,onChangeCallback:null,onEnterCallback:this.submitInnerHandler,onClickListRegion:function(d){var c=Event.findElement(d,"dd");if(c!=document){this.removeObserver();this.selectedEntry(c);if(this.onEnterCallback){this.onEnterCallback(this.getValue())}}},selectEntry:function(){this.active=false;var b=this.getCurrentEntry();if(b){this.removeObserver();this.selectedEntry(b)}},getMoreLists:function(){var p=this.searchDatas,o=null,j=this.choiceCount,m=new StringBuilder(),n=0;for(var l=0,k=p.length;l<k&&n<j;l++){o=p[l];m.append(this.createListItem(o));n++;this.searchIndex=l}this.entryCount+=n;return m.toString()}})},initializeField:function(){this.textInput=$(this.textInput);this.resultRegion=$(this.resultRegion);this.resultRegion.hide();this.searchBtn=$(this.searchBtn);this.submitInnerHandler=this.submitInner.bind(this);this.cache={}},initializeEvent:function(){this.searchBtn&&Event.observe(this.searchBtn,"click",this.submitInnerHandler)},reset:function(){this.autoComplete.textbox.clear();this.resultRegion.hide()},close:function(){if(!this.closed){this.destroy();this.closed=true}},destroy:function(){if(!this.destroyed){this.destroyEvent();this.destroyControl();this.destroyField();this.destroyed=true}},destroyEvent:function(){this.searchBtn&&Event.stopObserving(this.searchBtn,"click",this.submitInnerHandler)},destroyControl:function(){this.autoComplete.close()},destroyField:function(){},isLogin:function(){try{return !!self.getUserInfoResult.value.userId?true:false}catch(b){return false}},getValue:function(){return this.autoComplete.textbox.getValue()},setValue:function(b){this.autoComplete.textbox.setValue(b)},searchTheater:function(h){var l=this.getValue();if(l){if(this.cache[l]){h&&h(this.cache[l])}else{this.server.search([this.cityId,l],function(a){if(a&&a.value&&a.value.cinemas){this.cache[l]=a.value.cinemas.List;h&&h(a.value.cinemas.List)}}.bind(this))}}else{if(this.isLogin()){var k=this.resultRegion;var j=new Template(this.itemTemplate);var g=this.autoComplete;if(!g.defaultSearchDatas){this.getFavorite(function(a){g.defaultSearchDatas=a;h&&h(a)})}else{h&&h(g.defaultSearchDatas)}}}},submitInner:function(b){if(b&&b.ShowtimeUrl){window.open(b.ShowtimeUrl)}else{this.btnSubmit()}},btnSubmit:function(){var b=this.getValue();b&&(location.href=String.format(this.cinemaMapSearchUrl,encodeURIComponent(b).replace(/'/g,"%27")))},getFavorite:function(b){if(this.favoriteTheaters){b&&b(this.favoriteTheaters)}else{if(!this.hasGetFavorite){this.server.getFavorite([this.cityId],function(a){this.hasGetFavorite=true;if(a&&a.value&&a.value.cinemas){this.favoriteTheaters=a.value.cinemas.List;b&&b(this.favoriteTheaters)}}.bind(this))}}}});var TheaterShowtime=Class.create();Object.extend(TheaterShowtime.prototype,{options:{cityId:0,cityName:"",datenavRegion:"datenavRegion",showtimeRegion:"showtimeRegion",shortinfoRegion:"shortinfoRegion"},initialize:function(b){this.setOptions(b);this.initializeDOM()},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initializeControl:function(){},initializeDOM:function(){this.initializeField();this.initializeControl()},initializeField:function(){},initializeEvent:function(){this.initializeEvent()},close:function(){if(!this.closed){this.destroy();this.closed=true}},destroy:function(){if(!this.destroyed){this.destroyEvent();this.destroyControl();this.destroyDOM();this.destroyField();this.destroyed=true}},destroyEvent:function(){},destroyControl:function(){},destroyDOM:function(){},destroyField:function(){}});var baiduMapApiSiteUrl="";if(window.location.protocol==="https:"){baiduMapApiSiteUrl="https://sp2.baidu.com/9_Q4sjOpB1gCo2Kml5_Y_D3"}else{baiduMapApiSiteUrl="http://api.map.baidu.com"}var TheaterMap=Class.create();Object.extend(TheaterMap.prototype,{options:{mapRegion:null,theaterSelectCallback:null,theaters:null,showInfoWindow:true,InfoWindowTemplate:new Template('<div><p class="mt6">#{Address}</p>  <p class="mt6">#{Telephone}</p>  <p class="mt9">#{_URLHTML}</p><p class="line_dot mt12 mb12">&nbsp;</p>  <p><a href="#" onclick="return false;" method="to" class="onbold"></a> | <a href="#" onclick="return false;" method="from"></a></p>  <p class="mt9"><input type="text" class="w95 txt"><a href="#" onclick="return false;" class="i_btn_ws ml9" method="bt"></a><a href="#" onclick="return false;" class="i_btn_ws ml9" method="dt"></a></p></div>'),durl:new Template("http://map.baidu.com/?newmap=1&tn=B_NORMAL_MAP&i=0,1,1&s=nav%26sn%3D2%24%24%24%24%24%24#{from}%24%240%24%24%24%24%26en%3D2%24%24%24%24%24%24#{to}%24%240%24%24%24%24%26pn%3D0%26rn%3D5%26sy%3D0&sc=0"),burl:new Template("http://map.baidu.com/?newmap=1&tn=B_NORMAL_MAP&i=0,1,1&s=bt%26sn%3D2%24%24%24%24%24%24#{from}%24%240%24%24%24%24%26en%3D2%24%24%24%24%24%24#{to}%24%240%24%24%24%24%26pn%3D0%26rn%3D5%26sy%3D0&sc=0")},loadBaiduMapLib:function(d){if(window.BMap){d&&d()}else{var c;if(window.location.protocol==="https:"){window.HOST_TYPE="1";window.BMap_loadScriptTime=(new Date).getTime();c="https://sp0.baidu.com/9_Q4sjOpB1gCo2Kml5_Y_D3/getscript?v=2.0&ak=WWD0d9MDGGdDRBjkx6NNLzZM"}else{c=baiduMapApiSiteUrl+"/getscript?v=2.0&ak=WWD0d9MDGGdDRBjkx6NNLzZM"}$loadJs([c,cssServer+"/convertor.js"],function(){$loadCss(baiduMapApiSiteUrl+"/res/12/bmap.css",function(){d&&d()})})}},initialize:function(b){this.setOptions(b);this.mapRegion=$(this.mapRegion);if(this.mapRegion){this.initializeField();this.loadBaiduMapLib(function(){if(!this.initialized){this.initialized=true;this.initializeControl();this.initializeEvent();this.initializeCallback&&this.initializeCallback()}}.bind(this))}},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initializeControl:function(){for(var d=0;d<10;++d){this.icons.push(new BMap.Icon(cssServer+"/images/2011/mapnum.png",new BMap.Size(23,34),{imageOffset:new BMap.Size(0-d*23,0)}))}var f=new BMap.Map(this.mapRegion);f.enableScrollWheelZoom();f.addControl(new BMap.NavigationControl());if(this.cityName){f.centerAndZoom(this.cityName,12)}else{var g=new BMap.Point(116.404,39.915);f.centerAndZoom(g,5)}this.map=f;this.markTheaters(this.theaters)},initializeField:function(){this.TheaterInfoWindows={};this.TheaterBaiduPoints={};this.icons=[]},initializeEvent:function(){},close:function(){if(!this.closed){this.destroy();this.closed=true}},destroy:function(){if(!this.destroyed){this.destroyEvent();this.destroyControl();this.destroyField();this.destroyed=true}},destroyEvent:function(){},destroyControl:function(){},destroyField:function(){},getTheaterInfoWindow:function(n,m){if(n){var k=null;k=this.TheaterInfoWindows[n.Id];if(!k){var h=[];if(n.ShowtimeUrl){h.push('<a href="'+n.ShowtimeUrl+'" target="_blank" class="i_btn_bs"></a>')}if(n.EcouponUrl){h.push('<a href="'+n.EcouponUrl+'" target="_blank" class="i_btn_gs ml12"></a>')}if(n.HasOnlineTicket){h.push('<a href="'+n.ShowtimeUrl+'" target="_blank" class="i_btn_os ml12"></a>')}n._URLHTML=h.join("");var j=Builder.build(this.InfoWindowTemplate.evaluate(n));var l={width:400,height:0,title:"<h3>"+n.NameCn+"</h3>",offset:new BMap.Size(0,-15)};k=new BMap.InfoWindow(j,l);Event.observe(j,"click",function(b){var a=Event.findElement(b,"a");var f=null;if(a!=document&&(f=a.getAttribute("method"))){var s=j.down('a[method="to"]');var d=j.down('a[method="from"]');var t=j.down(".onbold").getAttribute("method");var g=j.down("input").value;switch(f){case"to":s.addClassName("onbold");d.removeClassName("onbold");break;case"from":d.addClassName("onbold");s.removeClassName("onbold");break;case"bt":if(g){var c,r;if(t=="to"){c=g;r=n.NameCn}else{c=n.NameCn;r=g}window.open(this.burl.evaluate({from:c,to:r}))}break;case"dt":if(g){var c,r;if(t=="to"){c=g;r=n.NameCn}else{c=n.NameCn;r=g}window.open(this.durl.evaluate({from:c,to:r}))}break;default:break}}}.bind(this));this.TheaterInfoWindows[n.Id]=k}return k}},pointConvert:function(j,g){var f=this.TheaterBaiduPoints[j.Id];if(f){g&&g(f)}else{var h=new BMap.Point(j.Longitude,j.Latitude);if(j.dulongitude!=0&&j.dulatitude!=0){h=new BMap.Point(j.dulongitude,j.dulatitude);this.TheaterBaiduPoints[j.Id]=h;g&&g(h)}else{BMap&&BMap.Convertor&&BMap.Convertor.translate(h,2,function(a){this.TheaterBaiduPoints[j.Id]=a;g&&g(a)}.bind(this))}}},markTheaters:function(g){if(this.map&&g){if(this.marked){this.unmarkTheaters()}var d=this.map;var f=[];g.each(function(b,a){this.pointConvert(b,function(l){var k=new BMap.Marker(l,{title:b.NameCn,icon:this.icons[a]}),c;d.addOverlay(k);if(this.showInfoWindow){c=this.getTheaterInfoWindow(b,l)}if(c||b.clickCallback){k.addEventListener("click",function(h){c&&this.openInfoWindow(c,l);b.clickCallback&&b.clickCallback(b)})}f.push(l);if(f.length==g.length){if(f.length>1){d.setViewport(f)}else{d.centerAndZoom(f[0],13);this.showInfoWindow&&this.openInfoWindow(g[0])}}}.bind(this))}.bind(this));this.marked=true}},unmarkTheaters:function(){this.map.clearOverlays();var b=this.map.getInfoWindow();b&&this.closeInfoWindow(b);this.TheaterInfoWindows={}},openInfoWindow:function(g){if(!this.map){return false}var d=this.TheaterInfoWindows[g.Id];if(d){var f=this.map;this.pointConvert(g,function(a){f.centerAndZoom(a,f.getZoom());f.openInfoWindow(d,a)})}}});var TheaterCustomerDialog=Class.create();Object.extend(Object.extend(TheaterCustomerDialog.prototype,Window.prototype),{options:{windowClassName:"",windowStyle:""},initializeWindow:function(){var b=this.uniqueId;this.id="window08_"+b},addDOM:function(){this.windowElement=Builder.build('<div><div class="'+this.windowClassName+'" style="'+this.windowStyle+'">'+this.content+"</div></div>")},destroyDOM:function(){},render:function(){this.open();setTimeout(function(){this.windowElement.down().setStyle({zoom:1})}.bind(this),50);if(this.closeTimeout>0){this.timerId=setTimeout(this.autoClose.bind(this),this.closeTimeout*1000)}},load:function(){this.readyCallback&&this.readyCallback(this)},setupDimensions:function(){var n=this.dimensions.viewport.height/2+this.pagePosition.y;var m=this.dimensions.viewport.width/2+this.pagePosition.x;var k=this.windowElement.down().getDimensions();var l=k.width,j=k.height;var h=(n-parseFloat(j)/2);if(h<=0){h=this.fixTopHeight}this.windowElement.setStyle({position:"absolute",top:h+"px",left:(m-parseFloat(l)/2)+"px",zIndex:this.overlay?parseInt(this.overlay.getStyle("zIndex"))+1:Windows.getZIndex()});this.windowElement.down().setStyle({zIndex:parseInt(this.windowElement.getStyle("zIndex"))+1})},autoClose:function(){if(this.timerId){clearTimeout(this.timerId)}this.close()},dispose:function(){}});var TheaterMapDialog=Class.create();Object.extend(TheaterMapDialog.prototype,{server:{getCinemaMap:function(d,c){return Mtime.Component.Ajax.request(theaterService,"Mtime.Theater.Pages.ShowtimeService","GetCinemaMap",[d],c,"/service/showtime.ms","get","20000")}},options:{theater:{Id:1,NameCn:"",Address:"",Telephone:"010-66086662",Longitude:116.379998,Latitude:39.9169,Rating:9.1},contentTemplate:new Template('<div class="share_tiper"><div class="c_maptit"><div class="btn_close" _type="close"><a title="" href="#" onclick="return false;"></a></div><div class="clearfix"><h3 class="fl yahei px24 normal lh10">#{NameCn}</h3><div class="point ml12 px14">#{RatingHTML}</div></div>#{RoadlineHTML}</div><div class="c_mapbox" _type="map"></div></div>')},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.initializeControl();this.initializeEvent()},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initializeControl:function(){if(this.theater.Rating>0){var c=Math.floor(this.theater.Rating);var d=this.theater.Rating-c;this.theater.RatingHTML=String.format('<span class="total">{0}</span><span class="total2">.{1}</span>',c,Math.round(d*10))}if(this.theater.Roadline){this.theater.RoadlineHTML='<p class="mt9 p_r lh18 zoom" style="padding-left:80px;"><strong class="px14" style="position:absolute; left:0; top:0;"></strong><span class="mr18">'+this.theater.Roadline+"</span></p>"}this.dialog=new TheaterCustomerDialog({content:this.contentTemplate.evaluate(this.theater),windowClassName:"share_tip",windowStyle:"width:960px;",readyCallback:this.dialogReadyCallback.bind(this)})},initializeDOM:function(){},initializeField:function(){},initializeEvent:function(){},close:function(){if(!this.closed){this.destroy();this.closed=true}},destroy:function(){if(!this.destroyed){this.destroyEvent();this.destroyControl();this.destroyDOM();this.destroyField();this.destroyed=true}},destroyEvent:function(){},destroyControl:function(){},destroyDOM:function(){},destroyField:function(){},dialogReadyCallback:function(h){var l=h.windowElement;var g=l.down('[_type="close"]');var k=l.down('[_type="map"]');var j=null;this.server.getCinemaMap(this.theater.Id,function(b){if(b&&b.value){var a={Id:this.theater.Id,EcouponUrl:b.value.EcouponUrl,HasOnlineTicket:b.value.HasOnlineTicket,Latitude:b.value.latidude,Longitude:b.value.longitude,dulatitude:b.value.dulatitude,dulongitude:b.value.dulongitude,NameCn:b.value.cinemaNameCn,Rating:b.value.Rating,Roadline:b.value.Roadline,ShowtimeUrl:b.value.ShowtimeUrl,Telephone:b.value.telphone,Address:b.value.address};j=new TheaterMap({theaters:[a],mapRegion:k})}}.bind(this));l.style.zoom="1";Event.observe(g,"click",function(a){j&&j.close();h.close()})}});self.animationFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(c,d){window.setTimeout(c,1000/60)}})();var SliderSwitch=Class.create();Object.extend(SliderSwitch.prototype,{options:{oncallback:null,offcallback:null,sliderRegion:"sliderregion",sliderTemplate:"<span>&nbsp;</span>",onpix:51,offpix:0,ison:true},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.initializeEvent()},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initializeDOM:function(){this.sliderRegion.innerHTML=this.sliderTemplate;this.sliderBtn=this.sliderRegion.down("span");if(this.ison){this.sliderBtn.setStyle({left:this.onpix+"px"})}else{this.sliderBtn.setStyle({left:this.offpix+"px"})}},initializeField:function(){this.sliderRegion=$(this.sliderRegion);this.mouseStartHandler=this.mouseStart.bind(this);this.mouseEndHandler=this.mouseEnd.bind(this);this.mouseMoveHandler=this.mouseMove.bind(this)},initializeEvent:function(){Event.observe(this.sliderRegion,"mousedown",this.mouseStartHandler)},close:function(){if(!this.closed){this.destroy();this.closed=true}},destroy:function(){if(!this.destroyed){this.destroyEvent();this.destroyDOM();this.destroyField();this.destroyed=true}},destroyEvent:function(){Event.stopObserving(this.sliderRegion,"mousedown",this.mouseStartHandler)},destroyControl:function(){},destroyDOM:function(){},destroyField:function(){},seton:function(){this.ison=true;var b=parseInt(this.sliderBtn.getStyle("left"),10);this.animation(this.sliderBtn,"left",b,this.onpix,Math.abs(this.onpix-b)/200)},setoff:function(){this.ison=false;var b=parseInt(this.sliderBtn.getStyle("left"),10);this.animation(this.sliderBtn,"left",b,this.offpix,Math.abs(this.offpix-b)/200)},mouseStart:function(b){Event.observe(document.body,"mouseup",this.mouseEndHandler);Event.observe(document.body,"mousemove",this.mouseMoveHandler);this.isMove=false;this.prevX=b.clientX;b.returnValue=false;b.preventDefault&&b.preventDefault()},mouseMove:function(g){this.isMove=true;var f=g.clientX;var h=parseInt(this.sliderBtn.getStyle("left"),10);var j=h+f-this.prevX;if([this.onpix,this.offpix,j].sort(function(a,b){return a-b}).indexOf(j)==1){this.sliderBtn.setStyle({left:j+"px"});this.prevX=f}g.returnValue=false;g.preventDefault&&g.preventDefault()},mouseEnd:function(){Event.stopObserving(document.body,"mouseup",this.mouseEndHandler);Event.stopObserving(document.body,"mousemove",this.mouseMoveHandler);var d=parseInt(this.sliderBtn.getStyle("left"),10);var c;if(this.isMove){c=Math.abs(this.onpix-d)<Math.abs(this.offpix-d)}else{c=!this.ison}if(c){this.animation(this.sliderBtn,"left",d,this.onpix,Math.abs(this.onpix-d)/200,this.oncallback)}else{this.animation(this.sliderBtn,"left",d,this.offpix,Math.abs(this.offpix-d)/200,this.offcallback)}if(c!=this.ison){this.ison=c}},animation:function(p,t,r,v,o,n){var q=60;var u=q*o;var s=(v-r)/(u);var m=function(){p.style[t]=r+"px";r+=s;if(u--<=0){p.style[t]=v+"px";n&&n();return}animationFrame(m)};animationFrame(m)}});var ScrollBar=Class.create();Object.extend(ScrollBar.prototype,{getXY:function(j){var k=0,l=0;if(j.getBoundingClientRect){var a=j.getBoundingClientRect();var b=document.documentElement;k=a.left+Math.max(b.scrollLeft,document.body.scrollLeft)-b.clientLeft;l=a.top+Math.max(b.scrollTop,document.body.scrollTop)-b.clientTop}else{for(;j!=document.body;k+=j.offsetLeft,l+=j.offsetTop,j=j.offsetParent){}}return{x:k,y:l}},hasChild:function(f,d){var g=d;while(g!=document.body&&(g=g.parentNode)!=f){}if(g==f){return true}else{return false}},isInView:function(h,f){if(this.hasChild(h,f)){var j=[];j[0]=this.getXY(h).y;j[1]=j[0]+parseInt(h.offsetHeight);var g=[];g[0]=this.getXY(f).y;g[1]=g[0]+parseInt(f.offsetHeight);if((g[0]-j[0])>=-5&&(j[1]-g[1])>=-5){return true}else{return false}}return false},options:{contentRegion:null,scrollbarTemplate:'<div class="scrollbar"><span>&nbsp;</span></div>'},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDom();this.initializeEvent();this.reset()},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initializeField:function(){this.content=$(this.contentRegion);this.upClickHandler=this.upClick.bind(this);this.downClickHandler=this.downClick.bind(this);this.keyDownHandler=this.keyDown.bind(this);this.mouseWheelHandler=this.mouseWheel.bind(this);this.stopClickHandler=this.stopClick.bind(this);this.trackHandler=this.track.bind(this);this.startTrackHandler=this.startTrack.bind(this);this.endTrackHandler=this.endTrack.bind(this);this.trackToHandler=this.trackTo.bind(this);this.resetHandler=this.reset.bind(this)},initializeDom:function(){var b=$(Builder.build(this.scrollbarTemplate));this.content.parentNode.appendChild(b);this.scrollbar={container:b,tracker:b.down("span")};this.content.up().setAttribute("tabindex","0")},initializeEvent:function(){Event.observe(this.content.parentNode,"keydown",this.keyDownHandler);Event.observe(this.content.parentNode,"mousewheel",this.mouseWheelHandler);Event.observe(this.content.parentNode,"DOMMouseScroll",this.mouseWheelHandler);this.scrollbar.upBtn&&Event.observe(this.scrollbar.upBtn,"mousedown",this.upClickHandler);this.scrollbar.upBtn&&Event.observe(this.scrollbar.upBtn,"mouseup",this.stopClickHandler);this.scrollbar.downBtn&&Event.observe(this.scrollbar.downBtn,"mousedown",this.downClickHandler);this.scrollbar.downBtn&&Event.observe(this.scrollbar.downBtn,"mouseup",this.stopClickHandler);Event.observe(this.scrollbar.tracker,"mousedown",this.startTrackHandler);Event.observe(this.scrollbar.container,"click",this.trackToHandler)},close:function(){if(!this.closed){this.destroy();this.closed=true}},destroy:function(){if(!this.destroyed){this.destroyEvent();this.destroyDom();this.destroyField();this.destroyed=true}},destroyField:function(){},destroyDom:function(){},destroyEvent:function(){Event.stopObserving(this.content.parentNode,"keydown",this.keyDownHandler);Event.stopObserving(this.content.parentNode,"mousewheel",this.mouseWheelHandler);Event.stopObserving(this.content.parentNode,"DOMMouseScroll",this.mouseWheelHandler);this.scrollbar.upBtn&&Event.stopObserving(this.scrollbar.upBtn,"mousedown",this.upClickHandler);this.scrollbar.upBtn&&Event.stopObserving(this.scrollbar.upBtn,"mouseup",this.stopClickHandler);this.scrollbar.downBtn&&Event.stopObserving(this.scrollbar.downBtn,"mousedown",this.downClickHandler);this.scrollbar.downBtn&&Event.stopObserving(this.scrollbar.downBtn,"mouseup",this.stopClickHandler);Event.stopObserving(this.scrollbar.tracker,"mousedown",this.startTrackHandler);Event.stopObserving(this.scrollbar.container,"click",this.trackToHandler)},upClick:function(c){c&&Event.stop(c);var d=20;this.scroll(d);this.render();if(this.clickTimeout){clearTimeout(this.clickTimeout);this.clickTimeout=null}this.clickTimeout=setTimeout(this.upClick.bind(this),100)},downClick:function(c){c&&Event.stop(c);var d=-20;this.scroll(d);this.render();if(this.clickTimeout){clearTimeout(this.clickTimeout);this.clickTimeout=null}this.clickTimeout=setTimeout(this.downClick.bind(this),100)},stopClick:function(b){Event.stop(b);if(this.clickTimeout){clearTimeout(this.clickTimeout);this.clickTimeout=null}},keyDown:function(c){if(c.keyCode==Event.KEY_UP||c.keyCode==Event.KEY_DOWN){var d=(c.keyCode==Event.KEY_UP?20:-20);this.scroll(d)&&Event.stop(c);this.render()}},mouseWheel:function(f){var d=f.wheelDelta||-f.detail;var g=(d>0?20:-20);this.scroll(g)&&Event.stop(f);this.render()},startTrack:function(b){Event.stop(b);this.mouseStart=b.clientY;Event.observe(document.body,"mousemove",this.trackHandler);Event.observe(document.body,"mouseup",this.endTrackHandler)},track:function(c){Event.stop(c);var d=c.clientY;this.scrollBar(d-this.mouseStart);this.mouseStart=d;this.render()},endTrack:function(b){Event.stopObserving(document.body,"mousemove",this.trackHandler);Event.stopObserving(document.body,"mouseup",this.endTrackHandler)},trackTo:function(d){var f=Event.element(d);if(f==this.scrollbar.container){var g=d.offsetY||d.layerY;this.scrollBarTo(g);this.render()}},scrollBar:function(c){var d=c+parseInt(this.scrollbar.tracker.style.top?this.scrollbar.tracker.style.top:0);this.scrollNum=-d/this.scrollbar.container.offsetHeight*this.contentHeight;return this.volidate()},scrollBarTo:function(b){this.scrollNum=-b/this.scrollbar.container.offsetHeight*this.contentHeight;return this.volidate()},scroll:function(b){if(this.scale>1){return false}this.scrollNum+=b;return this.volidate()},scrollTo:function(b){this.scrollNum=b;return this.volidate()},scrollToChild:function(d){if(this.hasChild(this.content,d)){var g=this.getXY(d).y;var f=this.getXY(this.content).y;this.scrollTo(f-g);this.render()}},volidate:function(){var b=true;if(this.scrollNum>0){this.scrollNum=0;b=false}if(this.scrollNum<(this.containerHeight-this.contentHeight)){this.scrollNum=(this.containerHeight-this.contentHeight);b=false}return b},reset:function(){this.containerHeight=this.content.parentNode.offsetHeight;this.contentHeight=this.content.offsetHeight;this.scale=this.containerHeight/this.contentHeight;var b=this.scrollbar.container.offsetHeight;this.scrollNum=0;this.renderContent();if(this.scale>=1){this.scrollbar.tracker.hide();this.scrollLock=true}else{this.scrollbar.tracker.show();this.scrollbar.tracker.style.height=(b*this.scale)-2+"px";this.scrollLock=false}this.clickTimeout=null;this.render()},render:function(){if(this.scrollLock){return}this.renderContent();this.renderBar()},renderContent:function(){this.content.style.top=this.scrollNum+"px"},renderBar:function(){var b=(-this.scrollNum/this.contentHeight)*this.scrollbar.container.offsetHeight;this.scrollbar.tracker.style.top=b+"px"}});var TheaterCombobox=Class.create();Object.extend(TheaterCombobox.prototype,{options:{containerRegion:null,datas:null,titleField:null,callback:null,itemTemplate:new Template('<dd dataindex="#{index}">#{title}</dd>')},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.initializeControl();this.initializeEvent();this.load()},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initializeControl:function(){},initializeDOM:function(){var b=[];b.push('<a href="#" onclick="return false;" _type="handler"><span class="text68" _type="text">'+(this.datas[0])[this.titleField]+'</span><em><b class="ico_cjt">&nbsp;</b></em></a>');b.push('<dl class="i_tips" style="width:95px; right:0; top:33px; display:none;" _type="drop"></dl>');this.containerRegion.innerHTML=b.join("");this.textRegion=this.containerRegion.down('[_type="text"]');this.handlerBtn=this.containerRegion.down('[_type="handler"]');this.dropRegion=this.containerRegion.down('[_type="drop"]')},load:function(){this.setDatas(this.datas)},setDatas:function(d){this.datas=d?d:[];var f=[],g=this;this.datas.each(function(a,b){f.push(this.itemTemplate.evaluate({index:b,title:a[this.titleField]}))}.bind(this));if(this.datas.length>5){this.dropRegion.setStyle({overflowX:"hidden",overflowY:"auto",height:"160px"})}else{this.dropRegion.setStyle({overflowX:"",overflowY:"",height:""})}this.dropRegion.innerHTML=f.join("");this.textRegion.innerHTML=(this.datas[0])[this.titleField]},initializeField:function(){this.datas=this.datas?this.datas:[];this.containerRegion=$(this.containerRegion);this.showDropHandler=this.showDrop.bind(this);this.hideDropHandler=this.hideDrop.bind(this);this.selectHandler=this.select.bind(this)},initializeEvent:function(){Event.observe(this.handlerBtn,"mouseover",this.showDropHandler);Event.observe(this.handlerBtn,"mouseout",this.hideDropHandler);Event.observe(this.dropRegion,"mouseover",this.showDropHandler);Event.observe(this.dropRegion,"mouseout",this.hideDropHandler);Event.observe(this.dropRegion,"click",this.selectHandler)},close:function(){if(!this.closed){this.destroy();this.closed=true}},destroy:function(){if(!this.destroyed){this.destroyEvent();this.destroyControl();this.destroyDOM();this.destroyField();this.destroyed=true}},destroyEvent:function(){Event.stopObserving(this.handlerBtn,"mouseover",this.showDropHandler);Event.stopObserving(this.handlerBtn,"mouseout",this.hideDropHandler);Event.stopObserving(this.dropRegion,"mouseover",this.showDropHandler);Event.stopObserving(this.dropRegion,"mouseout",this.hideDropHandler);Event.stopObserving(this.dropRegion,"click",this.selectHandler)},destroyControl:function(){},destroyDOM:function(){},destroyField:function(){},showDrop:function(b){this.hideTimeout&&clearTimeout(this.hideTimeout);this.hideTimeout=null;this.dropRegion.show()},hideDrop:function(b){this.hideTimeout&&clearTimeout(this.hideTimeout);this.hideTimeout=setTimeout(function(){this.dropRegion.hide();this.hideTimeout=null}.bind(this),200)},select:function(h){var g=Event.findElement(h,"dd");if(g!=document){this.dropRegion.hide();var j=g.getAttribute("dataindex");if(Mtime.isValue(j)){var f=this.datas[j];this.textRegion.innerHTML=f[this.titleField];this.callback&&this.callback(f)}}}});var TheaterListPageClient=Class.create();Object.extend(TheaterListPageClient.prototype,{server:{searchNear:function(d,c){return Mtime.Component.Ajax.request(theaterService,"Mtime.Theater.Pages.ShowtimeService","SearchNearCinemaByMap",d,c,"/service/showtime.ms","get","20000")},search:function(d,c){return Mtime.Component.Ajax.request(theaterService,"Mtime.Theater.Pages.ShowtimeService","SearchCinemaByMap",d,c,"/service/showtime.ms","get","20000")},getVcode:function(b){return Mtime.Component.Ajax.request(theaterService,"Mtime.Theater.Pages.ShowtimeService","GetVcode",[],b,"/service/showtime.ms","get","20000")}},options:{cityId:null,cityName:"",nearControlRegion:null,theaterListRegion:null,theaterPageRegion:null,theaterMapRegion:null,searchInput:null,searchBtn:null,searchResultRegion:null,districtContainer:null,keyword:null},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.initializeControl();this.initializeEvent();this.load()},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},load:function(){this.disnear(this.keyword)},initializeControl:function(){this.searchControl=new TheaterSearch({cityId:this.cityId,textInput:this.searchInput,searchBtn:this.searchBtn,watermarkText:"",resultRegion:this.searchResultRegion,submitInner:function(b){this.searchResultRegion.hide();this.searchText="";this.searchTheater({isnear:false,text:this.searchControl.getValue(),districtId:0},function(d){if(!d.err&&d.data&&d.data.districts){var a=d.data.districts.List;a.unshift({Name:"",Id:0});this.districtPicker.setDatas(a)}else{if(d.err){$alert(d.err)}}}.bind(this))}.bind(this),searchTheater:function(h){var l=this.getValue();if(l){if(this.cache[l]){h&&h(this.cache[l])}else{this.server.search([this.cityId,0,l,1,"",0,true],function(a){if(a&&a.value&&a.value.cinemas){this.cache[l]=a.value.cinemas.List;h&&h(a.value.cinemas.List)}}.bind(this))}}else{if(this.isLogin()){var k=this.resultRegion;var j=new Template(this.itemTemplate);var g=this.autoComplete;if(!g.defaultSearchDatas){this.getFavorite(function(a){g.defaultSearchDatas=a;h&&h(a)})}else{h&&h(g.defaultSearchDatas)}}}},getFavorite:function(b){}});this.searchControl.server.search=this.server.search;this.districtPicker=new TheaterCombobox({containerRegion:this.districtContainer,datas:[{Name:"",Id:0}],titleField:"Name",callback:function(b){this.selectDistrict(b)}.bind(this)});this.scrollBar=new ScrollBar({contentRegion:this.theaterListRegion});this.map=new TheaterMap({mapRegion:this.theaterMapRegion,cityName:this.cityName,initializeCallback:function(){this.mapInitialized=true;this.needMarkTheaters&&this.map.markTheaters(this.needMarkTheaters);this.needMarkTheaters=null}.bind(this)})},initializeDOM:function(){},initializeField:function(){this.nearControlRegion=$(this.nearControlRegion);this.theaterListRegion=$(this.theaterListRegion);this.theaterPageRegion=$(this.theaterPageRegion);this.theaterMapRegion=$(this.theaterMapRegion);this.districtContainer=$(this.districtContainer);this.theaterCountRegion=$(this.theaterCountRegion);this.searchInput=$(this.searchInput);this.searchBtn=$(this.searchBtn);this.searchResultRegion=$(this.searchResultRegion);this.selectTheaterHandler=this.selectTheater.bind(this);this.theaterPageHandler=this.theaterPage.bind(this);this.theaterListOverHandler=this.theaterListOver.bind(this);this.theaterListOutHandler=this.theaterListOut.bind(this);this.districtId=0},initializeEvent:function(){Event.observe(this.theaterListRegion,"click",this.selectTheaterHandler);Event.observe(this.theaterListRegion,"mouseover",this.theaterListOverHandler);Event.observe(this.theaterListRegion,"mouseout",this.theaterListOutHandler);Event.observe(this.theaterPageRegion,"click",this.theaterPageHandler)},close:function(){if(!this.closed){this.scrollBar.close();this.searchControl.close();this.map.close();this.destroy();this.closed=true}},destroy:function(){if(!this.destroyed){this.destroyEvent();this.destroyControl();this.destroyDOM();this.destroyField();this.destroyed=true}},destroyEvent:function(){Event.stopObserving(this.theaterListRegion,"click",this.selectTheaterHandler);Event.stopObserving(this.theaterListRegion,"mouseover",this.theaterListOverHandler);Event.stopObserving(this.theaterListRegion,"mouseout",this.theaterListOutHandler);Event.stopObserving(this.theaterPageRegion,"click",this.theaterPageHandler)},destroyControl:function(){},destroyDOM:function(){},destroyField:function(){},near:function(){this.searchTheater({isnear:true},function(d){if(d.data&&!d.err&&d.data.districts){var c=d.data.districts.List;c.unshift({Name:"",Id:0});this.districtPicker.setDatas(c)}else{if(d.err){$alert(d.err)}}}.bind(this))},disnear:function(b){var b=b?b:"";!b&&this.searchControl.reset();b&&this.searchControl.setValue(b);this.searchTheater({isnear:false,text:b},function(d){if(d.data&&!d.err&&d.data.districts){var a=d.data.districts.List;a.unshift({Name:"",Id:0});this.districtPicker.setDatas(a)}else{if(d.err){$alert(d.err)}}}.bind(this))},selectTheater:function(j){var h=Event.findElement(j,"li");if(h!=document&&h.hasAttribute("cinemaid")){var k=h.getAttribute("cinemaid");var l=this.theaterHash[k];var g=this.theaterListRegion.down("li.on");g&&g.removeClassName("on");h.addClassName("on");l&&this.map.openInfoWindow(l)}var h=Event.findElement(j,"a");if(h!=document&&h.getAttribute("_type")=="refresh_all"){Event.stop(j);this.disnear()}},theaterListOver:function(d){var c=Event.findElement(d,"li");if(c!=document){c.addClassName("hover")}},theaterListOut:function(d){var c=Event.findElement(d,"li");if(c!=document){c.removeClassName("hover")}},theaterPage:function(f){Event.stop(f);var d=Event.element(f);var g=0;if(d&&(g=d.getAttribute("pageindex"))){this.searchTheater({page:g})}},setTheaters:function(b){if(b){this.theaters=b;this.theaterHash={};this.theaters.each(function(a){this.theaterHash[a.Id]=a}.bind(this));if(this.mapInitialized){this.map.markTheaters(b)}else{this.needMarkTheaters=b}}},theaterRender:function(c,d){this.theaterListRegion.innerHTML=c;this.theaterPageRegion.innerHTML="";d&&this.theaterPageRegion.appendChild(d);this.scrollBar.reset();if(this.theaters&&this.theaters.length==1){this.theaterListRegion.down("li").addClassName("on")}},selectDistrict:function(b){this.searchTheater({isnear:false,districtId:b.Id},function(a){if(a.err){$alert(a.err)}})},openVcodeDialog:function(h,j,g,f){new Dialog({windowClassName:"w445",content:Builder.node("div",{className:"ml20 mr20"},[Builder.node("h3",{id:"tip"},[""]),Builder.node("p",{className:"mt10"},[Builder.node("input",{id:"vcodeText",type:"text",className:"w120"}),Builder.node("img",{id:"vcodeImage",src:""+j+"",alt:"",className:"v_m mlr10"}),Builder.node("a",{href:"#",id:"changeVcodeLink",onclick:"return false;"},[""])])]),buttonRegionClass:"mt10 pb15 ml20",buttons:[{title:"",buttonStyle:"btn_square_hover mr15",callback:function(a){var b=a.getEl("vcodeText").value;g.vcode=b;g.vcodeId=a.vcodeId;this.searchTheater(g,function(c){if(c.data&&!c.err){a.close();f&&f(c)}else{$alert(c.err)}}.bind(this))}.bind(this)}],readyCallback:function(a){a.vcodeId=h;a.changeVcodeLink=a.getEl("changeVcodeLink");var b=this;Event.observe(a.changeVcodeLink,"click",function(){b.reflashVcode(a)})},closeCallback:function(a){Event.stopObserving(a.changeVcodeLink,"click")},reflashVcode:function(a){this.server.getVcode(function(b){if(b&&b.value){a.vcodeId=b.value.vcodeId;a.getEl("vcodeImage").src=b.value.vcodeSrc}})}.bind(this)})},searchTheater:function(l,j){this.searchText=Mtime.isValue(l.text)?l.text:(this.searchText?this.searchText:"");this.isnear=Mtime.isValue(l.isnear)?l.isnear:this.isnear;this.districtId=Mtime.isValue(l.districtId)?l.districtId:(this.districtId?this.districtId:0);var k=l.page?l.page:1;var o=l.vcode?l.vcode:"";var p=l.vcodeId?l.vcodeId:0;var m=[];var n=null;if(this.isnear){m=[k,o,p];n=this.server.searchNear}else{m=[this.cityId,this.districtId,this.searchText,k,o,p,false];n=this.server.search}n(m,function(d){var b="";var a=null;if(d&&d.value){if(o){if(!d.value.vcodeValid){b=d.value.vcodeMessage}else{a=d.value}}else{if(d.value.isRobot){b="";this.openVcodeDialog(d.value.vcodeId,d.value.vcodeSrc,l,j)}else{a=d.value}}}else{b=""}if(!b&&a&&a.cinemas){this.setTheaters(a.cinemas.List);this.theaterCountRegion&&(this.theaterCountRegion.innerHTML=a.totalCount);var c=OriginalPagerBuilder.build(k,a.pageSize,a.totalCount,[1,3,1]);this.theaterRender(a.cinemaListHtml,c)}else{if(a&&a.totalCount==0){this.theaterCountRegion&&(this.theaterCountRegion.innerHTML=a.totalCount);this.theaterRender('<p class="tc c_red px14 bold mt30"><span class="ico_cerr">&nbsp;</span>&nbsp;</p><p class="tc mt25 bold"><a href="#" _type="refresh_all"></a></p>')}}j&&j({data:a,err:b})}.bind(this))}});var TheaterGallery=Class.create();Object.extend(TheaterGallery.prototype,{options:{region:"",imageList:[[],[],[]],regionTemplate:new Template('<div class="clearfix"><ul class="c_tabablum" _type="nav">#{navHTML}</ul><h3 class="px14 fl"></h3></div><div class="clearfix pt15"><div class="c_ablumleft"><div class="loading" _type="loading">&nbsp;</div><a class="turnleft" _type="prev" href="#" onclick="return false;"></a><a class="turnright" _type="next" href="#" onclick="return false;"></a><div class="c_ablumpic"><img src="#{url}" alt="#{title}" _type="show" /></div><p class="tc mt12" _type="showtitle">#{title}</p></div><div class="c_ablumright" _type="list">#{list}</div></div>'),pageSize:9,titles:["","","","",""]},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.initializeControl();this.initializeEvent()},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initializeControl:function(){},initializeDOM:function(){var d={};d.navHTML=[];for(var f=this.imageList.length-1,g;f>=0;--f){g=this.imageList[f];if(g&&g.length){d.navHTML.push('<li galleryid="'+f+'"><a href="#" onclick="return false;">'+this.titles[f]+"</a>("+g.length+")</li>")}}d.navHTML=d.navHTML.join("<li>|</li>");d.list=this.getListHTML(this.images,1);this.region.innerHTML=this.regionTemplate.evaluate(d);this.navCtn=this.region.down('[_type="nav"]');this.prevBtn=this.region.down('[_type="prev"]');this.nextBtn=this.region.down('[_type="next"]');this.listCtn=this.region.down('[_type="list"]');this.imageShow=this.region.down('[_type="show"]');this.showTitle=this.region.down('[_type="showtitle"]');this.loadingCtn=this.region.down('[_type="loading"]');this.render(0)},initializeField:function(){this.region=$(this.region);this.navHandler=this.nav.bind(this);this.prevHandler=this.prev.bind(this);this.nextHandler=this.next.bind(this);this.listHandler=this.list.bind(this);var b=[];this.imageList.each(function(a,d){a.each(function(c){c.GalleryId=d+1;c.GalleryTitle=this.titles[d+1]}.bind(this));b=b.concat(a)}.bind(this));this.imageList.unshift(b)},initializeEvent:function(){Event.observe(this.navCtn,"click",this.navHandler);Event.observe(this.prevBtn,"click",this.prevHandler);Event.observe(this.nextBtn,"click",this.nextHandler);Event.observe(this.listCtn,"click",this.listHandler)},close:function(){if(!this.closed){this.destroy();this.closed=true}},destroy:function(){if(!this.destroyed){this.destroyEvent();this.destroyControl();this.destroyDOM();this.destroyField();this.destroyed=true}},destroyEvent:function(){Event.stopObserving(this.navCtn,"click",this.navHandler);Event.stopObserving(this.prevBtn,"click",this.prevHandler);Event.stopObserving(this.nextBtn,"click",this.nextHandler);Event.stopObserving(this.listCtn,"click",this.listHandler)},destroyControl:function(){},destroyDOM:function(){},destroyField:function(){},getListHTML:function(o,p){if(o){var r=(p-1)*this.pageSize;var l=r+this.pageSize;var q=o.slice(r,l);var m=[];p=parseInt(p,10);q.each(function(a,b){if(b%3==0){m.push('<ul class="clearfix">')}m.push('<li imageindex="'+(r+b)+'"><a href="#" onclick="return false;"><img src="'+a.ThumbnailUrl+'" alt="'+a.Title+'"></a></li>');if(b%3==2||b==q.length-1){m.push("</ul>")}});if(o.length>this.pageSize){m.push('<div class="pagenav tr" style="margin-top:0;">');if(p>1){m.push('<a href="#" onclick="return false;" class="mr10 next" pageindex="'+(p-1)+'"></a>')}var k=Math.ceil(o.length/this.pageSize);for(var n=1;n<=k;++n){m.push('<a href="#" onclick="return false;" pageindex="'+n+'" class="'+(p==n?"on":"")+'">'+n+"</a>")}if(p!=k){m.push('<a class="ml10 next" href="#" onclick="return false;" pageindex="'+(p+1)+'"></a>')}m.push("</div>")}return m.join("")}else{return""}},nav:function(f){var d=Event.findElement(f,"li");if(d!=document&&d.hasAttribute("galleryid")&&!d.hasClassName("on")){var g=parseInt(d.getAttribute("galleryid"),10);this.render(g)}},prev:function(){if(this.currentIndex!=0){var b=this.currentImages[--this.currentIndex];this.showImage(b)}},next:function(){if(this.currentIndex!=this.currentImages.length-1){var b=this.currentImages[++this.currentIndex];this.showImage(b)}},list:function(h){var g=Event.findElement(h,"li");if(g!=document&&g.hasAttribute("imageindex")){var k=g.getAttribute("imageindex");this.currentIndex=parseInt(k,10);var j=this.currentImages[this.currentIndex];this.showImage(j)}g=Event.findElement(h,"a");if(g!=document&&g.hasAttribute("pageindex")){var l=g.getAttribute("pageindex");this.listCtn.innerHTML=this.getListHTML(this.currentImages,l);this.currentIndex=parseInt(this.listCtn.down("li[imageindex]").getAttribute("imageindex"),10);var j=this.currentImages[this.currentIndex];this.showImage(j)}},render:function(h){var k=this.imageList[h];if(k){this.currentImages=k;this.currentIndex=0;this.listCtn.innerHTML=this.getListHTML(k,1);var j=k[this.currentIndex];this.showImage(j);var l=this.navCtn.down(".on");l&&l.removeClassName("on");var g=this.navCtn.down('[galleryid="'+h+'"]');g.addClassName("on")}},showImage:function(g){this.imageShow.setAttribute("src","");var h=this.loadingCtn;h.show();this.imageShow.onload=function(){h.hide()};this.imageShow.setAttribute("src",g.PicUrl);this.imageShow.setAttribute("alt",g.Title);this.showTitle.innerHTML=g.Title+"&nbsp;&nbsp;:"+this.titles[g.GalleryId];if(this.currentIndex==0){this.prevBtn.hide()}else{this.prevBtn.show()}if(this.currentIndex!=this.currentImages.length-1){this.nextBtn.show()}else{this.nextBtn.hide()}var j=this.listCtn.down("li.hover");j&&j.removeClassName("hover");var f=this.listCtn.down('li[imageindex="'+this.currentIndex+'"]');f&&f.addClassName("hover")}});var TheaterEcouponsPageClient=Class.create();Object.extend(TheaterEcouponsPageClient.prototype,{server:{getEcouponsByTheaterId:function(d,c){return Mtime.Component.Ajax.request(theaterService,"Mtime.Theater.Pages.ShowtimeService","GetEcouponsByCinemaId",d,c,"/service/showtime.ms","get","20000")}},options:{cityId:null,cinemaId:null,theaters:[],districts:[],theaterListRegion:null,theaterCountRegion:"theatercount",searchInput:null,searchBtn:null,searchResultRegion:null,districtContainer:null,ecouponsContainer:null,ecouponsDescContainer:null,theaterTitleContainer:null,theaterTitleTemplate:new Template('<strong class="fl px16 mt12"><a href="#{Url}" target="_blank">#{NameCn}</a></strong><a href="#{Url}"  target="_blank" class="fr"><img src="#{CoverUrl}" width="120" height="60" class="img_pbox" /></a>'),feedbackTemplate:'<div><p class="tc c_red px14 bold mt30"><span class="ico_cerr">&nbsp;</span>&nbsp;</p><p class="tc mt25 bold"><a href="#" _type="refresh_all"></a></p></div>'},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.initializeControl();this.initializeEvent();this.load()},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},load:function(){var d=this.theaterListRegion.down();if(d){if(this.cinemaId&&this.theaterHash[this.cinemaId]){var f=this.theaterHash[this.cinemaId];this.searchControl.autoComplete.textbox.setValue(f.NameCn);this.searchControl.submitInner(f)}else{var g=d.getAttribute("cinemaid");this.feedback.hide();this.selectTheater(this.theaterHash[g])}}else{this.feedback.show();this.selectTheater(null)}},initializeControl:function(){this.searchControl=new TheaterSearch({cityId:this.cityId,textInput:this.searchInput,searchBtn:this.searchBtn,watermarkText:"",resultRegion:this.searchResultRegion,submitInner:function(b){if(b&&b.Id){this.theaterListRegion.childElements().each(function(a){a.hide()});this.feedback.hide();this.resetDistricts([b]);this.theaterCountRegion.innerHTML=1;this.showTheater(b);this.selectTheater(b);this.scrollBar.reset()}else{this.searchTheater({text:this.searchControl.autoComplete.textbox.getValue(),districtId:0})}}.bind(this),searchTheater:function(c){var d=this.searchControl.autoComplete.textbox.getValue();if(d){this.searchTheater({text:d,districtId:0},function(a){c&&c(a)})}}.bind(this),getFavorite:function(b){}});this.districts.unshift({Name:"",Id:0});this.districtPicker=new TheaterCombobox({containerRegion:this.districtContainer,datas:this.districts,titleField:"Name",callback:function(b){this.selectDistrict(b)}.bind(this)});this.scrollBar=new ScrollBar({contentRegion:this.theaterListRegion})},initializeDOM:function(){this.feedback=Builder.build(this.feedbackTemplate);this.theaterListRegion.up().appendChild(this.feedback);this.feedback.hide()},initializeField:function(){this.theaterListRegion=$(this.theaterListRegion);this.theaterPageRegion=$(this.theaterPageRegion);this.districtContainer=$(this.districtContainer);this.theaterTitleContainer=$(this.theaterTitleContainer);this.ecouponsContainer=$(this.ecouponsContainer);this.ecouponsDescContainer=$(this.ecouponsDescContainer);this.theaterCountRegion=$(this.theaterCountRegion);this.searchInput=$(this.searchInput);this.searchBtn=$(this.searchBtn);this.searchResultRegion=$(this.searchResultRegion);this.theaterSelectHandler=this.theaterSelect.bind(this);this.theaterListOverHandler=this.theaterListOver.bind(this);this.theaterListOutHandler=this.theaterListOut.bind(this);this.ecouponsSelectHandler=this.ecouponsSelect.bind(this);this.districtId=0;this.setTheaters(this.theaters)},initializeEvent:function(){Event.observe(this.theaterListRegion.up(),"click",this.theaterSelectHandler);Event.observe(this.theaterListRegion,"mouseover",this.theaterListOverHandler);Event.observe(this.theaterListRegion,"mouseout",this.theaterListOutHandler);Event.observe(this.ecouponsContainer,"click",this.ecouponsSelectHandler)},close:function(){if(!this.closed){this.scrollBar.close();this.searchControl.close();this.destroy();this.closed=true}},destroy:function(){if(!this.destroyed){this.destroyEvent();this.destroyControl();this.destroyDOM();this.destroyField();this.destroyed=true}},destroyEvent:function(){Event.stopObserving(this.theaterListRegion.up(),"click",this.theaterSelectHandler);Event.stopObserving(this.theaterListRegion,"mouseover",this.theaterListOverHandler);Event.stopObserving(this.theaterListRegion,"mouseout",this.theaterListOutHandler);Event.stopObserving(this.ecouponsContainer,"click",this.ecouponsSelectHandler)},destroyControl:function(){},destroyDOM:function(){},destroyField:function(){},theaterSelect:function(j){var h=Event.findElement(j,"li");var l=null;if(h!=document&&(l=h.getAttribute("cinemaid"))){var k=this.theaterHash[l];var g=this.theaterListRegion.down("li.on");g&&g.removeClassName("on");h.addClassName("on");this.selectTheater(k);return}var h=Event.findElement(j,"a");if(h!=document&&h.getAttribute("_type")=="refresh_all"){Event.stop(j);this.searchControl.autoComplete.textbox.clear();this.searchTheater({text:"",districtId:0});return}},theaterListOver:function(d){var c=Event.findElement(d,"li");if(c!=document){c.addClassName("hover")}},theaterListOut:function(d){var c=Event.findElement(d,"li");if(c!=document){c.removeClassName("hover")}},setTheaters:function(b){if(b){this.theaters=b;this.theaterHash={};this.theaters.each(function(a){this.theaterHash[a.Id]=a}.bind(this))}},selectDistrict:function(b){this.searchTheater({districtId:b.Id})},showTheater:function(d){var c=this.theaterListRegion.down('li[cinemaid="'+d.Id+'"]');if(c){c.show();return true}else{return false}},selectTheater:function(g){if(g){var f=this.theaterListRegion.down('li[cinemaid="'+g.Id+'"]');var d=this.theaterListRegion.down("li.on");d&&d.removeClassName("on");f.addClassName("on");this.theaterTitleContainer.innerHTML=this.theaterTitleTemplate.evaluate(g);this.showEcouponsInfo(g)}},resetDistricts:function(d){var c=this.districts.findAll(function(a){if(a.Id===0||d.any(function(b){return b.DistrictId==a.Id})){return true}else{return false}});this.districtPicker.setDatas(c)},searchTheater:function(f,d){this.searchText=Mtime.isValue(f.text)?f.text.trim():(this.searchText?this.searchText.trim():"");this.districtId=Mtime.isValue(f.districtId)?f.districtId:(this.districtId?this.districtId:0);var g=[];this.theaters.each(function(a){if(this.districtId==0||this.districtId==a.DistrictId){if(this.searchText==""||a.NameCn.toLowerCase().indexOf(this.searchText.toLowerCase())!=-1){g.push(a)}}}.bind(this));if(d){d(g)}else{this.theaterListRegion.childElements().each(function(a){a.hide()});if(g.length){this.feedback.hide();g.each(function(b,a){this.showTheater(b);if(a==0){this.selectTheater(b)}}.bind(this));if(f.districtId===0){this.resetDistricts(g)}}else{this.feedback.show();this.selectTheater(null)}this.theaterCountRegion.innerHTML=g.length;this.scrollBar.reset()}},showEcouponsInfo:function(d){if(d){this.ecouponsDescContainer.innerHTML="";this.ecouponsContainer.innerHTML="";this.ecouponsInfoCache=this.ecouponsInfoCache?this.ecouponsInfoCache:{};if(this.ecouponsInfoCache[d.Id]){var c=this.ecouponsInfoCache[d.Id];this.ecouponsDescs=c.description;this.ecouponsDescContainer.innerHTML=this.ecouponsDescs[0];this.ecouponsContainer.innerHTML=c.ecouponList}else{this.server.getEcouponsByTheaterId([d.Id,d.NameCn],function(a){if(a&&a.value){if(a.value.ecouponList){this.ecouponsInfoCache[d.Id]=a.value;this.ecouponsDescs=a.value.description;this.ecouponsDescContainer.innerHTML=this.ecouponsDescs[0];this.ecouponsContainer.innerHTML=a.value.ecouponList}}}.bind(this))}}},ecouponsSelect:function(h){var g=Event.element(h);if(g&&!g.hasAttribute("descindex")){g=g.up("div[descindex]")}if(g&&!g.hasClassName("currented")){var j=parseInt(g.getAttribute("descindex"),10);if(Mtime.isValue(j)){this.ecouponsDescContainer.innerHTML=this.ecouponsDescs[j];var f=this.ecouponsContainer.down(".currented");f&&f.removeClassName("currented");g.addClassName("currented")}}}});var TheaterQuickTicketsDialog=Class.create();Object.extend(TheaterQuickTicketsDialog.prototype,{server:{getMovies:function(d,c){return Mtime.Component.Ajax.request(theaterService,"Mtime.Theater.Pages.OnlineTicketService","GetOnlineMoviesInCity",d,c,"/service/onlineticket.ms","get","20000")},getTheaters:function(d,c){return Mtime.Component.Ajax.request(theaterService,"Mtime.Theater.Pages.OnlineTicketService","GetOnlineTheatersInCity",d,c,"/service/onlineticket.ms","get","20000")},getShowtimeDateList:function(d,c){return Mtime.Component.Ajax.request(theaterService,"Mtime.Theater.Pages.OnlineTicketService","GetShowtimeDateList",d,c,"/service/onlineticket.ms","get","20000")},getMoviesInTheater:function(d,c){return Mtime.Component.Ajax.request(theaterService,"Mtime.Theater.Pages.OnlineTicketService","GetOnlineMoviesInTheater",d,c,"/service/onlineticket.ms","get","20000")},getScreenings:function(d,c){return Mtime.Component.Ajax.request(theaterService,"Mtime.Theater.Pages.OnlineTicketService","GetOnlineTicketShowtime",d,c,"/service/onlineticket.ms","get","20000")},getTicket:function(d,c){return Mtime.Component.Ajax.request(theaterService,"Mtime.Theater.Pages.OnlineTicketService","GetOnlineTicketShowtimeDetail",d,c,"/service/onlineticket.ms","get","20000")},getUser:function(b){return Mtime.Component.Ajax.get("Mtime.Service.Pages.ManagerService","GetUserInfo2",[],b,"/Service/Manager.msi","get","10000")}},options:{dates:[],selectedDate:null,selectedMovieId:null,selectedTheaterId:null,dialogTemplate:'<div class="quick_grid"><div class="quick_title"><h3 class="fl ml12" _type="cityselector"><span _type="cityname"></span><em class="v_m ml3"></em></h3><div class="city_selector fl ml12 date_selector" _type="dateselector"></div><a href="#" onclick="return false;" _type="closebtn" class="btn_closes" title=""></a></div><div class="step01" _type="stepctn"><div class="quick_left"><div class="quick_mod"><div class="hd"><strong>:<span class="mlr5 c_orange" _type="popmoviescount"></span></strong></div><div class="bd p_r"><div class="quick_movie"><ul _type="popmoviesctn"></ul></div></div></div></div><div class="quick_right"><div class="quick_mod"><div class="hd"><div class="city_selector fr" _type="districtselector"></div><strong>:<span class="mlr5 c_orange" _type="theaterscount"></span></strong></div><div class="bd p_r" _type="theatersctn"></div></div></div><div class="quick_mask"></div></div><div class="step02" _type="stepctn"><div class="quick_mod"><div class="hd"><strong><span class="mr6 c_orange" _type="screeningscount"></span></strong></div><div class="bd p_r" style="height:320px;overflow:hidden;"><div _type="screeningsctn" style="position:absolute;"></div></div></div><div class="quick_mask"></div></div><!-- step02 end --><div class="step03" _type="stepctn"><div class="quick_box" _type="ticket"></div><div class="quick_mask"></div></div></div>',theaterTemplate:new Template('<li theaterid="#{theaterId}" class=""><a href="#" onclick="return false;" title="#{address}">#{name}<em>&nbsp;</em></a></li>')},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDialog();this.initializeControl();this.initializeEvent();this.load()},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initializeDialog:function(){this.dialog=new TheaterCustomerDialog({content:this.dialogTemplate,windowClassName:"share_tip",windowStyle:"width:960px;",readyCallback:this.dialogReadyCallback.bind(this)})},initializeControl:function(){var b=this.setCity.bind(this);this.cityMenu=new TheaterCityMenu({command:function(a){if(Mtime.isValue(a)){this.hide();b(this.getCity(this.items,a))}},container:this.citySelectorBtn});this.cityMenu.bodyPanel.setStyle({width:"748px",top:"25px"});this.datePicker=new TheaterCombobox({containerRegion:this.dateSelectorCtn,datas:this.defaultDates,titleField:"Name",itemTemplate:new Template('<dd dataindex="#{index}"><a href="#" onclick="return false;">#{title}</a></dd>'),initializeDOM:function(){var a=[];a.push('<a href="#" onclick="return false;" _type="handler"><span _type="text">'+(this.datas[0])[this.titleField]+"</span></a>");a.push('<dl style="display:none;" _type="drop"></dl>');this.containerRegion.innerHTML=a.join("");this.textRegion=this.containerRegion.down('[_type="text"]');this.handlerBtn=this.containerRegion.down('[_type="handler"]');this.dropRegion=this.containerRegion.down('[_type="drop"]')},callback:function(a){this.setDate(this.getDate(a.Id))}.bind(this)});this.dates.length&&this.addDateToPicker(this.dates);this.districtPicker=new TheaterCombobox({containerRegion:this.districtSelectorCtn,datas:[{name:"",id:0}],titleField:"name",itemTemplate:new Template('<dd dataindex="#{index}"><a href="#" onclick="return false;">#{title}</a></dd>'),initializeDOM:function(){var a=[];a.push('<a href="#" onclick="return false;" _type="handler"><span _type="text">'+(this.datas[0])[this.titleField]+"</span></a>");a.push('<dl style="display:none;" _type="drop"></dl>');this.containerRegion.innerHTML=a.join("");this.textRegion=this.containerRegion.down('[_type="text"]');this.handlerBtn=this.containerRegion.down('[_type="handler"]');this.dropRegion=this.containerRegion.down('[_type="drop"]')},callback:function(a){this.setDistrict(a)}.bind(this)});this.screeningScrollBar=new ScrollBar({contentRegion:this.screeningsCtn});this.popMoviesScrollBar=new ScrollBar({contentRegion:this.popMoviesCtn})},getDate:function(l){var g=new Date(this.DateNow.replace(/-/g,"/"));var h=g.getTime();var j=new Date(h+(l*24*60*60*1000));var k=j.getFullYear()+"-"+(j.getMonth()+1)+"-"+j.getDate();return k},addDateToPicker:function(l){var m=this.datePicker.textRegion.innerHTML;if(!l){this.datePicker.setDatas(this.defaultDates);if(m){this.datePicker.textRegion.innerHTML=m}return}l=Mtime.isArray(l)?l:[l];var j=new Date(this.DateNow.replace(/-/g,"/"));var n=new Date(j.getFullYear(),j.getMonth(),j.getDate());var h=[];l.each(function(a){var c=new Date(a.replace(/-/g,"/"));var f=(c-n)/1000/60/60/24;var b=this.defaultDates.find(function(g){return g.Id==f});if(!b){var d=(c.getMonth()+1)+""+(c.getDate())+"";h.push({Name:d,Id:f})}}.bind(this));if(h.length){var k=this.defaultDates.concat(h).sort(function(a,b){return a.Id-b.Id});this.datePicker.setDatas(k);if(m){this.datePicker.textRegion.innerHTML=m}}},setDatePicker:function(m){var m=new Date(m.replace(/-/g,"/"));var j=new Date(this.DateNow.replace(/-/g,"/"));var p=new Date(j.getFullYear(),j.getMonth(),j.getDate());var o=(m-p)/1000/60/60/24;var k=this.datePicker.datas.find(function(a){return a.Id==o});if(k){this.datePicker.textRegion.innerHTML=k.Name}else{var n=(m.getMonth()+1)+""+(m.getDate())+"";var l=this.datePicker.datas.concat([{Name:n,Id:o}]).sort(function(a,b){return a.Id-b.Id});this.datePicker.setDatas(l);this.datePicker.textRegion.innerHTML=n}},initializeField:function(){this.movieClickHandler=this.movieClick.bind(this);this.theaterClickHandler=this.theaterClick.bind(this);this.screeningClickHandler=this.screeningClick.bind(this);this.closeHandler=this.close.bind(this);this.movieMouseoverHandler=this.movieMouseover.bind(this);this.movieMouseoutHandler=this.movieMouseout.bind(this);this.ticketClickHandler=this.ticketClick.bind(this);this.defaultDates=[{Name:"&nbsp;",Id:0},{Name:"&nbsp;",Id:1},{Name:"&nbsp;",Id:2}]},initializeEvent:function(){Event.observe(this.closeBtn,"click",this.closeHandler);Event.observe(this.popMoviesCtn,"click",this.movieClickHandler);Event.observe(this.popMoviesCtn,"mouseover",this.movieMouseoverHandler);Event.observe(this.popMoviesCtn,"mouseout",this.movieMouseoutHandler);Event.observe(this.theatersCtn,"click",this.theaterClickHandler);Event.observe(this.screeningsCtn,"click",this.screeningClickHandler);Event.observe(this.ticketCtn,"click",this.ticketClickHandler)},checkLogin:function(b){if(typeof getUserInfoResult!=="undefined"&&Mtime.isValue(getUserInfoResult)){if(getUserInfoResult.value&&getUserInfoResult.value.userId){b&&b(true)}else{location.href=siteMcUrl+"/member/signin/?redirectURL="+encodeURIComponent(location.href)}}else{this.server.getUser(function(){if(typeof getUserInfoResult!=="undefined"&&Mtime.isValue(getUserInfoResult)){if(getUserInfoResult.value&&getUserInfoResult.value.userId){b&&b(true);return}}location.href=siteMcUrl+"/member/signin/?redirectURL="+encodeURIComponent(location.href)})}},load:function(){this.loadTimeout=setTimeout(function(){this.loadTimeout=null;this.setCity(this.city);this.masks[0].hide()}.bind(this),200)},close:function(){if(!this.closed){this.destroy();this.closed=true}},destroy:function(){if(!this.destroyed){this.destroyEvent();this.destroyControl();this.destroyDialog();this.destroyField();this.destroyed=true}},destroyEvent:function(){this.loadTimeout&&clearTimeout(this.loadTimeout);this.theaterInputTimeout&&clearTimeout(this.theaterInputTimeout);Event.stopObserving(this.closeBtn,"click",this.closeHandler);Event.stopObserving(this.popMoviesCtn,"click",this.movieClickHandler);Event.stopObserving(this.theatersCtn,"click",this.theaterClickHandler);Event.stopObserving(this.screeningsCtn,"click",this.screeningClickHandler)},destroyControl:function(){this.cityMenu.close();this.datePicker.close();this.districtPicker.close();this.popMoviesScrollBar.close();this.theaterScrollBar&&this.theaterScrollBar.close();this.screeningScrollBar&&this.screeningScrollBar.close();this.textbox&&this.textbox.close()},destroyDialog:function(){this.dialog.close()},destroyField:function(){this.theaterInputTimeout=null},dialogReadyCallback:function(c){var d=c.windowElement;this.closeBtn=d.down('[_type="closebtn"]');this.citySelectorBtn=d.down('[_type="cityselector"]');this.dateSelectorCtn=d.down('[_type="dateselector"]');this.popMoviesCountCtn=d.down('[_type="popmoviescount"]');this.popMoviesCtn=d.down('[_type="popmoviesctn"]');this.districtSelectorCtn=d.down('[_type="districtselector"]');this.theatersCountCtn=d.down('[_type="theaterscount"]');this.theatersCtn=d.down('[_type="theatersctn"]');this.screeningsCountCtn=d.down('[_type="screeningscount"]');this.screeningsCtn=d.down('[_type="screeningsctn"]');this.ticketCtn=d.down('[_type="ticket"]');this.masks=$$(".quick_mask",d)},setCity:function(b){this.unsetCity();this.cityId=b.Id;this.citySelectorBtn.down('[_type="cityname"]').innerHTML=b.NameCn;this.getShowtimeDateList()},getShowtimeDateList:function(){this.server.getShowtimeDateList([this.cityId],function(d){if(d&&d.value&&d.value.DateNow){this.DateNow=d.value.DateNow;if(this.selectedDate){this.setDate(this.selectedDate);this.selectedDate=null}else{this.setDate(this.getDate(this.datePicker.datas[0].Id))}if(d.value.DateList){this.addDateToPicker(d.value.DateList)}else{this.addDateToPicker()}}else{this.popMoviesCtn.innerHTML='<li><p class="mt30 tc"><em class="quick_icon">&nbsp;</em></p><p class="tc mt20"><strong class="px16 c_red"></strong></p></li>';this.popMoviesCountCtn.innerHTML="0";this.popMoviesScrollBar.reset();this.theaterInputTimeout&&clearTimeout(this.theaterInputTimeout);var c=[];c.unshift({name:"",id:0});this.districtPicker.setDatas(c);this.textbox&&this.textbox.close();this.textbox=null;this.theaterScrollBar&&this.theaterScrollBar.close();this.theaterScrollBar=null;this.theatersCountCtn.innerHTML=0;this.theatersCtn.innerHTML="";this.unsetMovieAndTheater();this.ticketCtn.innerHTML="";this.masks[2].show()}}.bind(this))},unsetCity:function(){this.datePicker.setDatas(this.defaultDates);this.theaterId=0;this.movieId=0},setDistrict:function(b){this.districtId=b.id;this.textbox&&this.textbox.clear()},setDate:function(b){this.date=b;this.setDatePicker(b);this.unsetDate();this.server.getMovies([this.cityId,0,this.date],function(g){if(g&&g.value&&g.value.html){var f=g.value.html;var a=g.value.movieCount;this.popMoviesCtn.innerHTML=f;this.popMoviesCountCtn.innerHTML=a;this.popMoviesScrollBar.reset();if(!a){return}if(!this.selectedMovieId&&this.movieId){this.selectedMovieId=this.movieId;this.movieId=0}if(!this.selectedTheaterId&&this.theaterId){this.selectedTheaterId=this.theaterId;this.theaterId=0}if(this.selectedMovieId){this.selectMovie(this.selectedMovieId);this.selectedMovieId=null}else{this.setMovie(0)}}}.bind(this))},setMovie:function(b){this.movieId=b;if(this.movieId&&this.theaterId){this.setMovieAndTheater();return}this.unsetMovieAndTheater();this.server.getTheaters([this.cityId,0,this.movieId,this.date],function(q){if(q&&q.value&&(q.value.cinemas||q.value.html)){this.theaterInputTimeout&&clearTimeout(this.theaterInputTimeout);var v=q.value.cinemas,a=q.value.districts;if(!a){a=[]}a.unshift({name:"",id:0});this.districtPicker.setDatas(a);this.textbox&&this.textbox.close();this.textbox=null;this.theaterScrollBar&&this.theaterScrollBar.close();this.theaterScrollBar=null;var n=q.value.html;if(v&&v.length>0){this.theatersCountCtn.innerHTML=v.length;var n=['<div class="quick_search mb6"><input type="text" _type="textinput" class="quick_text fl c_a5" value=""><input type="button" class="quick_btn fl"></div><div class="p_r" style="width:230px; height:290px; overflow:hidden;" tabindex="0"><ul class="quick_theater p_a" _type="theaterlist">'];v.each(function(c){n.push(this.theaterTemplate.evaluate(c))}.bind(this));n.push('</ul></div><div class="mt30" _type="notheatersfeedback" style="width:230px; height:210px; overflow:hidden;display:none;"><p class="tc"><a href="#" _type="showalltheater"></a></p></div>');this.theatersCtn.innerHTML=n.join("");this.theaterId=0;this.districtId=0;var o=this.theatersCtn.down('input[_type="textinput"]');var u=this.theatersCtn.down('ul[_type="theaterlist"]');var p=this.theatersCtn.down('div[_type="notheatersfeedback"]');var s=p.down('a[_type="showalltheater"]');if(!!o&&!!u){var t=new Textbox({text:o,watermarkText:""});this.textbox=t;this.theaterTextValue="";this.preDistrictId=this.districtId;var r=new ScrollBar({contentRegion:u});this.theaterScrollBar=r;Event.observe(s,"click",function(c){this.theaterInputTimeout&&clearTimeout(this.theaterInputTimeout);Event.stop(c);t.clear();this.districtId=0;this.districtPicker.setDatas(a);this.inputChecker()}.bind(this));this.theaterInputTimeout&&clearTimeout(this.theaterInputTimeout);this.inputChecker=function(){var d=t.getValue();if(d!==this.theaterTextValue||this.districtId!==this.preDistrictId){$$("li[theaterid]",this.theatersCtn).each(function(f){f.hide()});var c=false;v.each(function(f){if(f.name.indexOf(d)!=-1&&(this.districtId==0||this.districtId==f.districtId)){this.theatersCtn.down('li[theaterid="'+f.theaterId+'"]').show();c=true}}.bind(this));if(!c){u.up().hide();p.show()}else{p.hide();u.up().show();r.reset()}this.theaterTextValue=d;this.preDistrictId=this.districtId}this.theaterInputTimeout&&clearTimeout(this.theaterInputTimeout);this.theaterInputTimeout=setTimeout(arguments.callee.bind(this),500)};this.theaterInputTimeout=setTimeout(this.inputChecker.bind(this),500);if(this.selectedTheaterId){this.selectTheater(this.selectedTheaterId);this.selectedTheaterId=null}}}else{this.theatersCountCtn.innerHTML=0;this.theatersCtn.innerHTML=n}}}.bind(this))},setMovieAndTheater:function(){this.unsetScreening();this.server.getScreenings([this.theaterId,0,this.movieId,this.date,0,0,0,0],function(h){if(h&&h.value&&h.value.html){var f=h.value.showtimeCount;var g=h.value.html;if(g){this.screeningsCountCtn.innerHTML=f;this.screeningsCtn.innerHTML=g;var j=this.screeningsCtn.down("div.quick_time");this.screeningScrollBar&&this.screeningScrollBar.reset();this.masks[1].hide()}}}.bind(this))},unsetDate:function(){this.popMoviesCountCtn.innerHTML="";this.popMoviesCtn.innerHTML="";this.popMoviesScrollBar.reset();this.theatersCountCtn.innerHTML="";this.theaterScrollBar&&this.theaterScrollBar.close();this.theaterScrollBar=null;this.theatersCtn.innerHTML="";this.unsetMovieAndTheater()},unsetMovie:function(){this.movieId=0;this.unsetMovieAndTheater()},setTheater:function(b){this.theaterId=b;if(this.movieId&&this.theaterId){this.setMovieAndTheater();return}this.server.getMoviesInTheater([this.theaterId,this.date],function(g){if(g&&g.value&&g.value.html){this.unsetMovieAndTheater();var f=g.value.html;var a=g.value.movieCount;this.popMoviesCtn.innerHTML=f;this.popMoviesCountCtn.innerHTML=a;this.popMoviesScrollBar.reset()}}.bind(this))},unsetTheater:function(){this.theaterId=0;this.unsetMovieAndTheater()},unsetMovieAndTheater:function(){this.masks[1].show();this.screeningScrollBar&&this.screeningScrollBar.reset();this.screeningsCountCtn.innerHTML="";this.screeningsCtn.innerHTML="";this.unsetScreening()},setScreening:function(b){if(b){this.screeningId=b}this.unsetScreening(true);this.server.getTicket([this.screeningId],function(a){if(a&&a.value&&a.value.html){this.ticketCtn.innerHTML=a.value.html;this.masks[2].hide()}}.bind(this))},unsetScreening:function(b){this.ticketCtn.innerHTML="";!b&&this.masks[2].show()},ticketClick:function(d){var c=Event.findElement(d,"a");if(c!=document&&c.hasClassName("quick_btn")){this.close()}},refreshMovie:function(){this.server.getMovies([this.cityId,0,this.date],function(g){if(g&&g.value&&g.value.html){var f=g.value.html;var d=g.value.movieCount;this.popMoviesCtn.innerHTML=f;this.popMoviesCountCtn.innerHTML=d;this.popMoviesScrollBar.reset()}}.bind(this))},refreshTheater:function(){this.setMovie(0)},movieClick:function(l){var m=Event.findElement(l,"li");if(m!=document&&m.hasAttribute("movieid")){var n=m.getAttribute("movieid");if(n==this.movieId){m.down("dl").removeClassName("currented");this.unsetMovie();if(!this.theaterId){this.refreshMovie();this.refreshTheater()}}else{var h=this.popMoviesCtn.down(".currented");h&&h.removeClassName("currented");m.down("dl").addClassName("currented");if(this.movieId){this.theaterId=0}this.unsetMovie();this.setMovie(n)}}else{var k=Event.findElement(l,"a");if(k!=document&&k.hasAttribute("date")){Event.stop(l);var j=k.getAttribute("date");this.setDate(j)}}},theaterClick:function(l){var m=Event.findElement(l,"li");if(m!=document&&m.hasAttribute("theaterid")){var n=m.getAttribute("theaterid");if(n==this.theaterId){m.removeClassName("currented");this.unsetTheater();if(!this.movieId){this.refreshMovie();this.refreshTheater()}}else{this.unsetTheater();this.setTheater(n);var h=this.theatersCtn.down(".currented");h&&h.removeClassName("currented");m.addClassName("currented")}}else{var k=Event.findElement(l,"a");if(k!=document&&k.hasAttribute("date")){var j=k.getAttribute("date");this.setDate(j)}}},screeningClick:function(u){var t=Event.findElement(u,"a");if(t!=document){if(t.hasClassName("showtime_out")){Event.stop(u);return false}if(t.hasAttribute("ushowtimeid")){Event.stop(u);var z=t.getAttribute("ushowtimeid");this.setScreening(z);var r=t.up().down(".currented");r&&r.removeClassName("currented");t.addClassName("currented")}else{if(t.hasAttribute("version")||t.hasAttribute("language")){Event.stop(u);var B=t.getAttribute("version");var A=t.getAttribute("language");if(B==="0"){if(!t.hasClassName("currented")){$$(".currented",t.up()).each(function(a){a.removeClassName("currented")});t.addClassName("currented");this.showAllScreening=true}else{return}}else{var q=t.up().down('a[version="0"]');if(!t.hasClassName("currented")){q&&q.removeClassName("currented");var s=null;if(B){s=t.up().down("a.currented[version]")}if(A){s=t.up().down("a.currented[language]")}if(s){s.removeClassName("currented")}t.addClassName("currented");this.showAllScreening=false}else{var D=$$('a[method="otShowtimeVersion"]',t.up());var x=$$('a[method="otShowtimeLanguage"]',t.up());if(D.length>1||x.length>1){t.removeClassName("currented");if(q){if(!t.up().down(".currented")){q.addClassName("currented");this.showAllScreening=true}}}else{return}}}if(this.showAllScreening){$$("a[ushowtimeid]",this.screeningsCtn).each(function(a){a.show()})}else{var C=[];var w=[];var v=false;$$(".currented",t.up()).each(function(a){B=a.getAttribute("version");A=a.getAttribute("language");a.hasAttribute("version")&&Mtime.isValue(B)&&C.push(B);a.hasAttribute("language")&&Mtime.isValue(A)&&w.push(A)});$$("a[ushowtimeid]",this.screeningsCtn).each(function(b){B=b.getAttribute("version");A=b.getAttribute("language");var a=true;if(a&&C.length!=0&&C.indexOf(B)==-1){a=false}if(a&&w.length!=0&&w.indexOf(A)==-1){a=false}if(a){b.show();if(!!b.getAttribute("nextday")){v=true}}else{b.hide()}});var y=this.screeningsCtn.down("strong[nextday]");if(v){y&&y.show()}else{y&&y.hide()}}this.screeningScrollBar&&this.screeningScrollBar.reset()}}}},selectMovie:function(h){if(h){var g=this.popMoviesCtn.down('li[movieid="'+h+'"]');if(g){var j=g.previous()?g.previous():g;this.popMoviesScrollBar.scrollToChild(j);var f=this.popMoviesCtn.down(".currented");f&&f.removeClassName("currented");g.down("dl").addClassName("currented");this.setMovie(h)}else{this.setMovie(0)}}},selectTheater:function(g){if(g){var f=this.theatersCtn.down('[theaterid="'+g+'"]');if(f){var d=this.theatersCtn.down(".currented");d&&d.removeClassName("currented");f.addClassName("currented");this.theaterScrollBar&&this.theaterScrollBar.scrollToChild(f);this.setTheater(g)}}},movieMouseover:function(f){var d=Event.findElement(f,"dl");if(d!=document){this.movieMouseTimeout&&clearTimeout(this.movieMouseTimeout);this.movieMouseTimeout=null;var g=this.popMoviesCtn.down(".hover");g&&g.removeClassName("hover");d.addClassName("hover")}},movieMouseout:function(d){var c=Event.findElement(d,"dl");if(c!=document){this.movieMouseTimeout&&clearTimeout(this.movieMouseTimeout);this.movieMouseTimeout=setTimeout(function(){c.removeClassName("hover");this.movieMouseTimeout=null}.bind(this),100)}}});var TicketFilter=function(b){var b=$(b);if(b){Event.observe(b,"click",function(r){var p=Event.findElement(r,"span");if(p!=document&&(p.hasAttribute("version")||p.hasAttribute("language"))){var q=p.getAttribute("version");var n=p.up('div[method="mdShowtime"]');if(q==="0"){if(!p.hasClassName("m_typeon")){$$("span.m_typeon",n).each(function(c){c.removeClassName("m_typeon").addClassName("m_type")});p.addClassName("m_typeon").removeClassName("m_type");$$("li[version]",n).each(function(c){c.show()});return}else{return}}else{var a=n.down('span[version="0"]');if(p.hasClassName("m_typeon")){var u=$$('span[method="versionfilter"]',n);var t=$$('span[method="languagefilter"]',n);if(u.length>1||t.length>1){p.removeClassName("m_typeon").addClassName("m_type");if(a){if(!n.down("span.m_typeon")){n.down('span[version="0"]').removeClassName("m_type").addClassName("m_typeon");$$("li[version]",n).each(function(c){c.show()});return}}}else{return}}else{a&&a.removeClassName("m_typeon").addClassName("m_type");var o=null;if(p.hasAttribute("version")){o=n.down("span.m_typeon[version]")}else{o=n.down("span.m_typeon[language]")}o&&o.removeClassName("m_typeon").addClassName("m_type");p.addClassName("m_typeon").removeClassName("m_type")}var v=n.down("span.m_typeon[version]")?n.down("span.m_typeon[version]").getAttribute("version"):null;var s=n.down("span.m_typeon[language]")?n.down("span.m_typeon[language]").getAttribute("language"):null;$$("li[version]",n).each(function(c){var d=true;if(v&&c.getAttribute("version")!=v){d=false}if(s&&c.getAttribute("language")!=s){d=false}if(d){c.show()}else{c.hide()}})}}})}};var ReleasedMovieSearch=Class.create();Object.extend(ReleasedMovieSearch.prototype,{server:{searchHotplayMovie:function(d,c){return Mtime.Component.Ajax.request(theaterService,"Mtime.Theater.Pages.ShowtimeService","SearchHotplayMovie",d,c,"/service/showtime.ms","get","20000")}},options:{textInput:"",resultRegion:"",searchHotplayLink:"",cityId:null,stringId:null},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.initializeEvent();this.initializeControl()},initializeField:function(){this.textInput=$(this.textInput);this.resultRegion=$(this.resultRegion);this.searchHotplayLink=$(this.searchHotplayLink);this.cache={}},initializeDOM:function(){},initializeEvent:function(){if(Mtime.browser.ie&&Mtime.browser.ie<7){this.resultRegionHandler=this.resultMouseover.bind(this);Event.observe(this.resultRegion,"mouseover",this.resultRegionHandler);this.resultRegionHandler=this.resultMouseout.bind(this);Event.observe(this.resultRegion,"mouseout",this.resultRegionHandler)}this.searchHotplayLinkHandler=this.searchHotplayLinkClick.bind(this);Event.observe(this.searchHotplayLink,"click",this.searchHotplayLinkHandler)},initializeControl:function(){this.autoMovieSearch=new SearchAutoComplete({text:this.textInput,textWatermarkText:"",listRegion:this.resultRegion,itemTemplate:'<dd value="#{TitleCn}"><p class="clearfix"><strong class="fr c_orange pt9">#{RatingHTML}</strong><img src="#{CoverUrl}" width="26" class="img_box v_m mr12" alt="#{TitleCn}" />#{TitleCn}</p></dd>',idFieldName:"TitleCn",titleFieldName:"TitleCn",searchDatas:null,getSearchDataCallback:function(b){this.timeout&&clearTimeout(this.timeout);this.timeout=setTimeout(this.searchMovie.bind(this,b),500)}.bind(this),choiceCount:8,isAlwayShowList:true,onChangeInputCallback:null,onChangeCallback:null,onClickListRegion:function(d){var c=Event.findElement(d,"dd");if(c!=document){this.removeObserver();this.selectedEntry(c);if(this.onEnterCallback){this.onEnterCallback(this.getValue())}}},onEnterCallback:this.submitInner.bind(this)})},getKeyWord:function(){return this.textInput.value},searchMovie:function(c){var d=this.getKeyWord();if(this.getKeyWord().trim().length){if(this.cache[d]){c&&c(this.cache[d])}else{this.server.searchHotplayMovie([this.cityId,this.stringId,this.getKeyWord()],function(b){if(b&&b.value&&b.value.movies&&b.value.movies.List&&b.value.movies.List.length){var a=[];b.value.movies.List.each(function(g){if(g.BigRating!=0&&g.SmallRating!=0){g.RatingHTML=g.BigRating+"."+g.SmallRating;a.push(g)}else{g.RatingHTML="";a.push(g)}this.cache[d]=a}.bind(this));c&&c(a)}}.bind(this))}}},searchHotplayLinkClick:function(){this.autoMovieSearch.onEnterCallback()},resultMouseover:function(c){var d=Event.findElement(c,"dd");if(d==document){return false}d.addClassName("hover")},resultMouseout:function(c){var d=Event.findElement(c,"dd");if(d==document){return false}d.removeClassName("hover")},submitInner:function(b){if(b&&b.MovieShowtimeUrl){location.href=b.MovieShowtimeUrl}else{this.doSearch()}},doSearch:function(){if(this.getKeyWord().trim().length){var b="?q="+encodeURIComponent(this.getKeyWord().trim()).replace(/'/g,"%27");location.href=siteSearchUrl+"/search/"+b}},destroyDOM:function(){this.showTimeRegion=null},destroyEvent:function(){if(Mtime.browser.ie&&Mtime.browser.ie<7){this.resultMouseover&&Event.stopObserving(this.resultMouseover,"mouseover",this.resultRegionHandler);this.resultMouseout&&Event.stopObserving(this.resultMouseover,"mouseout",this.resultRegionHandler)}},close:function(){this.destroyDOM();this.destroyEvent()}});var ExpiryDateChecker=function(c,d){var d=$(d);if(c&&d){$$("li[time]",d).each(function(b){if(b.getAttribute("_type")=="expiry"){var a=new Date(b.getAttribute("time"));if(a<=c){b.removeClassName("ticketing").addClassName("ticketnonend");b.setAttribute("title","");var g=b.getAttribute("method");g=="timetips"&&b.removeAttribute("method")}}})}};var Fixedable=function(m,s){var m=$(m);var s=$(s);function n(b,f){b.setStyle({zIndex:100,borderBottom:"1px solid #CCC",width:b.offsetWidth+"px"});if(Mtime.browser.ie===6){b.style.position="absolute";document.body.style.backgroundImage="url(about:blank)";document.body.style.backgroundAttachment="fixed";var h=(typeof f.width!=="undefined")||b.offsetWidth,c=(typeof f.height!=="undefined")||b.offsetHeight,g=0;if(typeof f.top!=="undefined"){var a=$$(".c_content")[0]||$$(".c_out")[0];if(a){g=Position.cumulativeOffset(a)[1]}}var d=function(){var k=(typeof f.top!=="undefined")?f.top-g:(document.documentElement.clientHeight-f.bottom-c);var j=(typeof f.left!=="undefined")?f.left:(document.documentElement.clientWidth-f.right-h);!isNaN(k)&&b.style.setExpression("top","eval(document.documentElement.scrollTop + "+k+") + 'px'");!isNaN(j)&&b.style.setExpression("left","eval(document.documentElement.scrollLeft + "+j+") + 'px'")};d()}else{b.style.position="fixed";(typeof f.top!=="undefined")&&(b.style.top=f.top+"px");(typeof f.bottom!=="undefined")&&(b.style.bottom=f.bottom+"px");(typeof f.left!=="undefined")&&(b.style.left=f.left+"px");(typeof f.right!=="undefined")&&(b.style.right=f.right+"px")}return b}function t(a,b){a.setStyle({zIndex:"",borderBottom:"",width:""});if(Mtime.browser.ie===6){a.style.position=""}else{a.style.position="";(typeof b.top!=="undefined")&&(a.style.top="");(typeof b.bottom!=="undefined")&&(a.style.bottom="");(typeof b.left!=="undefined")&&(a.style.left="");(typeof b.right!=="undefined")&&(a.style.right="")}}if(m&&s){var o=false,p=null;var q=function(){var a=0,b=0;if(typeof(window.pageYOffset)=="number"){b=window.pageYOffset;a=window.pageXOffset}else{if(document.body&&(document.body.scrollLeft||document.body.scrollTop)){b=document.body.scrollTop;a=document.body.scrollLeft}else{if(document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)){b=document.documentElement.scrollTop;a=document.documentElement.scrollLeft}}}return[a,b]};var r=function(){var b=0,a=0;if(typeof(window.innerWidth)=="number"){b=window.innerWidth;a=window.innerHeight}else{if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)){b=document.documentElement.clientWidth;a=document.documentElement.clientHeight}else{if(document.body&&(document.body.clientWidth||document.body.clientHeight)){b=document.body.clientWidth;a=document.body.clientHeight}}}return[b,a]};var l=function(){var a=Position.cumulativeOffset(m.up())[1];var c=q()[1];var b=Position.cumulativeOffset(s)[1]+s.offsetHeight;if(c>(b-m.offsetHeight)||c<a){if(o){o=false;t(m,{top:0})}}else{if(c>a&&!o){n(m,{top:0});o=true}}};Event.observe(window,"scroll",l);Event.observe(window,"resize",l);return function(){Event.stopObserving(window,"scroll",l);Event.stopObserving(window,"resize",l)}}else{return null}};var ShowTimeTipsControl=Class.create();Object.extend(ShowTimeTipsControl.prototype,{server:{getShowtimeTipInfo:function(d,c){return Mtime.Component.Ajax.request(theaterService,"Mtime.Theater.Pages.ShowtimeService","GetShowtimeTipInfo",[d],c,"/service/showtime.ms","get","20000")}},options:{showTimeRegion:"",tipsHTML:new Template('<div class="s_ticketip"><span><b></b></span>#{content}</div>')},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeDOM();this.initializeField();this.initializeEvent()},initializeDOM:function(){this.showTimeRegion=$(this.showTimeRegion)},initializeField:function(){this.cache={}},initializeEvent:function(){this.movieTimeRegionHandler=this.timeTipsMouseover.bind(this);Event.observe(this.showTimeRegion,"mouseover",this.movieTimeRegionHandler);this.movieTimeRegionHandler=this.timeTipsMouseout.bind(this);Event.observe(this.showTimeRegion,"mouseout",this.movieTimeRegionHandler)},destroyDOM:function(){this.showTimeRegion=null},destroyEvent:function(){this.timeTipsMouseover&&Event.stopObserving(this.timeTipsMouseover,"mouseover",this.movieTimeRegionHandler);this.timeTipsMouseout&&Event.stopObserving(this.timeTipsMouseout,"mouseout",this.movieTimeRegionHandler)},close:function(){this.destroyDOM();this.destroyEvent()},timeTipsMouseover:function(h){var k=Event.findElement(h,"li");if(k==document){return false}var j=k.readAttribute("method");this.showtimeId=k.readAttribute("showtimeId");var m=0,n=0,l=k.offsetWidth;myElementHeight=k.offsetHeight;disLeft=k.offsetLeft,disTop=k.offsetTop+k.offsetHeight+8;while(k=k.offsetParent){m+=k.offsetLeft;n+=k.offsetTop}m=m+disLeft;n=n+disTop;if(j=="timetips"){this.handleOutTimer();this.myTimeOut=FunctionExt.defer(function(){if(this.cache[this.showtimeId]){this.showTimeTipsLayer(m,n,l,myElementHeight,this.cache[this.showtimeId])}else{this.server.getShowtimeTipInfo([this.showtimeId],function(a){if(a&&a.value&&a.value.ShowtimeId==this.showtimeId){this.cache[this.showtimeId]=a.value.ShowtimeTipContent;this.showTimeTipsLayer(m,n,l,myElementHeight,a.value.ShowtimeTipContent)}}.bind(this))}},200,this)}},timeTipsMouseout:function(){this.handleOutTimer();this.myTimeOut=FunctionExt.defer(function(){this.clearTimeTipsLayer()},200,this)},showTimeTipsLayer:function(u,v,t,q,r){if(this.showTimeTips!=null){this.clearTimeTipsLayer()}this.showTimeTips=Builder.build(this.tipsHTML.evaluate({content:r}));document.body.appendChild(this.showTimeTips);this.showTimeTips.style.position="absolute";this.showTimeTips.style.zIndex=99;this.showTimeTips.show();var s=document.documentElement.scrollTop||document.body.scrollTop;var n=document.documentElement.offsetWidth-u;var h=document.documentElement.clientHeight+s-v;var p=this.showTimeTips.offsetWidth;var o=this.showTimeTips.offsetHeight;if(n>p&&h>o){this.showTimeTips.style.left=u+"px";this.showTimeTips.style.top=v+"px";this.showTimeTips.down("span").className="s_tiplt"}else{if(n<p&&h>o){this.showTimeTips.style.left=u-this.showTimeTips.offsetWidth+t+"px";this.showTimeTips.style.top=v+"px";this.showTimeTips.down("span").className="s_tiprt"}else{if(n>p&&h<o){this.showTimeTips.style.left=u+"px";this.showTimeTips.style.top=v-this.showTimeTips.offsetHeight-q+"px";this.showTimeTips.down("span").className="s_tiplb"}else{this.showTimeTips.style.left=u-this.showTimeTips.offsetWidth+t+"px";this.showTimeTips.style.top=v-this.showTimeTips.offsetHeight-q+"px";this.showTimeTips.down("span").className="s_tiprb"}}}this.showTimeTips&&Event.observe(this.showTimeTips,"mouseover",function(a){Event.stop(a);this.handleOutTimer()}.bind(this));this.showTimeTips&&Event.observe(this.showTimeTips,"mouseout",function(a){Event.stop(a);this.myTimeOut=FunctionExt.defer(function(){this.clearTimeTipsLayer()},200,this)}.bind(this))},clearTimeTipsLayer:function(){this.showTimeTips&&document.body.removeChild(this.showTimeTips);this.showTimeTips=null},handleOutTimer:function(){if(this.myTimeOut!=null){clearTimeout(this.myTimeOut);this.myTimeOut=null}}});var TheaterFilter=Class.create();Object.extend(TheaterFilter.prototype,{options:{theaters:[],district:0,searchInput:"",searchBtn:"",searchTip:"",resultRegion:"",filterCallback:null},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeControl();this.initializeEvent()},initializeControl:function(){this.autoComplete=new SearchAutoComplete({text:this.$searchInput,textWatermarkText:"",listRegion:this.$searchTip,itemTemplate:'<dd value="#{Id}"><h3>#{Name}</h3><p class="c_666">#{DistrictName}</p></dd>',idFieldName:"Id",titleFieldName:"Name",searchDatas:null,getSearchDataCallback:function(b){this.searchTheater(b)}.bind(this),choiceCount:8,isAlwayShowList:true,onChangeInputCallback:null,onChangeCallback:null,onEnterCallback:this.filterHandler,onClickListRegion:function(d){var c=Event.findElement(d,"dd");if(c!=document){this.removeObserver();this.selectedEntry(c);if(this.onEnterCallback){this.onEnterCallback(this.getValue())}}},selectEntry:function(){this.active=false;var b=this.getCurrentEntry();if(b){this.removeObserver();this.selectedEntry(b)}}})},initializeField:function(){this.$searchInput=$(this.searchInput);this.$searchBtn=$(this.searchBtn);this.$searchTip=$(this.searchTip);this.$searchTip.hide();this.$resultRegion=$(this.resultRegion);this.theaterObjList=[];if(this.$resultRegion.children.length>0){$A(this.$resultRegion.children).each(function(d){d=$(d);if(d.nodeType===1&&d.hasAttribute("cinemaid")){var c=this.theaters.find(function(a){return a.Id==d.readAttribute("cinemaid")});if(c){this.theaterObjList.push({Name:c.Name,District:c.District,Id:c.Id,showtimeCount:parseInt(d.readAttribute("showtimecount"),10),el:d})}}}.bind(this))}this.filterHandler=this.filter.bind(this)},initializeEvent:function(){Event.observe(this.$searchBtn,"click",this.filterHandler)},searchTheater:function(d){var g=[];var f=this.$searchInput.value;this.theaters.each(function(a){if((!this.district||(this.district==a.District))&&(a.Name.indexOf(f)!=-1||!f)){g.push(a)}}.bind(this));d&&d(g)},setDistrict:function(b){this.district=parseInt(b);this.autoComplete.textbox.clear();this.filter()},setTheater:function(d){d=parseInt(d);var c=this.theaters.select(function(a){return a.Id==d})[0];if(c){this.district=0;this.autoComplete.textbox.setValue(c.Name);this.filter(c)}},filter:function(k){this.$searchTip.hide();var j=0,l=0,g=false,h=this.autoComplete.textbox.getValue();this.theaterObjList.each(function(a){g=false;if(k&&k.Id){if(a.Id==k.Id){g=true}}else{if((this.district==0||(this.district==a.District))&&a.Name.indexOf(h)!=-1){g=true}}if(g){a.el.show();j+=a.showtimeCount;++l}else{a.el.hide()}}.bind(this));this.filterCallback&&this.filterCallback(l,j)},destroyField:function(){},destroyEvent:function(){Event.stopObserving(this.$searchBtn,"click",this.filterHandler)},destroyControl:function(){},close:function(){if(!this.closed){this.destroy();this.closed=true}},destroy:function(){if(!this.destroyed){this.destroyEvent();this.destroyControl();this.destroyField();this.destroyed=true}}});if(typeof(Widgets)=="undefined"){var Widgets=Class.create()}Widgets.CallOutVideo=Class.create();Object.extend(Widgets.CallOutVideo.prototype,{server:{getVideoInfo:function(d,c){return Mtime.Component.Ajax.request(siteApiUrl,"Mtime.Api.Pages.VideoService","GetVideoInfo",[d],c,"/Service/Video.api?Ajax_CallBack=true","get","10000")}},options:{slidesRegion:"slides",playerWidth:1000,playerHeight:563,mp4Template:'<video width="1000" height="563" x-webkit-airplay="allow" controls="true" preload="none" src="#{mp4URL}"></video>',webTemplate:'<object width="#{width}" height="#{height}" autoactive="true" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" id="videoplayer" name="flashfirebug0"><param value="#{swfPath}?vid=#{vid}&autoplay=1&w=#{width}&h=#{height}#{debug}" name="movie"><param value="high" name="quality"><param value="true" name="allowFullScreen"><param value="false" name="menu"><param value="transparent" name="wmode"><param value="always" name="allowScriptAccess"><embed width="#{width}" height="#{height}" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" quality="high" src="#{swfPath}?vid=#{vid}&autoplay=1&w=#{width}&h=#{height}#{debug}" play="true" allowfullscreen="true" allowscriptaccess="always" wmode="transparent" id="flashfirebug0" name="flashfirebug0"></object>',webVideoUrlTemplate:'<object width="#{width}" height="#{height}" autoactive="true" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" id="videoplayer" name="flashfirebug0"><param value="#{swfPath}?video_url=#{videourl}&autoplay=1&w=#{width}&h=#{height}#{debug}" name="movie"><param value="high" name="quality"><param value="true" name="allowFullScreen"><param value="false" name="menu"><param value="transparent" name="wmode"><param value="always" name="allowScriptAccess"><embed width="#{width}" height="#{height}" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" quality="high" src="#{swfPath}?video_url=#{videourl}&autoplay=1&w=#{width}&h=#{height}#{debug}" play="true" allowfullscreen="true" allowscriptaccess="always" wmode="transparent" id="flashfirebug0" name="flashfirebug0"></object>',callback:null},initialize:function(b){this.setOptions(b);this.initializeDom();this.initializeEvent();this.load()},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initializeDom:function(){this.$slidesRegion=$(this.slidesRegion);this.isBrowser=this.browserRedirect();if(!this.isBrowser){window.videoPlayStop=this.outVideoPlayStop.bind(this);window.videoPlayPlay=this.outVideoPlayPlay.bind(this)}},initializeEvent:function(){this.onClickSlidesRegionHandler=this.onClickSlidesRegion.bind(this);this.$slidesRegion&&Event.observe(this.$slidesRegion,"click",this.onClickSlidesRegionHandler);Event.observe(window,"unload",this.close.bind(this))},onClickSlidesRegion:function(h){var g=Event.element(h),k,l,j;if(g){k=g.getAttribute("vid");if(!k){j=g.up();if(j){k=j.getAttribute("vid")}if(!k){j=j.up();if(j){k=j.getAttribute("vid")}}}if(k){k=parseInt(k,10);this.videoBuilder(k)}l=g.getAttribute("videourl");if(!l){j=g.up();if(j){l=j.getAttribute("videourl")}if(!l){j=j.up();if(j){l=j.getAttribute("videourl")}}}if(l){this.videoUrlBuilder(l)}}},videoBuilder:function(l){if(l!=""&&l!="0"){if(this.isBrowser){this.getmp4URL(l,"vid")}else{var h="http://static1.mtime.cn/static",g;if(window.jsServer){h=window.jsServer}this.playerTemplate='<div class="transition4" style="opacity: 0;"><div class="ele_videobg" style="height:#{bodyheight}px;"></div><div class="ele_videoinner"><a class="close" id="videoclose"></a>'+this.webTemplate+"</div></div>";var k=new Template(this.playerTemplate);var j=k.evaluate({vid:l,bodyheight:document.body.offsetHeight,width:this.playerWidth,height:this.playerHeight,swfPath:h+"/flash/newvideoplayer.swf",debug:debug?"&debug=true":""});this.videoBuilderMethod(j)}}},videoUrlBuilder:function(l){if(l&&l!=""){if(this.isBrowser){this.getmp4URL(vid,"videourl")}else{var h="http://static1.mtime.cn/static",g;if(window.jsServer){h=window.jsServer}this.playerTemplate='<div class="transition4" style="opacity: 0;"><div class="ele_videobg" style="height:#{bodyheight}px;"></div><div class="ele_videoinner"><a class="close" id="videoclose"></a>'+this.webVideoUrlTemplate+"</div></div>";var k=new Template(this.playerTemplate);var j=k.evaluate({videourl:l,bodyheight:document.body.offsetHeight,width:this.playerWidth,height:this.playerHeight,swfPath:h+"/flash/featherweightplayer.swf",debug:debug?"&debug=true":""});this.videoBuilderMethod(j)}}},videoBuilderMethod:function(b){this.$playerContainer=Builder.build(b);document.body.appendChild(this.$playerContainer);this.$playerContainer.show();this.$playerContainer.style.opacity=1;this.$closeBtn=$("videoclose");this.$videoplayer=$("videoplayer");Event.observe(this.$closeBtn,"click",this.closeBtnClick.bind(this))},getmp4URL:function(j,h){var g,f;if(h==="vid"){if(j){this.server.getVideoInfo(j,function(a){if(a&&a.value&&a.value.mp4URL){this.playerTemplate=this.playerTemplate='<div class="transition4" style="opacity: 0;"><div class="ele_videobg" style="height:#{bodyheight}px;"></div><div class="ele_videoinner"><a class="close" id="videoclose" style="zoom:2; top:-50px;"></a>'+this.mp4Template+"</div></div>";g=new Template(this.playerTemplate);f=g.evaluate({bodyheight:document.body.offsetHeight,mp4URL:a.value.mp4URL,debug:debug?"&debug=true":""});this.videoBuilderMethod(f)}}.bind(this))}}else{this.playerTemplate=this.playerTemplate='<div class="transition4" style="opacity: 0;"><div class="ele_videobg" style="height:#{bodyheight}px;"></div><div class="ele_videoinner"><a class="close" id="videoclose" style="zoom:2; top:-50px;"></a>'+this.mp4Template+"</div></div>";g=new Template(this.playerTemplate);f=g.evaluate({bodyheight:document.body.offsetHeight,mp4URL:j,debug:debug?"&debug=true":""});this.videoBuilderMethod(f)}},outVideoPlayStop:function(){this.$playerContainer.style.opacity=0;setTimeout(function(){this.$playerContainer.remove()}.bind(this),1000)},outVideoPlayPlay:function(){this.$closeBtn.addClassName("transition5");if(Mtime.browser.ie&&Mtime.browser.ie<9){this.$closeBtn.hide()}else{this.$closeBtn.style.opacity=0}Event.observe(this.$videoplayer,"mouseover",this.videoplayerOver.bind(this));Event.observe(this.$videoplayer,"mouseout",this.videoplayerOut.bind(this));Event.observe(this.$closeBtn,"mouseover",this.closeBtnOver.bind(this))},closeBtnClick:function(b){b&&Event.stop(b);this.$playerContainer.hide();this.$playerContainer.innerHTML="";Event.stopObserving(this.$videoplayer,"mouseover",this.videoplayerOver.bind(this));Event.stopObserving(this.$videoplayer,"mouseout",this.videoplayerOut.bind(this));Event.stopObserving(this.$closeBtn,"mouseover",this.closeBtnOver.bind(this));Event.stopObserving(this.$closeBtn,"click",this.closeBtnClick.bind(this));this.$closeBtn=null},videoplayerOver:function(d){var c=Event.element(d);if(this.$playerContainer===c.up(".transition4")){if(Mtime.browser.ie&&Mtime.browser.ie<9){this.$closeBtn.show()}else{this.$closeBtn.style.opacity=1}}},videoplayerOut:function(b){if(this.playerContainerTimeout!==null){clearTimeout(this.playerContainerTimeout)}this.playerContainerTimeout=FunctionExt.defer(function(){var a=Event.element(b);if(this.$playerContainer===a.up(".transition4")){if(Mtime.browser.ie&&Mtime.browser.ie<9){this.$closeBtn.hide()}else{this.$closeBtn.style.opacity=0}}},200,this)},closeBtnOver:function(b){if(this.playerContainerTimeout!==null){clearTimeout(this.playerContainerTimeout)}},load:function(){},browserRedirect:function(){var n=navigator.userAgent.toLowerCase();var j=n.match(/ipad/i)=="ipad";var k=n.match(/iphone/i)=="iphone";var l=n.match(/iphone/i)=="ipod";var h=n.match(/android/i)=="android";var m=n.match(/windows mobile/i)=="windows mobile";if(j||k||l||h||m){return true}return false},close:function(){this.destroyEvent();this.destroyDOM();this.destroyField()},destroyField:function(){},destroyEvent:function(){if(this.$slidesRegion){Event.stopObserving(this.$slidesRegion,"click",this.onClickSlidesRegionHandler)}},destroyDOM:function(){this.$slidesRegion=null}});var Tracker=Class.create();Object.extend(Tracker.prototype,{PAGE_TRACK_URL:"http://log.mtime.cn/_t.gif",PAGE_CLICK_URL:"http://log1.mtime.cn/_t.gif",AD_TRACK_URL:"http://log2.mtime.cn/_t.gif",AD_CLICK_URL:"http://log2.mtime.cn/_t.gif",MTIME_LOG_URL:"http://logx.mtime.cn/",options:{siteId:0,title:"",observeRegionStyle:"__r_c_",observeAdStyle:"__a_c_",args:null},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.initializeEvent();this.load()},initializeField:function(){this.observeAds=[];this.onClickAdHandlers=[]},initializeDOM:function(){},destroyDOM:function(){},initializeEvent:function(){this.mtimeClickHandler=this.onMtimeClick.bind(this);Event.observe(document,"mousedown",this.mtimeClickHandler);this.initializeClickEvent();Event.observe(window,"unload",this.close.bind(this))},initializeClickEvent:function(){if(this.observeRegionStyle.length>0){var b=$(document.body).readAttribute("pn");if(b&&b!==null&&b.length>0){this._initializeClickEvent(b)}}},_initializeClickEvent:function(r){var p=[],o=null;var n=document.getElementsByClassName(this.observeRegionStyle),m=null,q=null;for(var l=0,k=n.length;l<k;l++){m=$(n[l]);q=m.readAttribute("pan");if(q&&q!==null&&q.length>0){o=this.onClickPageArea.bindAsEventListener(this,r,q);p.push(o);Event.observe(m,"mousedown",o)}}this.observeRegions=n;this.onClickPageAreaHandlers=p},destroyClickEvent:function(){if(this.observeRegions&&this.observeRegions.length>0){var h=this.observeRegions;var j=this.onClickPageAreaHandlers;for(var g=0,f=h.length;g<f;g++){Event.stopObserving(h[g],"mousedown",j[g])}}},destroyEvent:function(){this.destroyClickEvent();if(this.observeAds&&this.observeAds.length>0){var h=this.observeAds;var j=this.onClickAdHandlers;for(var g=0,f=h.length;g<f;g++){Event.stopObserving(h[g],"mousedown",j[g])}}Event.stopObserving(this.mtimeClickHandler)},observeRegionClick:function(b){if(b&&b!==null&&b.length>0){this.destroyClickEvent();this._initializeClickEvent(b)}},load:function(){},onClickPageArea:function(d,g,f){if(!d._handle&&g&&g!==null&&g.length>0&&f&&f!==null&&f.length>0){d._handle=true;this.trackClick(g,f)}},onClickAd:function(d,c){this.trackAdClick(c)},onMtimeClick:function(l){var k=Event.element(l);if(!k||!k.tagName){return}var m=k.tagName.toLowerCase();if(m!="a"&&m!="button"&&m!="input"){k=Event.findElement(l,"a");if(!k||!k.tagName){return}m=k.tagName.toLowerCase()}if(m=="input"&&k.type!="submit"&&k.type!="button"){return}var n=k.href||"";if(k.type=="submit"){var h=Event.findElement(l,"form");if(h&&h.action){n=h.action}}var j={dom:Event.element(l),tu:n,cp:{left:Event.pointerX(l),top:Event.pointerY(l)}};this.trackMtimeClick(j)},getTargetDOMPath:function(s){var v=[];var p=$(s);do{var A=p.tagName||"";A=A.toLowerCase();if(!A||A=="html"){break}var B=new StringBuilder();B.append(A);if(p.id){B.append(String.format("#{0}",p.id))}else{var r=p.parentNode;if(r.childNodes.length>1){var z=1;for(var t=0;t<r.childNodes.length;++t){var x=r.childNodes[t];if(x==p){break}var y=x.tagName||"";if(y.toLowerCase()==A){z++}}if(z>1){B.append(String.format(":eq({0})",z))}}}if(p.className){var q=p.className.split(" ");B.append(String.format(".{0}",q.join(".")))}var u=p.readAttribute("pan");if(u){B.append(String.format("[pan='{0}']",u))}var w=p.readAttribute("pn");if(w){B.append(String.format("[pn='{0}']",w))}v.push(B.toString());p=$(p.parentNode)}while(p);return v.reverse().join(">")},trackMtimeClick:function(g){if(!g){return}if(!g.dom){return}this.pvid=this.pvid||new Date().getTime();var h=new StringBuilder();h.append(this.MTIME_LOG_URL);h.append(String.format("?pvid={0}",this.pvid));h.append(String.format("&u={0}",encodeURIComponent(location.href)));h.append(String.format("&tp={0}",encodeURIComponent(this.getTargetDOMPath(g.dom))));if(g.tu){h.append(String.format("&tu={0}",encodeURIComponent(g.tu)))}if(g.cp&&g.cp.left&&g.cp.top){h.append(String.format("&cp={0}",encodeURIComponent(String.format("{0}_{1}",g.cp.left,g.cp.top))))}var f=getCookie("_ar_")||"";if(f){h.append(String.format("&ar={0}",encodeURIComponent(f)))}var j=getCookie("_mi_")||"";if(j){h.append(String.format("&ut={0}",j))}this.log(h.toString())},trackMtimePageView:function(h){this.pvid=new Date().getTime();var g=new StringBuilder();g.append(this.MTIME_LOG_URL);g.append(String.format("?pvid={0}",this.pvid));g.append(String.format("&u={0}",encodeURIComponent(location.href)));h=h||this.getReferrer()||"";if(h){g.append(String.format("&ur={0}",encodeURIComponent(h)))}var f=getCookie("_ar_")||"";if(f){g.append(String.format("&ar={0}",encodeURIComponent(f)))}var j=getCookie("_mi_")||"";if(j){g.append(String.format("&ut={0}",j))}this.log(g.toString())},trackPageView:function(){this.trackMtimePageView();this.trackGooglePageView();var b=new StringBuilder();b.append(this.PAGE_TRACK_URL);this.getBaseParam(b);if(this.args!==null){b.append(String.format("&args={0}",encodeURIComponent(this.args)))}this.log(b.toString());this.trackBaiduPageView()},trackBaiduPageView:function(){$loadJs("http://hm.baidu.com/h.js?6dd1e3b818c756974fb222f0eae5512e")},trackGooglePageView:function(){if(typeof urchinTracker!=="undefined"){return}$loadJs("http://www.google-analytics.com/ga.js",function(){try{this._trackGooglePageView("UA-257914-4");this._trackGooglePageView("UA-2192709-1")}catch(b){}}.bind(this))},_trackGooglePageView:function(d){var g=_gat._getTracker(d);var f=this.getEvent();if(f.length>0){g._setCustomVar(1,"event",f,2);g._setCustomVar(2,"user",this.getUserId())}g._trackPageview()},trackClick:function(f,d){var g=new StringBuilder();g.append(this.PAGE_CLICK_URL);this.getBaseParam(g);g.append(String.format("&pn={0}",f));g.append(String.format("&pan={0}",d));this.log(g.toString())},trackAdView:function(d,f){if(typeof f==="string"){var g=new StringBuilder();g.append(this.AD_TRACK_URL);this.getBaseParam(g);g.append(String.format("&t={0}",0));g.append(String.format("&an={0}",f));this.log(g.toString())}},observeAdClick:function(d,f){var g=this.onClickAd.bindAsEventListener(this,f);Event.observe(d,"mousedown",g);this.observeAds.push(d);this.onClickAdHandlers.push(g)},trackAdClick:function(c){if(typeof c==="string"){var d=new StringBuilder();d.append(this.AD_CLICK_URL);this.getBaseParam(d);d.append(String.format("&t={0}",1));d.append(String.format("&an={0}",c));this.log(d.toString())}},getBaseParam:function(h){var f=this.getBrowser();h.append(String.format("?url={0}",encodeURIComponent(document.location.href)));h.append(String.format("&u={0}",this.getUserCode()));h.append(String.format("&uId={0}",this.getUserId()));h.append(String.format("&w={0}",screen.width));h.append(String.format("&h={0}",screen.height));h.append(String.format("&r={0}",encodeURIComponent(this.getReferrer())));h.append(String.format("&b={0}",f.type));h.append(String.format("&bVer={0}",f.ver));var j=this.getUserIdentity();h.append(String.format("&u2={0}",j.id));h.append(String.format("&isNew={0}",j.isNewbie));var g=this.getPartnerType();h.append(String.format("&pt={0}",g))},getReferrer:function(){var g="";try{g=top.document.referrer}catch(d){if(parent){try{g=parent.document.referrer}catch(f){g=""}}}if(g===""){g=document.referrer}return g},getBrowser:function(){var d=Mtime.browser,f=0,g=0;if(d.ie>0){f=1;g=d.ie}else{if(d.gecko>0){f=2;g=d.gecko}else{if(d.opera>0){f=3;g=d.opera}else{if(d.webkit>0){f=4;g=d.webkit}}}}return{type:f,ver:g}},getUserCode:function(){var g=getCookie("_userCode_");if(g===null||g.length===0){var f=new Date(),d=[];d.push(f.getFullYear());d.push(f.getMonth()+1);d.push(f.getDate());d.push(f.getHours());d.push(f.getMinutes());d.push(f.getSeconds());d.push(parseInt(Math.random()*10000,10));g=d.join("");setCookie("_userCode_",g)}return g},getUserIdentity:function(){var j=getCookie("_userIdentity_"),g=false;if(j===null||j.length===0){g=true;var h=new Date(),f=[];f.push(h.getFullYear());f.push(h.getMonth()+1);f.push(h.getDate());f.push(h.getHours());f.push(h.getMinutes());f.push(h.getSeconds());f.push(parseInt(Math.random()*10000,10));j=f.join("");setCookie("_userIdentity_",j)}return{id:j,isNewbie:g}},getUserId:function(){var b=getCookie("_mi_")||"";if(b||b.length>0){return b}return""},log:function(g){var f=new Date(),d=new Image(1,1);d.onLoad=function(){};d.src=g+"&r="+Math.random()},setCookie:function(f,g){var d=new Date();d.setTime(d.getTime()+12*60*60*1000);document.cookie=f+"="+escape(g)+";path=/;expires="+d.toUTCString()+";domain="+mtimeCookieDomain+";"},getEvent:function(){var b=Globals.getParam("event")||"";if(!b||b.length===0){b=getCookie("_e_")||""}if(b&&b.length>0){this.setCookie("_e_",b)}return b},getPartnerType:function(){var b=Globals.getParam("PartnerType")||"";if(!b||b.length===0){b=getCookie("_pt_")||""}if(b&&b.length>0){this.setCookie("_pt_",b)}return b},isClosed:false,close:function(){if(!this.isClosed){this.isClosed=true;this.destroyEvent();this.destroyDOM()}}});