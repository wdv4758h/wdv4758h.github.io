<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<title>Python Benchmark for Interpreter — Dv 名字很難念</title>
	<meta name="description" content="Title: Python Benchmark for Interpreter; Date: 2015-02-05; Author: wdv4758h">
	<meta name="author" content="wdv4758h">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
		<script src="/theme/html5.js"></script>
		<![endif]-->
	<link href="/theme/css/ipython.css" rel="stylesheet">
	<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
	<link href="//maxcdn.bootstrapcdn.com/bootswatch/3.2.0/simplex/bootstrap.min.css" rel="stylesheet">
	<link href="/theme/css/local.css" rel="stylesheet">
	<link href="/theme/css/pygments.css" rel="stylesheet">
    <link rel="stylesheet" href="/theme/tipuesearch/tipuesearch.css">
</head>

<body>
<div class="container">
	<div class="page-header">
		<h1>
            <a href="/">Dv 名字很難念</a>
			<br>
            <small>Aquí hay gato encerrado. </small>
            <form id="searchform" action="/search.html" onsubmit="return (this.elements['q'].value.length > 0)">
                    <input id="searchbox" type="text" name="q" size="12" placeholder="Search">
            </form>
        </h1>
        <a class="top-line-label" href="/about.html">About</a>
	</div>
	<div class="row">
        <div>
            <div class="row-fluid">
                <div class="col-md-8 col-md-offset-2">
<div class="article">

	<div class="text-center article-header">

		<h1 class="article-title">Python Benchmark for Interpreter</h1>
		<span>
			<h4>wdv4758h</h4>
		</span>
        <span>publish: <time datetime="2015-02-05T13:23:00+08:00">Thu 05 February 2015</time></span>

            <br>
            <span>update: <time datetime="2015-02-05 13:23:00+08:00">Thu 05 February 2015</time></span>

	</div>

	<div>
		Category:
		<span>
			<a href="/category/python.html" rel="category">Python</a>
		</span>
	</div>

	<div>
		Tags:
		<span>
			<a href="/tag/python.html" rel="tag">Python</a>
		</span>
		<span>
			<a href="/tag/interpreter.html" rel="tag">Interpreter</a>
		</span>
		<span>
			<a href="/tag/benchmark.html" rel="tag">Benchmark</a>
		</span>
		<span>
			<a href="/tag/cpython.html" rel="tag">CPython</a>
		</span>
		<span>
			<a href="/tag/pypy.html" rel="tag">PyPy</a>
		</span>
		<span>
			<a href="/tag/nuitka.html" rel="tag">Nuitka</a>
		</span>
	</div>

</div>
                </div>
            </div>
            <div class="row-fluid">
                <div class="col-md-2">
                </div>
                <div class="col-md-8">
	<div class="article-body"><div class="section" id="introduction">
<h2>Introduction</h2>
<div class="section" id="benchmark">
<h3>什麼是 benchmark ?</h3>
<p>benchmark 就是用幾個固定項目來測量不同程式的效率，
取得測量出來的數值後互相做比較，
藉此來做優劣分析，但是這作法其實是蠻粗糙的。
benchmark 這種作法一直都有人在用 (也常會被拿來說嘴)，
雖然一個程式的效率不能就這麼用 benchmark 跑出來的數字來輕易評斷，
但還是能獲得些許的資訊，或者找到進步的空間。</p>
<p>以下會說明幾個拿來評量 Python interpreter 的 benchmark。</p>
</div>
<div class="section" id="id1">
<h3>實作介紹</h3>
<div class="section" id="cpython">
<h4>CPython</h4>
<p>Python 官方實作，
中規中矩，
garbage collection 採用 reference counting。</p>
</div>
<div class="section" id="pypy">
<h4>PyPy</h4>
<p>JIT 版本實作，
garbage collection 為 incremental generational tracing，
內部 data structure 有做過改良。</p>
</div>
<div class="section" id="nuitka">
<h4>Nuitka</h4>
<p>不是一個 Python interpreter 實作，
而是把 Python code compile 成單一的執行檔，
不過這樣一來也就損失了很多 Python 的特性。</p>
</div>
</div>
</div>
<div class="section" id="hello-world">
<h2>Hello World</h2>
<div class="section" id="background">
<h3>Background</h3>
<p>沒什麼特別的，就是一個簡單的 Hello World，
目的是要測 interpreter 的 startup time，
在此項目中 startup time 愈小愈好。</p>
</div>
<div class="section" id="result">
<h3>Result</h3>
<p>Test:</p>
<table border="1" class="table table-bordered docutils">
<colgroup>
<col width="70%" />
<col width="30%" />
</colgroup>
<tbody valign="top">
<tr><td>CPython 2.7.9</td>
<td>0.01 ~ 0.03 s</td>
</tr>
<tr><td>CPython 3.4.2</td>
<td>0.02 ~ 0.04 s</td>
</tr>
<tr><td>PyPy 2.5  (Python 2.7.8)</td>
<td>0.10 ~ 0.12 s</td>
</tr>
<tr><td>PyPy3 2.4 (Python 3.2.5)</td>
<td>0.06 ~ 0.07 s</td>
</tr>
<tr><td>Nuitka compile 0.5.9 (Python 2.7)</td>
<td>0.01 ~ 0.02 s</td>
</tr>
<tr><td>Nuitka compile 0.5.9 (Python 3.4)</td>
<td>0.06 ~ 0.08 s</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="pystone">
<h2>PyStone</h2>
<div class="section" id="id2">
<h3>Background</h3>
<p>PyStone 是 CPython 裡面一個非常 high-level 的 benchmark (CPython <tt class="docutils literal">lib/test/pystone.py</tt> ，
拿不同的實作跑下去會拿到各自的 PyStone，代表著整體的效能分數，
愈多的 PyStone 愈好。</p>
</div>
<div class="section" id="id3">
<h3>Result</h3>
<p>在這個項目中，PyPy JIT 的優勢大幅顯現，隨著 loop 量的上升，差距也跟著拉大。</p>
<p>Test: (50000 passes)</p>
<table border="1" class="table table-bordered docutils">
<colgroup>
<col width="59%" />
<col width="41%" />
</colgroup>
<tbody valign="top">
<tr><td>CPython 2.7.9</td>
<td>59814 pystones/second</td>
</tr>
<tr><td>CPython 3.4.2</td>
<td>46957 pystones/second</td>
</tr>
<tr><td>PyPy 2.5  (Python 2.7.8)</td>
<td>570821 pystones/second</td>
</tr>
<tr><td>PyPy3 2.4 (Python 3.2.5)</td>
<td>475670 pystones/second</td>
</tr>
<tr><td>Nuitka compile 0.5.9 (Python 2.7)</td>
<td>188474 pystones/second</td>
</tr>
<tr><td>Nuitka compile 0.5.9 (Python 3.4)</td>
<td>94807 pystones/second</td>
</tr>
</tbody>
</table>
<p>Test: (1000000 passes)</p>
<table border="1" class="table table-bordered docutils">
<colgroup>
<col width="55%" />
<col width="45%" />
</colgroup>
<tbody valign="top">
<tr><td>CPython 2.7.9</td>
<td>56851.8 pystones/second</td>
</tr>
<tr><td>CPython 3.4.2</td>
<td>46869.8 pystones/second</td>
</tr>
<tr><td>PyPy 2.5  (Python 2.7.8)</td>
<td>1.88367e+06 pystones/second</td>
</tr>
<tr><td>PyPy3 2.4 (Python 3.2.5)</td>
<td>1.54948e+06 pystones/second</td>
</tr>
<tr><td>Nuitka compile 0.5.9 (Python 2.7)</td>
<td>186711 pystones/second</td>
</tr>
<tr><td>Nuitka compile 0.5.9 (Python 3.4)</td>
<td>103947 pystones/second</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="pybench-2-0">
<h2>PyBench 2.0</h2>
<div class="section" id="id4">
<h3>Background</h3>
<p>PyBench 是 CPython 裡的 low-level benchmarks (CPython <tt class="docutils literal">Tools/pybench</tt>)，
PyStone 用來衡量整體效能，
PyBench 用來衡量特定細項的效能。</p>
</div>
</div>
<div class="section" id="richards">
<h2>Richards</h2>
<div class="section" id="id5">
<h3>Background</h3>
<p>和 PyStone 類似，
是 PyPy 裡的 high-level benchmark (原版本是由 Dr. Martin Richards 在 Cambridge University 用 BCPL 寫的)
(PyPy <tt class="docutils literal">rpython/translator/goal/richards.py</tt>)，
一樣給出單一的值來衡量 (Average time per iteration)，
愈低的 &quot;Average time per iteration&quot; 愈好。</p>
</div>
<div class="section" id="id6">
<h3>Result</h3>
<table border="1" class="table table-bordered docutils">
<colgroup>
<col width="76%" />
<col width="24%" />
</colgroup>
<tbody valign="top">
<tr><td>CPython 2.7.9</td>
<td>382.70 ms</td>
</tr>
<tr><td>CPython 3.4.2</td>
<td>437.50 ms</td>
</tr>
<tr><td>PyPy 2.5  (Python 2.7.8)</td>
<td>49.66 ms</td>
</tr>
<tr><td>PyPy3 2.4 (Python 3.2.5)</td>
<td>58.72 ms</td>
</tr>
<tr><td>Nuitka compile 0.5.9 (Python 2.7)</td>
<td>178.72 ms</td>
</tr>
<tr><td>Nuitka compile 0.5.9 (Python 3.4)</td>
<td>261.62 ms</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="id7">
<h2>總結</h2>
<p>Nuitka 把 Python 轉成 C++ 然後 compile，
雖然可以得到效能提升，但是缺失去很多 Python 的特質，
雖然小 script 在處理過後可以得到小小的執行檔，
但如果是一個大專案的話，
compile 出來的結果可能就會很大 (先別提是否能好好處理)，
這樣相對之下選用原本 interpreter 的方式可能還會好一些，
而且如此一來，在更改 Python 專案時也需要不斷重新 compile，
失去了一些方便性，
如果別人要把 compile 過的 Python code import 進去來用又是另外一個問題，
但不可否認，對於一個小 script 且又有 performance 和 memory 考量下，
目前可能是個選擇。</p>
<p>若是單純講究 performance 的話，
PyPy 的可能性會大很多，
保留原本 Python 的特質，
還有 JIT 加持，
又有更好的 garbage collection 支援，
一些 data structure 也有做過改良，
雖然 PyPy 的成熟度已經愈來愈高了，
但是還是會有地方需要改進，
若發現有比原本 CPython 慢的地方可以回報，
PyPy developer 會找到問題點然後解決 (有時是 project code 需要小改進，讓 JIT 可以幫上忙)，
而且 PyPy 還有很多更 advanced 的 interpreter features 正在實驗，
評估效能和整體架構下，可看性最高。</p>
<p>不過這邊的 benchmark 都只是一個粗略衡量，
還是要像 speed.pypy.org 一樣拿一些實際在用的 project 來跑，
可看性會比較高。</p>
</div>
<div class="section" id="reference">
<h2>Reference</h2>
<ul class="simple">
<li><a class="reference external" href="https://hg.python.org/benchmarks/">CPython benchmark suite</a></li>
<li><a class="reference external" href="https://ironpython.codeplex.com/wikipage?title=IP26RC1VsCPy26Perf">IronPython Performance Report</a></li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/IronPython">Wikipedia - IronPython</a></li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Jython">Wikipedia - Jython</a></li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Dynamic_Language_Runtime">Wikipedia - Dynamic Language Runtime</a></li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Common_Language_Infrastructure">Wikipedia - Common Language Infrastructure</a></li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Cython">Wikipedia - Cython</a></li>
</ul>
</div>
</div>

        <hr>
        <h2>Related Posts</h2>
        <ul>
            <li><a href="/posts/2015/01/pypy-tutorial-for-brainfuck-interpreter/">PyPy - Tutorial for Brainfuck Interpreter</a></li>
            <li><a href="/posts/2014/10/jitviewer/">Try the jitviewer</a></li>
            <li><a href="/posts/2014/10/RPython/">RPython Intro.</a></li>
            <li><a href="/posts/2014/02/python-wraps/">Python - @wraps</a></li>
            <li><a href="/posts/2015/01/virtualenv-version-change/">virtualenv 版本號異動</a></li>
        </ul>

	<hr>

	<h2>Comments</h2>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'wdv4758h-blog';
    var disqus_title = 'Python Benchmark for Interpreter';
	var disqus_identifier = 'posts/2015/02/python-benchmark-for-interpreter/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

                </div>
            </div>
		</div>
	</div> 	<!-- <hr> -->
</div> <!-- /container -->
<footer class="aw-footer bg-danger">
	<div class="container"> <!-- footer -->
		<div class="row">
			<div class="col-md-10 col-md-offset-1">
				<div class="row">
					<div class="col-md-3">
						<h4>Navigation</h4>
						<ul class="list-unstyled my-list-style">
							<li><a href="">Dv 名字很難念</a></li>
                            <li><a href="/about.html">About</a></li>
							<li><a href="/archives"><i class="fa fa-archive "></i> archive</a></li>
							<li><a href="/tags"><i class="fa fa-tags "></i> tags</a></li>
							<li><a href="/feeds/all.rss.xml"><i class="fa fa-rss "></i> rss</a></li>
						</ul>
					</div>
					<div class="col-md-3">
						<h4>Author</h4>
						<ul class="list-unstyled my-list-style">
							<li><a href="https://wdv4758h.github.com">Homepage</a></li>
							<li><a href="https://github.com/wdv4758h/">Github</a></li>
							<li><a href="https://plus.google.com/103751737509044116269/posts">Google+</a></li>
							<li><a href="https://www.facebook.com/wdv4758h">Facebook</a></li>
							<li><a href="https://www.linkedin.com/pub/chiu-hsiang-hsu/69/83/530">Linked-in</a></li>
						</ul>
					</div>
					<div class="col-md-3">
						<h4>Categories</h4>
						<ul class="list-unstyled my-list-style">
							<li><a href="/category/c++.html">C++ (1)</a></li>
							<li><a href="/category/compiler.html">Compiler (1)</a></li>
							<li><a href="/category/django.html">Django (2)</a></li>
							<li><a href="/category/functional.html">Functional (2)</a></li>
							<li><a href="/category/fuzzy.html">Fuzzy (1)</a></li>
							<li><a href="/category/gc.html">GC (1)</a></li>
							<li><a href="/category/html5.html">HTML5 (1)</a></li>
							<li><a href="/category/linux.html">Linux (3)</a></li>
							<li><a href="/category/misc.html">Misc (40)</a></li>
							<li><a href="/category/prolog.html">Prolog (1)</a></li>
							<li><a href="/category/python.html">Python (14)</a></li>
							<li><a href="/category/qemu.html">QEMU (1)</a></li>
							<li><a href="/category/rust.html">Rust (3)</a></li>
							<li><a href="/category/ted.html">TED (1)</a></li>
							<li><a href="/category/vim.html">Vim (3)</a></li>
						</ul>
					</div>
					<div class="col-md-3">
						<h4>Links</h4>
						<ul class="list-unstyled my-list-style">
							<li><a href="https://www.python.org/">Python</a></li>
							<li><a href="https://www.djangoproject.com/">Django</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>
</footer>
<div class="container">
	<div class="row">
		<div class="col-md-12 text-center center-block aw-bottom">
			<p>&copy; wdv4758h 2014</p>
            <small>Arch Linux + Vim + reStructuredText + Pelican = Blog</small>
		</div>
	</div>
</div>
<!-- JavaScript -->
<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<!-- search -->
<script type="text/javascript" src="/theme/tipuesearch/tipuesearch_set.js"></script>
<script type="text/javascript" src="/theme/tipuesearch/tipuesearch.min.js"></script>
<!------------>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script type="text/javascript">
jQuery(document).ready(function($) {
	$("div.collapseheader").click(function () {
		$header = $(this).children("span").first();
		$codearea = $(this).children(".input_area");
		$codearea.slideToggle(500, function () {
			$header.text(function () {
				return $codearea.is(":visible") ? "Collapse Code" : "Expand Code";
			});
		});
	});
});
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42810012-2', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>