<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<title>HTML5 - Web Storage — Dv 名字很難念</title>
	<meta name="description" content="Title: HTML5 - Web Storage; Date: 2015-03-05; Author: wdv4758h">
	<meta name="author" content="wdv4758h">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
		<script src="/theme/html5.js"></script>
		<![endif]-->
	<link href="/theme/css/ipython.css" rel="stylesheet">
	<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
	<link href="//maxcdn.bootstrapcdn.com/bootswatch/3.2.0/simplex/bootstrap.min.css" rel="stylesheet">
	<link href="/theme/css/local.css" rel="stylesheet">
	<link href="/theme/css/pygments.css" rel="stylesheet">
    <link rel="stylesheet" href="/theme/tipuesearch/tipuesearch.css">
</head>

<body>
<div class="container">
	<div class="page-header">
		<h1>
            <a href="/">Dv 名字很難念</a>
			<br>
            <small>Aquí hay gato encerrado. </small>
            <form id="searchform" action="/search.html" onsubmit="return (this.elements['q'].value.length > 0)">
                    <input id="searchbox" type="text" name="q" size="12" placeholder="Search">
            </form>
        </h1>
        <a class="top-line-label" href="/about.html">About</a>
	</div>
	<div class="row">
        <div>
            <div class="row-fluid">
                <div class="col-md-8 col-md-offset-2">
<div class="article">

	<div class="text-center article-header">

		<h1 class="article-title">HTML5 - Web Storage</h1>
		<span>
			<h4>wdv4758h</h4>
		</span>
        <span>publish: <time datetime="2015-03-05T16:59:00+08:00">Thu 05 March 2015</time></span>

            <br>
            <span>update: <time datetime="2015-03-05 16:59:00+08:00">Thu 05 March 2015</time></span>

	</div>

	<div>
		Category:
		<span>
			<a href="/category/html5.html" rel="category">HTML5</a>
		</span>
	</div>

	<div>
		Tags:
		<span>
			<a href="/tag/web-storage.html" rel="tag">Web Storage</a>
		</span>
		<span>
			<a href="/tag/html5.html" rel="tag">HTML5</a>
		</span>
		<span>
			<a href="/tag/javascript.html" rel="tag">Javascript</a>
		</span>
	</div>

</div>
                </div>
            </div>
            <div class="row-fluid">
                <div class="col-md-2">
                </div>
                <div class="col-md-8">
    <div class="well">
        <h2>Table of Content</h2>
        <div class="contents topic">
            <div class="toc" id="">

<ul class="simple">
<li><a class="reference internal" href="#web-storage-v-s-cookies" id="id3">Web Storage V.S. Cookies</a><ul>
<li><a class="reference internal" href="#id1" id="id4">不同處</a><ul>
<li><a class="reference internal" href="#storage-size" id="id5">Storage size</a></li>
<li><a class="reference internal" href="#client-side-interface" id="id6">Client-side interface</a></li>
<li><a class="reference internal" href="#local-and-session-storage" id="id7">Local and session storage</a></li>
<li><a class="reference internal" href="#interface-and-data-model" id="id8">Interface and data model</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#web-storage" id="id9">Web Storage</a><ul>
<li><a class="reference internal" href="#usage" id="id10">Usage</a><ul>
<li><a class="reference internal" href="#sessionstorage" id="id11">sessionStorage</a></li>
<li><a class="reference internal" href="#localstorage" id="id12">localStorage</a></li>
<li><a class="reference internal" href="#accessing-data-for-the-currently-browsed-domain" id="id13">Accessing data for the currently browsed domain</a></li>
<li><a class="reference internal" href="#data-types" id="id14">Data types</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dom-storage" id="id15">DOM Storage</a></li>
<li><a class="reference internal" href="#web-storage-management" id="id16">Web Storage Management</a><ul>
<li><a class="reference internal" href="#local-storage" id="id17">Local Storage</a></li>
<li><a class="reference internal" href="#session-storage" id="id18">Session Storage</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#reference" id="id19">Reference</a></li>
</ul>
</div>
        </div>
    </div>
	<div class="article-body">
<p><strong>以下是放置很久的紀錄，最近整理清出來 (ry</strong></p>
<p>Web Storage 是一種可讓網頁將資料儲存於 local 端的技術，純粹運作於 client side，其作用如同 cookie，但空間更大。
它原本是 HTML5 規格的一部份，後來單獨劃為一個規格。</p>
<p>Web Storage 主要分成兩種 :</p>
<ul class="simple">
<li>local storage (類似 persistent cookies)</li>
<li>session storage (類似 session cookies)</li>
</ul>
<div class="section" id="web-storage-v-s-cookies">
<h2><a class="toc-backref" href="#id3">Web Storage V.S. Cookies</a></h2>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id4">不同處</a></h3>
<div class="section" id="storage-size">
<h4><a class="toc-backref" href="#id5">Storage size</a></h4>
<p>Web storage 可存的 size 遠大於 cookies</p>
</div>
<div class="section" id="client-side-interface">
<h4><a class="toc-backref" href="#id6">Client-side interface</a></h4>
<p>Cookies 在 server 和 client 端都可以 access，但 Web Storage 只在 client 端</p>
<p>Web Storage 的資料不會在每次 HTTP request 的時候都傳送過去，web server 也不能直接寫入 Web Storage (但這些都可以由 client-side scripts 達到)</p>
</div>
<div class="section" id="local-and-session-storage">
<h4><a class="toc-backref" href="#id7">Local and session storage</a></h4>
<p>local storage 和 session storage 的差別在於 scope 和 lifetime</p>
<p>local storage 是用 <a class="reference external" href="https://en.wikipedia.org/wiki/Same-origin_policy">來源 (Same-origin policy)</a> 分的 (size 也是用這個方式分開來算的)，在 browser 關掉之後仍會持續存在</p>
<p>session storage 是 per-page-per-window，lifetime 限制在那個 window，關掉後就沒了</p>
<p>Session storage is intended to allow separate instances of the same web application to run in different windows without interfering with each other, a use case that's not well supported by cookies</p>
<table border="1" class="table table-bordered docutils">
<colgroup>
<col width="16%"></col>
<col width="40%"></col>
<col width="44%"></col>
</colgroup>
<thead valign="bottom">
<tr><th class="head">性質</th>
<th class="head">local storage</th>
<th class="head">session storage</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>lifetime</td>
<td>browser 關掉仍會存在</td>
<td>windows/分頁 關掉後就沒了</td>
</tr>
<tr><td>scop</td>
<td>可跨分頁 (用 origin 分)</td>
<td>不可跨分頁</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="interface-and-data-model">
<h4><a class="toc-backref" href="#id8">Interface and data model</a></h4>
<p>Web storage 提供比 cookies 更好的 programmatic interface，使用了 associative array data model (keys 和 values 都是 strings)</p>
</div>
</div>
</div>
<div class="section" id="web-storage">
<h2><a class="toc-backref" href="#id9">Web Storage</a></h2>
<div class="section" id="usage">
<h3><a class="toc-backref" href="#id10">Usage</a></h3>
<p>支援 Web Storage 的 browsers 會有 <cite>sessionStorage</cite> 和 <cite>localStorage</cite> 這兩個 global variables，可以使用 Javascript 來操作</p>
<div class="section" id="sessionstorage">
<h4><a class="toc-backref" href="#id11">sessionStorage</a></h4>
<div class="highlight"><pre><span class="c1">// Store value on browser for duration of the session</span>
<span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">'key'</span><span class="p">,</span> <span class="s1">'value'</span><span class="p">);</span>

<span class="c1">// Retrieve value (gets deleted when browser is closed and re-opened)</span>
<span class="nx">alert</span><span class="p">(</span><span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">'key'</span><span class="p">));</span>
</pre></div>
</div>
<div class="section" id="localstorage">
<h4><a class="toc-backref" href="#id12">localStorage</a></h4>
<div class="highlight"><pre><span class="c1">// Store value on the browser beyond the duration of the session</span>
<span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">'key'</span><span class="p">,</span> <span class="s1">'value'</span><span class="p">);</span>

<span class="c1">// Retrieve value (persists even after closing and re-opening the browser)</span>
<span class="nx">alert</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">'key'</span><span class="p">));</span>
</pre></div>
</div>
<div class="section" id="accessing-data-for-the-currently-browsed-domain">
<h4><a class="toc-backref" href="#id13">Accessing data for the currently browsed domain</a></h4>
<p>以下是取得目前 domain 的所有在 local storage 裡的 data 的範例 code</p>
<div class="highlight"><pre><span class="kd">var</span> <span class="nx">output</span> <span class="o">=</span> <span class="s2">"LOCALSTORAGE DATA:\n------------------------------------\n"</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
           <span class="nx">output</span> <span class="o">+=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">key</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">': '</span> <span class="o">+</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">key</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="o">+</span> <span class="s1">'\n'</span><span class="p">;</span>
       <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
       <span class="nx">output</span> <span class="o">+=</span> <span class="s1">'There is no data stored for this domain.'</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">output</span> <span class="o">+=</span> <span class="s1">'Your browser does not support local storage.'</span>
<span class="p">}</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">output</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="data-types">
<h4><a class="toc-backref" href="#id14">Data types</a></h4>
<p>只有 strings 可以透過 Storage API 儲存進去，在多數的 browser 裡，如果要嘗試存入非 string 的 data type，會自動轉為 string</p>
<div class="highlight"><pre><span class="c1">// Store an object instead of a string</span>
<span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">'key'</span><span class="p">,</span> <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s1">'value'</span><span class="p">});</span>
<span class="nx">alert</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">'key'</span><span class="p">));</span> <span class="c1">// string</span>

<span class="c1">// Store an integer instead of a string</span>
<span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">'key'</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nx">alert</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">'key'</span><span class="p">));</span> <span class="c1">// string</span>

<span class="c1">// Store an object using JSON</span>
<span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">'key'</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span> <span class="s1">'value'</span><span class="p">}));</span>
<span class="nx">alert</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">'key'</span><span class="p">)).</span><span class="nx">name</span><span class="p">);</span> <span class="c1">// value</span>
</pre></div>
</div>
</div>
<div class="section" id="dom-storage">
<h3><a class="toc-backref" href="#id15">DOM Storage</a></h3>
<p>Web Storage 也常被稱為 DOM storage (這裡指的不是 Document Object Model)</p>
<p>According to the W3C, "The term DOM is used to refer to the API set made available to scripts in Web applications, and does not necessarily imply the existence of an actual Document object..."</p>
</div>
<div class="section" id="web-storage-management">
<h3><a class="toc-backref" href="#id16">Web Storage Management</a></h3>
<div class="section" id="local-storage">
<h4><a class="toc-backref" href="#id17">Local Storage</a></h4>
<p>Firefox 會把所有 web storage objects 存入一個叫作 webappsstore.sqlite 的 sqlite 檔案 (可以用 sqlite3 的 command 去看)，
例如 : <tt class="docutils literal"><span class="pre">~/.mozilla/firefox/XXX/webappsstore.sqlite</span></tt> ，
column 裡會有 reversed hostname 和 protocol</p>
<div class="highlight"><pre><span class="go">$ sqlite3 webappsstore.sqlite</span>
<span class="gp">sqlite&gt; </span><span class="p">.</span><span class="n">tables</span>
<span class="go">webappsstore2</span>
<span class="gp">sqlite&gt; </span><span class="p">.</span><span class="k">schema</span>
<span class="go">CREATE TABLE webappsstore2 (scope TEXT, key TEXT, value TEXT, secure INTEGER, owner TEXT);</span>
<span class="go">CREATE UNIQUE INDEX scope_key_index ON webappsstore2(scope, key);</span>
<span class="gp">sqlite&gt; </span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">webappsstore2</span><span class="p">;</span>
<span class="go">moc.elpmaxe.www.:http:80|stringkey|value|0|</span>
<span class="go">moc.elpmaxe.www.:http:80|jsonkey|{"key","value"}|0|</span>
<span class="gp">sqlite&gt; </span><span class="p">.</span><span class="n">exit</span>
</pre></div>
<p>Chrome 把這個 sqlite 的 file 依照 hostname 和 protocol 分開來</p>
<p>Chromium 的路徑 : <tt class="docutils literal"><span class="pre">~/.config/chromium/Default/Local</span> Storage/</tt></p>
</div>
<div class="section" id="session-storage">
<h4><a class="toc-backref" href="#id18">Session Storage</a></h4>
<p>因為 session storage 在重開之後就會被清掉，所以不需要存進 database</p>
<p>Firefox 還是會把它寫入 disk 來提供目前 session 的 restore (主要用於 recover from crashes)，
這個檔案是一個 JSON file 在 <tt class="docutils literal"><span class="pre">~/.mozilla/firefox/XXX/sessionstore.js</span></tt> ，
裡面有個 key 叫 <tt class="docutils literal">storage</tt> ，它的 value 是 URLs 和 sessionStorage data 的對應</p>
</div>
</div>
</div>
<div class="section" id="reference">
<h2><a class="toc-backref" href="#id19">Reference</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://en.wikipedia.org/wiki/Web_storage">Web Storage - Wikipedia</a></li>
<li><a class="reference external" href="http://huan-lin.blogspot.com/2012/06/html5-web-storage.html">HTML5 Web Storage</a></li>
<li><a class="reference external" href="http://blog.roodo.com/rocksaying/archives/15967715.html">Web Storage 使用經驗</a></li>
<li><a class="reference external" href="http://diveintohtml5.info/storage.html">The Past, Present &amp; Future of Local Storage for web applications</a></li>
<li><a class="reference external" href="http://www.html5rocks.com/tw/features/storage">HTML5 功能 - 儲存 - HTML5 Rocks</a></li>
<li><a class="reference external" href="https://developer.mozilla.org/en/docs/Web/Guide/API/DOM/Storage">DOM Storage guide</a></li>
<li><a class="reference external" href="https://stackoverflow.com/questions/9669184/how-is-html5-webstorage-data-physically-stored">How is HTML5 WebStorage data physically stored?</a></li>
<li><a class="reference external" href="https://stackoverflow.com/questions/7079075/where-does-firefox-store-javascript-html-localstorage">Where does Firefox store javascript/HTML localStorage?</a></li>
<li><a class="reference external" href="http://www.w3.org/TR/webstorage/">Web Storage - W3C</a></li>
</ul>
</div>
</div>

        <hr>
        <h2>Related Posts</h2>
        <ul>
            <li><a href="/posts/2014/02/chart-js/">Chart.js 簡單的畫出 Chart</a></li>
        </ul>

	<hr>

	<h2>Comments</h2>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'wdv4758h-blog';
    var disqus_title = 'HTML5 - Web Storage';
	var disqus_identifier = 'posts/2015/03/html5-web-storage/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

                </div>
            </div>
		</div>
	</div> 	<!-- <hr> -->
</div> <!-- /container -->
<footer class="aw-footer bg-danger">
	<div class="container"> <!-- footer -->
		<div class="row">
			<div class="col-md-10 col-md-offset-1">
				<div class="row">
					<div class="col-md-3">
						<h4>Navigation</h4>
						<ul class="list-unstyled my-list-style">
							<li><a href="">Dv 名字很難念</a></li>
                            <li><a href="/about.html">About</a></li>
							<li><a href="/archives"><i class="fa fa-archive "></i> archive</a></li>
							<li><a href="/tags"><i class="fa fa-tags "></i> tags</a></li>
							<li><a href="/feeds/all.rss.xml"><i class="fa fa-rss "></i> rss</a></li>
						</ul>
					</div>
					<div class="col-md-3">
						<h4>Author</h4>
						<ul class="list-unstyled my-list-style">
							<li><a href="https://wdv4758h.github.com">Homepage</a></li>
							<li><a href="https://github.com/wdv4758h/">Github</a></li>
							<li><a href="https://plus.google.com/103751737509044116269/posts">Google+</a></li>
							<li><a href="https://www.facebook.com/wdv4758h">Facebook</a></li>
							<li><a href="https://www.linkedin.com/pub/chiu-hsiang-hsu/69/83/530">Linked-in</a></li>
						</ul>
					</div>
					<div class="col-md-3">
						<h4>Categories</h4>
						<ul class="list-unstyled my-list-style">
							<li><a href="/category/c++.html">C++ (1)</a></li>
							<li><a href="/category/compiler.html">Compiler (1)</a></li>
							<li><a href="/category/django.html">Django (2)</a></li>
							<li><a href="/category/functional.html">Functional (2)</a></li>
							<li><a href="/category/fuzzy.html">Fuzzy (1)</a></li>
							<li><a href="/category/gc.html">GC (1)</a></li>
							<li><a href="/category/html5.html">HTML5 (1)</a></li>
							<li><a href="/category/linux.html">Linux (3)</a></li>
							<li><a href="/category/misc.html">Misc (40)</a></li>
							<li><a href="/category/prolog.html">Prolog (1)</a></li>
							<li><a href="/category/python.html">Python (14)</a></li>
							<li><a href="/category/qemu.html">QEMU (1)</a></li>
							<li><a href="/category/rust.html">Rust (3)</a></li>
							<li><a href="/category/ted.html">TED (1)</a></li>
							<li><a href="/category/vim.html">Vim (3)</a></li>
						</ul>
					</div>
					<div class="col-md-3">
						<h4>Links</h4>
						<ul class="list-unstyled my-list-style">
							<li><a href="https://www.python.org/">Python</a></li>
							<li><a href="https://www.djangoproject.com/">Django</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>
</footer>
<div class="container">
	<div class="row">
		<div class="col-md-12 text-center center-block aw-bottom">
			<p>&copy; wdv4758h 2014</p>
            <small>Arch Linux + Vim + reStructuredText + Pelican = Blog</small>
		</div>
	</div>
</div>
<!-- JavaScript -->
<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<!-- search -->
<script type="text/javascript" src="/theme/tipuesearch/tipuesearch_set.js"></script>
<script type="text/javascript" src="/theme/tipuesearch/tipuesearch.min.js"></script>
<!------------>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script type="text/javascript">
jQuery(document).ready(function($) {
	$("div.collapseheader").click(function () {
		$header = $(this).children("span").first();
		$codearea = $(this).children(".input_area");
		$codearea.slideToggle(500, function () {
			$header.text(function () {
				return $codearea.is(":visible") ? "Collapse Code" : "Expand Code";
			});
		});
	});
});
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42810012-2', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>