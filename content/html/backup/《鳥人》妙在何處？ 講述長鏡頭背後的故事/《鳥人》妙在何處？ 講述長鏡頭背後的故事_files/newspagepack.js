var loadMiniCart=true;var TopMenu=Class.create();Object.extend(TopMenu.prototype,{server:{getUser:function(b){return Mtime.Component.Ajax.get("Mtime.Service.Pages.ManagerService","GetUserInfo2",[],b,"/Service/Manager.msi","get","10000")},getSuggestions:function(d,c){return Mtime.Component.Ajax.request(siteServiceUrl,"Mtime.Service.Pages.UtilityService","GetSuggestionKeywords",[d],c,"/service/utility.msi","get","20000")},addRegisterDayBonus:function(c,d){Mtime.Component.Ajax.get("Mtime.Service.Pages.ScoreService","AddRegisterDayBonus",[],c,"/Service/Score.msi","get","20000",d)}},MainNavPageType:{NotSet:0,Home:1,News:2,Theater:3,Community:4,Movie:5,Mall:6},options:{type:1,mainNavPage:0,actionUrl:siteSearchUrl+"/search/",timer:1,showSearchBoxHrefs:["http://theater.mtime.com","http://news.mtime.com/pix","http://i.mtime.com","http://group.mtime.com","http://my.mtime.com","http://piao.mtime.com","http://mall.mtime.com"],pageSearchControlSearchTip:""},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.initializeData();this.initializeEvent()},initializeField:function(){this.isInitialize=false;this.isInitializeManager=false;this.type=topMenuValues.mainNavType=="Channel"?0:1;this.mainNavPage=topMenuValues.mainNavPage},initializeDOM:function(){this.topMenuRegion=$("topMenuRegion");if(!this.topMenuRegion){this.topMenuRegion=$("topbar")}if(this.topMenuRegion){this.addDOM()}},destroyDOM:function(){this.removeDOM();if(this.topMenuRegion){this.topMenuRegion=null}},initializeData:function(){if(!this.topMenuRegion){return}this.topMenuValues=topMenuValues;this.server.getUser(function(g){if(g&&g.value){var h=g.value;this.isLogin=h.userId>0?true:false;this.user={isLogin:this.isLogin,id:h.userId,nickname:h.nickName,homeUrl:h.homeUrl,blogUrl:h.blogUrl,headSrc:h.headSrc,isSaveEmail:h.isSaveEmail,isAutoExit:h.isAutoExit,signupTime:h.signupTime,email:h.email,cityId:h.cityId,cityName:h.cityName,isAnniversary:h.isAnniversary,authorizeUrl:typeof h.authorizeUrl==="undefined"?"":h.authorizeUrl,isVirtual:typeof h.isVirtual==="undefined"?false:h.isVirtual,enableMobileLogin:true,customizeMenus:typeof h.CustomizeMenus==="undefined"?null:h.CustomizeMenus,headSrc128:typeof h.headSrc128==="undefined"?"":h.headSrc128,shortNickName:typeof h.shortNickName==="undefined"?"":h.shortNickName,currentXP:typeof h.currentXP==="undefined"?"0":h.currentXP,level:typeof h.level==="undefined"?"0":h.level};var f,e=Globals.getParam("redirectUrl");if(e&&e.trim().length>0){f=e}else{f=encodeURIComponent(location.href)}this.message={receiveCount:h.receiveCount,promptCount:h.promptCount,noticeCount:h.noticeCount,allCount:h.allCount,unreadCount:h.receiveCount+h.promptCount+h.noticeCount};this.urls={mytime:siteMcUrl,signIn:siteUrl+"/member/signin/?redirectUrl="+f,signUp:siteUrl+"/member/signup/?redirectUrl="+f,signOut:siteUrl+"/member/signout/?redirectUrl="+f,siteHelp:siteUrl+"/help/",forgetPasswordUrl:h.forgetPasswordUrl};this.unreadMsgCount=h.allCount;this.render()}}.bind(this))},render:function(){if(this.bgLink&&this.topMenuValues&&this.topMenuValues.bgStartDate&&this.topMenuValues.bgEndDate){var d=new Date();var c=new Date(this.topMenuValues.bgEndDate.getFullYear(),this.topMenuValues.bgEndDate.getMonth(),this.topMenuValues.bgEndDate.getDate(),23,59,59);if(this.topMenuValues.bgStartDate<d&&d<c){if(this.topMenuValues.bgUrl){this.bgLink.href=this.topMenuValues.bgUrl;this.bgLink.target="_blank";this.bgLink.addClassName("linkpoint")}else{this.bgLink.href="javascript:void(0)";this.bgLink.removeClassName("linkpoint")}if(this.topMenuValues.bgSrc&&this.topMenuValues.bgSrc.length>0){this.topRegion.style.backgroundImage="url("+this.topMenuValues.bgSrc+")";this.topRegion.style.backgroundPosition="center top";this.topRegion.style.backgroundRepeat="no-repeat"}if(this.topMenuValues.bgHeight>0){this.topRegion.style.height=this.topMenuValues.bgHeight+"px"}if(this.topMenuValues.logoBGColor){this.logoRegion.style.backgroundColor=this.topMenuValues.logoBGColor}if(this.topMenuValues.searchTip){this.pageSearchControlSearchTip=this.topMenuValues.searchTip}}}this.initializeControl()},initializeEvent:function(){if(this.closeButton){this.onClickCloseButtonHandler=this.onClickCloseButton.bindAsEventListener(this);this.closeButton.observe("click",this.onClickCloseButtonHandler)}Event.observe(window,"unload",this.close.bind(this))},destroyEvent:function(){if(this.closeButton){this.closeButton.stopObserving("click",this.onClickCloseButtonHandler)}},initializeControl:function(){if(!this.cityMenu&&this.userCityRegion){this.cityMenu=new CityMenu({container:this.userCityRegion,userInfo:this.user})}if(!this.messageMenu&&this.userMessageRegion){this.messageMenu=new MessageMenu({container:this.userMessageRegion,message:this.message,user:this.user,isLogin:this.user.isLogin})}if(!this.userMenu&&this.userLoginRegion){this.userMenu=new UserMenu({container:this.userLoginRegion.parentNode,menu:this.userLoginRegion,userInfo:this.user,urls:this.urls})}if(typeof PageSearchControl!="undefined"){var d=0;if(this.mainNavPage==3){d=2}else{if(this.mainNavPage==6){d=4}}if(this.searchRegion&&this.suggestRegion){this.searchMenu=new PageSearchControl({searchRegion:this.searchRegion,suggestRegion:this.suggestRegion,text:this.pageSearchControlSearchTip,typeRegion:this.searchTypeRegion,typeListRegion:this.searchTypeListRegion,searchType:d})}}else{$loadJs("/js/2014/PageSearchControl.js",function(){var a=0;if(this.mainNavPage==3){a=2}else{if(this.mainNavPage==6){a=4}}if(this.searchRegion&&this.suggestRegion){this.searchMenu=new PageSearchControl({searchRegion:this.searchRegion,suggestRegion:this.suggestRegion,text:this.pageSearchControlSearchTip,typeRegion:this.searchTypeRegion,typeListRegion:this.searchTypeListRegion,searchType:a})}}.bind(this))}if(!this.navigationMenu&&this.navMenuButton){this.navigationMenu=new TopMenuNavigationMenu({menuRegion:this.navMenuButton,contentRegion:this.navMenuRegion,onOverCallback:function(){if(!this.navMenuButton.hasClassName("currmenuicon")){this.navMenuButton.addClassName("currmenuicon")}}.bind(this),onOutCallback:function(){if(this.navMenuButton.hasClassName("currmenuicon")){this.navMenuButton.removeClassName("currmenuicon")}}.bind(this)})}if(typeof ManagerExecuter!=="function"){var c=[]}else{manager=new ManagerExecuter({managerRegion:this.topMenuRegion,user:this.user,urls:this.urls,customizeMenus:this.user.customizeMenus})}if(typeof loadMiniCart!="undefined"&&loadMiniCart){if(!this.miniCart&&this.miniCartRegion){this.miniCart=new MiniCart({container:this.miniCartRegion,isLogin:this.user.isLogin})}}},addDOM:function(){this.searchTypeRegion=Builder.node("div",{className:"selctsearch"},[Builder.node("strong",["全部"]),Builder.node("i",[""]),Builder.node("span",["|"])]);this.searchTypeListRegion=Builder.node("div",{className:"selectshow",style:"display:none;"},[Builder.node("ul",[Builder.node("li",{searchtype:"0"},["全部"]),Builder.node("li",{searchtype:"1"},["电影"]),Builder.node("li",{searchtype:"3"},["影人"]),Builder.node("li",{searchtype:"2"},["影院"]),Builder.node("li",{searchtype:"4"},["商品"])])]);if(this.type==0){this.searchRegion=Builder.node("div",{className:"topsearch"},[Builder.node("div",{className:"searchshadow"},[this.searchTypeRegion,this.searchTypeListRegion,Builder.node("input",{type:"text",className:"text",value:""}),Builder.node("input",{type:"button",className:"button"})])])}else{this.searchRegion=Builder.node("div",{className:"topsearch"},[this.searchTypeRegion,this.searchTypeListRegion,Builder.node("input",{type:"text",className:"text",value:""}),Builder.node("input",{type:"button",className:"button"})])}this.suggestRegion=Builder.node("div",{className:"showsearch",style:"display:none;"});this.userLoginRegion=Builder.node("div",{className:"loginbox",style:"display:none;"});this.userMessageRegion=Builder.node("div",{className:"emailbox",style:"display:none;"},[Builder.node("i",{className:"ico_email"})]);this.userCityRegion=Builder.node("div",{className:"citybox",style:"display:none;"});this.bgLink=Builder.node("a",{href:"javascript:void(0)",className:"searchlink"},[]);this.miniCartRegion=Builder.node("div",{className:"shopbox onlyshop",onclick:"headTrackClick('M14_HeadNav_MiniCart_Region')",style:"display:none;"});if(this.type===0){this.addChannelDOM()}else{this.addDetailDOM()}},removeDOM:function(){if(this.type===0){}else{}},addChannelDOM:function(){this.topRegion=Builder.node("div",{className:"bartop"},[Builder.node("div",{className:"topmid"},[this.bgLink,this.searchRegion,this.suggestRegion])]);this.logoRegion=Builder.node("h1",{className:"mtimelogo",onclick:"headTrackClick('M14_HeadNav_MiddleNav')"},[Builder.node("a",{title:"Mtime时光网",href:"http://www.mtime.com"},["Mtime时光网"])]);this.topMenuRegion.appendChild(this.topRegion);var h=Builder.node("div",{className:"topline bigtopline"});this.topMenuRegion.appendChild(h);var e=Builder.node("ul",{className:"navbar"});e.appendChild(Builder.node("li",{className:this.mainNavPage==this.MainNavPageType.Home?"curr":""},[Builder.node("a",{href:"http://www.mtime.com/",onclick:"headTrackClick('M14_HeadNav_LeftNav_Index')"},[Builder.node("em",["首页"]),Builder.node("span",["首页"])])]));e.appendChild(Builder.node("li",{className:this.mainNavPage==this.MainNavPageType.News?"curr":""},[Builder.node("a",{href:"http://news.mtime.com/",onclick:"headTrackClick('M14_HeadNav_LeftNav_News')"},[Builder.node("em",["新闻"]),Builder.node("span",["新闻"])])]));e.appendChild(Builder.node("li",{className:this.mainNavPage==this.MainNavPageType.Theater?"curr":""},[Builder.node("a",{href:"http://theater.mtime.com/",onclick:"headTrackClick('M14_HeadNav_LeftNav_Theater')"},[Builder.node("em",["影院"]),Builder.node("span",["影院"])])]));if(typeof loadMiniCart!="undefined"&&loadMiniCart){e.appendChild(Builder.node("li",{className:this.mainNavPage==this.MainNavPageType.Mall?"curr":""},[Builder.node("a",{href:"http://mall.mtime.com/",onclick:"headTrackClick('M14_HeadNav_LeftNav_Mall')"},[Builder.node("em",["商城"]),Builder.node("span",["商城"]),Builder.node("i",{className:"i_new"})])]))}e.appendChild(Builder.node("li",{className:this.mainNavPage==this.MainNavPageType.Community?"curr":""},[Builder.node("a",{href:"http://www.mtime.com/community/",onclick:"headTrackClick('M14_HeadNav_LeftNav_Community')"},[Builder.node("em",["社区"]),Builder.node("span",["社区"])])]));e.appendChild(Builder.node("li",{className:this.mainNavPage==this.MainNavPageType.Movie?"curr":""},[Builder.node("a",{href:"http://movie.mtime.com/",onclick:"headTrackClick('M14_HeadNav_LeftNav_Movie')"},[Builder.node("em",["发现"]),Builder.node("span",["发现"])])]));var f=Builder.node("div",{className:"userbar"});if(typeof loadMiniCart!="undefined"&&loadMiniCart){f.appendChild(this.miniCartRegion)}f.appendChild(this.userMessageRegion);f.appendChild(this.userLoginRegion);f.appendChild(this.userCityRegion);var g=Builder.node("div",{className:"menubar"},[Builder.node("div",{className:"menubg"},[Builder.node("div",{className:"menumid clearfix"},[this.logoRegion,e,f])])]);this.topMenuRegion.appendChild(g)},addDetailDOM:function(){var h=Builder.node("div",{className:"topline"});this.topMenuRegion.appendChild(h);this.logoRegion=Builder.node("h1",{className:"mtimelogo",onclick:"headTrackClick('M14_HeadNav_MiddleNav')"},[Builder.node("a",{href:"http://www.mtime.com",title:"Mtime时光网"},["Mtime时光网"])]);this.navMenuButton=Builder.node("a",{href:"http://www.mtime.com/",className:"menuicon",title:"导航"},[]);var e=Builder.node("div",{className:"userbar"});if(typeof loadMiniCart!="undefined"&&loadMiniCart){e.appendChild(this.miniCartRegion)}e.appendChild(this.userMessageRegion);e.appendChild(this.userLoginRegion);e.appendChild(this.userCityRegion);this.navMenuRegion=Builder.node("div",{className:"menupop navpop",style:"display:none;"});var g=Builder.node("ul");g.appendChild(Builder.node("li",[Builder.node("a",{href:"http://www.mtime.com/",onclick:"headTrackClick('M14_HeadNav_LeftNav_Index')"},[Builder.node("i",{className:"ico_n_index"}),"首页"])]));g.appendChild(Builder.node("li",[Builder.node("a",{href:"http://news.mtime.com/",onclick:"headTrackClick('M14_HeadNav_LeftNav_News')"},[Builder.node("i",{className:"ico_n_news"}),"新闻"])]));g.appendChild(Builder.node("li",[Builder.node("a",{href:"http://theater.mtime.com/",onclick:"headTrackClick('M14_HeadNav_LeftNav_Theater')"},[Builder.node("i",{className:"ico_n_ticket"}),"影院"])]));if(typeof loadMiniCart!="undefined"&&loadMiniCart){g.appendChild(Builder.node("li",[Builder.node("a",{href:"http://mall.mtime.com/",onclick:"headTrackClick('M14_HeadNav_LeftNav_Mall')"},[Builder.node("i",{className:"ico_n_mall"}),"商城"])]))}g.appendChild(Builder.node("li",[Builder.node("a",{href:"http://www.mtime.com/community/",onclick:"headTrackClick('M14_HeadNav_LeftNav_Community')"},[Builder.node("i",{className:"ico_n_bbs"}),"社区"])]));g.appendChild(Builder.node("li",[Builder.node("a",{href:"http://movie.mtime.com/",onclick:"headTrackClick('M14_HeadNav_LeftNav_Movie')"},[Builder.node("i",{className:"ico_n_find"}),"发现"])]));this.navMenuRegion.appendChild(g);var f=Builder.node("div",{className:"menubar"},[Builder.node("div",{className:"menubg"},[Builder.node("div",{className:"menumid clearfix"},[this.logoRegion,Builder.node("div",{className:"navsearch clearfix"},[this.navMenuButton,this.searchRegion,this.suggestRegion,this.navMenuRegion]),e])])]);this.topMenuRegion.appendChild(f)},removeChannelDOM:function(){},closed:false,close:function(){if(!this.closed){this.closed=true;this.destroyEvent();this.destroyDOM()}}});var MessageMenu=Class.create();Object.extend(MessageMenu.prototype,{server:{getUnreadMessages:function(b){return Mtime.Component.Ajax.get("Mtime.Service.Pages.MessageService","GetUnreadMessages",[],b,"/Service/Message.msi","get","20000")},addRegisterDayBonus:function(c,d){return Mtime.Component.Ajax.get("Mtime.Service.Pages.ScoreService","AddRegisterDayBonus",[],c,"/Service/Score.msi","get","20000",d)},clearAllUnreadCount:function(b){return Mtime.Component.Ajax.get("Mtime.Service.Pages.MessageService","ClearAllUnreadCount",[],b,"/Service/Message.msi","get","20000")}},options:{container:null,user:null,isLogin:false},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeEvent();this.render()},initializeEvent:function(){Event.observe(this.container,"click",this.onClickContainer.bindAsEventListener(this))},render:function(){this.getUnReadMessage();if(this.isLogin){this.container.show()}},onClickContainer:function(g){var f=Event.element(g);if(f.hasClassName("close_btn")){this.container.down('[_type="message"]')&&this.server.clearAllUnreadCount(null);this.container.down(".m_message_notice").remove();var h=this.container.down(".m_message em");if(h){h.removeClassName("newmsg")}var k=getCookie("virtualuser");if(this.user.isVirtual&&(typeof(k)==="undefined"||k!=="virtualuser")){setCookie("virtualuser","virtualuser")}}else{if(!this.user.isAnniversary){var j=siteMcUrl+"/message/usermessage/";$redirect(j)}}},getUnReadMessage:function(){this.server.getUnreadMessages(function(y){var q=null;var s=this.user.isAnniversary;if(s){q=Builder.build('<p _type="anniversary"><a href="#" onclick="return false;">注册周年积分奖励，点击领取</a></p>')}var t=this.user.isVirtual;var z=t;if(t){var B=getCookie("virtualuser");if(B&&B==="virtualuser"){z=false}}var u=this.container.down(".m_message_notice");u&&u.remove();u=null;if((!y||!y.value)&&!q&&!z){return}else{if(!u){u=Builder.build('<div class="m_message_notice tl"><em></em><span class="close_btn fr">×</span></div>');this.container.appendChild(u)}var A=u.down('[_type="message"]');A&&A.remove();if(q){u.appendChild(q);var x=this.user.nickname;var r=this.closeMsg.bind(this);var w=this.container;var p=this.server.addRegisterDayBonus;Event.observe(q,"click",function(){var a=new Dialog({title:"注册周年积分奖励!",windowClassName:"w420",content:"<div>亲爱的"+x+"，感谢你对时光网一年的支持，时光网有你更精彩。</div>",buttonRegionClass:"tip_btnbox",buttons:[{title:"领取",buttonStyle:"btn_blue mr12",callback:function(){var d=null;if(d=w.down('[_type="message"]')){var b=w.down('[_type="anniversary"]');b&&b.remove()}else{w.down(".m_message_notice").remove();var c=w.down(".m_message em");if(c){c.removeClassName("newmsg")}}p();a.close()}}]})}.bind(this))}if(z&&this.user.authorizeUrl){var C=Builder.build(String.format('<p>完善信息后，服务更安全 <a href="{0}">立即设置</a></p>',this.user.authorizeUrl));u.appendChild(C)}if(y&&y.value){u.appendChild(Builder.build(y.value));this.container.addClassName("curremail")}}var v=this.container.down(".m_message em");if(typeof v!="undefined"){if(this.container.down(".m_message_notice")){if(!v.hasClassName("newmsg")){v.addClassName("newmsg")}}else{v.removeClassName("newmsg")}}}.bind(this))},closeMsg:function(d){var e=Event.element(d);if(e.hasClassName("close_btn")){this.container.down('[_type="message"]')&&this.server.clearAllUnreadCount(null);this.container.down(".m_message_notice").remove();var f=this.container.down(".m_message em");f.removeClassName("newmsg")}}});var UserMenu=Class.create();Object.extend(UserMenu.prototype,{server:{getUser:function(b){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.ManagerService","GetUserInfo2",[],b,"/utility/managerservice.m","get","10000")},signIn:function(j,m,l,k,o,n,h){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.ManagerService","SignIn",[j,m,l,k,o,n],h,"/utility/managerservice.m","get","10000")},refreshVcode:function(b){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.ManagerService","RefreshVcode",[],b,"/utility/managerservice.m","get","10000")},getXpAndLevel:function(d,c){return Mtime.Component.Ajax.crossDomainCallBack(siteGoodsServiceUrl,"Mtime.Ecommerce.Services","GetUserXpAndLevel",[d],c,"/Member.api","get","60000")}},options:{container:null,menu:null,userInfo:null,urls:null,onSignInCallback:null,hasLoadXpAndLevel:false},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeDOM();this.render();this.initializeEvent()},initializeDOM:function(){this.loginNameText=Builder.node("input",{type:"text",value:"输入电子邮箱地址",className:"tip"});this.passwordText=Builder.node("input",{type:"password",value:"",className:"tip"});this.autoLoginCheckBox=Builder.node("i",{className:"ico_m_check"},[""]);this.signInButton=Builder.node("input",{type:"button",value:"登录",className:"btn_login"});this.registerButton=Builder.node("input",{type:"button",value:"成为会员",className:"btn_regist"});this.vcodeText=Builder.node("input",{type:"text",value:"输入验证码",className:"tip"});this.refreshVcodeButton=Builder.node("a",{href:"#"},["刷新"])},initializeEvent:function(){Event.observe(this.menu,"click",this.onClickMenu.bind(this));if(this.userInfo.isLogin){this.initializeLoginEvent()}else{this.initializeUnloginEvent();this.onClickHandler=this.onClick.bindAsEventListener(this);Event.observe(document.body,"click",this.onClickHandler)}},onClick:function(f){var g=Event.pointerX(f);var h=Event.pointerY(f);var e=Event.element(f);if(this.unloginRegion&&this.menu!==e.up("div.loginbox")&&this.unloginRegion!==e.up("div.menupop")&&!Position.within(this.container,g,h)&&!Position.within(this.unloginRegion,g,h)){if(!this.userInfo.isLogin){if(this.unloginRegion.visible()){this.menu.removeClassName("currlogin");this.unloginRegion.hide()}}}},initializeLoginEvent:function(){},initializeUnloginEvent:function(){new Textbox({text:this.loginNameText,watermarkText:"输入电子邮箱地址"});new Textbox({text:this.passwordText,watermarkText:""});new Textbox({text:this.vcodeText,watermarkText:"输入验证码"});this.autoLoginCheckBox.observe("click",this.onClickAutoLoginCheckBox.bind(this));this.signInButton.observe("click",this.onClickSignInButton.bind(this));this.registerButton.observe("click",this.onClickRegisterButton.bind(this));this.checkAccountHandler=this.checkAccount.bind(this);Event.observe(this.loginNameText,"change",this.checkAccountHandler);this.checkPasswordHandler=this.checkPassword.bind(this);Event.observe(this.passwordText,"change",this.checkPasswordHandler);this.refreshVcodeHandler=this.refreshVcode.bind(this);Event.observe(this.refreshVcodeButton,"click",this.refreshVcodeHandler);document.onkeydown=function(){var b=window.event;if(typeof b!=="undefined"&&b.keyCode===13){this.onClickSignInButton()}}.bind(this)},render:function(){if(this.userInfo.isLogin){var d=Builder.node("span",{className:"logintxt"},[this.userInfo.nickname]);var f=Builder.node("span",{className:"loginpic"},[Builder.node("img",{height:"27",width:"27",src:this.userInfo.headSrc})]);this.menu.appendChild(d);this.menu.appendChild(f);this.loginRegion=this.buildLoginDOM();this.loginRegion.hide();this.container.appendChild(this.loginRegion);if(!this.userInfo.isAutoExit){this.autoLoginCheckBox.addClassName("ico_m_currcheck")}this.navigationMenu=new TopMenuNavigationMenu({menuRegion:this.menu,contentRegion:this.loginRegion,onOverCallback:this.onOverCallback.bind(this),onOutCallback:this.onOutCallback.bind(this)})}else{var d=Builder.node("span",{className:"logintxt"},["请登录"]);var f=Builder.node("span",{className:"loginpic"},[Builder.node("i",{className:"ico_user"})]);this.menu.appendChild(d);this.menu.appendChild(f);this.unloginRegion=this.buildUnloginDOM();var e=Builder.build('<dl class="otherlogin"><dt>使用第三方登录</dt><dd style="margin-left: 42px;"><a href="http://passport.mtime.com/unitelogin/dispatch/weibo/web/" title="新浪" class="o_sina"></a><a href="http://passport.mtime.com/unitelogin/dispatch/qq/web/" title="QQ" class="o_qq"></a></dd></dl>');this.unloginRegion.appendChild(e);this.unloginRegion.hide();this.container.appendChild(this.unloginRegion);this.loginNameText.value=this.userInfo.email}this.menu.style.display="block"},showVcodeRegion:function(){$(this.vcodeText.parentNode).show();if(!this.vcodeImageRegion){this.server.refreshVcode(function(b){if(b&&b.value&&b.value.id){this.vcodeImageRegion=this.buildVcodeImageDOM(b.value.src);this.vcodeText.parentNode.parentNode.appendChild(this.vcodeImageRegion);this.vcodeId=b.value.id;this.vcodeImage=this.vcodeImageRegion.down().down();this.vcodeImageRegion.show()}}.bind(this))}else{this.refreshVcode();this.vcodeImageRegion.show()}},hideVcodeRegion:function(){if(this.vcodeText){$(this.vcodeText.parentNode).hide()}if(this.vcodeImageRegion){this.vcodeImageRegion.hide()}},onOverCallback:function(){if(!this.menu.hasClassName("currlogin")){this.menu.addClassName("currlogin");if(this.userInfo.isLogin&&!this.hasLoadXpAndLevel){this.server.getXpAndLevel(this.userInfo.id,function(b){if(b&&b.value){$("topMenuLevelContainer").innerHTML="M"+b.value.level;$("topMenuXpContainer").innerHTML=b.value.currentXP;this.hasLoadXpAndLevel=true}}.bind(this))}}},onOutCallback:function(){if(this.menu.hasClassName("currlogin")){this.menu.removeClassName("currlogin")}},isShowing:function(){return this.loginRegion.style.display!="none"},onClickMenu:function(){if(this.userInfo.isLogin){if(this.isShowing()){this.loginRegion.hide();this.onOutCallback()}else{this.loginRegion.show();this.onOverCallback()}}else{if(this.unloginRegion.visible()){this.menu.removeClassName("currlogin");this.unloginRegion.hide()}else{this.unloginRegion.show();this.menu.addClassName("currlogin")}}},onClickRegisterButton:function(){if(typeof sitePassportUrl==="undefined"){sitePassportUrl="http://passport.mtime.com"}var b=sitePassportUrl+"/member/signin/?redirectUrl="+encodeURIComponent(location.href);location.href=b},onClickVcodeText:function(){if(!this.vcodeImageRegion){this.server.refreshVcode(function(b){if(b&&b.value&&b.value.id){this.vcodeImageRegion=this.buildVcodeImageDOM(b.value.src);this.vcodeText.parentNode.parentNode.appendChild(this.vcodeImageRegion);this.vcodeId=b.value.id;this.vcodeImage=this.vcodeImageRegion.down().down()}}.bind(this))}},refreshVcode:function(b){this.server.refreshVcode(function(a){if(a&&a.value&&a.value.id){this.vcodeText.value="";this.vcodeText.focus();this.vcodeId=a.value.id;this.vcodeImage.src=a.value.src}}.bind(this))},checkAccount:function(){var c=this.loginNameText.value.trim(),d=true;if(this.userInfo.enableMobileLogin){if(!Validator.Email.test(c)&&!Validator.MobilePhone.test(c)){$(this.loginNameText.parentNode).addClassName("false");d=false}else{$(this.loginNameText.parentNode).removeClassName("false")}}else{if(!Validator.Email.test(c)){$(this.loginNameText.parentNode).addClassName("false");d=false}else{$(this.loginNameText.parentNode).removeClassName("false")}}return d},checkPassword:function(){var c=this.passwordText.value,d=true;if(!Validator.Password.test(c)){$(this.passwordText.parentNode).addClassName("false");d=false}else{$(this.passwordText.parentNode).removeClassName("false")}return d},checkVcode:function(){var d=this.vcodeText.value.trim(),c=true;if(!d){$(this.vcodeText.parentNode).addClassName("false");c=false}else{$(this.vcodeText.parentNode).removeClassName("false")}return c},onClickSignInButton:function(){var e=this.loginNameText.value;var f=$encodePassword(this.passwordText.value);var d=!this.autoLoginCheckBox.hasClassName("ico_m_currcheck");if(this.checkAccount()&&this.checkPassword()&&(!this.vcodeId||this.checkVcode())&&!this.lock){this.lock=true;this.server.signIn(e,f,true,d,this.vcodeId||"",this.vcodeId?this.vcodeText.value:"",function(a){this.lock=false;if(a&&a.value){if(a.value.success){this.callback&&this.callback(a.value);location.reload()}else{if(a.value.isShieldStatus){this.showSecurityRiskDialog(a.value.shieldTip)}else{if(a.value.needResetPassword){this.showResetPasswordDialog(a.value.resetPasswordUrl)}else{if(a.value.redirect){$redirect(a.value.message)}else{if(a.value.isRobot){this.showVcodeRegion();if(!a.value.vcodeValid){$(this.vcodeText.parentNode).addClassName("false")}return}else{this.hideVcodeRegion();this.vcodeId=null}$(this.loginNameText.parentNode).addClassName("false");$(this.passwordText.parentNode).addClassName("false")}}}}}}.bind(this))}},showSecurityRiskDialog:function(b){this.securityRiskDialog=new Dialog({title:"提示",windowClassName:"w375",content:'<div class="yahei px14 tc bold">'+b+"</div>",buttonRegionClass:"tip_btnbox",buttons:[{title:"确定",keyCode:Event.KEY_RETURN,buttonStyle:"t_btn_blue_i bold",callback:function(a){a.close()}.bind(this)}]})},showResetPasswordDialog:function(b){this.needResetPwdDialog=new Dialog({title:"很抱歉，账户已被冻结",windowClassName:"w375",content:'<div class="yahei px14 tc bold">由于长时间未登录，账户已被临时冻结。<br/>请点击按钮，重新邮件激活。 </div>',buttonRegionClass:"tip_btnbox",buttons:[{title:"立即激活",keyCode:Event.KEY_RETURN,buttonStyle:"t_btn_blue_i bold",callback:function(a){location.href=b}.bind(this)}]})},onClickAutoLoginCheckBox:function(){if(this.autoLoginCheckBox.hasClassName("ico_m_currcheck")){this.autoLoginCheckBox.removeClassName("ico_m_currcheck")}else{this.autoLoginCheckBox.addClassName("ico_m_currcheck")}},buildLoginDOM:function(){var e=Builder.node("div",{className:"menupop loginpop"});var f=Builder.node("ul",{className:"loginexit"});var d=Builder.node("div",{className:"my_name"},[Builder.node("a",{className:"my_pic",href:siteMcUrl},[Builder.node("img",{src:this.userInfo.headSrc128,width:"96px",height:"96px"})]),Builder.node("dl",[Builder.node("dt",[Builder.node("a",{href:siteMcUrl},[this.userInfo.shortNickName]),Builder.node("a",{href:"http://vip.mtime.com/myprivilege"},Builder.node("span",{id:"topMenuLevelContainer"},["M0"]))]),Builder.node("dd",["我的经验值:",Builder.node("a",{href:"http://vip.mtime.com/myexp",id:"topMenuXpContainer"},["0"])])]),Builder.node("div",{className:"my_btns"},[Builder.node("a",{className:"btn_login",href:siteMcUrl},["我的时光"]),Builder.node("a",{className:"btn_login",href:"http://vip.mtime.com/"},["会员俱乐部"])])]);if(typeof loadMiniCart!="undefined"&&loadMiniCart){f.appendChild(Builder.node("li",["订单：",Builder.node("a",{href:siteMcUrl+"/account/"},["电影票订单"]),Builder.node("em",["|"]),Builder.node("a",{href:siteMcUrl+"/account/ecommerce/orderList/",className:"p_r"},["商品订单",Builder.node("i",{className:"i_new"})])]))}else{f.appendChild(Builder.node("li",{className:"first"},[Builder.node("a",{href:siteMcUrl},["进入我的时光 >>"]),Builder.node("em",["|"]),Builder.node("a",{href:siteMcUrl+"/account/"},["查看订单 >>"])]))}f.appendChild(Builder.node("li",["我的：",Builder.node("a",{href:siteMcUrl+"/app/blog/"},["博客"]),Builder.node("em",["|"]),Builder.node("a",{href:siteMcUrl+"/app/group/"},["群组"]),Builder.node("em",["|"]),Builder.node("a",{href:siteMcUrl+"/movie/"},["电影"]),Builder.node("em",["|"]),Builder.node("a",{href:siteMcUrl+"/favorite/"},["收藏"])]));f.appendChild(Builder.node("li",["游戏：",Builder.node("a",{href:siteMcUrl+"/app/card/"},["卡片大富翁"]),Builder.node("em",["|"]),Builder.node("a",{href:siteMcUrl+"/app/quiz/"},["猜电影"])]));f.appendChild(Builder.node("li",[Builder.node("a",{href:this.urls.signOut,className:"btn_exit"},["登出"]),Builder.node("a",{href:siteMcUrl+"/profile/basic/"},["修改资料"]),Builder.node("em",["|"]),Builder.node("a",{href:siteMcUrl+"/profile/password/"},["密码"])]));if(typeof loadMiniCart!="undefined"&&loadMiniCart){e.appendChild(d)}e.appendChild(f);return e},buildUnloginDOM:function(){var b=Builder.node("div",{className:"menupop loginpop"},[Builder.node("dl",{className:"logintool"},[Builder.node("dt",["为爱电影的人"]),Builder.node("dd",{className:"userlogin"},[Builder.node("ul",[Builder.node("li",{className:""},[Builder.node("label",{className:"name"},["用户名："]),this.loginNameText,Builder.node("i",{className:"ico_false"},[])]),Builder.node("li",{className:""},[Builder.node("label",{className:"password"},["输入密码："]),this.passwordText,Builder.node("i",{className:"ico_false"},[])]),Builder.node("li",{className:"",style:"display:none"},[Builder.node("label",{className:"code"},["输入验证码："]),this.vcodeText,Builder.node("i",{className:"ico_false"},[])])]),Builder.node("p",{className:"usertip"},[Builder.node("a",{href:siteMcUrl+"/member/forget_password/",target:"_blank",className:"fr"},["忘记密码"]),this.autoLoginCheckBox,"下次自动登录"]),Builder.node("div",{className:"btn"},[this.signInButton,this.registerButton])])])]);return b},buildVcodeImageDOM:function(c){var d=Builder.node("li",{className:"codetxt"},[Builder.node("span",{id:"img_vcode"},[Builder.node("img",{width:"90",height:"45",src:c,style:"cursor:pointer",className:"v_m mr6"})]),this.refreshVcodeButton]);return d}});var CityMenu=Class.create();Object.extend(CityMenu.prototype,{server:{getData:function(b){if(typeof threaterListBoxData!=="undefined"&&threaterListBoxData.locations){b&&b()}else{$loadJs("/Utility/Data/TheaterListBoxData.m",b)}},getTheaterCityHomeURL:function(c,d){if(typeof theaterService==="undefined"){return Mtime.Component.Ajax.callBack("Mtime.Showtime.Pages.ShowtimeService","GetTheaterCityHomeURL",[c],d,"/service/showtime.ms","get","25000")}else{return Mtime.Component.Ajax.request(theaterService,"Mtime.Showtime.Pages.ShowtimeService","GetTheaterCityHomeURL",[c],d,"/service/showtime.ms","get","25000")}}},options:{userInfo:null,items:[],hotSearchItems:[290,292,293,365,974,366,561,880,791],HOTROWSIZE:10,order:"热门",container:"",optionTS:"<li><a value=#{Id}>#{NameCn}</a></li>",content:{regRxpAG:["A","B","C","D","E","F","G"],regRxpHL:["H","I","J","K","L"],regRxpMT:["M","N","O","P","Q","R","S","T"],regRxpWZ:["U","V","W","X","Y","Z"]}},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.optionTemplate=new Template(this.optionTS);this.initializeDOM();this.initializeEvent();this.getItems()},initializeDOM:function(){this.headPanel=$(this.container);this.closeNode=Builder.node("span",{className:"btn_close fr"},["关闭"]);this.contentBox=Builder.node("div");this.searchCityText=Builder.node("input",{type:"text",className:"text"});this.tab=Builder.node("span",{className:"cityletter"},[Builder.node("a",{href:"#",onclick:"return false;",className:"on",_v:"热门"},["热门",Builder.node("b",[" "])]),Builder.node("a",{href:"#",onclick:"return false;",_v:"A-G"},["A-G",Builder.node("b",[" "])]),Builder.node("a",{href:"#",onclick:"return false;",_v:"H-L"},["H-L",Builder.node("b",[" "])]),Builder.node("a",{href:"#",onclick:"return false;",_v:"M-T"},["M-T",Builder.node("b",[" "])]),Builder.node("a",{href:"#",onclick:"return false;",_v:"W-Z"},["W-Z",Builder.node("b",[" "])])]);this.span=Builder.node("span",{className:"fl w30 bold mt5"});this.bodyPanel=$(Builder.node("div",{id:"showtime_tip",className:"showtime_tip",style:"display:none;width: 560px; position: absolute; top: 35px; right: 0px;"},[Builder.node("div",{className:"share_tit clearfix"},[this.closeNode,Builder.node("div",{className:"citysearch"},[this.searchCityText]),this.tab]),Builder.node("div",{className:"p15"},[this.contentBox])]));this.headPanel.appendChild(Builder.node("span",{className:"currcity"},["我在："+this.userInfo.cityName]));this.headPanel.appendChild(Builder.node("i",{className:"ico_city"}));this.headPanel.parentNode.insertBefore(this.bodyPanel,this.headPanel);var c=this.tab.childNodes;for(var d=0;d<c.length;d++){Event.observe(c[d],"click",function(e){var a=e.target||e.srcElement;if(a.innerHTML!==this.order){$A(this.tab.childNodes).each(function(f){f.className=""});a.className="on";var b=a.readAttribute("_v");this.order=b;this.reload(b)}}.bind(this))}this.headPanel.style.display="block"},initializeEvent:function(){this.ononSearchCityTextFocusHandler=this.onSearchCityTextFocus.bind(this);this.onSearchCityTextBlurHandler=this.onSearchCityTextBlur.bind(this);this.onHeadPanelClickHandler=this.onHeadPanelClick.bind(this);this.onCloseHandler=this.hide.bind(this);Event.observe(this.searchCityText,"focus",this.ononSearchCityTextFocusHandler);Event.observe(this.searchCityText,"blur",this.onSearchCityTextBlurHandler);Event.observe(this.headPanel,"click",this.onHeadPanelClickHandler);Event.observe(this.closeNode,"click",this.onCloseHandler);this.onClickPageHandler=this.onClickPage.bindAsEventListener(this);Event.observe(document.body,"click",this.onClickPageHandler)},destroyEvent:function(){this.ononSearchCityTextFocusHandler&&Event.stopObserving(this.searchCityText,"focus",this.ononSearchCityTextFocusHandler);this.onSearchCityTextBlurHandler&&Event.stopObserving(this.searchCityText,"blur",this.onSearchCityTextBlurHandler);this.onHeadPanelClickHandler&&Event.stopObserving(this.headPanel,"click",this.onHeadPanelClickHandler);this.onCloseHandler&&Event.stopObserving(this.closeNode,"click",this.onCloseHandler)},destroyPanel:function(){this.closeNode=null;this.contentBox=null;this.searchCityText=null;this.tab=null;this.span=null;this.bodyPanel=null;this.headPanel=null},close:function(){this.destroyEvent();this.destroyPanel()},onClickPage:function(d){var e=Event.pointerX(d);var f=Event.pointerY(d);if(!Position.within(this.container,e,f)&&!Position.within(this.bodyPanel,e,f)){if(this.isShowing()){this.hide();this.headPanel.removeClassName("oncity")}}},getHotItems:function(){if(!this.hotItems){this.hotItems=this.items.sortBy(function(b){return -b.OTicketCinemaCount}).slice(0,40).sortBy(function(b){return -b.VisitedTimes}).collect(function(b){return b.Id})}return this.hotItems},reload:function(k){this.contentBox.update();var f=null;switch(k){case"热门":if(!this.content.HOT){this.content.HOT=this.createOptions(this.getCitys(this.items,this.getHotItems())," ",true)}this.contentBox.update(this.content.HOT);break;case"A-G":if(!this.content.AG){f=this.items.findAll(function(a){var b=/[A-G]/.test(a.initial);return b});this.content.AG=this.makeNodes(f,this.content.regRxpAG)}this.contentBox.update(this.content.AG);break;case"H-L":if(!this.content.HL){f=this.items.findAll(function(a){var b=/[H-L]/.test(a.initial);return b});this.content.HL=this.makeNodes(f,this.content.regRxpHL)}this.contentBox.update(this.content.HL);break;case"M-T":if(!this.content.MT){f=this.items.findAll(function(a){var b=/[M-T]/.test(a.initial);return b});this.content.MT=this.makeNodes(f,this.content.regRxpMT)}this.contentBox.update(this.content.MT);break;case"W-Z":if(!this.content.WZ){f=this.items.findAll(function(a){var b=/[M-Z]/.test(a.initial);return b});this.content.WZ=this.makeNodes(f,this.content.regRxpWZ)}this.contentBox.update(this.content.WZ);break;default:break}var j=this.contentBox.getElementsByTagName("li");for(var h=0,g=j.length;h<g;h++){Event.observe(j[h],"click",function(b){var a=b.target||b.srcElement;this.command(a.getAttribute("value"))}.bind(this))}},makeNodes:function(h,k){var o=new StringBuilder();for(var l=0,j=k.length;l<j;l++){var n=k[l];var m=h.findAll(function(a){return a.initial===n}).sortBy(function(a){return -a.VisitedTimes});if(m.length>0){o.append(this.createOptions(m,n))}}return o.toString()},getItems:function(){this.locations=[];this.server.getData(function(){if(typeof threaterListBoxData!=="undefined"&&threaterListBoxData.locations){this.locations=threaterListBoxData.locations.List}this.items=[];this.locations.each(function(c){var d={Id:c.Id,NameCn:c.NameCn,NameEn:c.NameEn,initial:c.NameEn.charAt(0).toLocaleUpperCase(),PinyinShort:c.PinyinShort||"",VisitedTimes:c.VisitedTimes,OTicketCinemaCount:c.OTicketCinemaCount};this.items.push(d)}.bind(this));this.reload("热门");this.cityAutoComplete=new CityAutoComplete({text:this.searchCityText,textWatermarkText:"直接输入城市或城市拼音",listRegion:this.contentBox,itemTemplate:'<li value="#{Id}"><span class="fl">#{NameEn}</span><span class="fr">#{NameCn}</span></li>',idFieldName:"Id",titleFieldName:"NameCn",searchDatas:this.items,defaultSearchDatas:this.getCitys(this.items,this.hotSearchItems),choiceCount:9,doCommand:this.command.bind(this),onEnterCallback:function(f){var h=this.contentBox.getElementsByTagName("li");for(var g=0,e=h.length;g<e;g++){if(h[g].className==="on"){this.command(h[g].getAttribute("value"));break}}}.bind(this)})}.bind(this))},createOptions:function(k,h,j){var l=Builder.node("div");var m=new StringBuilder();m.append('<div class="city_list2 clearfix">');m.append('<span class="fl w30 bold mt5">'+h+"</span>");m.append("<ul>");for(var g=0;g<k.length;g++){if(j&&g!==0&&(g%this.HOTROWSIZE===0)){m.append('</ul><span class="fl w30 bold mt5"> </span><ul>')}m.append(this.optionTemplate.evaluate(k[g]))}m.append("</ul>");m.append("</div>");return m.toString()},onSearchCityTextFocus:function(){$A(this.tab.childNodes).each(function(b){b.className=""})},onSearchCityTextBlur:function(b){this.order=null},onHeadPanelClick:function(b){b&&Event.stop(b);if(this.isShowing()){this.hide();this.headPanel.removeClassName("oncity")}else{this.show();this.headPanel.addClassName("oncity")}},isShowing:function(){return(this.bodyPanel.style.display!="none")},show:function(){this.bodyPanel.show()},hide:function(){this.bodyPanel.hide()},command:function(f){if(f!==null){setCookie("DefaultCity-CookieKey",f);var h="http://theater."+mtimeCookieDomain+"/[^/]+";var k=["/","/cinema/","/movie/","/ecoupon/","/ticket/","/card/","/movie/\\d+/","/discount/","/discount/information/","/discount/coupon/","/movie/lastday/"];var j=null;var g=k.find(function(a){var b=new RegExp(("^"+h+"("+a+")$").replace(/\//g,"\\/"));j=(location.protocol+"//"+location.host+location.pathname).match(b);return j&&j.length==2});if(!g){location.reload()}this.server.getTheaterCityHomeURL(f,function(a){if(a&&a.value){if(g){$redirect(a.value.replace(/\/$/,"")+j[1])}else{if(callbackUrl){$redirect(callbackUrl)}else{$redirect(a.value)}}}})}},getCitys:function(o,l){var m=[];for(var n=0;n<l.length;n++){var k=l[n];var j=this.getCity(o,k);if(j!==null){m.push(j)}}if(m.length<l.length){var q=l.length-m.length;for(var p=0;p<o.length;p++){if(q===0){break}if(!l.include(o[p].Id)){m.push(o[p]);q--}}}return m},getCity:function(h,e){for(var f=0,g=h.length;f<g;f++){if(e==h[f].Id){return h[f]}}return null}});var CityAutoComplete=Class.create();Object.extend(Object.extend(CityAutoComplete.prototype,AutoCompleteBase.prototype),{initialize:function(b){this.baseInitialize(b)},initializeField:function(){this.firstRender=true;this.isShowMoreResult=false;this.isAutoMatchSuggest=true},initializeDOM:function(){},destroyDOM:function(){this.listTipText=null},initializeEvent:function(){},destroyEvent:function(){},baseInitializeEvent:function(){},getEntry:function(e){this.active=false;var f=this.listRegion.getElementsByTagName("li");var d=f.length;if(d>e&&e>=0){return $(f[e])}return null},onEnterText:function(){if(this.onEnterCallback){this.onEnterCallback()}},onObserverEvent:function(){var b=this.getSearchKeyword();if(b.length>=this.minChars){if(b!=this.keyword){this.keyword=b;this.render()}}else{this.keyword="";this.active=false;this.render()}},onBlurText:function(d,c){this.active=false;this.hasFocus=false;this.removeObserver()},reset:function(){this.selectedValue=null;this.index=0;this.searchIndex=0;this.entryCount=0},onClick:function(){},onClickText:function(){},onFocusText:function(b){this.hasFocus=true;this.active=true;this.render()},match:function(c,d){if((d.PinyinShort.toLowerCase().indexOf(c.toLowerCase())===0)){return true}else{if((d.NameCn.toLowerCase().indexOf(c.toLowerCase())===0)||(d.NameEn.toLowerCase().indexOf(c.toLowerCase())===0)){return true}}return false},onKeydownText:function(b){if(this.handled){this.handled=false;return}this.handled=true;switch(b.keyCode){case Event.KEY_RETURN:this.onEnterText();Event.stop(b);return;case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:this.markPrevious();Event.stop(b);return;case Event.KEY_DOWN:this.markNext();Event.stop(b);return;default:this.addObserver();this.onChangeInput();break}},doRender:function(){if(this.isEnable){if(this.changed){this.reset()}var c=this.getSearchKeyword();if(c.length===0){this.removeObserver();this.renderDefaultList();if(Prototype.Browser.Gecko&&this.hasFocus){setTimeout(function(){var a=this.getSearchKeyword();if(a!=this.keyword){var b=this.getMoreLists();if(this.isAlwayShowList||this.entryCount>0){this.renderTip(a,this.entryCount);this.renderList(this.changed,b)}}}.bind(this),1000)}}else{var d=this.getMoreLists();if(this.isAlwayShowList||this.entryCount>0){this.renderTip(c,this.entryCount);this.renderList(this.changed,d);this.showSelectList()}else{this.hideSelectList()}}}},renderTip:function(c,d){if(this.firstRender||c===""){this.firstRender=false;this.listTipText="输入中文/拼音或按&uarr;&darr;选择"}else{if(d>0){this.listTipText=c+"，按拼音数排序"}else{this.listTipText="对不起，找不到："+c}}},renderList:function(l,o){var j='<div class="sou_window"><div class="sou_note">'+this.listTipText+'</div><div class="sou_city"><ul>'+o+"</ul></div></div>";this.listRegion.update(j);var n=this.listRegion.getElementsByTagName("li");for(var k=0,h=n.length;k<h;k++){var m=n[k];m.style.cursor="pointer";Event.observe(m,"click",function(b){var a=b.target||b.srcElement;if(a.nodeName=="SPAN"){a=a.parentNode}this.doCommand(a.getAttribute("value"))}.bind(this));Event.observe(m,"mouseover",function(b){var c=this;if(Prototype.Browser.IE){var a=b.target||b.srcElement;if(a.nodeName=="SPAN"){c=a.parentNode}else{c=a}}$A(c.parentNode.childNodes).each(function(d){d.className=""});c.className="on"});Event.observe(m,"mouseout",function(b){var c=this;if(Prototype.Browser.IE){var a=b.target||b.srcElement;if(a.nodeName=="SPAN"){c=a.parentNode}else{c=a}}c.className=""})}if(n.length>0){n[0].className="on"}}});var TopMenuNavigationMenu=Class.create();Object.extend(TopMenuNavigationMenu.prototype,{options:{menuRegion:null,contentRegion:null,onOverCallback:null,onOutCallback:null,overTimeout:1,outTimeout:100},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeEvent()},initializeField:function(){this.outMenuTimer=null;this.overMenuTimer=null},initializeEvent:function(){this.onOverMenuHandler=this.onOverMenu.bindAsEventListener(this);this.menuRegion.observe("mouseover",this.onOverMenuHandler);this.contentRegion.observe("mouseover",this.onOverMenuHandler);this.onOutMenuHandler=this.onOutMenu.bindAsEventListener(this);this.menuRegion.observe("mouseout",this.onOutMenuHandler);this.contentRegion.observe("mouseout",this.onOutMenuHandler);this.onClickMenuHandler=this.onClickMenu.bindAsEventListener(this);this.menuRegion.observe("click",this.onClickMenuHandler)},destroyEvent:function(){this.menuRegion.stopObserving("mouseover",this.onOverMenuHandler);this.menuRegion.stopObserving("mouseout",this.onOutMenuHandler);this.menuRegion.stopObserving("click",this.onClickMenuHandler)},onOverMenu:function(b){this.handleOverMenuTimer();this.handleOutMenuTimer();this.overMenuTimer=FunctionExt.defer(function(){this.onMenuOverCallback()},this.overTimeout,this)},onOutMenu:function(b){this.handleOverMenuTimer();this.handleOutMenuTimer();this.outMenuTimer=FunctionExt.defer(function(){this.onMenuOutCallback()},this.outTimeout,this)},handleOverMenuTimer:function(){if(this.overMenuTimer!==null){clearTimeout(this.overMenuTimer);this.overMenuTimer=null}},handleOutMenuTimer:function(){if(this.outMenuTimer!==null){clearTimeout(this.outMenuTimer);this.outMenuTimer=null}},onClickMenu:function(b){this.onOverMenu()},onMenuOverCallback:function(){if(!this.contentRegion.visible()){this.contentRegion.show()}if(this.onOverCallback){this.onOverCallback()}},onMenuOutCallback:function(){if(this.contentRegion.visible()){this.contentRegion.hide()}if(this.onOutCallback){this.onOutCallback()}}});var SearchAutoComplete=Class.create();Object.extend(Object.extend(SearchAutoComplete.prototype,AutoCompleteBase.prototype),{initialize:function(b){this.baseInitialize(b)},initializeField:function(){this.isAlwayShowList=false;this.isShowMoreResult=false},selectEntry:function(){this.active=false;var b=this.getCurrentEntry();this.selectedEntry(b)},getEntry:function(c){var d=null;if(c>=0){d=$(this.listRegion.childNodes[c])}return d},getOption:function(d){var f=null;var e=this.idFieldName;this.searchDatas.each(function(a){if(a[e]==d){f=a;throw $break}});return f},render:function(){if(this.getSearchDataCallback!==null){this.getSearchDataCallback(function(b){this.searchDatas=b;this.doRender()}.bind(this))}else{this.doRender()}},getMoreLists:function(){var m=this.searchDatas,l=null,j=new StringBuilder(),k=0;for(var h=0,g=m.length;h<g;h++){l=m[h];j.append(this.createListItem(l));k++;this.searchIndex=h}this.entryCount+=k;return j.toString()},renderList:function(c,d){this.listRegion.innerHTML=d},onClickText:function(){this.render()},createListItem:function(d){var c=this.itemTemplate.evaluate(d);c=c.replace("<em >被查询 0 次</em>","");return c}});var MiniCart=Class.create();Object.extend(MiniCart.prototype,{server:{getCartList:function(b){return Mtime.Component.Ajax.crossDomainCallBack(siteTradeServiceUrl,"Mtime.Trade.Pages.TradeService","GetMiniCartList",[],b,"/Service/Trade.p","get","60000")},removeCartItem:function(d,c){return Mtime.Component.Ajax.crossDomainCallBack(siteTradeServiceUrl,"Mtime.Trade.Pages.TradeService","RemoveCartItemsBySkus",[d],c,"/Service/Trade.p","get","60000")}},options:{container:null,isLogin:false},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeDOM();this.initializeEvent();this.render()},initializeDOM:function(){this.headPanel=$(this.container);var d=Builder.node("i",{className:"ico_shop"});Event.observe(d,"click",function(){window.location.href=siteTradeServiceUrl+"/cart/"});var c=Builder.node("em",{className:"emailnum",id:"emGoodsCount",style:"display:none;"},[0]);Event.observe(c,"click",function(){window.location.href=siteTradeServiceUrl+"/cart/"});this.headPanel.appendChild(d);this.headPanel.appendChild(c);if(this.isLogin){this.headPanel.removeClassName("onlyshop")}this.bodyPanel=Builder.node("div",{className:"menupop m_shopcart",style:"display:none;"});this.bodyPanel.appendChild(this.getNoDataElement());this.headPanel.appendChild(this.bodyPanel);this.headPanel.style.display="block"},initializeEvent:function(){this.navigationMenu=new TopMenuNavigationMenu({menuRegion:this.headPanel,contentRegion:this.bodyPanel,onOverCallback:this.onHeadPanelOver.bind(this),onOutCallback:this.onHeadPanelOut.bind(this)})},render:function(){this.server.getCartList(function(h){if(h&&h.value){var f=0;var g=0;this.clearBodyPanel();this.goodsListPanel=Builder.node("ul");$A(h.value).each(function(c){var k=c.salePrice;var a=c.buyCount;if(f<3){var b=Builder.node("a",{href:"javascript:void(0)"},["删除"]);Event.observe(b,"click",function(){headTrackClick("M14_HeadNav_MiniCart_DeleteBtn");this.server.removeCartItem(c.sku,function(j){if(j&&j.value&&j.value.success){this.render()}}.bind(this))}.bind(this));var d=Builder.node("li",{className:"clearfix"},[Builder.node("div",{className:"shop_pic fl"},[Builder.node("a",{href:c.detailUrl,target:"_blank",onclick:"headTrackClick('M14_HeadNav_MiniCart_GoodsPic')"},[Builder.node("img",{src:c.imageUrl})])]),Builder.node("dl",{className:"shop_txt fl"},[Builder.node("dt",[Builder.node("a",{href:c.detailUrl,target:"_blank",onclick:"headTrackClick('M14_HeadNav_MiniCart_GoodsTitle')"},[c.title])]),Builder.node("dd",[c.saleProperty])]),Builder.node("dl",{className:"shop_price fl"},[Builder.node("dt",["￥"+(k/100)]),Builder.node("dd",[b])])]);this.goodsListPanel.appendChild(d)}f++;g+=(k*a)}.bind(this));if(f>0){$("emGoodsCount").innerHTML=f;$("emGoodsCount").show()}else{$("emGoodsCount").hide()}if(f>0){var e=Builder.node("div",{className:"shop_btns"},[Builder.node("a",{className:"shoplink",href:siteTradeServiceUrl+"/cart/",onclick:"headTrackClick('M14_HeadNav_MiniCart_GoToCartBtn')"},["去购物车结算"]),Builder.node("dl",[Builder.node("dt").update("共<span>"+f+"</span>件商品"),Builder.node("dd").update("合计：<span>￥"+g/100+"</span>")])]);this.bodyPanel.appendChild(this.goodsListPanel);this.bodyPanel.appendChild(e)}else{this.bodyPanel.appendChild(this.getNoDataElement())}}}.bind(this))},destroyEvent:function(){this.onHeadPanelOverHandler&&Event.stopObserving(this.headPanel,"mouseover",this.onHeadPanelOverHandler);this.onHeadPanelOutHandler&&Event.stopObserving(this.headPanel,"mouseout",this.onHeadPanelOutHandler)},destroyPanel:function(){this.goodsListPanel=null;this.bodyPanel=null;this.headPanel=null},close:function(){this.destroyEvent();this.destroyPanel()},getNoDataElement:function(){return Builder.node("p",{className:"tips"},["您的购物车还是空的，赶快选购哦。"])},clearBodyPanel:function(){this.bodyPanel.update("")},onHeadPanelOver:function(b){if(!this.headPanel.hasClassName("currshop")){this.headPanel.addClassName("currshop")}},onHeadPanelOut:function(b){if(this.headPanel.hasClassName("currshop")){this.headPanel.removeClassName("currshop")}}});var headTrackClick=function(c){var d="M14_HeadNav";if(typeof tracker!="undefined"){tracker.trackClick(d,c)}};var topMenu=null;var manager=null;function initializeManager(b){topMenu=new TopMenu(b)}function reinitializeManager(){topMenu.close();topMenu.initializeUser()}var StaticManager=Class.create();StaticManager.prototype={options:{mainNavigaionType:-1,subNavigaionType:-1,isMini:false,isChannelFooter:false,is2011MiniFooter:false,showTopSearch:true,showTopSearchInChannel:false},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},server:{createSubscriber:function(d,c){return Mtime.Component.Ajax.request(siteChannelServiceUrl,"Mtime.Channel.Pages.DatabaseService","CreateSubscriber",[d],c,"/service/Database.mcs","get","20000")}},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.initializeEvent();this.load();this.render()},initializeField:function(){},initializeDOM:function(){this.topRegion=$("top");this.bottomRegion=$("bottom")},destroyDOM:function(){this.topRegion=null;this.bottomRegion=null;this.iptEMail=this.btnSubscribe=null},initializeEvent:function(){Event.observe(window,"unload",this.close.bind(this))},destroyEvent:function(){if(this.btnSubscribe){this.btnSubscribe.stopObserving("click",this.onClickBtnSubscribeHandler)}if(this.iptEMailTextbox){this.iptEMailTextbox.close()}},load:function(){if(document.documentElement.clientWidth<=1024){$(document.documentElement).addClassName("scroll1024")}},render:function(){this.renderManager();this.renderHeader();this.renderNavigatorBar();this.renderFooter()},renderHeader:function(){},renderManager:function(){if(typeof initializeManager!=="function"){$loadJs("/js/2014/topmenu.js",function(){initializeManager({})}.bind(this))}else{initializeManager({})}},renderNavigatorBar:function(){},renderFooter:function(){if(this.bottomRegion){if(this.isMini){this.renderMiniFooter()}else{this.renderMtimeFooter()}}},renderMtimeFooter:function(){var b=['<div class="footout">','<span class="topline"></span>','<div class="footinner clearfix">','<div class="fotlogo">',"<dl>",'<dt><a href="http://www.mtime.com" title="Mtime时光网">Mtime时光网</a></dt>','<dd class="clearfix"><a href="http://jobs.mtime.com/">加入我们</a><a href="http://feature.mtime.com/help/contact.htm" class="ml30">联系我们</a></dd>','<dd class="clearfix"><a href="http://group.mtime.com/help/">站务论坛</a><a href="http://my.mtime.com/reportError/" class="ml30">问题反馈</a></dd>','<dd class="clearfix"><a href="http://feature.mtime.com/help/rules.htm">社区准则</a><a href="http://www.mtime.com/sitemap.htm" class="ml30">网站地图</a></dd>',"</dl>",'<i class="line"></i>',"</div>",'<div class="fotmap">','<dl style="width:42px;">',"<dt>栏目</dt>",'<dd><a href="http://www.mtime.com">首页</a></dd>','<dd><a href="http://news.mtime.com/">新闻</a></dd>','<dd><a href="http://theater.mtime.com/">影院</a></dd>','<dd><a href="http://www.mtime.com/community/">社区</a></dd>',"</dl>",'<dl style="width:185px;">',"<dt>推荐</dt>",'<dd><a href="http://www.mtime.com/top/movie/top100/">电影热榜</a><a href="http://movie.mtime.com/new/" class="ml30">全球新片</a></dd>','<dd><a href="http://news.mtime.com/conversation/">时光对话</a><a href="http://movie.mtime.com/classic/" class="ml30">典藏佳片</a></dd>','<dd><a href="http://video.mtime.com/trailer/">新片预告</a><a href="http://award.mtime.com/all/" class="ml30">电影节</a></dd>','<dd><a href="http://www.mtime.com/weekly/">时光周刊</a><a href=" http://my.mtime.com/app/card/" class="ml30">卡片大富翁</a></dd>',"</dl>","<dl>","<dt>关注我们</dt>",'<dd><a href="http://weibo.com/movietime?topnav=1&wvr=5&topsug=1" target="_blank" class="sina" title="新浪">新浪</a></dd>','<dd><a id="aWeiXinPicButton" href="javascript:void(0)" class="weixin" title="微信">微信</a></dd>','<dd><a href="http://www.mtime.com/rss/" target="_blank" class="rss" title="RSS">RSS</a></dd>',"</dl>",'<i class="line"></i>','<div id="divWeiXinPicContainer" class="my_layer none"> <em class="l_arrow">&nbsp;</em>','<div class="inner p15" style="width:195px;">',"<i></i>","<p>扫描二维码，微信实时关注时光网</p>","</div>","</div>","</div>",'<div class="fotweek">',"<dl>",(window.topMenuValues&&window.topMenuValues.footer)?topMenuValues.footer:"",'<dd class="input"><input id="iptEMail" type="text" value="邮箱地址" class="c_a5" /><a id="btnSubscribe" href="javascript:void(0)">订阅</a></dd>',"</dl>","</div>",'<div class="fothr">',"<dl>","<dt><strong>手机购票</strong> 方便 实惠</dt>",'<dd><a href="http://feature.mtime.com/mobile/" target="_blank"><i></i></a></dd>',"<dd>扫描二维码 下载客户端</dd>","</dl>","</div>","</div>","</div>"].concat(this.getMiniFooterHTMLArray());this.bottomRegion.innerHTML=b.join("");this.iptEMail=$("iptEMail");this.btnSubscribe=$("btnSubscribe");this.iptEMailTextbox=new Textbox({text:this.iptEMail,watermarkText:"邮箱地址",onKeypressCallback:this.onEnter.bind(this)});this.onClickBtnSubscribeHandler=this.orderWeekly.bindAsEventListener(this);this.btnSubscribe.observe("click",this.onClickBtnSubscribeHandler);this.aWeiXinPicButton=$("aWeiXinPicButton");this.divWeiXinPicContainer=$("divWeiXinPicContainer");this.divWeiXinPicContainer.hide();this.divWeiXinPicContainer.removeClassName("none");this.onWeiXinPicButtonHandler=this.clickWeiXinPicButton.bindAsEventListener(this);this.aWeiXinPicButton.observe("click",this.onWeiXinPicButtonHandler);this.onClickPageHandler=this.onClickPage.bindAsEventListener(this);Event.observe(document.body,"click",this.onClickPageHandler)},renderMiniFooter:function(){this.bottomRegion.innerHTML=this.getMiniFooterHTMLArray().join("")},getMiniFooterHTMLArray:function(){var b=['<div class="db_foot">',"<p>",'<span class="mr12">北京动艺时光网络科技有限公司</span>Copyright 2006-',new Date().getFullYear()," Mtime.com Inc. All rights reserved.<br>",'<a href="http://feature.mtime.com/help/icp.htm" target="_blank" class="mr12 ml12">京ICP证050715号</a> ','<a href="http://feature.mtime.com/help/videolicence.htm" target="_blank" class="mr12">网络视听许可证0108265号</a>','<a href="http://feature.mtime.com/help/network.htm" target="_blank" class="mr12">网络文化经营许可证</a>','<a href="http://feature.mtime.com/help/tvlicence.htm" target="_blank" class="mr12">广播电视节目制作经营许可证(京)字第1435号</a>',"<span>京公网安备：110105000744号</span>","</p>",'<div class="credible"><a href="http://feature.mtime.com/help/credible.htm" target="_blank" title="可信网站" class="credibler"></a><a href="http://feature.mtime.com/help/goodfaith.htm" target="_blank" title="诚信网站" class="goodfaith"></a></div>',"</div>"];return b},orderWeekly:function(){var b=$F(this.iptEMail);b=b.trim();if(b.length>0){if(!Validator.validateEmail(b)){$alert("请输入合法的邮箱地址！");this.iptEMail.focus();return}else{this.server.createSubscriber(b,this.onCreateSubScriberCallBack.bind(this))}}},onCreateSubScriberCallBack:function(){var b=orderResult;if(b&&b.value&&b.value.success){$alert("您已成功订阅周刊，您的邮箱将会定期收到最新一期的周刊。");this.iptEMail.value="请输入邮箱地址"}else{$alert("订阅周刊失败，请重试或联系管理员。")}},onEnter:function(b){switch(b.keyCode){case Event.KEY_RETURN:this.orderWeekly();Event.stop(b);break;default:break}},clickWeiXinPicButton:function(b){this.divWeiXinPicContainer.show()},onClickPage:function(d){var e=Event.pointerX(d);var f=Event.pointerY(d);if(!Position.within(this.divWeiXinPicContainer,e,f)&&!Position.within(this.aWeiXinPicButton,e,f)){if(this.divWeiXinPicContainer.visible()){this.divWeiXinPicContainer.hide()}}},closed:false,close:function(){if(!this.closed){this.closed=true;this.destroyEvent();this.destroyDOM()}}};function f_navigationBarSearch(){var d=$("navSearchValueInput").value.Trim();var c=$F("navSearchTypeSelect");if(d!==""){window.open("/search/"+(c=="all"?"":c)+"?"+encodeURI(d),"_blank")}}var Card=Class.create();Object.extend(Object.extend(Card.prototype),{information:{},followBool:false,options:{mytimeContentRegion:"",loadTemplate:'<div class="inner w270" style="min-height:120px;"><span class="load48"></span></div>',leftCardTemplate:"",callback:null},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeDOM();this.load();this.initializeEvent()},initializeDOM:function(){this.mytimeContentRegion=$(this.mytimeContentRegion);this.collectBoxTimeout=null;cardFollowBool=false},destroyDOM:function(){this.mytimeContentRegion=null;this.collectBoxId=null;cardFollowBool=null},initializeEvent:function(){if(this.mytimeContentRegion){this.onOverHandler=this.onOver.bind(this);this.mytimeContentRegion.observe("mouseover",this.onOverHandler);this.onOutHandler=this.onOut.bind(this);this.mytimeContentRegion.observe("mouseout",this.onOutHandler)}Event.observe(window,"unload",this.close.bind(this))},destroyEvent:function(){if(this.mytimeContentRegion){this.mytimeContentRegion.stopObserving("mouseover",this.onOverHandler);this.mytimeContentRegion.stopObserving("mouseout",this.onOutHandler)}},load:function(){},render:function(){},onOver:function(e){var d=Event.element(e),f;this.method=d.getAttribute("method");this.cardElement=d;if(!this.method){f=d.up();this.method=f.getAttribute("method");this.cardElement=f}if(this.method){this.clientx=e.clientX;this.clienty=e.clientY;switch(this.method){case"usercard":this.userMethod(this.method);break;case"useridcard":this.userMethod(this.method);break;case"personcard":this.personMethod(this.method);break;case"personidcard":this.personMethod(this.method);break;case"moviecard":this.movieMethod(this.method);break;case"movieidcard":this.movieMethod(this.method);break;case"badgecard":this.badgeMethod(this.method);break;case"moviecard-left":this.movieMethod(this.method);break;case"tvcard":this.movieMethod(this.method);break}}d=f=null},builderHtml:function(b){this.overMy_leftMethod(this.cardElement,b)},userMethod:function(b){this.handleOutTimer();this.collectBoxTimeout=FunctionExt.defer(function(){var a;if(b==="usercard"){a=this.cardElement.readAttribute("ftwitterid")}else{if(b==="useridcard"){a=this.cardElement.readAttribute("userid")}}this.twitterId=a;this.key=b+a;this.cardElement.makePositioned();this.overMy_leftMethod(this.cardElement,this.loadTemplate);new UserLayerControl({id:this.twitterId,callback:this.builderHtml.bind(this)})},500,this)},movieMethod:function(b){this.handleOutTimer();this.collectBoxTimeout=FunctionExt.defer(function(){var a;if(b==="moviecard"){a=this.cardElement.readAttribute("ftwitterid")}else{if(b==="movieidcard"||b==="moviecard-left"){a=this.cardElement.readAttribute("movieid")}else{if(b==="tvcard"){a=this.cardElement.readAttribute("tvid")}}}this.twitterId=a;this.key=b+a;this.cardElement.makePositioned();this.overMy_leftMethod(this.cardElement,this.loadTemplate);if(b==="moviecard-left"){var d=this.cardElement.readAttribute("layerpan");new MovieLayerControl({id:this.twitterId,pagetype:1,callback:this.builderHtml.bind(this),pan:d?d:""})}else{if(b==="tvcard"){new TvLayerControl({id:this.twitterId,pagetype:1,callback:this.builderHtml.bind(this)})}else{new MovieLayerControl({id:this.twitterId,callback:this.builderHtml.bind(this)})}}},500,this)},personMethod:function(b){this.handleOutTimer();this.collectBoxTimeout=FunctionExt.defer(function(){var a;if(b==="personcard"){a=this.cardElement.readAttribute("ftwitterid")}else{if(b==="personidcard"){a=this.cardElement.readAttribute("personid")}}this.twitterId=a;var d=b+a;this.cardElement.makePositioned();this.overMy_leftMethod(this.cardElement,this.loadTemplate);new PersonLayerControl({id:this.twitterId,callback:this.builderHtml.bind(this)})},500,this)},badgeMethod:function(b){this.handleOutTimer();this.collectBoxTimeout=FunctionExt.defer(function(){var f=this.cardElement.readAttribute("userid");var e=this.cardElement.readAttribute("medaltype");var a=b+e;this.cardElement.makePositioned();if(this.information[a]===undefined){this.overMy_leftMethod(this.cardElement,this.loadTemplate);this.server.GetBadgeLayerInfo(f,e,function(d){if(d&&d.value){var c=d.value.value;this.information[a]=c;this.overMy_leftMethod(this.cardElement,c)}}.bind(this))}else{this.overMy_leftMethod(this.cardElement,this.information[a])}},500,this)},onOut:function(f){var e=Event.element(f),h;var g=e.getAttribute("method");if(!g){h=e.up();g=h.getAttribute("method")}if(g==="usercard"||g==="moviecard"||g==="personcard"||g==="useridcard"||g==="movieidcard"||g==="personidcard"||g==="badgecard"||g==="moviecard-left"||g==="tvcard"){this.handleOutTimer();if(this.collectBox!=null){this.collectBoxTimeout=FunctionExt.defer(function(){if(cardFollowBool==false){this.closeCard()}},500,this)}}e=h=g=null},timedCount:function(){if(this.isChanger){this.contentEnd=$("contentEnd");if(this.contentEnd){this.movieRating=this.contentEnd.down(".w330");if(this.movieRating){setTimeout(function(){this.timedCount()}.bind(this),1000)}else{if(this.collectBox!=null){this.closeCard();cardFollowBool=false}this.isChanger=false}}}else{setTimeout(function(){this.timedCount()}.bind(this),1000);this.isChanger=true}},closeCardIeMethod:function(){if(Mtime.browser.ie&&Mtime.browser.ie<7&&this.collectBox!=null){this.closeCard()}},overMy_leftMethod:function(c,d){if(this.collectBox!=null){this.closeCard()}this.isAutoClose=true;if(this.method==="moviecard"||this.method==="movieidcard"){this.isAutoClose=false}if(this.method!=="moviecard-left"&&this.method!=="tvcard"){this.collectBox=new DialogBox({element:c,content:d,arrowNew:true,isAutoClose:this.isAutoClose,setupDimensions:function(){var y=0,A=0;var C=this.windowElement.getDimensions();var D=C.width;var B=C.height;var w=this.elementX+this.elementWidth/2;var x=this.elementY;var t=w;var u=x+this.elementHeight;if(this.arrowNew){var b=this.cardId.down("em."+this.indicationStyle)}else{var b=this.cardId.down("p."+this.indicationStyle)}var a;if(b===undefined||b===null){a=17}else{a=b.getHeight()}switch(this.positionType){case 0:y=t-47;A=u+a;break;case 1:y=t-(D-47);A=u+a;break;case 2:y=w-47;A=x-a-B;break;case 3:y=w-(D-47);A=x-a-B;break;default:y=t-47;A=u+a;break}var E=0;if(this.overlay){E=parseInt(this.overlay.getStyle("zIndex"),10)+1}else{E=Windows.getZIndex()+1}if(Mtime.browser.ie&&Mtime.browser.ie>=7){var s=this.element.getHeight();var v=this.element.getStyle("fontSize");var z=parseInt(v.slice(0,2),10);if(this.element.innerHTML!==""&&s>z+10){y=200}}this.windowElement.setStyle({position:"absolute",top:A+"px",left:y+"px",zIndex:E})}});this.collectBoxId=$(this.collectBox.id);this.isWordWrap(c)}else{this.collectBox=new LeftCardControl({element:c,content:d});this.collectBoxId=$(this.collectBox.id)}if(this.collectBoxId){if(d==""){this.collectBoxId.down("em",0).className=""}this.overCollectBoxIdHandler=this.overCollectBox.bind(this);this.outCollectBoxIdHandler=this.outCollectBox.bind(this);this.collectBoxId.observe("mouseover",this.overCollectBoxIdHandler);this.collectBoxId.observe("mouseout",this.outCollectBoxIdHandler)}},overCollectBox:function(b){Event.stop(b);this.handleOutTimer()},outCollectBox:function(b){Event.stop(b);this.collectBoxTimeout=FunctionExt.defer(function(){if(cardFollowBool==false){this.closeCard()}},500,this)},handleOutTimer:function(){if(this.collectBoxTimeout!=null){clearTimeout(this.collectBoxTimeout);this.collectBoxTimeout=null;this.collectBoxId=null}},isWordWrap:function(B){var C=B.getHeight();var H=B.getStyle("fontSize");var R=parseInt(H.slice(0,2),10);if(B.innerHTML!==""&&C>R+10){var O=B.up(0);var Q=O.getWidth();var D=B.getWidth();var P=Position.cumulativeOffset(O);var J=Position.cumulativeOffset(B);var E=Q-(this.collectBox.elementX-P[0]);var A;var M;var L;var G;var z=this.collectBoxId.down("em",0);if(this.collectBox.elementX<=this.clientx){A=Math.round(E/2);M=this.collectBox.elementX;L=J[1];G=L+C/2}else{var I=B.innerHTML.length;var S=(R*I-E)+(Q-D);A=20;M=P[0];L=J[1]+C/2+5;G=this.collectBox.elementY+this.collectBox.elementHeight;if(this.collectBox.positionType===1){this.collectBox.positionType=0;if(z!==undefined||z!==null){z.className="tl_arrow"}}if(this.collectBox.positionType===3){this.collectBox.positionType=2;if(z!==undefined||z!==null){z.className="bl_arrow"}}}var N=0,T=0;var V=this.collectBoxId.getDimensions();var W=V.width;var U=V.height;var K=M+A;var F=K;if(z!==undefined||z!==null){arrowHeight=z.getHeight()}else{arrowHeight=10}switch(this.collectBox.positionType){case 0:N=F-67;T=G+arrowHeight;break;case 1:N=F-(W-47);T=G+arrowHeight;break;case 2:N=K-67;T=L-arrowHeight-U;break;case 3:N=K-(W-47);T=L-arrowHeight-U;break;default:N=F-67;T=G+arrowHeight;break}this.collectBoxId.setStyle({top:T+"px",left:N+"px"})}},closeCard:function(){if(this.collectBoxId){this.collectBoxId.stopObserving("mouseover",this.overCollectBoxIdHandler);this.collectBoxId.stopObserving("mouseout",this.outCollectBoxIdHandler)}this.collectBoxId=null;this.collectBox.close()},closed:false,close:function(){if(!this.closed){this.closed=true;this.destroyEvent();this.destroyDOM();this.information=null}}});var LeftCardControl=Class.create();Object.extend(LeftCardControl.prototype,{options:{element:null,content:"",closed:false},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.builderLeftCard(this.element,this.content)},builderLeftCard:function(u,v){if(!u){return}var A=u.readAttribute("method");if(A=="tvcard"){u=u.up("dd")}var y=this.getXY(u),s=document.documentElement.clientWidth||document.body.clientWidth,x=u.getWidth(),w=u.getHeight(),B=(s/2)>=y.x?0:1,r=y.y+Math.round(w/2)-60,z=B==1?"r_arrow":"l_arrow",q=B==1?y.x-291:y.x+x+20,C=new Date().getTime();if(A=="tvcard"){q=B==1?y.x-285:y.x+x+14}this.id="dialogBox_"+C;this.windowElement=$(Builder.node("div",{id:this.id,className:"my_layer",style:"top:"+r+"px;left:"+q+"px"},[Builder.node("em",{className:z},[" "]),typeof v=="string"?Builder.build(v):v]));var t=this.getContainer();t.appendChild(this.windowElement);var p=this.windowElement.getHeight();r=y.y+Math.round(w/2)-Math.round(p/2);this.windowElement.style.top=r+"px"},getContainer:function(){var b=$("contentEnd");if(typeof b==="undefined"||b===null){b=document.getElementsByTagName("body")[0]}return b},destroyWindowElement:function(){if(this.windowElement!==null){var b=this.getContainer();b.removeChild(this.windowElement);this.windowElement=null;this.content=null;this.element=null}},getXY:function(h){var j=0,k=0;if(h.getBoundingClientRect){var a=h.getBoundingClientRect();var b=document.documentElement;j=Math.round(a.left+Math.max(b.scrollLeft,document.body.scrollLeft)-b.clientLeft);k=Math.round(a.top+Math.max(b.scrollTop,document.body.scrollTop)-b.clientTop)}else{for(;h!=document.body;j+=h.offsetLeft,k+=h.offsetTop,h=h.offsetParent){}}return{x:j,y:k}},close:function(){if(!this.closed){this.destroyWindowElement()}}});var MovieLayerControl=Class.create();Object.extend(Object.extend(MovieLayerControl.prototype),{Server:{GetMovieLayerInfoByMovieId:function(d,c){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","GetMovieLayerInfoByMovieId",[d],c,"/Community.api","get","20000")}},options:{id:0,pagetype:0,callback:null,pan:""},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeEvent();this.load()},initializeField:function(){},initializeEvent:function(){Event.observe(window,"unload",this.close.bind(this))},close:function(){movieCache=null},load:function(){if(this.id>0){if(typeof movieCache=="undefined"){movieCache={}}if(movieCache[this.id+"_"+this.pagetype]){this.callback&&this.callback(movieCache[this.id+"_"+this.pagetype])}else{this.Server.GetMovieLayerInfoByMovieId(this.id,function(b){if(b&&b.value){movieCache[this.id+"_"+this.pagetype]=this.render(b.value);this.callback&&this.callback(this.render(b.value))}else{this.callback&&this.callback("")}}.bind(this))}}},render:function(e){var d=new StringBuilder();if(this.pagetype==0){d.append('<div class="inner w340">')}else{if(this.pagetype==1){d.append('<div class="inner w270">')}else{}}if(e.movielabel&&e.movielabel!=""){if(this.pagetype==0){d.append(String.format('<i class="ico_thefilm">{0}</i>',e.movielabel))}}if(this.options.pan){d.append('<div class="minfo __r_c_" pan="').append(this.options.pan).append('">')}else{d.append('<div class="minfo">')}if(this.pagetype==0){d.append('<div class="moviepic clearfix">');d.append(String.format('<a href="{0}" class="pic" target="_blank"><img src="{1}" width="96" height="128"></a>',e.moviepage,e.cover))}d.append('<div class="infomovie">');d.append(String.format('<h2><a href="{0}" target="_blank">{1} {2}</a>',e.moviepage,e.titlecn,e.year));if(e.ratingfinal&&e.ratingfinal>0){d.append(String.format('<em class="score">{0}</em>',e.ratingfinal))}d.append("</h2>");if(e.titleen!=""){d.append(String.format("<h3>{0}</h3>",e.titleen))}if(e.runtime==""||e.propertys==""){d.append(String.format('<p class="infocolor">{0}{1}</p>',e.runtime,e.propertys))}else{d.append(String.format('<p class="infocolor">{0} - {1}</p>',e.runtime,e.propertys))}if(this.pagetype==0){if(typeof e.showtimecount!="undefined"&&e.showtimecount>0){d.append(String.format("<p>{0}</p>",e.releasedate));d.append(String.format('<p><a href="{0}" target="_blank">{1}家影院上映{2}场</a><span class="song slink">&gt;</span></p>',e.movieshowtimepage,e.cinemacount,e.showtimecount))}else{if(e.director!=""){d.append(String.format('<p class="infocolor">导演：{0}</p>',e.director))}if(e.actor1!=""||e.actor2!=""){d.append(String.format('<p class="infocolor">主演：{0} {1}</p>',e.actor1,e.actor2))}}}else{if(this.pagetype==1){var f=(typeof e.cinemacount=="undefined"||e.cinemacount<=0)?"":String.format("{0}家影院",e.cinemacount);f+=((typeof e.showtimecount=="undefined"||e.showtimecount<=0)?"":String.format("上映{0}场",e.showtimecount));if(e.releasedate==""||typeof e.showtimecount=="undefined"||e.showtimecount<=0){d.append(String.format("<p>{0}{1}</p>",e.releasedate,f))}else{d.append(String.format("<p>{0} - {1}</p>",e.releasedate,f))}}else{}}if(this.pagetype==0){}else{if(this.pagetype==1){if(e.comments!=""){d.append(String.format('<p class="txtinfo"><i class="ico_quot">&nbsp;</i>{0}</p>',e.comments))}}else{}}d.append("</div>");if(this.pagetype==0){d.append("</div>")}if(typeof e.btntext!="undefined"&&e.btntext!=""){d.append('<div class="mticket">');d.append(String.format('<a href="{0}" target="_blank" class="bm_ticket">{1}</a>',e.movieshowtimepage,e.btntext));if(typeof e.onlineticketcount!="undefined"&&e.onlineticketcount>0){d.append(String.format(" <b>{0}</b> 元起",e.lowestprice))}d.append("</div>")}d.append("</div></div>");return d.toString()}});var TvLayerControl=Class.create();Object.extend(Object.extend(TvLayerControl.prototype),{Server:{GetTvLayerInfoByTvId:function(d,c){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","GetTvLayerInfoByTvId",[d],c,"/Community.api","get","20000")}},options:{id:0,pagetype:1,callback:null},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeEvent();this.load()},initializeField:function(){},initializeEvent:function(){Event.observe(window,"unload",this.close.bind(this))},close:function(){tvCache=null},load:function(){if(this.id>0){if(typeof tvCache=="undefined"){tvCache={}}if(tvCache[this.id+"_"+this.pagetype]){this.callback&&this.callback(tvCache[this.id+"_"+this.pagetype])}else{this.Server.GetTvLayerInfoByTvId(this.id,function(b){if(b&&b.value){tvCache[this.id+"_"+this.pagetype]=this.render(b.value);this.callback&&this.callback(this.render(b.value))}else{this.callback&&this.callback("")}}.bind(this))}}},render:function(B){var s=new StringBuilder();if(this.pagetype==0){s.append('<div class="inner w340">')}else{if(this.pagetype==1){s.append('<div class="inner w270">')}else{}}if(B===null){return}s.append('<div class="tostar">');if(B.actors.length!=0){s.append('<div class="starbox"><h2>主演：</h2>');var p=B.actors;for(var t=0;t<p.length;t++){var q=p[t].alt;var r=p[t].cover;var u=p[t].nameCn;var v=p[t].nameEn;var w=p[t].roleDesc;var y=p[t].roleImage;var A=p[t].roleUrl;var C=p[t].url;var x="";if(w.length>0){if(A.length>0){x=String.format('  <p>饰&nbsp;<a href="{0}" target="_self">{1}</a></p>',A,w)}else{x=String.format("  <p>饰&nbsp;{0}</p>",w)}}var z="";if(y.length>0){if(A.length>0){z=String.format('<a href="{0}" target="_self" title="{1}"><img src="{2}" width="50" height="50" alt="{1}" class="cha" /></a>',A,w,y)}else{z=String.format('<img src="{0}" width="50" height="50" alt="{1}" class="cha" />',y,w)}}s.append(String.format('<dl class="main_actor"><dd>   <a href="{4}" target="_blank" title="{2} {3}"><img src="{1}" width="50" height="50" alt="{0}" class="per"></a>'+(u.length>0?'  <p> <a href="{4}" target="_blank" rel="v:starring">{2}</a> </p>':"")+(v.length>0?'  <p><a href="{4}" target="_blank" rel="v:starring">{3}</a></p>':"")+x+z+"</dd></dl>",q,r,u,v,C))}s.append(String.format('<p class="tr mt15 px12"><a href="{0}">更多<i class="gt"></i></a></p>',B.moreUrl))}else{s.append('<div class="plot"><h2>剧情：</h2>');s.append(String.format('<p class="txtinfo">{0}</p><p class="tr mt15 px12"><a href="{1}">更多<i class="gt"></i></a></p>',B.plot,B.moreUrl))}s.append("</div></div>");return s.toString()}});var PersonLayerControl=Class.create();Object.extend(Object.extend(PersonLayerControl.prototype),{Server:{GetPersonLayerInfoByPersonId:function(d,c){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","GetPersonLayerInfoByPersonId",[d],c,"/Community.api","get","20000")}},options:{id:0,callback:null},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeEvent();this.load()},initializeField:function(){},initializeEvent:function(){Event.observe(window,"unload",this.close.bind(this))},close:function(){personCache=null},load:function(){if(this.id>0){if(typeof personCache=="undefined"){personCache={}}if(personCache[this.id]){this.callback&&this.callback(personCache[this.id])}else{this.Server.GetPersonLayerInfoByPersonId(this.id,function(b){if(b&&b.value){personCache[this.id]=this.render(b.value);this.callback&&this.callback(this.render(b.value))}else{this.callback&&this.callback("")}}.bind(this))}}},render:function(d){var c=new StringBuilder();c.append('<div class="inner w340">');c.append('<div class="minfo mpeople">');c.append('<div class="moviepic clearfix">');if(d.cover!=""){c.append(String.format('<a href="{0}" class="pic" target="_blank"><img src="{1}" width="96" height="128"></a>',d.personpage,d.cover))}c.append('<div class="infomovie">');c.append("<h2>");if(d.namecn!=""){c.append(String.format('<a href="{0}" target="_blank">{1}</a>',d.personpage,d.namecn))}if(d.ratingfinal!=""&&d.ratingfinal>0){c.append(String.format('<em class="like"><i class="ico_like">&nbsp;</i>{0}%</em>',d.ratingfinal*10))}c.append("</h2>");if(d.nameen!=""){c.append(String.format("<h3>{0}</h3>",d.nameen))}if(d.sex==""||d.constellation==""){c.append(String.format('<p class="infocolor">{0}{1}</p>',d.sex,d.constellation))}else{c.append(String.format('<p class="infocolor">{0}， {1}</p>',d.sex,d.constellation))}if(d.job!=""){c.append(String.format('<p class="infocolor">职业：{0}</p>',d.job))}c.append("</div>");c.append("</div>");if(typeof d.movietitle!="undefined"){c.append(String.format('<div class="mticket link_thefilm "><a href="{0}" target="_blank">{1}：{2}</a><span class="song slink">&gt;</span></div>',d.movieshowtimepage,d.movielabel,d.movietitle))}c.append("</div>");return c.toString()}});var UserLayerControl=Class.create();Object.extend(Object.extend(UserLayerControl.prototype),{Server:{GetUserLayerInfoByUserId:function(d,c){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","GetUserLayerInfoByUserId",[d],c,"/Community.api","get","20000")}},options:{id:0,callback:null},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeDOM();this.initializeField();this.initializeEvent();this.load()},initializeDOM:function(){if(typeof cardIsLogin==="undefined"){cardIsLogin=false}},initializeField:function(){},destroyDOM:function(){this.userLayerRegion=null;userCache=null;cardIsLogin=null},initializeEvent:function(){Event.observe(window,"unload",this.close.bind(this))},destroyEvent:function(){this.userLayerRegion&&this.userLayerRegion.stopObserving("click",this.clickControlHandler)},load:function(){if(this.id>0){if(typeof(Follow)=="undefined"){$loadJs("/js/2014/Follow.js")}if(typeof userCache=="undefined"){userCache={}}if(userCache[this.id]){this.callback&&this.callback(userCache[this.id]);this.initEvent()}else{this.Server.GetUserLayerInfoByUserId(this.id,function(d){if(d&&d.value){cardIsLogin=d.value.islogin;var c=this.render(d.value);userCache[this.id]=c;this.callback&&this.callback(c);this.initEvent()}else{this.callback&&this.callback("")}}.bind(this))}}},render:function(h){var e=new StringBuilder();e.append('<div id="userLayerRegion" class="inner w340">');e.append('<div class="minfo">');e.append('<div class="moviepic clearfix peoppic">');e.append(String.format('<a href="{0}" class="pic" target="_blank"><img src="{1}" width="70" height="70"></a>',h.mytimepage,h.cover));e.append('<div class="infomovie">');e.append(String.format('<h2><a href="{0}" target="_blank">{1}</a> </h2>',h.mytimepage,h.nickname));e.append(String.format('<p class="infocolor">{0}  {1}</p>',h.address,h.sex));e.append(String.format('<p class="glink">关注<a href="#" target="_blank">{0}</a>粉丝<a href="#" target="_blank">{1}</a>微评<a href="#" target="_blank">{2}</a></p>',h.followcount,h.fanscount,h.tweetcount));e.append("</div>");e.append("</div>");e.append('<div class="movietip">');if(h.intro!=""){e.append(String.format("<p>简介：{0}</p>",h.intro))}if(typeof h.movies!="undefined"&&h.movies.length>0){e.append("<p>最近看过：");for(var f=0;f<h.movies.length;f++){var g=h.movies[f];e.append("《");e.append(g.moviename);e.append("》")}e.append("</p>")}e.append("</div>");if(h.twitterid>0){e.append('<div class="mticket">');if(h.relation==0||h.relation==1){e.append(String.format('<a href="#" method="cFollow" ftwitterid="{0}" nickname="{1}" target="_blank" class="bm_ticket" onclick="return false;">+ 加关注</a><span method="at" nickname="{1}" class="mtxt">@TA</span>',h.twitterid,h.nickname))}else{if(h.relation==2){e.append(String.format('<b class="bm_ticket not_bm_ticket"><i>√</i>已关注<span><a atype="a" method="aFollow" ftwitterid="{0}" nickname="{1}" href="#" target="_blank" onclick="return false;">取消</a></span></b>',h.twitterid,h.nickname));e.append(String.format('<span class="mtxt"><a method="message" nickname="{1}" href="#" target="_blank" onclick="return false;">发消息</a> | <a method="group" ftwitterid="{0}" nickname="{1}" href="#" target="_blank" onclick="return false;">分组</a> | <a method="at" nickname="{1}" href="#" target="_blank" onclick="return false;">@TA</a></span>',h.twitterid,h.nickname))}else{if(h.relation==3){e.append(String.format('<b class="bm_ticket not_bm_ticket">粉丝<span><a method="dFollow" ftwitterid="{0}" nickname="{1}" href="#" target="_blank" onclick="return false;">加关注</a></span></b>',h.twitterid,h.nickname));e.append(String.format('<span class="mtxt"><a method="at" nickname="{0}" href="#" target="_blank" onclick="return false;">@TA</a></span>',h.nickname))}else{if(h.relation==4){e.append(String.format('<b href="#" target="_blank" class="bm_ticket not_bm_ticket">相互关注<span><a atype="a" method="bFollow" ftwitterid="{0}" nickname="{1}" href="#" target="_blank" onclick="return false;">取消</a></span></b>',h.twitterid,h.nickname));e.append(String.format('<span class="mtxt"><a method="message" nickname="{1}" href="#" target="_blank" onclick="return false;">发消息</a> | <a method="group" ftwitterid="{0}" nickname="{1}" href="#" target="_blank" onclick="return false;">分组</a> | <a method="at" nickname="{1}" href="#" target="_blank" onclick="return false;">@TA</a></span>',h.twitterid,h.nickname))}else{}}}}e.append("</div>")}e.append("</div>");e.append("</div>");return e.toString()},initEvent:function(){this.userLayerRegion=$("userLayerRegion");if(this.userLayerRegion){this.clickControlHandler=this.clickControl.bind(this);this.userLayerRegion.observe("click",this.clickControlHandler);this.follow=new Follow({container:"userLayerRegion",autoGetFollowInfo:false,ischange:true,iscard:true,isuser:true,callback:this.getFollowBool.bind(this)})}},getFollowBool:function(e,d,f){cardFollowBool=d;if(this.id){userCache[this.id]=undefined;this.id=null}},clickControl:function(g){var f=Event.element(g);var j=f.readAttribute("method");switch(j){case"at":if(!cardIsLogin){if(typeof UserLoginDialog!=="undefined"){new UserLoginDialog({callback:function(){location.reload()}})}else{$loadJs("/js/2014/UserLoginDialog.js",function(){new UserLoginDialog({callback:function(){location.reload()}})}.bind(this))}return}var k=f.readAttribute("nickname");new Weibo.TwitterDialog({content:"对@"+k+" 说:"});break;case"message":var k=f.readAttribute("nickname");new Weibo.SendMessageDialog({user:{nickname:k}});break;case"group":var h=f.readAttribute("ftwitterid");var k=f.readAttribute("nickname");new Weibo.FollowSuccDialog({user:{id:h,name:k}});break;case"aFollow":cardFollowBool=true;break;case"bFollow":cardFollowBool=true;break}},close:function(){this.destroyEvent();this.destroyDOM()}});var SlidesControl=Class.create();Object.extend(SlidesControl.prototype,{options:{slidesRegion:"",prev:"",next:"",scale:0,duration:0.2,tabName:null,amount:null,type:null},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeEvent();this.load()},initializeField:function(){this.slidesRegion=$(this.slidesRegion);this.prev=$(this.prev);this.next=$(this.next);this.currentIndex=0;this.position=0;this.items=this.slidesRegion.childElements();this.length=this.items.length;this.lock=false},initializeEvent:function(){this.onPrevClickHandler=this.onPrevClick.bind(this);this.onNextClickHandler=this.onNextClick.bind(this);Event.observe(this.prev,"click",this.onPrevClickHandler);Event.observe(this.next,"click",this.onNextClickHandler)},destroyEvent:function(){this.onPrevClickHandler&&Event.stopObserving(this.prev,"click",this.onPrevClickHandler);this.onNextClickHandler&&Event.stopObserving(this.next,"click",this.onNextClickHandler)},destroyDOM:function(){this.slidesRegion=null;this.prev=null;this.next=null},closed:function(){this.destroyEvent();this.destroyDOM()},close:function(){this.closed()},load:function(){if(this.tabName){$loadSubJs("/js/AutoSwitchTabPanel.js",function(){var k=this.items;for(var l=0,j=k.length;l<j;l++){var h=k[l];if(h.getAttribute("name")===this.tabName){var m=h.childElements();var g=new AutoSwitchTabPanel({menuRegion:m[1],contentRegion:m[0],autoTimeout:7000})}}}.bind(this))}},onPrevClick:function(c){var d=c.target||c.srcElement;Event.stop(c);this.prevSlides()},onNextClick:function(c){var d=c.target||c.srcElement;Event.stop(c);this.nextSlides()},prevSlides:function(){if(this.lock){return}var f=null;if(this.type==="neat"){var e=this.items.pop();var d=this.items[0];this.items.unshift(e);this.slidesRegion.insertBefore(e,d);this.slidesRegion.style.left=this.position-this.scale;f={node:this.slidesRegion,duration:this.duration,scale:this.scale,position:this.position-this.scale};this.move(f)}else{f={node:this.slidesRegion,duration:this.duration,scale:this.scale,position:-this.currentIndex*this.scale};if(this.amount&&this.currentIndex<1){f.scale=-this.scale*(this.amount-1);this.currentIndex=this.amount-1}else{if(this.currentIndex<1){f.scale=-this.scale*(this.length-1);this.currentIndex=this.length-1}else{this.currentIndex--}}this.move(f)}},nextSlides:function(){if(this.lock){return}var b=null;if(this.type==="neat"){b={node:this.slidesRegion,duration:this.duration,scale:-this.scale,position:this.position,callback:function(){var a=this.items.shift();var d=this.items.last();this.items.push(a);a=this.slidesRegion.removeChild(a);this.slidesRegion.appendChild(a);this.slidesRegion.style.left=this.position}.bind(this)};this.move(b)}else{b={node:this.slidesRegion,duration:this.duration,scale:-this.scale,position:-this.currentIndex*this.scale};if(this.amount&&this.currentIndex>this.amount-2){b.scale=this.scale*(this.amount-1);this.currentIndex=0}else{if(this.currentIndex>this.length-2){b.scale=this.scale*(this.length-1);this.currentIndex=0}else{this.currentIndex++}}this.move(b)}},move:function(b){this.lock=true;new Fx.Move(b.node,{scaleX:true,duration:b.duration,distances:{left:b.scale,position:b.position},callback:function(){this.lock=false;b.callback&&b.callback()}.bind(this)})}});Fx.Move=Class.create();Object.extend(Object.extend(Fx.Move.prototype,Fx.Base.prototype),{setup:function(c){var d;if(this.options.distances){d=this.options.distances;this.currentLeft=d.left;this.currentTop=d.top;this.originalPosition=d.position;this.factor=1}else{this.steps=-1}},update:function(j,l){var d=this.factor*l;var k=this.currentLeft*d;var m=this.currentTop*d;var h={};if(j.options.scaleX){h.left=this.originalPosition+Math.round(k)+"px"}if(j.options.scaleY){h.top=this.originalPosition+Math.round(m)+"px"}this.element.setStyle(h)},end:function(b){if(b.options.callback){b.options.callback()}}});if(typeof(Widgets)=="undefined"){var Widgets=Class.create()}Widgets.Base=Class.create();Object.extend(Widgets.Base.prototype,{options:{},initialize:function(b){this.setOptions(b);this.initializeDom();this.initializeEvent();this.load()},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initializeDom:function(){},initializeEvent:function(){Event.observe(window,"unload",this.close.bind(this))},load:function(){},close:function(){this.destroyEvent();this.destroyDOM();this.destroyField()},destroyField:function(){},destroyEvent:function(){},destroyDOM:function(){}});Widgets.SlidesControl=Class.create();Object.extend(Widgets.SlidesControl.prototype,Widgets.Base.prototype);Object.extend(Widgets.SlidesControl.prototype,{options:{slidesRegion:"movieSlidesItems",prev:"moviePrev",next:"movieNext",duration:0.5,showLength:4,videID:10404,items:[],autoTimeout:null,type:"detail",itemWidth:245,isHide:false,moreLink:"",imageTemplate:'<li class="#{sty}"><span class="sharp"></span><a href="#{Url}" class="db_avideo"><img src="#{ImagePath}" alt="#{TitleSamll}" /><em></em><b></b><i>#{hdHtml}#{Length}</i><span>#{TitleSamll}</span></a></li>',callback:null},isOther:false,initializeDom:function(){this.$slidesRegion=$(this.slidesRegion);if(!this.$slidesRegion){return}this.$prev=$(this.prev);this.$next=$(this.next);this.scale=this.itemWidth*this.showLength;this.$slidesRegion.style.width=(this.scale*2+100)+"px";if(this.type==="other"){this.isOther=true;this.$prev_i=this.$prev.down("i");this.$next_i=this.$next.down("i");if(this.moreLink!==""){this.moreLinkOjb={nextBtnTemplate:'<a class="next_screen" href="#{morelink}" target="_blank"><em></em><i class="on"></i></a>',morelink:this.moreLink};this.$parentRegion=this.$next.up();var d=new Template(this.moreLinkOjb.nextBtnTemplate),c=d.evaluate(this.moreLinkOjb);this.nextBtnHtml=Builder.build(c);this.nextBtnHtml.hide();this.$parentRegion.appendChild(this.nextBtnHtml)}}this.durations=this.durationInfo(this.duration)},renderImage:function(g){if(!g){return}var f,h=new Template(this.imageTemplate),e=new StringBuilder();if(typeof this.videoID!=="undefined"&&typeof g.VideoID!=="undefined"&&g.VideoID==this.videoID){g.sty="on"}else{g.sty=""}g.hdHtml=g.HD===1?'<strong title="HD"></strong>':"";f=h.evaluate(g);return f.toString()},show:function(){var l=[];for(var h=this.min;h<this.length&&h<this.max;h++){var j=this.imgItems[h];var g=this.renderImage(j);var m=Builder.build(g);if(this.type==="list"){if(this.isVideoList){if(h%2===0){var k=Builder.build("<li></li>");k.appendChild(m);this.$slidesRegion.appendChild(k);l.push(k)}else{j=this.imgItems[h];g=this.renderImage(j);m=Builder.build(g);l[l.length-1].appendChild(m)}}else{var k=Builder.build("<li></li>");k.appendChild(m);this.$slidesRegion.appendChild(k);l.push(k)}}else{this.$slidesRegion.appendChild(m);l.push(m)}if(h===0){if(this.isOther){this.$prev_i.removeClassName("on")}else{this.$prev.hide()}}if(h===this.length-1){if(this.type==="other"){if(this.moreLink!==""){if(this.isHide&&this.items.length<=this.showLength){this.$next_i.hide()}else{this.nextBtnHtml.show()}}else{this.$next_i.removeClassName("on")}}else{this.$next.hide()}}}this.selectedItems=l},load:function(){this.pageIndex=0;this.imgItems=[];if(typeof this.items==="undefined"||this.items.length===0){return}this.imgItems=this.items;this.length=this.imgItems.length;this.amount=Math.ceil(this.length/this.showLength);var f,h,e,g=0;for(i=0;i<this.length;i++){if(typeof this.imgItems[i]!=="undefined"&&typeof this.imgItems[i].VideoID!=="undefined"){if(this.imgItems[i].VideoID==this.videoID){f=this.imgItems[i];g=i+1;if(i>0){h=this.imgItems[i-1]}if(i<this.length-1){e=this.imgItems[i+1]}this.callback&&this.callback({nowVideo:f,preVideo:h,nextVideo:e,videoCount:this.length})}}}if(this.length>this.showLength){if(this.isOther){this.$prev_i.addClassName("on");this.$next_i.addClassName("on")}else{this.$prev.show();this.$next.show()}}else{if(this.isOther){if(this.isHide){this.$prev_i.hide();this.$next_i.hide()}else{this.$prev_i.removeClassName("on");this.$next_i.removeClassName("on")}}else{this.$prev.hide();this.$next.hide()}}this.isVideoList=this.type==="list"&&this.length>=20?true:false;this.pageIndex=Math.ceil(g/this.showLength);this.min=(this.pageIndex-1)*this.showLength;if(this.min<0){this.min=0}this.max=this.pageIndex*this.showLength;if(this.max<this.showLength){this.max=this.showLength}if(this.isVideoList){this.$slidesRegion.up().style.height="274px";this.max=this.max*2}this.show();if(typeof SlidesControl!="undefined"){this.instantiation()}else{$loadJs(["/js/2011/SlidesControl.js"],function(){this.instantiation()}.bind(this))}},durationInfo:function(d){var f=Math.floor(d*10)/10,e;switch(f){case 0.2:e={className:"transition2",duration:200};break;case 0.3:e={className:"transition3",duration:300};break;case 0.4:e={className:"transition4",duration:400};break;case 0.5:e={className:"transition5",duration:500};break;case 0.6:e={className:"transition6",duration:600};break;default:e={className:"transition6",duration:600}}return e},instantiation:function(){var d=this;var c=new SlidesControl({slidesRegion:this.slidesRegion,prev:this.prev,next:this.next,scale:d.scale,duration:this.duration,type:"neat",prevSlides:function(){if(this.lock){return}if(typeof d.$prev_i!=="undefined"&&!d.$prev_i.hasClassName("on")){return}var w=null;d.selectedItems=this.slidesRegion.immediateDescendants();var a=[],b=d.selectedItems[0],u,x,y,z,A=[],t,q,s=0;if(d.isVideoList){d.min-=d.showLength*2;d.max-=d.showLength*2}else{d.min-=d.showLength;d.max-=d.showLength}if(d.min<=0){d.min=0;if(d.isVideoList){d.max=d.showLength*2}else{d.max=d.showLength}}if(d.max>=d.length){if(d.isVideoList){d.max=d.length-d.selectedItems.length*2;d.min=d.max-d.showLength*2}else{d.max=d.length-d.selectedItems.length;d.min=d.max-d.showLength}}if(d.isOther){d.$next_i.addClassName("on")}else{d.$next.show()}if(d.nextBtnHtml){d.nextBtnHtml.hide()}for(var r=d.min;r<d.length&&r<d.max;r++){t=d.imgItems[r];q=d.renderImage(t);z=Builder.build(q);if(r===0){if(d.isOther){d.$prev_i.removeClassName("on")}else{d.$prev.hide()}}if(d.type==="list"){if(d.isVideoList){if(r%2===0){var v=Builder.build("<li></li>");v.appendChild(z);this.slidesRegion.insertBefore(v,b);a.push(v)}else{t=d.imgItems[r];q=d.renderImage(t);z=Builder.build(q);a[a.length-1].appendChild(z)}}else{var v=Builder.build("<li></li>");v.appendChild(z);this.slidesRegion.insertBefore(v,b);a.push(v)}}else{a.push(z);this.slidesRegion.insertBefore(z,b)}}if(d.isVideoList){s=Math.floor((d.max-d.min)/2)}else{s=d.max-d.min}d.scale=d.itemWidth*s;this.slidesRegion.style.left=this.position-d.scale+"px";if(Mtime.browser.ie===0||Mtime.browser.ie>9){FunctionExt.defer(function(){this.slidesRegion.addClassName(d.durations.className);this.slidesRegion.style.left="0px"},10,this);FunctionExt.defer(function(){this.slidesRegion.removeClassName(d.durations.className);for(r=d.showLength-s;r<d.showLength;r++){d.selectedItems[r]&&this.slidesRegion.removeChild(d.selectedItems[r])}this.lock=false},d.durations.duration,this);return}w={node:this.slidesRegion,duration:this.duration,scale:d.scale,position:this.position-d.scale,callback:function(){for(r=d.showLength-s;r<d.showLength;r++){d.selectedItems[r]&&this.slidesRegion.removeChild(d.selectedItems[r])}this.slidesRegion.style.left=this.position;d.selectedItems=a}.bind(this)};this.move(w)},nextSlides:function(){if(this.lock){return}if(typeof d.$next_i!=="undefined"&&!d.$next_i.hasClassName("on")){return}var a=null;if(d.isVideoList){d.min+=d.showLength*2;d.max+=d.showLength*2}else{d.min+=d.showLength;d.max+=d.showLength}if(d.isOther){d.$prev_i.addClassName("on")}else{d.$prev.show()}d.show();d.selectedItems=this.slidesRegion.immediateDescendants();if(Mtime.browser.ie===0||Mtime.browser.ie>9){this.slidesRegion.addClassName(d.durations.className);this.slidesRegion.style.left=-d.scale+"px";FunctionExt.defer(function(){this.slidesRegion.removeClassName(d.durations.className);for(i=0;i<d.showLength;i++){d.selectedItems[i]&&this.slidesRegion.removeChild(d.selectedItems[i])}this.slidesRegion.style.left=this.position;this.lock=false},d.durations.duration,this);return}a={node:this.slidesRegion,duration:this.duration,scale:-d.scale,position:this.position,callback:function(){for(i=0;i<d.showLength;i++){d.selectedItems[i]&&this.slidesRegion.removeChild(d.selectedItems[i])}this.slidesRegion.style.left=this.position}.bind(this)};this.move(a)},move:function(a){this.lock=true;new Fx.Move(a.node,{scaleX:true,duration:a.duration,distances:{left:a.scale,position:a.position},callback:function(){this.lock=false;a.callback&&a.callback()}.bind(this)})}})}});Widgets.BehindSlidesControl=Class.create();Object.extend(Widgets.BehindSlidesControl.prototype,Widgets.Base.prototype);Object.extend(Widgets.BehindSlidesControl.prototype,{options:{slidesRegion:"movieSlidesItems",prev:"moviePrev",next:"movieNext",presentNumber:"present_number",sumNumber:"sum_number",titleTxt:"title_txt",describeTxt:"describe_txt",duration:0.5,type:"neat",callback:null},initializeDom:function(){this.$slidesRegion=$(this.slidesRegion);if(!this.$slidesRegion){return}this.$presentNumber=$(this.presentNumber);this.$sumNumber=$(this.sumNumber);this.$titleTxt=$(this.titleTxt);this.$describeTxt=$(this.describeTxt);this.$images=this.$slidesRegion.immediateDescendants();this.imagesLen=this.$images.length;this.$slidesRegion.style.width=(this.$images[0].offsetWidth*this.imagesLen+100)+"px";if(this.$sumNumber){this.$sumNumber.innerHTML="/"+this.imagesLen}this.presentNum=1;if(this.$presentNumber){this.$presentNumber.innerHTML=this.presentNum}if(this.$titleTxt){this.$titleTxt.innerHTML=Widgets.Utils.strShort(this.$images[0].readAttribute("title"),24)}if(this.$describeTxt){this.$describeTxt.innerHTML=Widgets.Utils.strShort(this.$images[0].readAttribute("imgabstract"),46)}},load:function(){if(typeof SlidesControl!=="undefined"){this.instanceSlidesControl()}else{$loadJs(["/js/2011/SlidesControl.js"],function(){this.instanceSlidesControl()}.bind(this))}},instanceSlidesControl:function(){var d=this;if(!this.$slidesRegion||this.$slidesRegion.children.length<2){return}var c=new SlidesControl({slidesRegion:this.slidesRegion,prev:this.prev,next:this.next,scale:this.$images[0].offsetWidth,duration:this.duration,type:"neat",move:function(a){this.lock=true;d.moveMethod(a.scale);new Fx.Move(a.node,{scaleX:true,duration:a.duration,distances:{left:a.scale,position:a.position},callback:function(){this.lock=false;a.callback&&a.callback()}.bind(this)})}})},moveMethod:function(b){if(b>0){this.presentNum-=1;if(this.presentNum<=0){this.presentNum=this.imagesLen}}else{this.presentNum+=1;if(this.presentNum>this.imagesLen){this.presentNum=1}}this.$presentNumber.innerHTML=this.presentNum;if(this.$titleTxt){this.$titleTxt.innerHTML=Widgets.Utils.strShort(this.$images[this.presentNum-1].readAttribute("title"),24)}if(this.$describeTxt){this.$describeTxt.innerHTML=Widgets.Utils.strShort(this.$images[this.presentNum-1].readAttribute("imgabstract"),46)}this.callback&&this.callback()},destroyDOM:function(){this.$presentNumber=null;this.$sumNumber=null;this.$titleTxt=null;this.$describeTxt=null;this.$images=null;this.imagesLen=null}});var Fixedable=function(l,r){var l=$(l);var r=$(r);function m(b,e){b.setStyle({zIndex:100,width:b.offsetWidth+"px"});if(Mtime.browser.ie===6){b.style.position="absolute";document.body.style.backgroundImage="url(about:blank)";document.body.style.backgroundAttachment="fixed";var g=(typeof e.width!=="undefined")||b.offsetWidth,c=(typeof e.height!=="undefined")||b.offsetHeight,f=0;if(typeof e.top!=="undefined"){var a=$$(".c_content")[0]||$$(".c_out")[0];if(a){f=Position.cumulativeOffset(a)[1]}}var d=function(){var h=(typeof e.top!=="undefined")?e.top-f:(document.documentElement.clientHeight-e.bottom-c);h=h-Position.cumulativeOffset(b.up())[1];!isNaN(h)&&b.style.setExpression("top","eval(document.documentElement.scrollTop + "+h+") + 'px'")};d()}else{b.style.position="fixed";(typeof e.top!=="undefined")&&(b.style.top=e.top+"px");(typeof e.bottom!=="undefined")&&(b.style.bottom=e.bottom+"px");(typeof e.left!=="undefined")&&(b.style.left=e.left+"px");(typeof e.right!=="undefined")&&(b.style.right=e.right+"px")}return b}function s(a,b){a.setStyle({zIndex:"",width:""});if(Mtime.browser.ie===6){a.style.position="static";a.style.width="100%";a.style.top="";document.body.style.backgroundImage="";document.body.style.backgroundAttachment=""}else{a.style.position="";(typeof b.top!=="undefined")&&(a.style.top="");(typeof b.bottom!=="undefined")&&(a.style.bottom="");(typeof b.left!=="undefined")&&(a.style.left="");(typeof b.right!=="undefined")&&(a.style.right="")}}if(l&&r){var n=false,o=null;var p=function(){var a=0,b=0;if(typeof(window.pageYOffset)=="number"){b=window.pageYOffset;a=window.pageXOffset}else{if(document.body&&(document.body.scrollLeft||document.body.scrollTop)){b=document.body.scrollTop;a=document.body.scrollLeft}else{if(document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)){b=document.documentElement.scrollTop;a=document.documentElement.scrollLeft}}}return[a,b]};var q=function(){var b=0,a=0;if(typeof(window.innerWidth)=="number"){b=window.innerWidth;a=window.innerHeight}else{if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)){b=document.documentElement.clientWidth;a=document.documentElement.clientHeight}else{if(document.body&&(document.body.clientWidth||document.body.clientHeight)){b=document.body.clientWidth;a=document.body.clientHeight}}}return[b,a]};var k=function(){var a=Position.cumulativeOffset(l.up())[1];var c=p()[1];var b=Position.cumulativeOffset(r)[1]+r.offsetHeight;if(c>(b-l.offsetHeight)||c<a){if(n){n=false;s(l,{top:0})}}else{if(c>a&&!n){m(l,{top:0});n=true}}};Event.observe(window,"scroll",k);Event.observe(window,"resize",k);return function(){Event.stopObserving(window,"scroll",k);Event.stopObserving(window,"resize",k)}}else{return null}};var AutoHeight=Class.create();Object.extend(AutoHeight,{getXY:function(h){var j=0,k=0;if(h.getBoundingClientRect){var a=h.getBoundingClientRect();var b=document.documentElement;j=a.left+Math.max(b.scrollLeft,document.body.scrollLeft)-b.clientLeft;k=a.top+Math.max(b.scrollTop,document.body.scrollTop)-b.clientTop}else{for(;h!=document.body;j+=h.offsetLeft,k+=h.offsetTop,h=h.offsetParent){}}return{x:j,y:k}},cssList:["font-family","font-size","font-style","font-weight","font-variant","line-height","margin-top","margin-bottom","margin-left","margin-right","overflow-x","overflow-y","padding-top","padding-bottom","padding-left","padding-right","word-break","word-wrap"],startAuto:function(b){b=$(b);lengthExpMax=210;normalTemplate="还可以输入{0}字";warnTemplate='<span class="c_red">字数超出{0}字</span>';this.handler=AutoHeight.auto.bind(b);Event.observe(b,"blur",this.handler);Event.observe(b,"focus",this.handler);Event.observe(b,"keyup",this.handler);Event.observe(b,"mouseup",this.handler);return AutoHeight.stopAuto.bind(b,this.handler)},auto:function(q){var z=this.up(".ele_replay").down('[_type="fd"]');var x=this.up();if(this.value.length==0){this.style.height="";z.innerHTML=String.format(normalTemplate,[lengthExpMax]);if(q.type==="blur"){AutoHeight.stopAuto(this)}return}if(!AutoHeight.mirrorCtn){AutoHeight.mirrorCtn=$(Builder.node("div"));document.body.appendChild(AutoHeight.mirrorCtn);AutoHeight.mirrorCtn.style.opacity="0";AutoHeight.mirrorCtn.style.zIndex=-1000;AutoHeight.mirrorCtn.style.position="absolute"}mirrorCtn=AutoHeight.mirrorCtn;cssList=AutoHeight.cssList;styleObj={};for(var r=0,s=cssList.length,l,y,u;r<s;++r){l=cssList[r];if((y=this.getStyle(l))){styleObj[l]=y}}mirrorCtn.setStyle(styleObj);mirrorCtn.setStyle({width:this.offsetWidth+"px"});var A=this.value;if(A.lastIndexOf("\n")!=-1&&A.lastIndexOf("\n")+1==A.length){A+="占"}mirrorCtn.innerHTML=A.replace(/\n/g,"<br/>");var w=AutoHeight.getXY(this);mirrorCtn.style.top=w.y+"px";mirrorCtn.style.left=w.x+"px";var v=mirrorCtn.offsetHeight;if(v<60){v=60}x.style.height=this.style.height=v+"px";if(A){var t=Widgets.Utils.strLen(A),o;if(t>0){o=lengthExpMax-t;if(o>=0){z.innerHTML=String.format(normalTemplate,[o])}else{z.innerHTML=String.format(warnTemplate,[Math.abs(o)])}}}z=x=v=null},stopAuto:function(e,f){var g=e.up();var h=g.up(".ele_replay").down(".mt6");h&&h.remove();e.value="发表评论";if(f){g.removeClassName("focus");e.style.height="30px";g.style.height="30px"}e.setAttribute("toggle","0");Event.stopObserving(e,"blur",AutoHeight.handler);Event.stopObserving(e,"focus",AutoHeight.handler);Event.stopObserving(e,"keyup",AutoHeight.handler);Event.stopObserving(e,"mouseup",AutoHeight.handler)}});!function(){function m(f,e){var d=0,a=f.split(""),p=[];e=(e||12)*2;var c=a.length;for(var b=0;b<c;++b){if(a[b].charCodeAt(0)<299){d++}else{d+=2}p.push(a[b]);if(d>=e-2){p.push("..");break}}return p.join("")}function l(e){var d=0,a=e.split("");var c=a.length;for(var b=0;b<c;++b){if(a[b].charCodeAt(0)<299){d++}else{d+=2}}return Math.ceil(d/2)}function k(b){var e=0,a,c=b.length;for(var d=0;d<c;d++){a=l(b[d]);if(a>e){e=a}}return e}function g(b){var y=b.value;var a=this.addLength||0;this.lengthExp=this.lengthExp||{};this.lengthExp.max=this.lengthExp.max||210;this.lengthExp.min=this.lengthExp.min||41;this.lengthExp.surl=this.lengthExp.surl||21;var c=y.trim().length;if(c>0&&y!=this.defaultText&&y.trim()!="发表评论"){var n=this.lengthExp.min,f=this.lengthExp.max,x=this.lengthExp.surl,o=y;var d=0;if(!this.notShortUrl){var z=y.match(/(http|https):\/\/[a-zA-Z0-9]+(\.[a-zA-Z0-9]+)+([-A-Z0-9a-z\$\.\+\!\_\*\(\)\/\,\:;@&=\?~#%]*)*/gi)||[];for(var e=0,c=z.length;e<c;e++){var w=z[e].bytelength2();if(/^(http:\/\/murl.tv)/.test(z[e])){continue}else{d+=w<=f?x:(w-f+x)}o=o.replace(z[e],"")}}return Math.ceil((d+o.bytelength2())/2)+a}else{return 0+a}}function h(r,d,q,f){var a=[];var c,b,s=Math.round((f*r)/d),e=Math.round(q*d/r);if(s<=q){c=s;b=f}else{if(e<=f){c=q;b=e}}a[0]=c;a[1]=b;return a}function j(c){var d=0,e=0;if(c.getBoundingClientRect){var a=c.getBoundingClientRect();var b=document.documentElement;d=Math.round(a.left+Math.max(b.scrollLeft,document.body.scrollLeft)-b.clientLeft);e=Math.round(a.top+Math.max(b.scrollTop,document.body.scrollTop)-b.clientTop)}else{for(;c!=document.body;d+=c.offsetLeft,e+=c.offsetTop,c=c.offsetParent){}}return{x:d,y:e}}Widgets.Utils={strShort:m,strLen:l,strArrayMax:k,getLength:g,getRatioSize:h,getXY:j}}();Fx.Move=Class.create();Object.extend(Object.extend(Fx.Move.prototype,Fx.Base.prototype),{setup:function(c){var d;if(this.options.distances){d=this.options.distances;this.currentLeft=d.left;this.currentTop=d.top;this.originalPosition=d.position;this.factor=1}else{this.steps=-1}},update:function(j,l){var d=this.factor*l;var k=this.currentLeft*d;var m=this.currentTop*d;var h={};if(j.options.scaleX){h.left=this.originalPosition+Math.round(k)+"px"}if(j.options.scaleY){h.top=this.originalPosition+Math.round(m)+"px"}this.element.setStyle(h)},end:function(b){if(b.options.callback){b.options.callback()}}});Widgets.Artwork=Class.create();Object.extend(Widgets.Artwork.prototype,Widgets.Base.prototype);Object.extend(Widgets.Artwork.prototype,{options:{width:0,height:0,imgUrl:"",isLoader:false,imageTemplate:'<div class="db_firstphoto" style="#{divStyle}"><img class="#{_className}" src="#{imgUrl}" width="#{width}" height="#{height}" style="#{imgStyle}"></div>',closeTemplate:'<a id="imgClose" href="javascript:void(0);" class="db_imgclose" title="关闭"></a>'},load:function(){if(!this.imgUrl&&(typeof isArtwork!=="undefined"&&isArtwork>0)){return}document.documentElement.style.overflow="hidden";this.clientHeight=document.documentElement.clientHeight;this.clientWidth=document.documentElement.clientWidth;this.scrollTop=document.documentElement.scrollTop||document.body.scrollTop;if(typeof this.width==="undefined"||typeof this.height==="undefined"||this.width===0||this.height===0){var f;if(this.isLoader){f='<div><div class="db_picloading" style="height:1000px; width:100%; z-index:50;"><div class="load104"><i class="logo"></i><i class="loadimg"></i></div></div><div class="db_firstphoto" style="visibility:hidden;"><img id="img" src="'+this.imgUrl+'"></div></div>'}else{f='<div class="db_firstphoto" style="visibility:hidden;"><img id="img" src="'+this.imgUrl+'"></div>'}var d=Builder.build(f);document.body.appendChild(d);var e=$("img");e.onload=function(){this.width=e.width;this.height=e.height;d&&d.remove();this.buildHtml()}.bind(this)}else{this.buildHtml()}},buildHtml:function(){var j={divStyle:"height:"+this.clientHeight+"px;top:"+this.scrollTop+"px",imgUrl:this.imgUrl,width:this.width,height:this.height,_className:(this.clientHeight>=this.height&&this.clientWidth>=this.width)?"":"bimg",imgStyle:this.clientHeight>this.height?"margin-top:"+Math.floor((this.clientHeight-this.height)/2)+"px;":""},h,k=new Template(this.imageTemplate),g,f;h=k.evaluate(j);this.$artworkNode=Builder.build(h.toString());document.body.appendChild(this.$artworkNode);this.$imgClose=Builder.build(this.closeTemplate.toString());document.body.appendChild(this.$imgClose);this.changeHandler=setInterval(function(){if(this.clientHeight===document.documentElement.clientHeight&&this.clientWidth===document.documentElement.clientWidth){return}this.clientHeight=document.documentElement.clientHeight;this.clientWidth=document.documentElement.clientWidth;this.scrollTop=document.documentElement.scrollTop||document.body.scrollTop;this.$artworkNode.style.height=this.clientHeight+"px";this.$artworkNode.style.top=this.scrollTop+"px";if(this.clientHeight>this.height||this.clientWidth>this.width){if(this.$image.hasClassName("bimg")){this.$image.removeClassName("bimg")}if(this.$image.hasClassName("simg")){this.$image.removeClassName("simg")}}else{var a=Widgets.Utils.getRatioSize(this.width,this.height,this.clientWidth,this.clientHeight);this.$image.style.width=a[0]+"px";this.$image.style.height=a[1]+"px"}}.bind(this),1500);this.$image=this.$artworkNode.down("img");this.imgCloseOnClickHandler=this.imgCloseOnClick.bind(this);Event.observe(this.$imgClose,"click",this.imgCloseOnClickHandler);if(this.$image.hasClassName("bimg")){this.imgClickHandler=this.imgClick.bind(this);Event.observe(this.$artworkNode,"click",this.imgClickHandler)}isArtwork=1},imgCloseOnClick:function(){this.$artworkNode.remove();this.$imgClose.remove();document.documentElement.style.overflow="";isArtwork=null;clearInterval(this.changeHandler);this.changeHandler=null},imgClick:function(){if(this.$image.hasClassName("bimg")){this.$image.removeClassName("bimg");this.$image.addClassName("simg");var b=Widgets.Utils.getRatioSize(this.width,this.height,this.clientWidth,this.clientHeight);this.$image.style.width=b[0]+"px";this.$image.style.height=b[1]+"px"}else{if(this.$image.hasClassName("simg")){this.$image.removeClassName("simg");this.$image.addClassName("bimg");this.$image.style.width=this.width+"px";this.$image.style.height=this.height+"px"}}},destroyEvent:function(){Event.stopObserving(this.$imgClose,"click",this.imgCloseOnClickHandler);Event.stopObserving(this.$artworkNode,"click",this.imgClickHandler)},destroyDOM:function(){this.clientHeight=null;this.clientWidth=null;this.$artworkNode=null;this.$imgClose=null;this.$image=null;this.imageTemplate=null;this.closeTemplate=null;this.width=null;this.height=null;if(this.changeHandler){clearInterval(this.changeHandler);this.changeHandler=null}}});Widgets.AwardSlidesControl=Class.create();Object.extend(Widgets.AwardSlidesControl.prototype,Widgets.SlidesControl.prototype);Object.extend(Widgets.AwardSlidesControl.prototype,{initializeEvent:function(){Widgets.SlidesControl.prototype.initializeEvent.apply(this);this.slidesRegionClickHandler=this.slidesRegionClick.bind(this);Event.observe(this.slidesRegion,"click",this.slidesRegionClickHandler.bind(this))},show:function(){var j=[];for(var g=this.min;g<this.length&&g<this.max;g++){var h=this.imgItems[g];var f=this.renderImage(h);var k=Builder.build(f);this.$slidesRegion.appendChild(k);j.push(k);if(g===0){if(this.isOther){this.$prev_i.removeClassName("on")}else{this.$prev.hide()}}if(g===this.length-1){if(this.type==="other"){if(this.moreLink!==""){this.nextBtnHtml.show()}else{this.$next_i.removeClassName("on")}}else{this.$next.hide()}}}this.selectedItems=j},load:function(){Widgets.SlidesControl.prototype.load.apply(this);this.type="award";this.$awardInfoRegion=$(this.awardInfoRegion);this.builderAwardInfo(0);this.selectedItems[0].addClassName("on");var d=this.selectedItems[0];var e=d.down("span"),f;if(e){f=$(Builder.node("span",{style:"background-image: url("+this.imgItems[0].DefaultImageUrl+");"}));d.insertBefore(f,e);e.remove()}d=e=f=null;this.clickIndex=0},slidesRegionClick:function(g){var f=Event.findElement(g,"dd"),h=0,j,k;this.festivalId=f.getAttribute("festivalid");if(this.festivalId){this.selectedItems=this.$slidesRegion.immediateDescendants();this.selectedItems.each(function(b){if(b.hasClassName("on")){b.removeClassName("on");var a=parseInt(b.getAttribute("festivalid"),10);this.imgItems.each(function(d,c){if(d.FestivalId===a){h=c}}.bind(this));j=b.down("span");if(j){k=$(Builder.node("span",{style:"background-image: url("+this.imgItems[h].BackgroundImageUrl+");"}));b.insertBefore(k,j);j.remove()}}}.bind(this));f.addClassName("on");this.festivalId=parseInt(this.festivalId,10);this.imgItems.each(function(b,a){if(b.FestivalId===this.festivalId){h=a}}.bind(this));if(h>=0){this.clickIndex=h;j=f.down("span");if(j){k=$(Builder.node("span",{style:"background-image: url("+this.imgItems[h].DefaultImageUrl+");"}));f.insertBefore(k,j);j.remove()}this.builderAwardInfo(h)}}f=h=j=k=null},builderAwardInfo:function(b){},instantiation:function(){var d=this;var c=new SlidesControl({slidesRegion:this.slidesRegion,prev:this.prev,next:this.next,scale:this.itemWidth,duration:this.duration,initializeField:function(){this.slidesRegion=$(this.slidesRegion);this.prev=$(this.prev);this.next=$(this.next);this.currentIndex=d.showLength-1;this.totalNum=d.length-d.showLength;this.position=0;this.items=this.slidesRegion.childElements();this.length=this.items.length;this.lock=false},prevSlides:function(){if(this.lock){return}this.items=this.slidesRegion.immediateDescendants();var a=this.items[0],b,k;this.next.show();this.isMoreLink=false;var j=null;j={node:this.slidesRegion,duration:this.duration,scale:this.scale,position:this.position-this.scale,callback:function(){var e=this.items.last();this.slidesRegion.removeChild(e);this.slidesRegion.style.left=this.position}.bind(this)};this.currentIndex--;var h=this.currentIndex-(d.showLength-1);if(h<=-1){this.currentIndex=0;return}else{if(h===0){this.prev.hide()}}b=d.renderImage(d.imgItems[h]);k=Builder.build(b);this.slidesRegion.insertBefore(k,a);if(h===d.clickIndex){k.addClassName("on");k.down("span").style.backgroundImage="url("+d.imgItems[h].DefaultImageUrl+")"}this.move(j)},nextSlides:function(){if(this.lock){return}var a,f;var b=null;this.prev.show();this.items=this.slidesRegion.immediateDescendants();b={node:this.slidesRegion,duration:this.duration,scale:-this.scale,position:this.position,callback:function(){var e=this.items.shift();this.slidesRegion.removeChild(e);this.slidesRegion.style.left=this.position}.bind(this)};this.currentIndex++;if(this.currentIndex>=d.length-1){this.next.hide()}a=d.renderImage(d.imgItems[this.currentIndex]);f=Builder.build(a);if(this.currentIndex===d.clickIndex){f.addClassName("on")}this.slidesRegion.appendChild(f);this.move(b)}})}});Widgets.backTopControl=Class.create();Object.extend(Widgets.backTopControl.prototype,Widgets.Base.prototype);Object.extend(Widgets.backTopControl.prototype,{options:{backTop_HTML:'<a href="#" onclick="return false" id="backTop" style="display:none" class="transition backtop " title="返回顶部"></a>'},initializeEvent:function(){this.mybackTopandler=this.backTop.bind(this);Event.observe(window,"scroll",this.mybackTopandler);Event.observe(window,"unload",this.close.bind(this))},destroyDOM:function(){this.backTopBtn.remove()},destroyEvent:function(){Event.stopObserving(window,"scroll",this.mybackTopandler)},close:function(){this.destroyDOM();this.destroyEvent()},load:function(){this.backTopBtn=Builder.build(this.backTop_HTML);document.body.appendChild(this.backTopBtn);Event.observe(this.backTopBtn,"click",function(){document.body.scrollIntoView()})},backTop:function(){var b=document.documentElement.scrollTop||document.body.scrollTop;if(Mtime.browser.ie&&Mtime.browser.ie<7){this.backTopBtn.style.top=document.documentElement.clientHeight+b-200+"px"}if(b<=0){this.backTopBtn.style.display="none"}else{this.backTopBtn.style.display="block"}}});Widgets.Comment=Class.create();Object.extend(Widgets.Comment.prototype,Widgets.Base.prototype);Object.extend(Widgets.Comment.prototype,{options:{container:"",lengthExpMax:210,pageClient:null,type:"",commentTemplate:'<div class="mt6"><a method="submit" href="#" onclick="return false;" class="replaybtn">回复</a><p class="pt3 c_a5" _type="fd">还可以输入210字</p></div>',commentCollBackTemplate:'<div class="pic_32 mt20"><a href="{0}" target="_blank" title="{1}"><img src="{2}" width="32" height="32" alt="{1}"></a><p class="px14"><a href="{0}" target="_blank">{1}</a></p><p class="mt3 px12">{3}</p><p class="mt5 px12">{4}</p></div>',commentCollBackTemplate1:'<div class="pic_32 mt20"><a href="{0}" target="_blank" title="{1}"><img src="{2}" width="32" height="32" alt="{1}"></a><p class="px14"><a href="{0}" target="_blank">{1}</a><span class="pl25">{3}</span></p><p class="mt5 px12">{4}</p></div>'},server:{AddTweetComment:function(p,q,n,l,k,o,j){var m=Mtime.isValue(n)?[p,q,n,l,false,0,false,k]:[p,q,0,l,false,0,false,k];return Mtime.Component.Ajax.crossDomainCallBack(siteServiceUrl,"Mtime.Service.Pages.TwitterService","AddTweetCommentWithOptionCrossDomainByFlash",m,j,"/Service/Twitter.msi","post","20000",o)}},initializeDom:function(){this.$contentRegion=$(this.container);this.editors=[]},initializeEvent:function(){this.clickRegionHandler=this.onClickRegion.bind(this);Event.observe(this.$contentRegion,"click",this.clickRegionHandler);Event.observe(window,"unload",this.close.bind(this))},onClickRegion:function(u){var s=Event.element(u);var w=s.readAttribute("method");while(!w&&s!=document.body){s=s.up();w=s.readAttribute("method")}if(!w){return}switch(w){case"comment":Event.stop(u);var E=s.readAttribute("toggle");if(typeof E==="undefined"||E!=="1"){s.setAttribute("toggle","1")}else{return}var G=s.up(".mod_short");this.tweetid=G.readAttribute("tweetid");this.oldClickElementHtml=s.value;this.textarea=s;s.value="";s.style.height="60px";var y=s.up(".ele_replay");var A=s.up();A.style.height="60px";A.addClassName("focus");var x=Builder.build(this.commentTemplate);y&&y.appendChild(x);AutoHeight.startAuto(s);break;case"submit":Event.stop(u);var G=s.up(".mod_short");var F=G.readAttribute("tweetid");var r=G.down('[region="newcomment"]');var D=G.down("textarea");var t=D.value;var C;var B;B=B?B.checked:false;var v=Widgets.Utils.strLen(t);if(v>0&&v<=this.lengthExpMax&&!/^发表评论.*:$/.test(t)){var z=null;if(/发表评论.*:/.test(t)){z=this.replyParentid}if(this.pageClient&&!this.pageClient.isLogin){if(typeof UserLoginDialog!=="undefined"){new UserLoginDialog({callback:function(){location.reload()}})}else{$loadJs("/js/2014/UserLoginDialog.js",function(){new UserLoginDialog({callback:function(){location.reload()}})}.bind(this))}return}this.server.AddTweetComment(t,F,this.replyParentid,C,B,s,function(b){if(b&&b.value&&this.addCommentErrorCheck(b)){if(!r){return}var c;if(this.type===""){c=this.commentCollBackTemplate}else{if(this.type==="movie"){c=this.commentCollBackTemplate1}}var a=String.format(c,[b.value.commentUserUrl,b.value.commentUserNickName,b.value.commentUserAvatar,b.value.commentTime,b.value.commentTextBody]);r.innerHTML=a;AutoHeight.stopAuto(D)}}.bind(this))}else{if(v==0||/^发表评论.*:$/.test(t)){$alert("你还没有填写内容，请填写后提交。",null,null,4)}else{$alert("内容过长,请确认内容字符长度小于"+editor.lengthExp.max+"。",null,null,4)}AutoHeight.stopAuto(D)}break}},addCommentErrorCheck:function(j){var k=parseInt(j.value.success);if(k===1){var f=function(a){switch(a){case 0:return"保存失败.";case -1:return"内容过长.";case -2:return"内容为空.";case -3:return"非法的用户.";case -4:return"微评不存在.";case -5:return"原回复已被删除.";case -6:return"在对方的黑名单中.";case -7:return"原作者微评正在审核中，如有不便敬请谅解！";default:return""}};var h=function(a){switch(a){case 0:return"保存失败.";case -1:return"内容过长.";case -2:return"非法的用户.";case -3:return"原微评不存在.";case -4:return"原微评不存在.";case -5:return"原作者微评正在审核中，如有不便敬请谅解！";default:return""}};var g="";if(parseInt(j.value.commentId,10)<=0){g=f(parseInt(j.value.commentId,10))}if(!g&&j.value.isForward&&parseInt(j.value.forwardTweetId,10)<=0){g=h(parseInt(j.value.forwardTweetId,10))}if(!g&&j.value.isCommentToRoot&&parseInt(j.value.commentToRootId,10)<=0){g=f(parseInt(j.value.commentToRootId,10))}if(!g&&parseInt(j.value.replyResult,10)!=1){g=j.value.replyError||""}if(g){$alert(g,null,null,4);return false}else{return true}}else{if(k===-4){$alert("你的评论有被禁止的内容，请修改后发布。",null,null,4);return false}else{if(k===-5){$alert("你的评论有被禁止的内容，请修改后发布。",null,null,4);return false}else{if(k===-20){$alert("你发布的速度太快了，休息一下吧：）",null,null,4);return false}else{if(k===-30){$alert("非法用户",null,null,4);return false}}}}}}});Widgets.BlogComment=Class.create();Object.extend(Widgets.BlogComment.prototype,Widgets.Comment.prototype);Object.extend(Widgets.BlogComment.prototype,{options:{container:"",lengthExpMax:210,pageClient:null,clickTextareaCallBack:null,blurTextareaCallBack:null,isStyleChange:true,callback:null,commentTemplate:'<div class="mt6"><a method="submit" href="#" onclick="return false;" class="replaybtn">回复</a><p class="pt3 c_a5" _type="fd">还可以输入210字</p></div>',commentCollBackTemplate:'<div class="pic_32 mt20"><a href="{0}" target="_blank" title="{1}"><img src="{2}" width="32" height="32" alt="{1}"></a><p class="px14"><a href="{0}" target="_blank">{1}</a></p><p class="mt3 px12">{3}</p><p class="mt5 px12">{4}</p></div>'},onClickRegion:function(p){var n=Event.element(p);var r=n.readAttribute("method");while(!r&&n!=document.body){n=n.up();r=n.readAttribute("method")}if(!r){return}switch(r){case"comment":Event.stop(p);var y=n.getAttribute("toggle");this.clickElement=n;if(typeof y==="undefined"||y!=="1"){n.setAttribute("toggle","1");var t=n.getAttribute("objid");var u=n.getAttribute("objtypeid");this.clickTextareaCallBack&&this.clickTextareaCallBack(u,t,n)}else{return}this.oldClickElementHtml=n.value;this.textarea=n;n.value="";n.style.height="60px";var v=n.up(".ele_replay");if(this.isStyleChange){var w=n.up();w.style.height="60px";w.addClassName("focus")}var s=Builder.build(this.commentTemplate);v&&v.appendChild(s);AutoHeight.startAuto(n);this.clickElementHandler=this.elementBlur.bind(this);Event.observe(n,"blur",this.clickElementHandler);break;case"submit":Event.stop(p);var v=n.up(".ele_replay");var x=v.down("textarea");var t=x.getAttribute("objid");var u=x.getAttribute("objtypeid");var o=x.value;var q=Widgets.Utils.strLen(o);if(q>0&&q<=this.lengthExpMax&&!/^发表评论.*:$/.test(o)){if(this.pageClient&&!this.pageClient.isLogin){if(typeof UserLoginDialog!=="undefined"){new UserLoginDialog({callback:function(){location.reload()}})}else{$loadJs("/js/2014/UserLoginDialog.js",function(){new UserLoginDialog({callback:function(){location.reload()}})}.bind(this))}return}this.callback&&this.callback(o,u,t,x);if(!this.isStyleChange){AutoHeight.stopAuto(x,this.isStyleChange)}}else{if(q==0||/^发表评论.*:$/.test(o)){$alert("你还没有填写内容，请填写后提交。",null,null,4)}else{$alert("内容过长,请确认内容字符长度小于"+editor.lengthExp.max+"。",null,null,4)}AutoHeight.stopAuto(x,this.isStyleChange)}break}},elementBlur:function(d){if(this.clickElement){var e=this.clickElement.getAttribute("objid");var f=this.clickElement.getAttribute("objtypeid");this.blurTextareaCallBack&&this.blurTextareaCallBack(f,e,this.clickElement);Event.stopObserving(this,"blur",this.clickElementHandler);e=f=this.clickElement=null}}});var GoodsComment=Class.create();Object.extend(GoodsComment.prototype,Widgets.Comment.prototype);Object.extend(GoodsComment.prototype,{options:{container:"",lengthExpMax:210,focusClassName:null,commentTemplate:'<div class="mt6"><a method="submit" href="#" onclick="return false;" class="replaybtn">回复</a><p class="pt3 c_a5" _type="fd">还可以输入210字</p></div>',callback:null,clickTextareaCallBack:null,blurTextareaCallBack:null},onClickRegion:function(o){var m=Event.element(o);var q=m.readAttribute("method");while(!q&&m!=document.body){m=m.up();q=m.readAttribute("method")}if(!q){var u=$$(".ele_replay")[0];var v=u.down("textarea");NewAutoHeight.stopAuto(v);return}switch(q){case"comment":Event.stop(o);var w=m.getAttribute("toggle");this.clickElement=m;if(typeof w==="undefined"||w!=="1"){m.setAttribute("toggle","1");var s=m.getAttribute("objid");var t=m.getAttribute("objtypeid");this.clickTextareaCallBack&&this.clickTextareaCallBack(t,s,m)}else{return}this.oldClickElementHtml=m.value;this.textarea=m;m.value="";m.style.height="60px";var u=m.up(".ele_replay");var r=Builder.build(this.commentTemplate);if(u){u.appendChild(r);if(this.focusClassName&&!u.hasClassName(this.focusClassName)){u.addClassName(this.focusClassName)}}NewAutoHeight.startAuto(m,this.focusClassName);break;case"submit":Event.stop(o);var u=m.up(".ele_replay");var v=u.down("textarea");var s=v.getAttribute("objid");var t=v.getAttribute("objtypeid");var n=v.value;var p=Widgets.Utils.strLen(n);if(p>0&&p<=this.lengthExpMax&&!/^发表评论.*$/.test(n)){this.callback&&this.callback(n,t,s,v);NewAutoHeight.stopAuto(v)}else{if(p==0||/^发表评论.*$/.test(n)){$alert("你还没有填写内容，请填写后提交。",null,null,4)}else{NewAutoHeight.stopAuto(v);$alert("内容过长,请确认内容字符长度小于"+this.lengthExpMax+"。",null,null,4)}}break}}});var NewAutoHeight=Class.create();Object.extend(NewAutoHeight,{getXY:function(h){var j=0,k=0;if(h.getBoundingClientRect){var a=h.getBoundingClientRect();var b=document.documentElement;j=a.left+Math.max(b.scrollLeft,document.body.scrollLeft)-b.clientLeft;k=a.top+Math.max(b.scrollTop,document.body.scrollTop)-b.clientTop}else{for(;h!=document.body;j+=h.offsetLeft,k+=h.offsetTop,h=h.offsetParent){}}return{x:j,y:k}},cssList:["font-family","font-size","font-style","font-weight","font-variant","line-height","margin-top","margin-bottom","margin-left","margin-right","overflow-x","overflow-y","padding-top","padding-bottom","padding-left","padding-right","word-break","word-wrap"],startAuto:function(c,d){c=$(c);lengthExpMax=210;normalTemplate="还可以输入{0}字";NewAutoHeight.focusClassName=d;warnTemplate='<span class="c_red">字数超出{0}字</span>';this.handler=NewAutoHeight.auto.bind(c);Event.observe(c,"blur",this.handler);Event.observe(c,"focus",this.handler);Event.observe(c,"keyup",this.handler);Event.observe(c,"mouseup",this.handler);return NewAutoHeight.stopAuto.bind(c,this.handler)},auto:function(q){var z=this.up(".ele_replay").down('[_type="fd"]');var x=this.up();if(this.value.length==0){return}if(!NewAutoHeight.mirrorCtn){NewAutoHeight.mirrorCtn=$(Builder.node("div"));document.body.appendChild(NewAutoHeight.mirrorCtn);NewAutoHeight.mirrorCtn.style.opacity="0";NewAutoHeight.mirrorCtn.style.zIndex=-1000;NewAutoHeight.mirrorCtn.style.position="absolute"}mirrorCtn=NewAutoHeight.mirrorCtn;cssList=NewAutoHeight.cssList;styleObj={};for(var r=0,s=cssList.length,l,y,u;r<s;++r){l=cssList[r];if((y=this.getStyle(l))){styleObj[l]=y}}mirrorCtn.setStyle(styleObj);mirrorCtn.setStyle({width:this.offsetWidth+"px"});var A=this.value;if(A.lastIndexOf("\n")!=-1&&A.lastIndexOf("\n")+1==A.length){A+="占"}mirrorCtn.innerHTML=A.replace(/\n/g,"<br/>");var w=NewAutoHeight.getXY(this);mirrorCtn.style.top=w.y+"px";mirrorCtn.style.left=w.x+"px";var v=mirrorCtn.offsetHeight;if(v<60){v=60}if(A){var t=Widgets.Utils.strLen(A),o;if(t>0){o=lengthExpMax-t;if(o>=0){z.innerHTML=String.format(normalTemplate,[o])}else{z.innerHTML=String.format(warnTemplate,[Math.abs(o)])}}}z=x=v=null},stopAuto:function(d){var e=d.up(".ele_replay");if(!e){return}var f=e.down(".mt6");f&&f.remove();d.value="发表评论";if(NewAutoHeight.focusClassName&&e.hasClassName(NewAutoHeight.focusClassName)){e.removeClassName(NewAutoHeight.focusClassName)}e.style.height=d.style.height="40px";d.setAttribute("toggle","0");Event.stopObserving(d,"blur",NewAutoHeight.handler);Event.stopObserving(d,"focus",NewAutoHeight.handler);Event.stopObserving(d,"keyup",NewAutoHeight.handler);Event.stopObserving(d,"mouseup",NewAutoHeight.handler)}});Widgets.DistanceSlidesControl=Class.create();Object.extend(Widgets.DistanceSlidesControl.prototype,Widgets.Base.prototype);Object.extend(Widgets.DistanceSlidesControl.prototype,{options:{slidesRegion:"",prev:"",next:"",showRegionWidth:695,slidesRegionWidth:1000,currentPosition:0,itemWidth:0,duration:0.5,type:"neat"},initializeDom:function(){this.$slidesRegion=$(this.slidesRegion);if(!this.$slidesRegion){return}if(Mtime.browser.ie>0||Mtime.browser.ie<9){this.$slidesRegion.addClassName("transition6")}this.$prev=$(this.prev);this.$next=$(this.next);this.span=this.$next.next("span.shadow")},initializeEvent:function(){this.onPrevClickHandler=this.onPrevClick.bind(this);this.onNextClickHandler=this.onNextClick.bind(this);Event.observe(this.$prev,"click",this.onPrevClickHandler);Event.observe(this.$next,"click",this.onNextClickHandler);Event.observe(window,"unload",this.close.bind(this))},load:function(){this.reset()},onLoader:function(b){},getItems:function(){this.$slidesRegions=this.$slidesRegion.immediateDescendants();this.length=this.$slidesRegions.length;if(this.itemWidth>0){this.amount=this.itemWidth*this.length}else{for(var b=0;b<this.length;b++){this.amount+=this.$slidesRegions[b].clientWidth}}this.$slidesRegion.style.width=this.amount+100+"px";this.amountIndex=Math.ceil(this.amount/this.slidesRegionWidth)},reset:function(){this.isReset=true;this.currentPosition=0;this.$slidesRegion.style.left=this.currentPosition+"px";this.pageIndex=0;this.amount=0;this.getItems();if(this.amount>this.slidesRegionWidth){this.$next.show();if(this.currentPosition===0){this.$prev.hide()}else{this.$prev.show()}}else{this.$prev.hide();this.$next.hide()}},onPrevClick:function(c){var d=c.target||c.srcElement;Event.stop(c);if(this.amount<=this.slidesRegionWidth){this.getItems();return}if(Mtime.browser.ie===0||Mtime.browser.ie>9){this.$next.show();this.pageIndex--;this.currentPosition+=this.slidesRegionWidth;if(this.pageIndex<=0){this.currentPosition=0;this.$prev.hide()}this.$slidesRegion.style.left=this.currentPosition+"px"}else{this.prevSlides()}},onNextClick:function(d){var f=d.target||d.srcElement;Event.stop(d);if(this.amount<=this.slidesRegionWidth){this.getItems();return}if(Mtime.browser.ie===0||Mtime.browser.ie>9){this.$prev.show();this.pageIndex++;this.currentPosition-=this.slidesRegionWidth;if(this.pageIndex>=this.amountIndex-1){var e=(this.amount-this.showRegionWidth)%this.slidesRegionWidth;this.currentPosition=this.currentPosition+(this.slidesRegionWidth-e);this.$next.hide();if(this.span){this.span.hide()}}this.$slidesRegion.style.left=this.currentPosition+"px"}else{this.nextSlides()}},prevSlides:function(){if(this.lock){return}var c=null;var d=0;this.$next.show();if(this.span){this.span.show()}this.pageIndex--;d=this.slidesRegionWidth;if(this.pageIndex<=0){d=Math.abs(this.currentPosition);this.$prev.hide()}c={node:this.slidesRegion,duration:this.duration,scale:d,position:this.currentPosition,callback:function(){if(this.pageIndex<=0){this.currentPosition=0}}.bind(this)};this.move(c);this.currentPosition+=this.slidesRegionWidth},nextSlides:function(){if(this.lock){return}var d=null;var f=0;this.$prev.show();this.pageIndex++;var e;f=-this.slidesRegionWidth;if(this.pageIndex>=this.amountIndex-1){e=(this.amount-this.showRegionWidth)%this.slidesRegionWidth;f=f+(this.slidesRegionWidth-e);this.$next.hide();if(this.span){this.span.hide()}}d={node:this.slidesRegion,duration:this.duration,scale:f,position:this.currentPosition,callback:function(){if(this.pageIndex>=this.amountIndex-1){e=(this.amount-this.showRegionWidth)%this.slidesRegionWidth;this.currentPosition=this.currentPosition+(this.slidesRegionWidth-e)}}.bind(this)};this.move(d);this.currentPosition-=this.slidesRegionWidth},move:function(b){this.lock=true;new Fx.Move(b.node,{scaleX:true,duration:b.duration,distances:{left:b.scale,position:b.position},callback:function(){this.lock=false;b.callback&&b.callback()}.bind(this)})},destroyEvent:function(){this.onPrevClickHandler&&Event.stopObserving(this.$prev,"click",this.onPrevClickHandler);this.onNextClickHandler&&Event.stopObserving(this.$next,"click",this.onNextClickHandler)},destroyDOM:function(){this.slidesRegion=null;this.prev=null;this.next=null}});Widgets.indexDistanceSlidesControl=Class.create();Object.extend(Widgets.indexDistanceSlidesControl.prototype,Widgets.DistanceSlidesControl.prototype);Object.extend(Widgets.indexDistanceSlidesControl.prototype,{initializeDom:function(){this.$slidesRegion=$(this.slidesRegion);if(Mtime.browser.ie>0||Mtime.browser.ie<9){this.$slidesRegion.addClassName("transition6")}this.$prev=$(this.prev);this.$next=$(this.next);this.spanr=this.$next.next("i.shadowr");this.spanl=this.$next.next("i.shadowl");this.spanl&&(this.spanl.hide())},getItems:function(){this.$slidesRegions=this.$slidesRegion.immediateDescendants();this.length=this.$slidesRegions.length;if(this.itemWidth>0){this.amount=this.itemWidth*this.length}else{for(var b=0;b<this.length;b++){this.amount+=this.$slidesRegions[b].clientWidth}}this.$slidesRegion.style.width=this.amount+100+"px";this.amountIndex=Math.ceil(this.amount/this.slidesRegionWidth)-1},onPrevClick:function(c){var d=c.target||c.srcElement;Event.stop(c);if(this.amount<=this.slidesRegionWidth){this.getItems();return}this.spanr.show();if(Mtime.browser.ie===0||Mtime.browser.ie>9){this.$next.show();this.pageIndex--;this.currentPosition+=this.slidesRegionWidth;if(this.pageIndex<=0){this.currentPosition=0;this.$prev.hide();this.spanl&&(this.spanl.hide())}this.$slidesRegion.style.left=this.currentPosition+"px"}else{this.prevSlides()}},onNextClick:function(d){var f=d.target||d.srcElement;Event.stop(d);if(this.amount<=this.slidesRegionWidth){this.getItems();return}this.spanl.show();if(Mtime.browser.ie===0||Mtime.browser.ie>9){this.$prev.show();this.pageIndex++;this.currentPosition-=this.slidesRegionWidth;this.$slidesRegion.style.left=this.currentPosition+"px";if(this.pageIndex>=this.amountIndex-1){var e=(this.amount-this.showRegionWidth)%this.slidesRegionWidth;this.$next.hide();this.spanr&&(this.spanr.hide())}}else{this.nextSlides()}},prevSlides:function(){if(this.lock){return}var c=null;var d=0;this.$next.show();this.pageIndex--;d=this.slidesRegionWidth;c={node:this.slidesRegion,duration:this.duration,scale:d,position:this.currentPosition,callback:function(){if(this.pageIndex<=0){this.currentPosition=0;this.spanl&&(this.spanl.hide())}}.bind(this)};this.move(c);if(this.pageIndex<=0){this.pageIndex=0;d=Math.abs(this.currentPosition);this.$prev.hide()}this.currentPosition+=this.slidesRegionWidth},nextSlides:function(){if(this.lock){return}var d=null;var f=0;this.$prev.show();this.pageIndex++;var e;f=-this.slidesRegionWidth;d={node:this.slidesRegion,duration:this.duration,scale:f,position:this.currentPosition,callback:function(){if(this.pageIndex>=this.amountIndex-1){e=(this.amount-this.showRegionWidth)%this.slidesRegionWidth;this.spanr&&(this.spanr.hide())}}.bind(this)};this.move(d);if(this.pageIndex>=this.amountIndex-1){e=(this.amount-this.showRegionWidth)%this.slidesRegionWidth;f=f+(this.slidesRegionWidth-e);this.$next.hide();if(this.span){this.span.hide()}}this.currentPosition-=this.slidesRegionWidth}});Widgets.ShowButtonDistanceSlidesControl=Class.create();Object.extend(Widgets.ShowButtonDistanceSlidesControl.prototype,Widgets.DistanceSlidesControl.prototype);Object.extend(Widgets.ShowButtonDistanceSlidesControl.prototype,{options:{slidesRegion:"",prev:"",next:"",prevCss:"",nextCss:"",showRegionWidth:695,slidesRegionWidth:1000,currentPosition:0,itemWidth:0,duration:0.5,type:"neat"},reset:function(){this.isReset=true;this.currentPosition=0;this.$slidesRegion.style.left=this.currentPosition+"px";this.pageIndex=0;this.amount=0;this.getItems();if(this.amount>this.slidesRegionWidth){this.showNextbtn();if(this.currentPosition===0){this.hidePrevbtn()}else{this.showPrevbtn()}}else{this.$prev.hide();this.$next.hide()}},onPrevClick:function(c){var d=c.target||c.srcElement;Event.stop(c);if(this.amount<=this.slidesRegionWidth){this.getItems();return}this.showNextbtn();this.pageIndex--;this.currentPosition+=this.slidesRegionWidth;if(this.pageIndex<=0){this.currentPosition=0;this.hidePrevbtn()}this.$slidesRegion.style.left=this.currentPosition+"px"},showPrevbtn:function(){if(this.prevCss!=""){if(this.$prev.hasClassName(this.prevCss)){this.$prev.removeClassName(this.prevCss)}}else{this.$prev.show()}},hidePrevbtn:function(){if(this.prevCss!=""){if(!this.$prev.hasClassName(this.prevCss)){this.$prev.addClassName(this.prevCss)}}else{this.$prev.show()}},showNextbtn:function(){if(this.nextCss!=""){if(this.$next.hasClassName(this.nextCss)){this.$next.removeClassName(this.nextCss)}}else{this.$next.show()}},hideNextbtn:function(){if(this.nextCss!=""){if(!this.$next.hasClassName(this.nextCss)){this.$next.addClassName(this.nextCss)}}else{this.$next.hide()}},onNextClick:function(c){var d=c.target||c.srcElement;Event.stop(c);if(this.amount<=this.slidesRegionWidth){this.getItems();return}this.showPrevbtn();this.pageIndex++;this.currentPosition-=this.slidesRegionWidth;if(this.pageIndex>=this.amountIndex-1){this.hideNextbtn();if(this.span){this.span.hide()}}this.$slidesRegion.style.left=this.currentPosition+"px"},prevSlides:function(){if(this.lock){return}var c=null;var d=0;this.$next.show();this.showNextbtn();if(this.span){this.span.show()}this.pageIndex--;d=this.slidesRegionWidth;if(this.pageIndex<=0){d=Math.abs(this.currentPosition);this.hidePrevbtn()}c={node:this.slidesRegion,duration:this.duration,scale:d,position:this.currentPosition,callback:function(){if(this.pageIndex<=0){this.currentPosition=0}}.bind(this)};this.move(c);this.currentPosition+=this.slidesRegionWidth},nextSlides:function(){if(this.lock){return}var d=null;var f=0;this.showPrevbtn();this.pageIndex++;var e;f=-this.slidesRegionWidth;if(this.pageIndex>=this.amountIndex-1){e=(this.amount-this.showRegionWidth)%this.slidesRegionWidth;f=f+(this.slidesRegionWidth-e);this.hideNextbtn();if(this.span){this.span.hide()}}d={node:this.slidesRegion,duration:this.duration,scale:f,position:this.currentPosition,callback:function(){if(this.pageIndex>=this.amountIndex-1){e=(this.amount-this.showRegionWidth)%this.slidesRegionWidth;this.currentPosition=this.currentPosition+(this.slidesRegionWidth-e)}}.bind(this)};this.move(d);this.currentPosition-=this.slidesRegionWidth}});Widgets.WholePageDistanceSlidesControl=Class.create();Object.extend(Widgets.WholePageDistanceSlidesControl.prototype,Widgets.DistanceSlidesControl.prototype);Object.extend(Widgets.WholePageDistanceSlidesControl.prototype,{onPrevClick:function(d){if(this.lock){return}var f=d.target||d.srcElement;Event.stop(d);if(this.amount<=this.slidesRegionWidth){this.getItems();return}this.$next.show();var e=this.currentPosition;this.currentPosition+=this.slidesRegionWidth;if(this.currentPosition>=0){this.currentPosition=0;this.$prev.hide()}if(Mtime.browser.ie===0||Mtime.browser.ie>9){this.$slidesRegion.style.left=this.currentPosition+"px";setTimeout(function(){this.lock=false}.bind(this),600)}else{this.slideMethod(this.$slidesRegion,e,this.currentPosition)}},onNextClick:function(d){if(this.lock){return}var f=d.target||d.srcElement;Event.stop(d);if(this.amount<=this.slidesRegionWidth){this.getItems();return}this.$prev.show();this.pageIndex++;var e=this.currentPosition;this.currentPosition-=this.slidesRegionWidth;if((this.showRegionWidth-this.currentPosition)>=this.amount){this.currentPosition=-(this.amount-this.showRegionWidth);this.$next.hide();if(this.span){this.span.hide()}}if(Mtime.browser.ie===0||Mtime.browser.ie>9){this.$slidesRegion.style.left=this.currentPosition+"px";setTimeout(function(){this.lock=false}.bind(this),600)}else{this.slideMethod(this.$slidesRegion,e,this.currentPosition)}},slideMethod:function(e,h,f){var g={element:e,duration:this.duration,speed:10,startScale:h,endScale:f,callback:function(){this.lock=false}.bind(this)};this.lock=true;this.move(g)},move:function(k){var m=k.speed;var h=k.startScale;var j=k.endScale;var g=k.startScale;function l(){var a=false;if(h>j){g-=m;if(g<=j){g=j;a=true}}else{if(h<j){g+=m;if(g>=j){g=j;a=true}}else{g=j;a=true}}k.element.setStyle({left:g+"px"});if(a){k.callback()}else{setTimeout(l,k.duration)}}l()}});Widgets.FilterComponent=Class.create();Object.extend(Widgets.FilterComponent.prototype,Widgets.Base.prototype);Object.extend(Widgets.FilterComponent.prototype,{options:{container:"filters",filterArray:["最新","最热","最近三个月"],currentIndex:0,callback:null,filterWidth:50,itemWidth:15},initializeDom:function(){this.$container=$(this.container);this.builderHtml()},initializeEvent:function(){if(this.$filterContainer){this.containerOverHandler=this.containerOver.bind(this);Event.observe(this.$filterContainer,"mouseover",this.containerOverHandler);this.containerOutHandler=this.containerOut.bind(this);Event.observe(this.$filterContainer,"mouseout",this.containerOutHandler)}if(this.$dbSeldrop){this.dbSeldropClickHandler=this.dbSeldropClick.bind(this);Event.observe(this.$dbSeldrop,"click",this.dbSeldropClickHandler)}Event.observe(window,"unload",this.close.bind(this))},containerOver:function(b){this.handleOutTimer();Event.stop(b);this.collectBoxTimeout=FunctionExt.defer(function(){if(this.collectBoxTimeout!=null){clearTimeout(this.collectBoxTimeout)}this.$filterContainer.addClassName("open");this.$filterContainer.style.height=this._height+25+"px";this.$dbSeldrop.style.height=this._height+"px";this.$filterContainer.style.width=this._width+"px"},300,this)},containerOut:function(b){this.handleOutTimer();Event.stop(b);this.collectBoxTimeout=FunctionExt.defer(function(){this.$filterContainer.style.height="0px";this.$dbSeldrop.style.height="0px";FunctionExt.defer(function(){this.$filterContainer.removeClassName("open");this.$filterContainer.style.width=this.currentTxtWidth+"px"},100,this)},100,this)},dbSeldropClick:function(g){var f=Event.findElement(g,"p"),j=f.readAttribute("serial"),h=this.currentIndex;this.currentIndex=parseInt(j,10);var k=this.filterArray[this.currentIndex];if(k===this.$currentBtn.innerHTML){return}f.addClassName("active");this.$dbSeldrops[h].removeClassName("active");this.$currentBtn.innerHTML=k;this.callback&&this.callback(j);this.currentTxtWidth=this.filterWidth+this.itemWidth*Widgets.Utils.strLen(k);this.containerOut(g)},handleOutTimer:function(){if(this.collectBoxTimeout!=null){clearTimeout(this.collectBoxTimeout);this.collectBoxTimeout=null}},builderHtml:function(){var j=25,k=Widgets.Utils.strArrayMax(this.filterArray),g=this.filterArray.length,h=new StringBuilder(),f=this.filterArray[this.currentIndex];this.currentTxtWidth=this.filterWidth+this.itemWidth*Widgets.Utils.strLen(f);this._height=j*g;this._width=this.filterWidth+this.itemWidth*k;this.$container.style.width=this.currentTxtWidth+"px";h.append('<div id="filterContainer" class="db_selinner" style="width:'+this.currentTxtWidth+'px"><i></i>');h.append('<div id="currentBtn" method="currentBtn" class="db_selon">'+f+"</div>");h.append('<div id="dbseldrop" class="db_seldrop">');for(i=0;i<g;i++){if(i===this.currentIndex){h.append('<p serial="'+i+'" class="active"><em></em>'+this.filterArray[i]+"</p>")}else{h.append('<p serial="'+i+'"><em></em>'+this.filterArray[i]+"</p>")}}h.append("</div></div>");this.$container.innerHTML=h.toString();this.$filterContainer=$("filterContainer");this.$currentBtn=$("currentBtn");this.$dbSeldrop=$("dbseldrop");this.$dbSeldrops=this.$dbSeldrop.immediateDescendants()},destroyEvent:function(){if(this.$filterContainer){Event.stopObserving(this.$filterContainer,"mouseover",this.containerOverHandler);Event.stopObserving(this.$filterContainer,"mouseout",this.containerOutHandler)}if(this.$dbSeldrop){Event.stopObserving(this.$dbSeldrop,"click",this.dbSeldropClickHandler)}},destroyDOM:function(){this.containerOverHandler=null;this.containerOutHandler=null;this.dbSeldropClickHandler=null;this.$filterContainer=null;this.$dbSeldrop=null;this.$container=null;this.$currentBtn=null;this.$dbSeldrops=null}});Widgets.FixSpan=Class.create();Object.extend(Widgets.FixSpan.prototype,Widgets.Base.prototype);Object.extend(Widgets.FixSpan.prototype,{options:{container:"",prev:"",next:""},initializeDom:function(b){if(this.container){this.$container=$(this.container);this.$conParent=this.$container.up();this.$conTop=this.$conParent.previous()}if(this.prev){this.$prev=$(this.prev);this.prevTopHeight=this.$prev.offsetTop-this.$prev.offsetHeight*2}if(this.next){this.$next=$(this.next);this.nextTopHeight=this.$next.offsetTop-this.$next.offsetHeight*2}this.viewWidth=document.documentElement.clientWidth;if(this.$conParent){this.fixHeight=this.$conTop.offsetHeight+this.$conParent.offsetHeight}if(this.viewWidth<=1100){if(this.$prev.hasClassName("fixed")){this.$prev.removeClassName("fixed");this.$prev.addClassName("fixed1024")}if(this.$next.hasClassName("fixed")){this.$next.removeClassName("fixed");this.$next.addClassName("fixed1024")}}if(Mtime.browser.ie===6){this.$prev.style.position="absolute";this.$prev.style.marginLeft=-275+"px";this.$prev.style.top=299+"px";this.$next.style.position="absolute";this.$next.style.marginLeft=235+"px";this.$next.style.top=299+"px";if(this.viewWidth<=1100){this.$prev.style.marginLeft=-225+"px";this.$next.style.marginRight=0;this.$next.style.right=50+"px"}}},initializeEvent:function(){this.fixedSpanHandler=this.fixedSpan.bind(this);this.resizeSpanHandler=this.resizeSpan.bind(this);Event.observe(window,"scroll",this.fixedSpanHandler);Event.observe(window,"resize",this.resizeSpanHandler);Event.stopObserving(window,"unload",this.close.bind(this))},resizeSpan:function(){this.viewWidth=document.documentElement.clientWidth;if(this.$prev&&Mtime.browser.ie!==6&&this.fixHeight>this.tHeight){this.prevTopHeight=this.$prev.offsetTop-this.$prev.offsetHeight*2}if(this.$next&&Mtime.browser.ie!==6&&this.fixHeight>this.tHeight){this.nextTopHeight=this.$next.offsetTop-this.$next.offsetHeight*2}if(this.viewWidth<=1100){if(this.$prev.hasClassName("fixed")){this.$prev.removeClassName("fixed");this.$prev.addClassName("fixed1024")}if(this.fixHeight<=this.tHeight){this.$prev.style.marginLeft=(this.viewWidth-1000)/2+"px"}else{this.$prev.style.left=""}if(this.$next.hasClassName("fixed")){this.$next.removeClassName("fixed");this.$next.addClassName("fixed1024")}if(this.fixHeight<=this.tHeight){this.$next.style.marginRight=(this.viewWidth-1000)/2+"px"}else{this.$next.style.right=""}if(Mtime.browser.ie===6){if(this.fixHeight<=this.tHeight){this.$prev.style.marginLeft=0;this.$prev.style.left=50+"px"}else{this.$prev.style.marginLeft=-225+"px";this.$prev.style.left=""}this.$next.style.marginRight=0;this.$next.style.right=50+"px"}}else{if(this.$prev.hasClassName("fixed1024")){this.$prev.removeClassName("fixed1024");this.$prev.addClassName("fixed")}if(this.fixHeight<=this.tHeight){this.$prev.style.left="";this.$prev.style.marginLeft=""}else{this.$prev.style.left=""}if(this.$next.hasClassName("fixed1024")){this.$next.removeClassName("fixed1024");this.$next.addClassName("fixed")}if(this.fixHeight<=this.tHeight){this.$next.style.right="";this.$next.style.marginRight=""}else{this.$next.style.right=""}if(Mtime.browser.ie===6){if(this.fixHeight<=this.tHeight){this.$prev.style.marginLeft=0;this.$prev.style.left=0}else{this.$prev.style.marginLeft=-275+"px";this.$prev.style.left=""}this.$next.style.marginLeft=235+"px";this.$next.style.marginRight="";this.$next.style.right=""}}},fixedSpan:function(){this.scrollTop=document.documentElement.scrollTop||document.body.scrollTop;this.tHeight=this.scrollTop+document.documentElement.clientHeight;if(this.$prev&&Mtime.browser.ie!==6&&this.fixHeight<=this.tHeight){this.prevTopHeight=this.$prev.offsetTop-this.$prev.offsetHeight*2}if(this.$next&&Mtime.browser.ie!==6&&this.fixHeight<=this.tHeight){this.nextTopHeight=this.$next.offsetTop-this.$next.offsetHeight*2}this.viewWidth=document.documentElement.clientWidth;this.prevDynamicHeight=this.prevTopHeight+this.$prev.offsetHeight*2+16;this.nextDynamicHeight=this.nextTopHeight+this.$next.offsetHeight*2+16;if(this.fixHeight<=this.tHeight){if(this.viewWidth<=1100){if(this.$prev.hasClassName("fixed1024")){this.$prev.removeClassName("fixed1024");if(Mtime.browser.ie){this.$prev.style.top=this.prevDynamicHeight+this.scrollTop+"px";this.$prev.style.marginLeft=(this.viewWidth-1000)/2+"px";if(Mtime.browser.ie===6){this.$prev.style.marginLeft=0;this.$prev.style.left=50+"px";this.ie6UnFix(this.$prev,this.$prev.offsetTop+220)}}else{this.$prev.style.top=this.prevTopHeight+this.scrollTop+"px";this.$prev.style.marginLeft=(this.viewWidth-1000)/2+"px"}}if(this.$next.hasClassName("fixed1024")){this.$next.removeClassName("fixed1024");if(Mtime.browser.ie){this.$next.style.top=this.nextDynamicHeight+this.scrollTop+"px";this.$next.style.marginRight=(this.viewWidth-1000)/2+"px";if(this.viewWidth<1000){this.$next.style.marginRight=-(this.viewWidth-1000)/2+"px"}if(Mtime.browser.ie===6){this.$next.style.marginRight=0;this.$next.style.right=50+"px";this.ie6UnFix(this.$next,this.$next.offsetTop+220)}}else{this.$next.style.top=this.nextTopHeight+this.scrollTop+"px";this.$next.style.marginRight=(this.viewWidth-1000)/2+"px";if(this.viewWidth<1000){this.$next.style.marginRight=-(this.viewWidth-1000)/2+"px"}}}}else{if(this.$prev.hasClassName("fixed")){this.$prev.removeClassName("fixed");if(Mtime.browser.ie){this.$prev.style.top=this.prevDynamicHeight+this.scrollTop+"px";if(Mtime.browser.ie===6){this.$prev.style.marginLeft=0;this.ie6UnFix(this.$prev,this.$prev.offsetTop+218)}}else{this.$prev.style.top=this.prevTopHeight+this.scrollTop+"px"}}if(this.$next.hasClassName("fixed")){this.$next.removeClassName("fixed");if(Mtime.browser.ie){this.$next.style.top=this.nextDynamicHeight+this.scrollTop+"px";if(Mtime.browser.ie===6){this.$next.style.marginLeft=0;this.ie6UnFix(this.$next,this.$next.offsetTop+218)}}else{this.$next.style.top=this.nextTopHeight+this.scrollTop+"px"}}}}else{if(this.viewWidth<=1100){if(!this.$prev.hasClassName("fixed1024")){this.$prev.addClassName("fixed1024");this.$prev.style.top="";this.$prev.style.left="";if(Mtime.browser.ie===6){this.$prev.style.marginLeft=0;this.$prev.style.left=50+"px"}else{this.$prev.style.marginLeft=""}}if(!this.$next.hasClassName("fixed1024")){this.$next.addClassName("fixed1024");this.$next.style.top="";this.$next.style.right="";if(Mtime.browser.ie===6){this.$next.style.marginLeft=0;this.$next.style.right=50+"px"}else{this.$next.style.marginRight=""}}if(Mtime.browser.ie===6&&this.$next.hasClassName("fixed1024")&&this.$prev.hasClassName("fixed1024")){this.ie6Fix(this.$prev,this.prevDynamicHeight+203);this.ie6Fix(this.$next,this.nextDynamicHeight+203)}}else{if(!this.$prev.hasClassName("fixed")){this.$prev.addClassName("fixed");this.$prev.style.top="";this.$prev.style.left="";if(Mtime.browser.ie===6){this.$prev.style.marginLeft=-275+"px"}}if(!this.$next.hasClassName("fixed")){this.$next.addClassName("fixed");this.$next.style.top="";this.$next.style.right="";if(Mtime.browser.ie===6){this.$next.style.marginLeft=235+"px"}}if(Mtime.browser.ie===6&&this.$next.hasClassName("fixed")&&this.$prev.hasClassName("fixed")){this.ie6Fix(this.$prev,this.prevDynamicHeight+203);this.ie6Fix(this.$next,this.nextDynamicHeight+203)}}}},ie6Fix:function(c,d){document.documentElement.style.backgroundImage="url(about:blank)";document.documentElement.style.backgroundAttachment="fixed";!isNaN(d)&&c.style.setExpression("top","eval(document.documentElement.scrollTop + "+d+")")},ie6UnFix:function(c,d){document.documentElement.style.backgroundImage="";document.documentElement.style.backgroundAttachment="";!isNaN(d)&&c.style.setExpression("top","eval("+d+") + 'px'")},destroyEvent:function(){if(this.fixedSpanHandler){Event.stopObserving(window,"scroll",this.fixedSpanHandler)}if(this.resizeSpanHandler){Event.stopObserving(window,"resize",this.resizeSpanHandler)}},destroyDOM:function(){this.$container=null;this.$conParent=null;this.$conTop=null;this.$prev=null;this.$next=null;this.viewWidth=null;this.fixHeight=null;this.prevTopHeight=null;this.nextTopHeight=null;this.scrollTop=null;this.tHeight=null}});Widgets.IndexTopSlidesControl=Class.create();Object.extend(Widgets.IndexTopSlidesControl.prototype,Widgets.BehindSlidesControl.prototype);Object.extend(Widgets.IndexTopSlidesControl.prototype,{options:{slidesRegion:"movieSlidesItems",dotSlidesRegion:"",backSlidesRegion:"",txtSlidesRegion:"",advertisementRegion:"",prev:"prev",next:"next",autoTimeout:null,items:[],imageTemplate:"",duration:0.5,type:"neat"},initializeDom:function(){this.$slidesRegion=$(this.slidesRegion);if(!this.$slidesRegion){return}this.$presentNumber=$(this.presentNumber);this.$sumNumber=$(this.sumNumber);this.$titleTxt=$(this.titleTxt);this.$describeTxt=$(this.describeTxt);this.$images=this.$slidesRegion.immediateDescendants();this.imagesLen=this.$images.length;if(this.$sumNumber){this.$sumNumber.innerHTML="/"+this.imagesLen}this.presentNum=1;if(this.$presentNumber){this.$presentNumber.innerHTML=this.presentNum}if(this.$titleTxt){this.$titleTxt.innerHTML=Widgets.Utils.strShort(this.$images[0].readAttribute("title"),24)}if(this.$describeTxt){this.$describeTxt.innerHTML=Widgets.Utils.strShort(this.$images[0].readAttribute("imgabstract"),46)}},destroyDOM:function(){this.$presentNumber=null;this.$sumNumber=null;this.$titleTxt=null;this.$describeTxt=null;this.$images=null;this.imagesLen=null;if(this.mySlidesControl){this.mySlidesControl.close()}},instanceSlidesControl:function(){if(!this.$slidesRegion){return}var b=this;this.mySlidesControl=new SlidesControl({slidesRegion:this.slidesRegion,prev:this.prev,next:this.next,scale:this.$images[0].offsetWidth,duration:this.duration,type:"neat",autoTimeout:this.autoTimeout,initializeField:function(){this.slidesRegion=$(this.slidesRegion);this.prev=$(this.prev);this.next=$(this.next);this.currentIndex=0;this.position=0;this.length=0;if(this.slidesRegion){this.items=this.slidesRegion.immediateDescendants();this.length=this.items.length;this.clientHeight=document.documentElement.clientHeight||document.body.clientHeight}this.lock=false;this.$dotSlidesRegion=$(b.dotSlidesRegion);if(this.$dotSlidesRegion){this.$dotSlidesRegions=this.$dotSlidesRegion.immediateDescendants()}this.$backSlidesRegion=$(b.backSlidesRegion);if(this.$backSlidesRegion){this.$backSlidesRegions=this.$backSlidesRegion.immediateDescendants()}this.$txtSlidesRegion=$(b.txtSlidesRegion);if(this.$txtSlidesRegion){this.$txtSlidesRegions=this.$txtSlidesRegion.immediateDescendants();if(this.$txtSlidesRegions){var a=this.$txtSlidesRegions[0];var f=a.getAttribute("rectype");if(f==="special"){this.$txtSlidesRegion.style.zIndex=1}}}this.$adRegion=$(b.advertisementRegion);if(this.$adRegion){this.$adRegion.style.display="none";this.$adRegions=this.$adRegion.immediateDescendants()}this.prevIndex=0;for(var e=0;e<this.length;e++){if(this.$adRegion&&this.$adRegions&&this.$adRegions.length>0){this.$adRegions[e].adClose=this.$adRegions[e].down('i[method="close"]');this.$adRegions[e].adTip=this.$adRegions[e].down('div[method="tip"]');if(this.$adRegions[e].adTip&&this.$adRegions[e].adTip.childElements().length>0){this.$adRegions[e].removeClassName("none");this.$adRegions[e].setAttribute("tiptype","1")}}if(e===0){this.items[e].style.opacity=1;this.items[e].style.zIndex=3;if(this.$adRegion&&this.$adRegions&&this.$adRegions.length>0){this.$adRegions[e].style.opacity=1;this.$adRegions[e].style.zIndex=3;if(this.$adRegions[e].adTip&&this.$adRegions[e].adTip.childElements().length>0){this.$adRegion.style.display="block"}}}else{if(Mtime.browser.ie>0&&Mtime.browser.ie<=9){this.items[e].style.display="none"}this.items[e].style.opacity=0;this.items[e].style.zIndex=1;if(this.$adRegion&&this.$adRegions&&this.$adRegions.length>0){this.$adRegions[e].style.opacity=0;this.$adRegions[e].style.zIndex=1}}}this.timeOutMethod()},initializeEvent:function(){this.slidesRegionOverHendler=this.slidesRegionOver.bind(this);this.slidesRegionOutHendler=this.slidesRegionOut.bind(this);this.slidesRegionClickHendler=this.slidesRegionClick.bind(this);if(this.slidesRegion){Event.observe(this.slidesRegion,"mouseover",this.slidesRegionOverHendler);Event.observe(this.slidesRegion,"mouseout",this.slidesRegionOutHendler)}if(this.$adRegion){Event.observe(this.$adRegion,"mouseover",this.slidesRegionOverHendler);Event.observe(this.$adRegion,"mouseout",this.slidesRegionOutHendler);Event.observe(this.$adRegion,"click",this.slidesRegionClickHendler)}if(this.prev){this.onPrevClickHandler=this.onPrevClick.bind(this);Event.observe(this.prev,"click",this.onPrevClickHandler);Event.observe(this.prev,"mouseover",this.slidesRegionOverHendler);Event.observe(this.prev,"mouseout",this.slidesRegionOutHendler)}if(this.next){this.onNextClickHandler=this.onNextClick.bind(this);Event.observe(this.next,"click",this.onNextClickHandler);Event.observe(this.next,"mouseover",this.slidesRegionOverHendler);Event.observe(this.next,"mouseout",this.slidesRegionOutHendler)}if(this.$dotSlidesRegion){this.dotSlidesRegionClickHandler=this.dotSlidesRegionClick.bind(this);Event.observe(this.$dotSlidesRegion,"click",this.dotSlidesRegionClickHandler);Event.observe(this.$dotSlidesRegion,"mouseover",this.slidesRegionOverHendler);Event.observe(this.$dotSlidesRegion,"mouseout",this.slidesRegionOutHendler)}Event.observe(window,"unload",this.close.bind(this))},onPrevClick:function(a){var d=a.target||a.srcElement;Event.stop(a);if(this.lock){return}if(this.amount&&this.currentIndex<1){this.currentIndex=this.amount-1}else{if(this.currentIndex<1){this.currentIndex=this.length-1}else{this.currentIndex--}}this.myTimeout&&clearTimeout(this.myTimeout);this.move()},onNextClick:function(a){var d=a.target||a.srcElement;Event.stop(a);if(this.lock){return}if(this.amount&&this.currentIndex>this.amount-2){this.currentIndex=0}else{if(this.currentIndex>this.length-2){this.currentIndex=0}else{this.currentIndex++}}this.myTimeout&&clearTimeout(this.myTimeout);this.move()},move:function(a){this.lock=true;this.slidesRegionMethod();this.backSlidesRegionsMethod();this.dotSlidesRegionsMethod();this.txtSlidesRegionsMethod();this.prevIndex=this.currentIndex},slidesRegionMethod:function(){if(this.slidesRegion){var q=this.items[this.prevIndex],p=this.items[this.currentIndex],a,l,o,n,k,m;if(this.$adRegion&&this.$adRegions&&this.$adRegions.length>0){a=this.$adRegions[this.prevIndex];l=this.$adRegions[this.currentIndex];o=this.$adRegions[this.currentIndex].adTip;n=l.getAttribute("tiptype");k=a.getAttribute("tiptype");m=l.getAttribute("tiptype")}if(q!==p){if(!q.hasClassName("transition8")){q.addClassName("transition8")}if(!p.hasClassName("transition8")){p.addClassName("transition8")}if(this.$adRegion&&this.$adRegions&&this.$adRegions.length>0){if(!a.hasClassName("transition8")){a.addClassName("transition8")}if(!l.hasClassName("transition8")){l.addClassName("transition8")}this.beforeAdMthod(l,o,n)}p.style.zIndex=3;q.style.zIndex=1;q.style.opacity=0;p.style.opacity=1;if(this.$adRegion&&this.$adRegions&&this.$adRegions.length>0){n=l.getAttribute("tiptype");if(n){a.style.zIndex=1;l.style.zIndex=3;a.style.opacity=0;l.style.opacity=1;a.style.filter="alpha(opacity=0)";l.style.filter="alpha(opacity=100)"}else{if(this.$adRegion){this.$adRegion.style.display="none";a.addClassName("none");l.addClassName("none");a.style.zIndex=1;l.style.zIndex=1;a.style.opacity=0;l.style.opacity=0;a.style.filter="alpha(opacity=0)";l.style.filter="alpha(opacity=0)"}}}if(Mtime.browser.ie===0||Mtime.browser.ie>9){FunctionExt.defer(function(){this.timeOutMethod();if(this.$adRegion&&this.$adRegions&&this.$adRegions.length>0){this.afterAdMethod(a,k)}if(!this.$txtSlidesRegions||(this.$txtSlidesRegions&&this.$txtSlidesRegions.length<=0)){this.lock=false}q=p=a=l=o=k=m=n=null}.bind(this),800)}else{this.lock=false;q.style.display="none";p.style.display="block";this.timeOutMethod();this.afterAdMethod(a,k);q=p=a=l=o=k=m=n=null}}}},beforeAdMthod:function(a,f,e){if(!e&&f&&f.childElements().length>0){a.removeClassName("none");a.setAttribute("tiptype","1");if(this.$adRegion){this.$adRegion.style.display="block"}}else{if(e==="1"){if(this.$adRegion){this.$adRegion.style.display="block"}}}},afterAdMethod:function(a,d){if(d==="1"){a.addClassName("none");a.setAttribute("tiptype","2")}if(d==="2"){a.removeClassName("none");a.setAttribute("tiptype","1")}},backSlidesRegionsMethod:function(){if(this.$backSlidesRegions){var d=this.$backSlidesRegions[this.prevIndex],a=this.$backSlidesRegions[this.currentIndex];if(d!==a){if(!d.hasClassName("transition3")){d.addClassName("transition3")}if(!a.hasClassName("transition3")){a.addClassName("transition3")}a.style.opacity=1;d.style.opacity=0;if(Mtime.browser.ie===0||Mtime.browser.ie>9){FunctionExt.defer(function(){a.style.zIndex=3;d.style.zIndex=1;d=a=null}.bind(this),300)}else{a.style.zIndex=3;d.style.zIndex=1;d=a=null}}}},dotSlidesRegionsMethod:function(){if(this.$dotSlidesRegions){var d=this.$dotSlidesRegions[this.prevIndex],a=this.$dotSlidesRegions[this.currentIndex];if(d.hasClassName("on")){d.removeClassName("on")}if(!a.hasClassName("on")){a.addClassName("on")}d=a=null}},txtSlidesRegionsMethod:function(){if(this.$txtSlidesRegions){var e=this.$txtSlidesRegions[this.prevIndex],a=this.$txtSlidesRegions[this.currentIndex];if(e!==a){if(this.$txtSlidesRegion.style.zIndex==="1"||this.$txtSlidesRegion.style.zIndex===1){this.$txtSlidesRegion.style.zIndex=3}if(!e.hasClassName("transition4")){e.addClassName("transition4")}var f=a.getAttribute("rectype");if(f==="special"){this.$txtSlidesRegion.style.zIndex=1}if(!a.hasClassName("transition6")){a.addClassName("transition6")}if(Mtime.browser.ie===0||Mtime.browser.ie>9){e.style.opacity=0;FunctionExt.defer(function(){a.style.display="block";e.style.display="none"}.bind(this),400);FunctionExt.defer(function(){a.style.opacity=1;this.lock=false;e=a=f=null}.bind(this),600)}else{a.style.opacity=1;a.style.display="block";e.style.display="none";e=a=f=null}}}},dotSlidesRegionClick:function(e){Event.stop(e);var a=Event.element(e),f;if(a&&!a.hasClassName("on")){if(this.lock){return}f=parseInt(a.innerHTML,10)-1;if(!isNaN(f)){this.currentIndex=f;this.move()}}},timeOutMethod:function(){this.myTimeout&&clearTimeout(this.myTimeout);var a,e=false,f;f=this.getXY(this.slidesRegion);a=document.documentElement.scrollTop||document.body.scrollTop;if(f.y>(a-400)&&f.y<(a+this.clientHeight+550)){e=true}if(this.autoTimeout){if(e){this.myTimeout=setTimeout(function(){f=this.getXY(this.slidesRegion);a=document.documentElement.scrollTop||document.body.scrollTop;if(f.y>(a-400)&&f.y<(a+this.clientHeight+550)){e=true}else{e=false}if(e){if(this.amount&&this.currentIndex>this.amount-2){this.currentIndex=0}else{if(this.currentIndex>this.length-2){this.currentIndex=0}else{this.currentIndex++}}this.nextSlides()}else{this.myTimeout=setTimeout(function(){this.timeOutMethod()}.bind(this),3000)}a=e=f=null}.bind(this),this.autoTimeout*1000)}else{a=e=f=null;this.myTimeout=setTimeout(function(){this.timeOutMethod()}.bind(this),3000)}}},slidesRegionOver:function(a){this.myTimeout&&clearTimeout(this.myTimeout)},slidesRegionOut:function(a){this.timeOutMethod()},slidesRegionClick:function(f){var a=Event.element(f);var h=a.getAttribute("method");if(h==="close"){Event.stop(f);var g=a.up("div.ddtiper");if(g.getAttribute("method")==="tipbox"){g.addClassName("none");if(this.$adRegion){this.$adRegion.style.display="none"}}}},getXY:function(j){var k=0,l=0;if(j.getBoundingClientRect){var a=j.getBoundingClientRect();var h=document.documentElement;k=Math.round(a.left+Math.max(h.scrollLeft,document.body.scrollLeft)-h.clientLeft);l=Math.round(a.top+Math.max(h.scrollTop,document.body.scrollTop)-h.clientTop)}else{for(;j!=document.body;k+=j.offsetLeft,l+=j.offsetTop,j=j.offsetParent){}}return{x:k,y:l}},close:function(){this.destroyEvent();this.destroyDOM()},destroyEvent:function(){if(this.$adRegion){Event.stopObserving(this.$adRegion,"mouseover",this.slidesRegionOverHendler);Event.stopObserving(this.$adRegion,"mouseout",this.slidesRegionOutHendler);Event.stopObserving(this.$adRegion,"click",this.slidesRegionClickHendler)}if(this.slidesRegion){Event.stopObserving(this.slidesRegion,"mouseover",this.slidesRegionOverHendler);Event.stopObserving(this.slidesRegion,"mouseout",this.slidesRegionOutHendler)}if(this.prev){Event.stopObserving(this.prev,"click",this.onPrevClickHandler);Event.stopObserving(this.prev,"mouseover",this.slidesRegionOverHendler);Event.stopObserving(this.prev,"mouseout",this.slidesRegionOutHendler)}if(this.next){Event.stopObserving(this.next,"click",this.onNextClickHandler);Event.stopObserving(this.next,"mouseover",this.slidesRegionOverHendler);Event.stopObserving(this.next,"mouseout",this.slidesRegionOutHendler)}if(this.$dotSlidesRegion){Event.stopObserving(this.$dotSlidesRegion,"click",this.dotSlidesRegionClickHandler);Event.stopObserving(this.$dotSlidesRegion,"mouseover",this.slidesRegionOverHendler);Event.stopObserving(this.$dotSlidesRegion,"mouseout",this.slidesRegionOutHendler)}},destroyDOM:function(){this.$adRegion=null;this.slidesRegion=null;this.prev=null;this.next=null;this.currentIndex=null;this.position=null;this.items=null;this.length=null;this.lock=null;this.$dotSlidesRegion=null;this.clientHeight=null}})}});Widgets.InfiniteScroll=Class.create();Object.extend(Widgets.InfiniteScroll.prototype,Widgets.Base.prototype);Object.extend(Widgets.InfiniteScroll.prototype,{options:{container:"",images:[],showRow:3,ddList:[],loading:"",pages:"pageDiv",type:"images",objType:1},indexNmu:0,descriptionSize:16,types:[6,1,41,31,5,21],subTypes:[[-1,6001,6002,6003],[-1,101,102,103,105],[-1,4101,4102,4103,4104],[-1],[-1],[-1,2104,2101,2103,2102]],subNavTabs:[["全部图片","官方剧照","截图","其它"],["全部图片","正式海报","预告海报","角色海报","其它海报"],["全部图片","官方工作照","定妆照","概念图","片场照"],["全部图片"],["全部图片"],["全部图片","蓝光封套","DVD封套","原声碟封套","录像带封套"]],imageTemplate:'<div class="db_pictypemod"><p><a class="pic_outer" href="#{imgDetailUrl}" target="_blank"><img width="220" alt="#{title}" src="#{img_220}" />#{statusRegion}</a></p><div class="p9 c_94 px12"><p class="c_a5">#{descriptionRegion}</p><div class="clearfix mt6">#{commentRegion}#{width}x#{height}</div></div></div>',imageCommentTemplate:'<span class="fr"><a class="icon_piccom" target="_blank" href="#{imgDetailUrl}"><i></i>#{commentCount}</a></span>',initializeDom:function(){this.ddList=[];this.$container=$(this.container);if(!this.$container){return}this.$loading=$(this.loading);if(this.$loading){this.$loading.hide()}this.$pages=$(this.pages);var c,d=false;if(this.type==="images"){this.imagesLen=this.images.length;for(c=0;c<this.imagesLen;c++){if(this.images[c].length>this.showRow){d=true}}}else{this.ddList=this.$container.immediateDescendants();this.imagesLen=this.ddList.length;for(c=0;c<this.imagesLen;c++){if(this.ddList[c].immediateDescendants().length>this.showRow){d=true}}}if(this.$pages){$hide(this.$pages)}if(!d){if(this.$pages){$show(this.$pages)}return}this.clientHeight=document.documentElement.clientHeight},initializeEvent:function(){this.onScrollDrawSeatHandler=this.onScrollDrawSeat.bind(this);Event.observe(window,"scroll",this.onScrollDrawSeatHandler);Event.observe(window,"unload",this.close.bind(this))},load:function(){if(this.type==="images"){for(var d=0;d<this.imagesLen;d++){var c=document.createElement("dd");this.ddList.push(c);this.$container.appendChild(c)}this.itemsLen=this.imagesLen;this.builderHtml()}else{this.items=[];for(var d=0;d<this.imagesLen;d++){if(this.ddList[d]){this.items.push(this.ddList[d].immediateDescendants())}}this.itemsLen=this.items.length;this.showItem()}},onScrollDrawSeat:function(g){if(this.indexNmu<this.itemsLen){var f=document.documentElement.scrollTop||document.body.scrollTop,e=document.body.offsetHeight;var h=f+this.clientHeight;if(f+this.clientHeight>=e-500){if(this.type==="images"){this.builderHtml()}else{this.showItem()}}f=e=h=null}},showItem:function(){if(this.itemsLen>0){for(i=0;i<this.itemsLen;i++){this.show(this.items[i])}}},show:function(g){var h=g.length,f;if(h===0){this.indexNmu++;if(this.indexNmu>=this.itemsLen){if(this.$loading){this.$loading.hide()}if(this.$pages){$show(this.$pages)}}return}for(var e=0;e<h&&e<this.showRow;e++){f=g.shift();$show(f)}},builderHtml:function(){var e=false,f;for(var d=0;d<this.imagesLen;d++){f=this.images[d].length;if(f>this.showRow){e=true}this.renderImage(this.ddList[d],this.images[d])}if(!e&&this.$pages){$show(this.$pages)}},renderImage:function(n,r){var q,u=new Template(this.imageTemplate),m=new Template(this.imageCommentTemplate),s=r.length,p,t;if(s===0){this.indexNmu++;if(this.indexNmu>=this.itemsLen){if(this.$loading){this.$loading.hide()}if(this.$pages){this.$pages.show()}}return}for(var o=0;o<s&&o<this.showRow;o++){p=r.shift();if(this.objType===1){p.descriptionRegion=this.getDescription(p)}else{if(this.objType===2){p.descriptionRegion=p.description}}p.commentRegion=p.commentCount>0?m.evaluate(p):"";p.statusRegion=p.status==4?"<span>待审核</span>":"";q=u.evaluate(p);var l=new StringBuilder();l.append(q);t=Builder.build(l.toString());n.appendChild(t)}},getDescription:function(j){var g="";switch(j.type){case 1:case 5:case 21:var k=this.types.indexOf(j.type);var l=this.subTypes[k].indexOf(j.subType);if(l>0){g=this.subNavTabs[k][l]}else{if(j.type===5){g="桌面"}}var m=j.title.indexOf("(");var h=j.title.indexOf(")");if(m>0&&h>m){g+=" "+j.title.substr(m+1,h-m-1);g=g.Trim()}break;default:g=j.description;break}g=g.bytelength()>this.descriptionSize*2?g.substr(0,this.descriptionSize-1)+"..":g;return g},destroyEvent:function(){Event.stopObserving(window,"scroll",this.onScrollDrawSeatHandler);Event.stopObserving(window,"unload",this.close.bind(this))},destroyDOM:function(){this.$container=null;this.imagesLen=null;this.images=null;this.ddList=[];this.itemsLen=null;this.scrollHeight=null;this.scrollGap=null;this.types=null;this.subTypes=null;this.subNavTabs=null;this.imageTemplate=null;this.imageCommentTemplate=null;this.onScrollDrawSeatHandler=null}});if(typeof(Widgets)=="undefined"){var Widgets=Class.create()}Widgets.Loading=function(){var h='<div class="db_picloading" style="height:{0}px; width:100%; z-index:105;"><div class="load104"><i class="logo"></i><i class="loadimg"></i></div></div>',e=document.documentElement.clientHeight,g=Builder.build(String.format(h,[e]));document.body.scrollIntoView();document.documentElement.style.overflow="hidden";document.body.appendChild(g);function f(){document.documentElement.style.overflow="";document.body.removeChild(g);h=null;e=null;g=null}return{close:f}};Widgets.LoopSlidesControl=Class.create();Object.extend(Widgets.LoopSlidesControl.prototype,Widgets.SlidesControl.prototype);Object.extend(Widgets.LoopSlidesControl.prototype,{instantiation:function(){var d=this;if(this.length<=this.showLength){this.$prev.hide();this.$next.hide();return}else{this.$prev.show();this.$next.show()}this.moveWidth=this.itemWidth*this.showLength;this.min=this.showLength-1;var c=new SlidesControl({slidesRegion:this.slidesRegion,prev:this.prev,next:this.next,scale:d.scale,duration:this.duration,type:"neat",autoTimeout:this.autoTimeout,initializeField:function(){this.slidesRegion=$(this.slidesRegion);this.prev=$(this.prev);this.next=$(this.next);this.currentIndex=0;this.position=0;this.items=this.slidesRegion.childElements();this.length=this.items.length;this.lock=false;this.isLoop=false;this.timeOutMethod()},initializeEvent:function(){this.onPrevClickHandler=this.onPrevClick.bind(this);this.onNextClickHandler=this.onNextClick.bind(this);Event.observe(this.prev,"click",this.onPrevClickHandler);Event.observe(this.next,"click",this.onNextClickHandler);this.slidesRegionOverHendler=this.slidesRegionOver.bind(this);this.slidesRegionOutHendler=this.slidesRegionOut.bind(this);Event.observe(this.slidesRegion,"mouseover",this.slidesRegionOverHendler);Event.observe(this.slidesRegion,"mouseout",this.slidesRegionOutHendler);Event.observe(this.prev,"mouseover",this.slidesRegionOverHendler);Event.observe(this.prev,"mouseout",this.slidesRegionOutHendler);Event.observe(this.next,"mouseover",this.slidesRegionOverHendler);Event.observe(this.next,"mouseout",this.slidesRegionOutHendler)},prevSlides:function(){if(this.lock){return}var t=null;var a=[],s,u,v,w,y=[],r,b,q=0,p;var x=d.min-d.showLength;for(p=0;p<d.showLength;p++){x--;if(x<0){x=d.length-1}y[p]=x}d.min=x+d.showLength;for(p=0;p<d.showLength;p++){r=d.imgItems[y[p]];b=d.renderImage(r);w=Builder.build(b);a.push(w);d.selectedItems=this.slidesRegion.immediateDescendants();firstItem=d.selectedItems[0];this.slidesRegion.insertBefore(w,firstItem)}d.scale=d.moveWidth;this.slidesRegion.style.left=this.position-d.scale+"px";if(Mtime.browser.ie===0||Mtime.browser.ie>9){FunctionExt.defer(function(){this.lock=true;this.slidesRegion.addClassName(d.durations.className);this.slidesRegion.style.left="0px"},10,this);FunctionExt.defer(function(){this.slidesRegion.removeClassName(d.durations.className);for(p=d.showLength-1;p<d.showLength*2;p++){d.selectedItems[p]&&this.slidesRegion.removeChild(d.selectedItems[p])}this.lock=false},d.durations.duration,this);return}t={node:this.slidesRegion,duration:this.duration,scale:d.scale,position:this.position-d.scale,callback:function(){for(p=d.showLength-1;p<d.showLength*2;p++){d.selectedItems[p]&&this.slidesRegion.removeChild(d.selectedItems[p])}this.slidesRegion.style.left=this.position;d.selectedItems=a}.bind(this)};this.move(t)},nextSlides:function(){if(this.lock){return}var l=null,b,o=[];var n=d.min;for(b=0;b<d.showLength;b++){n++;if(n>=d.length){n=0}o[b]=n}d.min=n;for(b=0;b<d.showLength;b++){var k=d.imgItems[o[b]];var a=d.renderImage(k);var m=Builder.build(a);this.slidesRegion.appendChild(m)}d.selectedItems=this.slidesRegion.immediateDescendants();if(Mtime.browser.ie===0||Mtime.browser.ie>9){this.lock=true;this.slidesRegion.addClassName(d.durations.className);this.slidesRegion.style.left=-d.scale+"px";FunctionExt.defer(function(){this.slidesRegion.removeClassName(d.durations.className);for(b=0;b<d.showLength;b++){d.selectedItems[b]&&this.slidesRegion.removeChild(d.selectedItems[b])}this.slidesRegion.style.left=this.position;this.lock=false;this.timeOutMethod()},d.durations.duration,this);return}l={node:this.slidesRegion,duration:this.duration,scale:-d.scale,position:this.position,callback:function(){for(b=0;b<d.showLength;b++){d.selectedItems[b]&&this.slidesRegion.removeChild(d.selectedItems[b])}this.slidesRegion.style.left=this.position}.bind(this)};this.move(l)},move:function(a){this.lock=true;new Fx.Move(a.node,{scaleX:true,duration:a.duration,distances:{left:a.scale,position:a.position},callback:function(){this.lock=false;this.timeOutMethod();a.callback&&a.callback()}.bind(this)})},timeOutMethod:function(){this.myTimeout&&clearInterval(this.myTimeout);if(this.autoTimeout&&!this.isLoop){this.myTimeout=setInterval(function(){this.nextSlides();this.myTimeout&&clearInterval(this.myTimeout)}.bind(this),this.autoTimeout*1000)}},slidesRegionOver:function(a){this.myTimeout&&clearInterval(this.myTimeout);this.isLoop=true},slidesRegionOut:function(a){this.isLoop=false;this.timeOutMethod()}})}});Widgets.TopPicSlide=Class.create();Object.extend(Widgets.TopPicSlide.prototype,Widgets.Base.prototype);Object.extend(Widgets.TopPicSlide.prototype,{options:{container:"",prev:"",next:"",slidesRegion:"",tabName:"",autoTimeout:7000},iNow:0,initializeDom:function(){this.$container=$(this.container);if(!this.$container){return}if(this.prev){this.$prev=$(this.prev)}if(this.next){this.$next=$(this.next)}if(this.slidesRegion){this.$slidesRegion=$(this.slidesRegion);this.slidesImgs=this.$slidesRegion.getElementsByTagName("dd");for(var b=0;b<this.slidesImgs.length;b++){this.slidesImgs[b].style.opacity=0;this.slidesImgs[b].style.filter="alpha(opacity=0)"}this.slidesImgs[0].style.opacity=1;this.slidesImgs[0].style.filter="alpha(opacity=100)";this.slidesImgs[0].style.zIndex=1}if(this.tabName){this.$tabName=$(this.tabName);this.btns=this.$tabName.getElementsByTagName("li")}this.autoSlide()},initializeEvent:function(){this.onConMouseOverHandler=this.onConMouseOver.bind(this);this.onConMouseOutHandler=this.onConMouseOut.bind(this);Event.observe(this.$container,"mouseover",this.onConMouseOverHandler);Event.observe(this.$container,"mouseout",this.onConMouseOutHandler);this.onPrevClickHandler=this.onPrevClick.bind(this);this.onNextClickHandler=this.onNextClick.bind(this);Event.observe(this.$prev,"click",this.onPrevClickHandler);Event.observe(this.$next,"click",this.onNextClickHandler);this.onBtnClickHandler=this.onBtnClick.bind(this);for(var b=0;b<this.btns.length;b++){this.btns[b].index=b;Event.observe(this.btns[b],"click",this.onBtnClickHandler)}Event.observe(window,"unload",this.close.bind(this))},autoSlide:function(){if(this.autoTimeout){this.autoFadeTimerHandler=this.autoFade.bind(this);this.timer=setInterval(this.autoFadeTimerHandler,this.autoTimeout)}},onConMouseOver:function(){clearInterval(this.timer)},onConMouseOut:function(){if(this.autoTimeout){this.autoFadeTimerHandler=this.autoFade.bind(this);this.timer=setInterval(this.autoFadeTimerHandler,this.autoTimeout)}},onPrevClick:function(c){var d=c.target||c.srcElement;Event.stop(c);this.autoFadePrev()},onNextClick:function(c){var d=c.target||c.srcElement;Event.stop(c);this.autoFade()},onBtnClick:function(f){var e=Event.element(f);var h=f.target||f.srcElement;Event.stop(f);if(e.hasClassName("on")){return false}else{for(var g=0;g<this.btns.length;g++){this.btns[g].removeClassName("on")}e.addClassName("on");for(var g=0;g<this.slidesImgs.length;g++){this.fadeOut(this.slidesImgs[g])}this.fadeIn(this.slidesImgs[e.index]);this.iNow=e.index}},autoFade:function(){if(this.iNow===this.slidesImgs.length-1){this.iNow=0}else{this.iNow++}for(var c=0;c<this.slidesImgs.length;c++){this.fadeOut(this.slidesImgs[c])}this.fadeIn(this.slidesImgs[this.iNow]);for(var d=0;d<this.btns.length;d++){this.btns[d].removeClassName("on")}this.btns[this.iNow].addClassName("on")},autoFadePrev:function(){if(this.iNow===0){this.iNow=this.slidesImgs.length-1}else{this.iNow--}for(var c=0;c<this.slidesImgs.length;c++){this.fadeOut(this.slidesImgs[c])}this.fadeIn(this.slidesImgs[this.iNow]);for(var d=0;d<this.btns.length;d++){this.btns[d].removeClassName("on")}this.btns[this.iNow].addClassName("on")},fadeIn:function(e){var f=0;if(Mtime.browser.ie){var d=this.getStyle(e,"filter")}else{var d=this.getStyle(e,"opacity")}if(d==="1"||d==="alpha(opacity=100)"){return false}clearInterval(e.timer);e.timer=setInterval(function(){var a=5;if(f===100){clearInterval(e.timer)}else{f+=a;e.style.opacity=f/100;e.style.filter="alpha(opacity="+f+")";e.style.zIndex=1}}.bind(this),30)},fadeOut:function(e){var f=100;if(Mtime.browser.ie){var d=this.getStyle(e,"filter")}else{var d=this.getStyle(e,"opacity")}if(d==="0"||d==="alpha(opacity=0)"){return false}clearInterval(e.timer);e.timer=setInterval(function(){var a=-5;if(f===0){clearInterval(e.timer)}else{f+=a;e.style.opacity=f/100;e.style.filter="alpha(opacity="+f+")";e.style.zIndex=""}}.bind(this),30)},getStyle:function(d,c){if(d.currentStyle){return d.currentStyle[c]}else{return getComputedStyle(d,false)[c]}},destroyEvent:function(){this.onConMouseOverHandler&&Event.stopObserving(this.$container,"mouseover",this.onConMouseOverHandler);this.onConMouseOutHandler&&Event.stopObserving(this.$container,"mouseout",this.onConMouseOutHandler);this.onPrevClickHandler&&Event.stopObserving(this.$prev,"click",this.onPrevClickHandler);this.onNextClickHandler&&Event.stopObserving(this.$next,"click",this.onNextClickHandler);if(this.onBtnClickHandler){for(var b=0;b<this.btns.length;b++){Event.stopObserving(this.btns[b],"click",this.onBtnClickHandler)}}},destroyDom:function(){this.$container=null;this.$prev=null;this.$next=null;this.$slidesRegion=null;this.slidesImgs=null;this.$tabName=null;this.btns=null}});Widgets.VideoListTopVideoControl=Class.create();Object.extend(Widgets.VideoListTopVideoControl.prototype,Widgets.Base.prototype);Object.extend(Widgets.VideoListTopVideoControl.prototype,{server:{getVideoInfo:function(d,c){return Mtime.Component.Ajax.request(siteApiUrl,"Mtime.Api.Pages.VideoService","GetVideoInfo",[d],c,"/Service/Video.api?Ajax_CallBack=true","get","10000")}},options:{container:"db_videobox",topVideoContainer:"db_videoinner",playBtn:"playbtn",videoTitle:"videotitle",topVideoList:"topvideolist",playerContainer:"playercontainer",isNewsVideo:false,playerWidth:1000,playerHeight:563,mp4Template:'<video width="1000" height="563" x-webkit-airplay="allow" controls="true" preload="none" src="#{mp4URL}"></video>',webTemplate:'<object width="#{width}" height="#{height}" autoactive="true" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" id="videoplayer" name="flashfirebug0"><param value="#{swfPath}?vid=#{vid}&mid=#{mid}&autoplay=1&w=#{width}&h=#{height}#{debug}" name="movie"><param value="high" name="quality"><param value="true" name="allowFullScreen"><param value="false" name="menu"><param value="transparent" name="wmode"><param value="always" name="allowScriptAccess"><embed width="#{width}" height="#{height}" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" quality="high" src="#{swfPath}?vid=#{vid}&mid=#{mid}&autoplay=1&w=#{width}&h=#{height}#{debug}" play="true" allowfullscreen="true" allowscriptaccess="always" wmode="transparent" id="flashfirebug0" name="flashfirebug0"></object>'},initializeDom:function(){this.$container=$(this.container);this.$topVideoContainer=$(this.topVideoContainer);this.$playBtn=$(this.playBtn);this.$videoTitle=$(this.videoTitle);this.$topVideoList=$(this.topVideoList);this.topVideoLists=this.$topVideoList.immediateDescendants();this.topVideoLists[0].addClassName("on");this.$playerContainer=$(this.playerContainer);this.indexNum=0;this.isBrowser=this.browserRedirect();if(!this.isBrowser){window.videoPlayStop=this.videoPlayStop.bind(this);window.videoPlayPlay=this.videoPlayPlay.bind(this)}this.opacity=1;this.$topVideoContainer.addClassName("transition6")},initializeEvent:function(){this.playBtnClickHandler=this.playBtnClick.bind(this);Event.observe(this.$playBtn,"click",this.playBtnClickHandler);Event.observe(this.$videoTitle,"click",this.playBtnClickHandler);this.topVideoListClickHandler=this.topVideoListClick.bind(this);this.topVideoListMouseoverHandler=this.topVideoListMouseover.bind(this);this.topVideoListMouseoutHandler=this.topVideoListMouseout.bind(this);Event.observe(this.$topVideoList,"click",this.topVideoListClickHandler);Event.observe(this.$topVideoList,"mouseover",this.topVideoListMouseoverHandler);Event.observe(this.$topVideoList,"mouseout",this.topVideoListMouseoutHandler);Event.observe(window,"unload",this.close.bind(this))},playBtnClick:function(b){Event.stop(b);this.currTrailer=this.topVideoLists[0];this.play();this.render()},play:function(){this.$topVideoContainer.style.opacity=0;this.playMethod()},playMethod:function(){var b=this.currTrailer.readAttribute("vid");this.mid=this.currTrailer.readAttribute("mid");if(b){b=parseInt(b,10);this.videoBuilder(b)}},videoBuilder:function(k){if(k!=""&&k!="0"){if(this.isBrowser){this.getmp4URL(k)}else{var g="http://static1.mtime.cn/static",f;this.playerTemplate='<a id="closebtn" href="#" title="关闭" class="close transition4"></a>'+this.webTemplate;var j=new Template(this.playerTemplate);var h=j.evaluate({vid:k,mid:this.mid,bodyheight:document.body.offsetHeight,width:this.playerWidth,height:this.playerHeight,swfPath:g+"/flash/newvideoplayer.swf",debug:debug?"&debug=true":""});this.videoBuilderMethod(h)}}},getmp4URL:function(b){if(b){this.server.getVideoInfo(b,function(e){if(e&&e.value&&e.value.mp4URL){this.playerTemplate='<a id="closebtn" href="#" title="关闭" class="close transition4"></a>'+this.mp4Template;var f=new Template(this.playerTemplate);var a=f.evaluate({bodyheight:document.body.offsetHeight,mp4URL:e.value.mp4URL,debug:debug?"&debug=true":""});this.videoBuilderMethod(a)}}.bind(this))}},videoBuilderMethod:function(b){this.$playerContainer.innerHTML=b;this.$playerContainer.style.display="block";this.$closeBtn=$("closebtn");this.$videoplayer=$("videoplayer");Event.observe(this.$closeBtn,"click",this.closeBtnClick.bind(this))},videoplayerOver:function(d){var c=Event.element(d);this.videoObject=c.up(".db_videoobject");if(this.$playerContainer===c.up(".db_videoobject")){if(Mtime.browser.ie&&Mtime.browser.ie<9){this.$closeBtn.show()}else{this.$closeBtn.style.opacity=1}}},videoplayerOut:function(b){if(this.playerContainerTimeout!==null){clearTimeout(this.playerContainerTimeout)}this.playerContainerTimeout=FunctionExt.defer(function(){if(this.$playerContainer===this.videoObject){if(Mtime.browser.ie&&Mtime.browser.ie<9){this.$closeBtn.hide()}else{this.$closeBtn.style.opacity=0}}},200,this)},closeBtnOver:function(b){if(this.playerContainerTimeout!==null){clearTimeout(this.playerContainerTimeout)}},closeBtnClick:function(b){b&&Event.stop(b);this.closeMethod()},closeMethod:function(){this.$topVideoContainer.style.opacity=1;this.$playerContainer.hide();this.$playerContainer.innerHTML="";Event.stopObserving(this.$videoplayer,"mouseover",this.videoplayerOver.bind(this));Event.stopObserving(this.$videoplayer,"mouseout",this.videoplayerOut.bind(this));Event.stopObserving(this.$closeBtn,"mouseover",this.closeBtnOver.bind(this));Event.stopObserving(this.$closeBtn,"click",this.closeBtnClick.bind(this));this.$closeBtn=null;this.$videoplayer=null},playNext:function(){this.currTrailer=this.currTrailer.next();if(!this.currTrailer){if(this.isNewsVideo){this.closeMethod();return}this.currTrailer=this.$topVideoList.down("dd")}this.playMethod()},render:function(){},videoPlayStop:function(){},videoPlayPlay:function(){FunctionExt.defer(function(){if(Mtime.browser.ie&&Mtime.browser.ie<9){this.$closeBtn.hide()}else{this.$closeBtn.style.opacity=0}},3000,this);Event.observe(this.$videoplayer,"mouseover",this.videoplayerOver.bind(this));Event.observe(this.$videoplayer,"mouseout",this.videoplayerOut.bind(this));Event.observe(this.$closeBtn,"mouseover",this.closeBtnOver.bind(this))},topVideoListClick:function(b){this.currTrailer=Event.findElement(b,"dd");if(this.currTrailer!==document&&this.currTrailer.readAttribute("vid")){this.play();this.render()}},topVideoListMouseover:function(e){var d=Event.findElement(e,"dd");var f=this.topVideoLists.indexOf(d);if(f>0&&d!==document&&d.readAttribute("vid")){this.topVideoLists[0].removeClassName("on");d.addClassName("on")}},topVideoListMouseout:function(e){var d=Event.findElement(e,"dd");var f=this.topVideoLists.indexOf(d);if(f>0&&d!==document&&d.readAttribute("vid")){this.topVideoLists[0].addClassName("on");d.removeClassName("on")}},setOpacity:function(d){var c=navigator.userAgent.toLowerCase();if(this.opacity<0){this.opacity=0}if(this.opacity>1){this.opacity=1}if(Mtime.browser.ie&&Mtime.browser.ie<9){d.style.filter="alpha(opacity="+(this.opacity*100)+")"}else{d.style.opacity=this.opacity}},browserRedirect:function(){var m=navigator.userAgent.toLowerCase();var h=m.match(/ipad/i)=="ipad";var j=m.match(/iphone/i)=="iphone";var k=m.match(/iphone/i)=="ipod";var g=m.match(/android/i)=="android";var l=m.match(/windows mobile/i)=="windows mobile";if(h||j||k||g||l){return true}return false},destroyEvent:function(){},destroyDOM:function(){this.$container=null;this.$topVideoContainer=null;this.$playBtn=null;this.$videoxTitle=null;this.$topVideoList=null;this.topVideoLists=null;this.$playerContainer=null;if(this.$closeBtn){this.$closeBtn=null}}});var SwfToMp4Video=Class.create();Object.extend(SwfToMp4Video.prototype,{name:"SwfToMp4Video",server:{getVideoInfo:function(d,c){return Mtime.Component.Ajax.request(siteApiUrl,"Mtime.Api.Pages.VideoService","GetVideoInfo",[d],c,"/Service/Video.api?Ajax_CallBack=true","get","10000")}},options:{contentRegion:""},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeDOM();this.initializeEvent()},initializeField:function(){},initializeDOM:function(){var h=this.browserRedirect();if(h){this.newsContentRegion=$(this.contentRegion);if(this.newsContentRegion){var l=this.newsContentRegion.getElementsByTagName("object");var m=l.length;if(m>0){for(var j=0;j<m;j++){this.buildPlayer(l[j],0)}}l=this.newsContentRegion.getElementsByTagName("embed");m=l.length;if(m>0){for(var g=0;g<m;g++){var k=l[g].up();if(k.tagName!=="OBJECT"){this.buildPlayer(l[g],1)}}}}}},destroyDOM:function(){if(this.newsContentRegion){this.newsContentRegion=null}},initializeEvent:function(){Event.observe(window,"unload",this.close.bind(this))},destroyEvent:function(){},buildPlayer:function(m,l){if(m){var k;this._height=375;if(l===0){var g=m.getElementsByTagName("embed");if(g[0]){k=g[0].readAttribute("src");this._height=g[0].getHeight();if(k.search("vid")>-1){this.buildHtml(m,k)}}else{g=m.getElementsByTagName("param");var j=g.length;for(var h=0;h<j;h++){k=g[h].value;if(k.search("vid")>-1){this.buildHtml(m,k)}}}}else{k=m.readAttribute("src");if(k.search("vid")>-1){this.buildHtml(m,k,true)}}}},buildHtml:function(h,l,j){var k=l.toQueryParams(),m=k.vid,g=h.getWidth();if(m){this.server.getVideoInfo(m,function(b){if(b&&b.value&&b.value.mp4URL){if(j){var a=h.up();var c=Builder.build('<video width="'+g+'" height="'+this._height+'" x-webkit-airplay="allow" controls="true" preload="none" src="'+b.value.mp4URL+'"></video>');a.insertBefore(c,h);h.remove()}else{h.innerHTML='<video width="'+g+'" height="'+this._height+'" x-webkit-airplay="allow" controls="true" preload="none" src="'+b.value.mp4URL+'"></video>'}}}.bind(this))}},browserRedirect:function(){var m=navigator.userAgent.toLowerCase();var h=m.match(/ipad/i)=="ipad";var j=m.match(/iphone/i)=="iphone";var k=m.match(/iphone/i)=="ipod";var g=m.match(/android/i)=="android";var l=m.match(/windows mobile/i)=="windows mobile";if(h||j||k||g||l){return true}return false},close:function(){this.destroyEvent();this.destroyDOM()}});var NewsWidgets=NewsWidgets||Class.create();NewsWidgets.NewsVideoListTopVideoControl=Class.create();Object.extend(NewsWidgets.NewsVideoListTopVideoControl.prototype,Widgets.VideoListTopVideoControl.prototype);Object.extend(NewsWidgets.NewsVideoListTopVideoControl.prototype,{initializeEvent:function(){this.playBtnClickHandler=this.playBtnClick.bind(this);Event.observe(this.$playBtn,"click",this.playBtnClickHandler);if(this.$videoTitle){Event.observe(this.$videoTitle,"click",this.playBtnClickHandler)}this.topVideoListClickHandler=this.topVideoListClick.bind(this);Event.observe(this.$topVideoList,"click",this.topVideoListClickHandler);Event.observe(window,"unload",this.close.bind(this))}});NewsWidgets.NewsTopPicSlide=Class.create();Object.extend(NewsWidgets.NewsTopPicSlide.prototype,Widgets.TopPicSlide.prototype);Object.extend(NewsWidgets.NewsTopPicSlide.prototype,{});Widgets.MixAlbumLoopSlidesControl=Class.create();Object.extend(Widgets.MixAlbumLoopSlidesControl.prototype,Widgets.SlidesControl.prototype);Object.extend(Widgets.MixAlbumLoopSlidesControl.prototype,{options:{slidesRegion:"movieSlidesItems",getSlidesRegion:"",page:"",currentIndex:0,prev:"moviePrev",next:"movieNext",duration:0.6,showLength:1,items:[],autoTimeout:null,type:"detail",itemWidth:1000,imageTemplate:"",logRelatedType:0,logRelatedID:0,callback:null},load:function(){this.imgItems=$(this.getSlidesRegion).immediateDescendants();this.page=$(this.page);this.pageIndex=0;this.length=this.imgItems.length;if(this.length>this.showLength){this.$prev.show();this.$next.show()}else{this.$prev.hide();this.$next.hide()}this.show();if(typeof SlidesControl!="undefined"){this.instantiation()}else{$loadJs(["/js/2011/SlidesControl.js"],function(){this.instantiation()}.bind(this))}},show:function(){var b=this.imgItems[this.currentIndex];this.$slidesRegion.appendChild(b);this.page.innerHTML=(this.currentIndex+1)+" / "+this.length},instantiation:function(){var b=this;this.mySlidesControl=new SlidesControl({slidesRegion:this.slidesRegion,prev:this.prev,next:this.next,scale:b.scale,duration:this.duration,type:"neat",initializeField:function(){this.slidesRegion=$(this.slidesRegion);this.prev=$(this.prev);this.next=$(this.next);this.currentIndex=b.currentIndex;this.position=0;this.items=this.slidesRegion.childElements();this.length=this.items.length;this.lock=false},onPrevClick:function(a){var d=a.target||a.srcElement;Event.stop(a);this.prevSlides(-1)},onNextClick:function(a){var d=a.target||a.srcElement;Event.stop(a);this.nextSlides(-1)},noSlides:function(a){if(this.lock){return}if(b.logRelatedType>0&&b.logRelatedID>0){Mtime.Component.Statistic.Service.Log(b.logRelatedType,b.logRelatedID)}var f=null;var e;if(a!==-1){this.currentIndex=a}b.page.innerHTML=(this.currentIndex+1)+" / "+b.length;this.slidesRegion.appendChild(b.imgItems[this.currentIndex]);b.selectedItems=this.slidesRegion.immediateDescendants();b.callback&&b.callback(this.currentIndex,this.currentIndex==0);b.selectedItems[0]&&this.slidesRegion.removeChild(b.selectedItems[0]);this.slidesRegion.style.left=this.position},prevSlides:function(a){if(this.lock){return}if(b.logRelatedType>0&&b.logRelatedID>0){Mtime.Component.Statistic.Service.Log(b.logRelatedType,b.logRelatedID)}var f=null;var e;if(a!==-1){this.currentIndex=a+1}if(this.currentIndex<1){b.callback&&b.callback(this.currentIndex,true);return;this.currentIndex=b.length-1}else{this.currentIndex--}b.page.innerHTML=(this.currentIndex+1)+" / "+b.length;this.selectedItems=this.slidesRegion.immediateDescendants();firstItem=this.selectedItems[0];this.slidesRegion.insertBefore(b.imgItems[this.currentIndex],firstItem);this.selectedItems=this.slidesRegion.immediateDescendants();this.slidesRegion.style.left=this.position-b.scale+"px";b.callback&&b.callback(this.currentIndex,false);if(Mtime.browser.ie===0||Mtime.browser.ie>9){FunctionExt.defer(function(){this.lock=true;this.slidesRegion.addClassName(b.durations.className);this.slidesRegion.style.left="0px"},10,this);FunctionExt.defer(function(){this.slidesRegion.removeClassName(b.durations.className);this.selectedItems[1]&&this.slidesRegion.removeChild(this.selectedItems[1]);this.lock=false},b.durations.duration,this);return}f={node:this.slidesRegion,duration:this.duration,scale:this.scale,position:this.position-b.scale,callback:function(){this.selectedItems[1]&&this.slidesRegion.removeChild(this.selectedItems[1]);this.slidesRegion.style.left=this.position}.bind(this)};this.move(f)},nextSlides:function(f){if(this.lock){return}if(b.logRelatedType>0&&b.logRelatedID>0){Mtime.Component.Statistic.Service.Log(b.logRelatedType,b.logRelatedID)}var g=null,a,h=[];if(f!==-1){this.currentIndex=f-1}if(this.currentIndex>b.length-2){this.currentIndex=0}else{this.currentIndex++}b.page.innerHTML=(this.currentIndex+1)+" / "+b.length;this.slidesRegion.appendChild(b.imgItems[this.currentIndex]);b.selectedItems=this.slidesRegion.immediateDescendants();b.callback&&b.callback(this.currentIndex,this.currentIndex==0);if(Mtime.browser.ie===0||Mtime.browser.ie>9){this.lock=true;this.slidesRegion.addClassName(b.durations.className);this.slidesRegion.style.left=-b.scale+"px";FunctionExt.defer(function(){this.slidesRegion.removeClassName(b.durations.className);b.selectedItems[0]&&this.slidesRegion.removeChild(b.selectedItems[0]);this.slidesRegion.style.left=this.position;this.lock=false},b.durations.duration,this);return}g={node:this.slidesRegion,duration:this.duration,scale:-b.scale,position:this.position,callback:function(){b.selectedItems[0]&&this.slidesRegion.removeChild(b.selectedItems[0]);this.slidesRegion.style.left=this.position}.bind(this)};this.move(g)},move:function(a){this.lock=true;new Fx.Move(a.node,{scaleX:true,duration:a.duration,distances:{left:a.scale,position:a.position},callback:function(){this.lock=false;a.callback&&a.callback()}.bind(this)})}})}});Widgets.MixAlbumThumbnail=Class.create();Object.extend(Widgets.MixAlbumThumbnail.prototype,Widgets.Base.prototype);Object.extend(Widgets.MixAlbumThumbnail.prototype,{options:{slidesRegion:"",currentIndex:0,items:[],showLength:10,callback:null,imageTemplate:'<dd class="#{sty}"><a><img method="#{currentIndex}" src="#{SmallPicUrl}">#{hdHtml}</a><p class="pt6"><a method="#{currentIndex}">#{Title}</a></p></dd>',pageTemplate:'<a class="#{sty}">#{pageIndex}</a>',pageClass:""},initializeDom:function(){this.$slidesRegion=$(this.slidesRegion)},initializeEvent:function(){if(this.$slidesRegion){this.onClickSlidesRegionHandler=this.onClickSlidesRegion.bind(this);Event.observe(this.$slidesRegion.up(),"click",this.onClickSlidesRegionHandler)}Event.observe(window,"unload",this.close.bind(this))},load:function(){this.pageIndex=0;this.imgItems=[];if(typeof this.items==="undefined"||this.items.length===0){return}this.imgItems=this.items;this.length=this.imgItems.length;this.amount=Math.ceil(this.length/this.showLength);this.pageIndex=Math.ceil((this.currentIndex+1)/this.showLength);this.show();var b=Builder.build(this.renderPage(this.pageIndex));this.$slidesRegion.up().appendChild(b)},show:function(){this.$slidesRegion.innerHTML="";if(this.$slidesRegion.next()){this.$slidesRegion.next().remove()}this.min=(this.pageIndex-1)*this.showLength;if(this.min<0){this.min=0}this.max=this.pageIndex*this.showLength;if(this.max<this.showLength){this.max=this.showLength}var j=[];for(var g=this.min;g<this.length&&g<this.max;g++){var h=this.imgItems[g];var f=this.renderImage(h,g);var k=Builder.build(f);if(g===this.currentIndex){k.addClassName("on")}this.$slidesRegion.appendChild(k);j.push(k)}this.selectedItems=j},renderImage:function(j,h){if(!j){return}var g,k=new Template(this.imageTemplate),f=new StringBuilder();if(typeof this.currentIndex!=="undefined"&&typeof h!=="undefined"&&h==this.currentIndex){j.sty="on"}else{j.sty=""}if(j.MixAlbumItemType){j.hdHtml=j.MixAlbumItemType===1?"<i></i>":""}j.currentIndex=h;g=k.evaluate(j);return g.toString()},renderPage:function(l){if(l<=0){l==1}var k,m=new Template(this.pageTemplate),g=new StringBuilder();g.append('<div class="pagenav tc p_r '+this.pageClass+'">');if(this.amount>1){if(l>1){g.append('<a pageindex="'+(l-1)+'" class="mr10 next">上一页</a>')}for(var h=1;h<=this.amount;h++){var j={};if(h==l){j.sty="on"}else{j.sty="num"}j.pageIndex=h;g.append(m.evaluate(j))}if(l<this.amount){g.append('<a pageindex="'+(l+1)+'" class="mr10 next">下一页</a>')}}g.append("</div>");return g.toString()},onClickSlidesRegion:function(j){var h=Event.element(j);if(h.hasAttribute("method")){var l=h.readAttribute("method");var k=parseInt(l,10);if(k>-1){this.callback&&this.callback(k)}}else{if(h.tagName=="A"){var g=h.readAttribute("class");if(g=="num"||g=="mr10 next"){this.pageIndex=parseInt(h.innerHTML,10)||parseInt(h.readAttribute("pageIndex"),10);this.show();var m=Builder.build(this.renderPage(this.pageIndex));this.$slidesRegion.up().appendChild(m)}}}},destroyEvent:function(){Event.stopObserving(this.$slidesRegion,"click",this.onClickSlidesRegionHandler)},destroyDOM:function(){this.$slidesRegion=null}});NewsWidgets.IndexTopSlidesControl=Class.create();Object.extend(NewsWidgets.IndexTopSlidesControl.prototype,Widgets.BehindSlidesControl.prototype);Object.extend(NewsWidgets.IndexTopSlidesControl.prototype,{options:{slidesRegion:"movieSlidesItems",dotSlidesRegion:"",backSlidesRegion:"",prev:"prev",next:"next",autoTimeout:null,items:[],imageTemplate:"",duration:0.5,type:"neat"},instanceSlidesControl:function(){var d=this;var c=new SlidesControl({slidesRegion:this.slidesRegion,prev:this.prev,next:this.next,scale:this.$images[0].offsetWidth,duration:this.duration,type:"neat",autoTimeout:this.autoTimeout,initializeField:function(){this.slidesRegion=$(this.slidesRegion);this.prev=$(this.prev);this.next=$(this.next);this.currentIndex=0;this.position=0;this.items=this.slidesRegion.childElements();this.length=this.items.length;this.lock=false;this.timeOutMethod();this.$dotSlidesRegion=$(d.dotSlidesRegion);if(this.$dotSlidesRegion){this.$dotSlidesRegions=this.$dotSlidesRegion.immediateDescendants()}this.$backSlidesRegion=$(d.backSlidesRegion);if(this.$backSlidesRegion){this.$backSlidesRegions=this.$backSlidesRegion.immediateDescendants()}this.prevIndex=0},initializeEvent:function(){this.onPrevClickHandler=this.onPrevClick.bind(this);this.onNextClickHandler=this.onNextClick.bind(this);Event.observe(this.prev,"click",this.onPrevClickHandler);Event.observe(this.next,"click",this.onNextClickHandler);this.slidesRegionOverHendler=this.slidesRegionOver.bind(this);this.slidesRegionOutHendler=this.slidesRegionOut.bind(this);Event.observe(this.slidesRegion,"mouseover",this.slidesRegionOverHendler);Event.observe(this.slidesRegion,"mouseout",this.slidesRegionOutHendler)},onPrevClick:function(a){var b=a.target||a.srcElement;Event.stop(a);if(this.amount&&this.currentIndex<1){this.currentIndex=this.amount-1}else{if(this.currentIndex<1){this.currentIndex=this.length-1}else{this.currentIndex--}}this.myTimeout&&clearInterval(this.myTimeout);this.prevSlides()},onNextClick:function(a){var b=a.target||a.srcElement;Event.stop(a);if(this.amount&&this.currentIndex>this.amount-2){this.currentIndex=0}else{if(this.currentIndex>this.length-2){this.currentIndex=0}else{this.currentIndex++}}this.myTimeout&&clearInterval(this.myTimeout);this.nextSlides()},move:function(k){this.lock=true;new Fx.Move(k.node,{scaleX:true,duration:k.duration,distances:{left:k.scale,position:k.position},callback:function(){this.lock=false;this.timeOutMethod();k.callback&&k.callback()}.bind(this)});if(this.$backSlidesRegions){var j=this.$backSlidesRegions[this.prevIndex],b=this.$backSlidesRegions[this.currentIndex];if(j!==b){if(j.hasClassName("transition5")){b.removeClassName("transition5")}if(!b.hasClassName("transition5")){b.addClassName("transition5")}b.style.zIndex=3;b.style.opacity=1;b.style.zIndex=2;j.style.zIndex=1;j.style.opacity=0}}if(this.$dotSlidesRegions){var h=this.$dotSlidesRegions[this.prevIndex],a=this.$dotSlidesRegions[this.currentIndex];if(h.hasClassName("on")){h.removeClassName("on")}if(!a.hasClassName("on")){a.addClassName("on")}}this.prevIndex=this.currentIndex},timeOutMethod:function(){this.myTimeout&&clearInterval(this.myTimeout);if(this.autoTimeout){this.myTimeout=setInterval(function(){if(this.amount&&this.currentIndex>this.amount-2){this.currentIndex=0}else{if(this.currentIndex>this.length-2){this.currentIndex=0}else{this.currentIndex++}}this.nextSlides();this.myTimeout&&clearInterval(this.myTimeout)}.bind(this),this.autoTimeout*1000)}},slidesRegionOver:function(a){this.myTimeout&&clearInterval(this.myTimeout)},slidesRegionOut:function(a){this.timeOutMethod()}})}});NewsWidgets.SimpleSwitchControl=Class.create();Object.extend(NewsWidgets.SimpleSwitchControl.prototype,{server:{},options:{cover:"",content:"",region:"",slidesRegion:"",prev:"",next:"",page:"",jumpFirst:"",showThumbnail:"",thumbnails:"",itemWidth:1000,duration:0.5,logRelatedType:0,logRelatedID:0,hashName:""},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.initializeEvent();this.load()},initializeField:function(){},initializeDOM:function(){this.cover=$(this.cover);this.content=$(this.content);this.jumpFirst=$(this.jumpFirst);this.showThumbnail=$(this.showThumbnail);this.slidesRegions=$(this.slidesRegion);this.thumbnailsRegions=$(this.thumbnails);this.showMenuTag=$("showMenuTag");this.closeMenuTag=$("closeMenuTag");if(this.closeMenuTag){this.menuRegion=this.closeMenuTag.next()}},initializeEvent:function(){this.onShowMenuTagHandler=this.onShowMenuTagClick.bind(this);this.showMenuTag&&Event.observe(this.showMenuTag,"click",this.onShowMenuTagHandler);this.onCloseMenuTagHandler=this.onCloseMenuTagClick.bind(this);this.closeMenuTag&&Event.observe(this.closeMenuTag,"click",this.onCloseMenuTagHandler);this.onMenuRegionClickHandler=this.onMenuRegionClick.bind(this);this.menuRegion&&Event.observe(this.menuRegion,"click",this.onMenuRegionClickHandler);this.onJumpFirstClickHandler=this.onJumpFirstClick.bind(this);this.jumpFirst&&Event.observe(this.jumpFirst,"click",this.onJumpFirstClickHandler);this.onRegionClickHandler=this.onRegionClick.bind(this);this.slidesRegions&&Event.observe(this.slidesRegions,"click",this.onRegionClickHandler);this.onShowThumbnailClickHandler=this.onShowThumbnailClick.bind(this);this.showThumbnail&&Event.observe(this.showThumbnail,"click",this.onShowThumbnailClickHandler);Event.observe(window,"resize",this.changeResolution.bind(this))},destroyEvent:function(){this.showMenuTag&&Event.stopObserving(this.showMenuTag,"click",this.onShowMenuTagHandler);this.closeMenuTag&&Event.stopObserving(this.closeMenuTag,"click",this.onCloseMenuTagHandler);this.menuRegion&&Event.stopObserving(this.menuRegion,"click",this.onMenuRegionClickHandler);this.jumpFirst&&Event.stopObserving(this.jumpFirst,"click",this.onJumpFirstClickHandler);this.slidesRegions&&Event.stopObserving(this.slidesRegions,"click",this.onRegionClickHandler);this.showThumbnail&&Event.stopObserving(this.showThumbnail,"click",this.onShowThumbnailClickHandler)},destroyDOM:function(){this.cover=null;this.content=null;this.region=null;this.prev=null;this.next=null;this.page=null;this.jumpFirst=null;this.showMenuTag=null;this.closeMenuTag=null},destroyControl:function(){},close:function(){this.destroyControl();this.destroyEvent();this.destroyDOM()},load:function(){var b=location.hash.indexOf("#all")>-1;this.initShow();this.slides=new Widgets.MixAlbumLoopSlidesControl({slidesRegion:this.slidesRegion,getSlidesRegion:this.region,currentIndex:this.pageIndex-1<0?0:this.pageIndex-1,prev:this.prev,next:this.next,page:this.page,itemWidth:this.itemWidth,logRelatedType:this.logRelatedType,logRelatedID:this.logRelatedID,callback:this.changeUrl.bind(this)});if(b){this.onShowThumbnailClick()}this.changeResolution()},changeUrl:function(c,d){this.pageIndex=c+1;if(c<=0&&d){this.jump(0)}else{location.href="#/"+this.hashName+"/"+(c+1)}},onShowMenuTagClick:function(){this.showMenuTag.next().removeClassName("none")},onCloseMenuTagClick:function(){this.closeMenuTag.parentNode.addClassName("none")},onMenuRegionClick:function(e){var h=Event.element(e);var j=h.up().up();if(j.tagName=="DD"){var k=j.getAttribute("url");if(k.indexOf("http")==-1){var m;if(k.length>0&&k.indexOf("#")>-1){var l=k.trimRight("/").split("/");m=parseInt(l[l.length-1],10)-1}else{var m=parseInt(j.getAttribute("index"),10)}this.jump(m+1);if(m>this.slides.mySlidesControl.currentIndex){this.slides.mySlidesControl.nextSlides(m)}else{if(m<this.slides.mySlidesControl.currentIndex){this.slides.mySlidesControl.prevSlides(m)}}}}},changeResolution:function(){if(document.documentElement.clientWidth<=1024){this.slidesRegions.up().up().addClassName("screen1024")}else{this.slidesRegions.up().up().removeClassName("screen1024")}},onRegionClick:function(d){var e=Event.element(d);if(e.tagName=="EM"&&e.hasAttribute("originalPicUrl")){var f=e.getAttribute("originalPicUrl");new Widgets.Artwork({isLoader:true,imgUrl:f})}},onShowThumbnailClick:function(){new Widgets.MixAlbumThumbnail({slidesRegion:this.thumbnails,currentIndex:this.pageIndex-1<0?0:this.pageIndex-1,items:mixAlbumItems,callback:this.showThumbnailCallBack.bind(this)});location.href=location.hash+"#all";this.thumbnailsRegions.up().previous().addClassName("none");this.thumbnailsRegions.up().removeClassName("none")},showThumbnailCallBack:function(b){this.thumbnailsRegions.up().previous().removeClassName("none");this.thumbnailsRegions.up().addClassName("none");this.jump(b+1);this.slides.mySlidesControl.noSlides(b)},onJumpFirstClick:function(){this.jump(1)},initShow:function(){var d=0;var c=location.hash.replace("#all","");if(this.hashName=="feature"){if(/^#\/feature\/(\d+)$/.test(c)){d=parseInt(c.replace(/^#\/feature\/(\d+)$/,"$1"),10)}}else{if(this.hashName=="page"){if(/^#\/page\/(\d+)$/.test(c)){d=parseInt(c.replace(/^#\/page\/(\d+)$/,"$1"),10)}}}this.length=$(this.region).immediateDescendants().length;if(d<0||d>this.length){d=0}this.pageIndex=d;this.jump(d)},jump:function(b){if(b>0){this.pageIndex=b;this.cover.addClassName("none");this.content.removeClassName("none");location.href="#/"+this.hashName+"/"+b}else{this.cover.removeClassName("none");this.content.addClassName("none");location.href="#"}if(this.closeMenuTag){this.closeMenuTag.up().addClassName("none")}}});NewsWidgets.NewsPixSlidesControl=Class.create();Object.extend(NewsWidgets.NewsPixSlidesControl.prototype,Widgets.SlidesControl.prototype);Object.extend(NewsWidgets.NewsPixSlidesControl.prototype,{options:{slidesRegion:"pixSlidesRegion",page:"pixPage",currentIndex:0,prev:"pixPrev",next:"pixNext",summary:"pixSummary",showThumbnail:"showPixThumbnail",showOriginal:"showPixOriginal",thumbnailRegion:"pixThumbnailRegion",commendRegion:"pixCommendRegion",replay:"pixReplay",duration:0.3,showLength:1,pixItems:[],autoTimeout:null,type:"detail",itemWidth:1000,pixTemplate:'<dd><img src="#{MiddlePicUrl}" alt="#{Title}" /></dd>',thumbnailTemplate:'<dd class="#{sty}"><a href="javascript:void(0);" title="#{Title}" method="#{currentIndex}"><img src="#{SmallPicUrl}" alt="#{Title}"></a></dd>',thumbnailPageTemplate:'<a class="#{sty}">#{pageIndex}</a>',logRelatedType:0,logRelatedID:0,callback:null},load:function(){this.slidesRegion=$(this.slidesRegion);this.page=$(this.page);this.prev=$(this.prev);this.next=$(this.next);this.summary=$(this.summary);this.showThumbnail=$(this.showThumbnail);this.showOriginal=$(this.showOriginal);this.thumbnailRegion=$(this.thumbnailRegion);this.commendRegion=$(this.commendRegion);this.listRegion=this.thumbnailRegion.up().up();this.loading=this.slidesRegion.previous("div");this.showPicRegion=this.slidesRegion.up("div");this.replay=$(this.replay);this.summaryBG=this.summary.previous();this.resizeHeight=700;this.getClientHeight();this.imgItems=[];var d=new Template(this.pixTemplate);for(var c=0;c<this.pixItems.length;c++){this.imgItems.push(d.evaluate(this.pixItems[c]).toString())}this.page=$(this.page);this.pageIndex=0;this.length=this.imgItems.length;if(this.length>this.showLength){this.$prev.show();this.$next.show()}else{this.$prev.hide();this.$next.hide()}this.show();if(typeof SlidesControl!="undefined"){this.instantiation()}else{$loadJs(["/js/2011/SlidesControl.js"],function(){this.instantiation()}.bind(this))}},show:function(){this.nowImageNode=Builder.build(this.imgItems[this.currentIndex]);this.nowImageNode.hide();this.slidesRegion.appendChild(this.nowImageNode);this.changeRegionStyle(0);this.page.innerHTML=(this.currentIndex+1)+" / "+this.length+"<i></i>";var b=this.pixItems[this.currentIndex].Content;this.summary.innerHTML=b;if(b.length>0){this.summaryBG.show()}else{this.summaryBG.hide()}this.page.up().show();this.showThumbnail.show();this.hideButton()},hideButton:function(){this.prev.down().hide();this.next.down().hide();this.showOriginal.hide()},changeRegionStyle:function(h){var g=this.slidesRegion.getElementsByTagName("img"),e,f;if(g.length>0){if(h>0){e=g[g.length-1]}else{e=g[0]}f=document.createElement("img");f.onload=(function(a,b){return function(){this.resizeImage(b,1000,this.resizeHeight);var d=b.width;var c=b.height;if(d==0){if(b.hasAttribute("width")){d=parseInt(b.readAttribute("width"),10)}else{d=b.naturalWidth}}if(c==0){if(b.hasAttribute("height")){c=parseInt(b.readAttribute("height"),10)}else{c=b.naturalHeight}}a.width=d;a.height=c;this.showPicRegion.style.height=Math.max(this.resizeHeight,c)+"px";if(c<this.resizeHeight){$(a).style.marginTop=parseInt(this.resizeHeight-c,10)/2+"px"}else{$(a).style.marginTop="0px"}this.loading.hide();$(a).up().show()}})(e,f).bind(this);f.src=e.src}},getClientHeight:function(){var b=document.documentElement.clientHeight;if(b<=400){this.resizeHeight=400}else{if(b>400&&b<700){this.resizeHeight=b}else{this.resizeHeight=700}}},resizeImage:function(h,f,e){var g=new Image();g.src=h.src;if(g.width>0&&g.height>0){if(g.width>f){h.width=f;h.height=(g.height*f)/g.width;if(h.height>e){h.height=e;h.width=(g.width*e)/g.height}}else{if(g.height>e){h.height=e;h.width=(g.width*e)/g.height;if(g.width>f){h.width=f;h.height=(g.height*f)/g.width}}else{h.width=g.width;h.height=g.height}}}},instantiation:function(){var b=this;this.mySlidesControl=new SlidesControl({slidesRegion:this.slidesRegion,prev:this.prev,next:this.next,scale:b.itemWidth,duration:this.duration,type:"neat",itemWidth:b.itemWidth,initializeField:function(){this.slidesRegion=$(this.slidesRegion);this.prev=$(this.prev);this.next=$(this.next);this.currentIndex=b.currentIndex;this.position=0;this.items=b.imgItems;this.length=this.items.length;this.lock=false},initializeEvent:function(){this.onPrevClickHandler=this.onPrevClick.bind(this);this.onNextClickHandler=this.onNextClick.bind(this);Event.observe(this.prev,"click",this.onPrevClickHandler);Event.observe(this.next,"click",this.onNextClickHandler);this.slidesRegionOverHandler=this.slidesRegionOver.bind(this);this.slidesRegionOutHandler=this.slidesRegionOut.bind(this);Event.observe(this.prev,"mouseover",this.slidesRegionOverHandler);Event.observe(this.prev,"mouseout",this.slidesRegionOutHandler);Event.observe(this.next,"mouseover",this.slidesRegionOverHandler);Event.observe(this.next,"mouseout",this.slidesRegionOutHandler);Event.observe(b.showOriginal,"mouseover",this.slidesRegionOverHandler);Event.observe(b.showOriginal,"mouseout",this.slidesRegionOutHandler);this.showThumbnailClickHandler=this.showThumbnailClick.bind(this);Event.observe(b.showThumbnail,"click",this.showThumbnailClickHandler);this.onListRegionClickHandler=this.onListRegionClick.bind(this);Event.observe(b.listRegion,"click",this.onListRegionClickHandler);this.showOriginalClickHandler=this.showOriginalClick.bind(this);Event.observe(b.showOriginal,"click",this.showOriginalClickHandler);this.replayClickHandler=this.replayClick.bind(this);Event.observe(b.replay,"click",this.replayClickHandler);this.keydownHandler=this.keydown.bind(this);Event.observe(document.body||document.documentElement,"keydown",this.keydownHandler);Event.observe(window,"resize",this.changeResolution.bind(this))},onPrevClick:function(a){var d=a.target||a.srcElement;Event.stop(a);this.prevSlides(-1)},onNextClick:function(a){var d=a.target||a.srcElement;Event.stop(a);this.nextSlides(-1)},keydown:function(a){var d=a.target||a.srcElement;if(a.keyCode==37){this.prevSlides(-1)}else{if(a.keyCode==39){this.nextSlides(-1)}}},slidesRegionOver:function(a){Event.stop(a);if(this.currentIndex>0&&this.currentIndex<b.length){$(this.prev).down().show()}else{$(this.prev).down().hide()}$(this.next).down().show();b.showOriginal.show()},slidesRegionOut:function(a){Event.stop(a);b.hideButton()},showThumbnailClick:function(a){new Widgets.MixAlbumThumbnail({slidesRegion:b.thumbnailRegion,currentIndex:this.currentIndex,items:b.pixItems,imageTemplate:'<dd class="#{sty}"><a href="javascript:void(0);" title="#{Title}"><img src="#{SmallPicUrl}" method="#{currentIndex}" alt="#{Title}"></a></dd>',pageTemplate:b.thumbnailPageTemplate,pageClass:"newsimgpage",callback:this.showThumbnailCallBack.bind(this)});b.commendRegion.hide();b.listRegion.show();b.thumbnailRegion.up().show()},showThumbnailCallBack:function(a){b.listRegion.hide();b.commendRegion.hide();b.thumbnailRegion.innerHTML="";this.noSlides(a)},onListRegionClick:function(a){var d=Event.element(a);if(d.hasClassName("close")){b.listRegion.hide();b.thumbnailRegion.innerHTML="";b.commendRegion.hide()}},showOriginalClick:function(){new Widgets.Artwork({isLoader:true,imgUrl:b.pixItems[this.currentIndex].OriginalPicUrl})},replayClick:function(){b.thumbnailRegion.up().hide();b.listRegion.hide();b.commendRegion.hide();this.noSlides(0)},changeResolution:function(){b.getClientHeight();var f=Builder.build(b.imgItems[this.currentIndex]);var a=f.getElementsByTagName("img")[0],e;b.loading.show();e=document.createElement("img");e.onload=(function(c,d){return function(){b.resizeImage(d,1000,b.resizeHeight);var k=d.width;var j=d.height;if(k==0){if(d.hasAttribute("width")){k=parseInt(d.readAttribute("width"),10)}else{k=d.naturalWidth}}if(j==0){if(d.hasAttribute("height")){j=parseInt(d.readAttribute("height"),10)}else{j=d.naturalHeight}}c.width=k;c.height=j;b.showPicRegion.style.height=Math.max(b.resizeHeight,j)+"px";if(j<b.resizeHeight){$(c).style.marginTop=parseInt(b.resizeHeight-j,10)/2+"px"}else{$(c).style.marginTop="0px"}b.loading.hide();this.slidesRegion.innerHTML="";this.slidesRegion.appendChild(f)}})(a,e).bind(this);e.src=a.src},noSlides:function(a){if(this.lock){return}if(b.logRelatedType>0&&b.logRelatedID>0){Mtime.Component.Statistic.Service.Log(b.logRelatedType,b.logRelatedID)}var g=null;var f;if(a!==-1){this.currentIndex=a}b.page.innerHTML=(this.currentIndex+1)+" / "+b.length+"<i></i>";var h=b.pixItems[this.currentIndex].Content;b.summary.innerHTML=h;if(h.length>0){b.summaryBG.show()}else{b.summaryBG.hide()}b.loading.show();this.nowImageNode=Builder.build(b.imgItems[this.currentIndex]);this.nowImageNode.hide();this.slidesRegion.innerHTML="";this.slidesRegion.appendChild(this.nowImageNode);b.callback&&b.callback(this.currentIndex);b.changeRegionStyle(0);if(b.logRelatedType>0&&b.logRelatedID>0){Mtime.Component.Statistic.Service.Log(b.logRelatedType,b.logRelatedID)}},prevSlides:function(a){if(this.lock){return}if(b.logRelatedType>0&&b.logRelatedID>0){Mtime.Component.Statistic.Service.Log(b.logRelatedType,b.logRelatedID)}if(this.currentIndex==0){return}b.loading.show();var g=null;var f;if(a!==-1){this.currentIndex=a+1}if(this.currentIndex<1){b.callback&&b.callback(this.currentIndex,true);return;this.currentIndex=b.length-1}else{this.currentIndex--}b.page.innerHTML=(this.currentIndex+1)+" / "+b.length+"<i></i>";var h=b.pixItems[this.currentIndex].Content;b.summary.innerHTML=h;if(h.length>0){b.summaryBG.show()}else{b.summaryBG.hide()}this.selectedItems=this.slidesRegion.immediateDescendants();firstItem=this.selectedItems[0];b.loading.show();this.nowImageNode=Builder.build(b.imgItems[this.currentIndex]);this.nowImageNode.hide();this.slidesRegion.appendChild(this.nowImageNode);this.slidesRegion.insertBefore(this.nowImageNode,firstItem);this.selectedItems=this.slidesRegion.immediateDescendants();this.slidesRegion.style.left=this.position-this.scale+"px";b.callback&&b.callback(this.currentIndex);if(Mtime.browser.ie===0||Mtime.browser.ie>9){FunctionExt.defer(function(){this.lock=true;this.slidesRegion.addClassName(b.durations.className);this.slidesRegion.style.left="0px"},10,this);FunctionExt.defer(function(){this.slidesRegion.removeClassName(b.durations.className);this.selectedItems[1]&&this.slidesRegion.removeChild(this.selectedItems[1]);this.lock=false},b.durations.duration,this);b.changeRegionStyle(-1);return}g={node:this.slidesRegion,duration:this.duration,scale:this.scale,position:this.position-this.scale,callback:function(){this.selectedItems[1]&&this.slidesRegion.removeChild(this.selectedItems[1]);this.slidesRegion.style.left=this.position}.bind(this)};this.move(g);b.changeRegionStyle(-1)},nextSlides:function(g){if(this.lock){return}if(this.currentIndex==b.length-1){b.thumbnailRegion.up().hide();b.listRegion.show();b.commendRegion.show();return}if(b.logRelatedType>0&&b.logRelatedID>0){Mtime.Component.Statistic.Service.Log(b.logRelatedType,b.logRelatedID)}var h=null,a,j=[];if(g!==-1){this.currentIndex=g-1}if(this.currentIndex>b.length-2){this.currentIndex=0}else{this.currentIndex++}b.page.innerHTML=(this.currentIndex+1)+" / "+b.length+"<i></i>";var k=b.pixItems[this.currentIndex].Content;b.summary.innerHTML=k;if(k.length>0){b.summaryBG.show()}else{b.summaryBG.hide()}b.loading.show();this.nowImageNode=Builder.build(b.imgItems[this.currentIndex]);this.nowImageNode.hide();this.slidesRegion.appendChild(this.nowImageNode);this.selectedItems=this.slidesRegion.immediateDescendants();b.callback&&b.callback(this.currentIndex);if(Mtime.browser.ie===0||Mtime.browser.ie>9){this.lock=true;this.slidesRegion.addClassName(b.durations.className);this.slidesRegion.style.left=-this.scale+"px";FunctionExt.defer(function(){this.slidesRegion.removeClassName(b.durations.className);this.selectedItems[0]&&this.slidesRegion.removeChild(this.selectedItems[0]);this.slidesRegion.style.left=this.position;this.lock=false},b.durations.duration,this);b.changeRegionStyle(1);return}h={node:this.slidesRegion,duration:this.duration,scale:-this.scale,position:this.position,callback:function(){this.selectedItems[0]&&this.slidesRegion.removeChild(this.selectedItems[0]);this.slidesRegion.style.left=this.position}.bind(this)};this.move(h);b.changeRegionStyle(1)},move:function(a){this.lock=true;new Fx.Move(a.node,{scaleX:true,duration:a.duration,distances:{left:a.scale,position:a.position},callback:function(){this.lock=false;a.callback&&a.callback()}.bind(this)})}})}});NewsWidgets.BehindSlidesControl=Class.create();Object.extend(NewsWidgets.BehindSlidesControl.prototype,Widgets.BehindSlidesControl.prototype);Object.extend(NewsWidgets.BehindSlidesControl.prototype,{currentIndex:0,options:{slidesRegion:"movieSlidesItems",prev:"moviePrev",next:"movieNext",presentNumber:"present_number",sumNumber:"sum_number",titleTxt:"title_txt",describeTxt:"describe_txt",moreLink:"",maxNumber:10,amount:16,duration:0.5,type:"neat"},initializeEvent:function(){Widgets.BehindSlidesControl.prototype.initializeEvent.apply(this);this.slidesRegionClickHandler=this.slidesRegionClick.bind(this);Event.observe(this.slidesRegion,"click",this.slidesRegionClickHandler.bind(this))},slidesRegionClick:function(d){Event.stop(d);var c=Event.findElement(d,"a");if(c){this.mySlidesControl.onNextClick(d)}},instanceSlidesControl:function(){var b=this;this.$sumNumber.innerHTML="/"+this.amount;this.mySlidesControl=new SlidesControl({slidesRegion:this.slidesRegion,prev:this.prev,next:this.next,scale:this.$images[0].offsetWidth,duration:this.duration,maxNumber:this.maxNumber,initializeField:function(){this.slidesRegion=$(this.slidesRegion);this.prev=$(this.prev);this.next=$(this.next);this.currentIndex=0;this.position=0;this.items=this.slidesRegion.childElements();this.length=this.items.length;this.itemsLen=this.length>this.maxNumber?this.maxNumber:this.length;if(this.length<this.maxNumber){b.moreLink=null}this.lock=false;this.isMoreLink=false;this.prev.addClassName("false")},onNextClick:function(a){var d=a.target||a.srcElement;if(!this.isMoreLink){Event.stop(a);this.nextSlides()}else{if(!b.moreLink){Event.stop(a)}}},prevSlides:function(){if(this.lock){return}if(this.next.hasClassName("false")){this.next.removeClassName("false")}this.isMoreLink=false;var a=null;a={node:this.slidesRegion,duration:this.duration,scale:this.scale,position:-this.currentIndex*this.scale};this.currentIndex--;if(this.currentIndex<=-1){this.currentIndex=0;return}else{if(this.currentIndex===0){this.prev.addClassName("false")}}b.currentIndex=this.currentIndex;this.move(a)},nextSlides:function(){if(this.lock){return}var a=null;if(this.prev.hasClassName("false")){this.prev.removeClassName("false")}b.selectedItems=this.slidesRegion.immediateDescendants();a={node:this.slidesRegion,duration:this.duration,scale:-this.scale,position:-this.currentIndex*this.scale};this.currentIndex++;if(this.itemsLen&&this.currentIndex>=this.itemsLen-1){this.currentIndex=this.itemsLen-1;this.isMoreLink=true;if(b.moreLink&&b.amount>10){this.next.href=b.moreLink;this.next.target="blank"}else{this.next.addClassName("false")}}b.currentIndex=this.currentIndex;this.move(a)},move:function(a){this.lock=true;b.moveMethod(a.scale);new Fx.Move(a.node,{scaleX:true,duration:a.duration,distances:{left:a.scale,position:a.position},callback:function(){this.lock=false;a.callback&&a.callback()}.bind(this)})}})}});NewsWidgets.StorySwitchControl=Class.create();Object.extend(NewsWidgets.StorySwitchControl.prototype,{server:{},options:{content:"",region:"",slidesRegion:"",prev:"",next:"",page:"",showThumbnail:"",thumbnails:"",itemWidth:1000,duration:0.5,logRelatedType:0,logRelatedID:0,hashName:""},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.initializeEvent();this.load()},initializeField:function(){},initializeDOM:function(){this.content=$(this.content);this.showThumbnail=$(this.showThumbnail);this.slidesRegions=$(this.slidesRegion);this.thumbnailsRegions=$(this.thumbnails)},initializeEvent:function(){this.onRegionClickHandler=this.onRegionClick.bind(this);this.slidesRegions&&Event.observe(this.slidesRegions,"click",this.onRegionClickHandler);this.onShowThumbnailClickHandler=this.onShowThumbnailClick.bind(this);this.showThumbnail&&Event.observe(this.showThumbnail,"click",this.onShowThumbnailClickHandler);Event.observe(window,"resize",this.changeResolution.bind(this))},destroyEvent:function(){this.slidesRegions&&Event.stopObserving(this.slidesRegions,"click",this.onRegionClickHandler);this.showThumbnail&&Event.stopObserving(this.showThumbnail,"click",this.onShowThumbnailClickHandler)},destroyDOM:function(){this.content=null;this.region=null;this.prev=null;this.next=null;this.page=null},destroyControl:function(){},close:function(){this.destroyControl();this.destroyEvent();this.destroyDOM()},load:function(){var b=location.hash.indexOf("#all")>-1;this.initShow();this.slides=new Widgets.MixAlbumLoopSlidesControl({slidesRegion:this.slidesRegion,getSlidesRegion:this.region,currentIndex:this.pageIndex-1<0?0:this.pageIndex-1,prev:this.prev,next:this.next,page:this.page,itemWidth:this.itemWidth,logRelatedType:this.logRelatedType,logRelatedID:this.logRelatedID,callback:this.changeUrl.bind(this)});if(b){this.onShowThumbnailClick()}this.changeResolution()},changeUrl:function(c,d){this.pageIndex=c+1;if(c<=0&&d){this.jump(1)}else{location.href="#/"+this.hashName+"/"+(c+1)}},changeResolution:function(){if(document.documentElement.clientWidth<=1024){this.slidesRegions.up().up().addClassName("screen1024")}else{this.slidesRegions.up().up().removeClassName("screen1024")}},onRegionClick:function(d){var e=Event.element(d);if(e.tagName=="EM"&&e.hasAttribute("originalPicUrl")){var f=e.getAttribute("originalPicUrl");new Widgets.Artwork({isLoader:true,imgUrl:f})}},onShowThumbnailClick:function(){new Widgets.MixAlbumThumbnail({slidesRegion:this.thumbnails,currentIndex:this.pageIndex-1<0?0:this.pageIndex-1,items:mixAlbumItems,callback:this.showThumbnailCallBack.bind(this)});location.href=location.hash+"#all";this.thumbnailsRegions.up().previous().addClassName("none");this.thumbnailsRegions.up().removeClassName("none")},showThumbnailCallBack:function(b){this.thumbnailsRegions.up().previous().removeClassName("none");this.thumbnailsRegions.up().addClassName("none");if(b!=this.pageIndex-1){this.slides.mySlidesControl.noSlides(b)}},initShow:function(){var d=1;var c=location.hash.replace("#all","");if(this.hashName=="story"){if(/^#\/story\/(\d+)$/.test(c)){d=parseInt(c.replace(/^#\/story\/(\d+)$/,"$1"),10)}}else{if(this.hashName=="page"){if(/^#\/page\/(\d+)$/.test(c)){d=parseInt(c.replace(/^#\/page\/(\d+)$/,"$1"),10)}}}this.length=$(this.region).immediateDescendants().length;if(d<0||d>this.length){d=0}this.pageIndex=d;this.jump(d)},jump:function(b){this.pageIndex=b;this.content.removeClassName("none");location.href="#/"+this.hashName+"/"+b}});var Pager=Class.create();Pager.prototype={threshold:7,maxThreshold:10,options:{pageRegionId:"",pageIndex:1,pageSize:10,totalRecord:1,callback:null},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeDOM();this.initializeEvent()},initializeDOM:function(){this.pageRegion=$(this.pageRegionId)},initializeEvent:function(){this.onClickPageRegionHander=this.onClickPageRegion.bindAsEventListener(this);this.pageRegion.observe("click",this.onClickPageRegionHander)},removeEvent:function(){this.pageRegion.stopObserving("click",this.onClickPageRegionHander)},render:function(s,y){this.pageIndex=parseInt(s,10);if(typeof y!="undefined"){this.totalRecord=y}var x=this.threshold,o=this.maxThreshold,s=this.pageIndex,t=this.pageSize,y=this.totalRecord,r=Math.ceil(parseFloat(y/t));if(r>1){var q=new StringBuilder();q.append('<div class="pagenav tc" onclick="return false;">');if(s==1){q.append('<a class="mr10 false" onclick="return false;">上一页</a>')}else{var v=s-1;q.append('<a href="#" class="mr10 next" pageIndex="'+v+'" onclick="return false;">上一页</a>')}var w=0,n=r,u=-1;if(r<=o){w=1;n=r}else{if(s<x&&r>o){w=1;n=x;u=0}else{if(s>(r-x+1)){w=r-x+1;n=r;u=1}else{if(s>=x&&s<=(r-x+1)){w=s-2;n=s+2;u=2}}}}q.append(this._createPageNumberHTML(w,n,r,u,s));if(s==r){q.append('<a class="mr10 false" onclick="return false;">下一页</a>')}else{var p=s+1;q.append('<a href="#" class="mr10 next" pageIndex="'+p+'" onclick="return false;">下一页</a>')}q.append("</div>");this.pageRegion.update(q.toString())}else{this.pageRegion.update("")}},_createPageNumberHTML:function(s,k,o,r,p){var q=new StringBuilder(),m="",l="";switch(r){case 0:l=this._createBehindHTML(o);break;case 1:m=this._createFrontHTML();break;case 2:m=this._createFrontHTML();l=this._createBehindHTML(o);break;default:break}q.append(m);for(var n=s;n<=k;n++){if(p==n){q.append('<a href="#" class="on" onclick="return false;">');q.append(n);q.append("</a>")}else{q.append('<a class="num" href="#" onclick="return false;" pageIndex="'+n+'">');q.append(n);q.append("</a>")}}q.append(l);return q.toString()},_createBehindHTML:function(d){var c=new StringBuilder();c.append("<span>...</span>");c.append('<a class="num" href="#" onclick="return false;" pageIndex="'+(d-1)+'">');c.append(d-1);c.append("</a>");c.append('<a class="num" href="#" onclick="return false;" pageIndex="'+d+'">');c.append(d);c.append("</a>");return c.toString()},_createFrontHTML:function(){var b=new StringBuilder();b.append('<a class="num" href="#" onclick="return false;" pageIndex="1">');b.append(1);b.append("</a>");b.append('<a class="num" href="#" onclick="return false;" pageIndex="2">');b.append(2);b.append("</a>");b.append("<span>...</span>");return b.toString()},onClickPageRegion:function(e){var d=Event.element(e);var f=d.readAttribute("pageIndex");if(f&&parseInt(f,10)>0){f=parseInt(f,10);this.callback&&this.callback(f)}},close:function(){this.removeEvent();this.pageRegion.update("");this.pageRegion=null}};var NewsPageClient=Class.create();Object.extend(NewsPageClient.prototype,{server:{},options:{viewType:0,pageIndex:1,pageSize:0,totalCount:0},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeServerData();this.initializeDOM();this.initializeEvent();this.initializeControl();this.load()},initializeServerData:function(){},initializeDOM:function(){this.spanSearch=$("spanSearch");this.newsText=$("newsText");this.newSearch=$("newSearch");this.newsRegion=$("newsRegion");this.loadingBtn=$("loadingBtn");this.pagerDiv=$("pagerDiv");this.eaboxBtn=$("eabox");this.cnboxBtn=$("cnbox");this.industryRegion=$("industryRegion");this.weekHotRegion=$("weekHotRegion")},destroyDOM:function(){this.spanSearch=null;this.newsText=null;this.newSearch=null;this.newsRegion=null;this.loadingBtn=null;this.pagerDiv=null;this.eaboxBtn=null;this.cnboxBtn=null;this.industryRegion=null;this.weekHotRegion=null},initializeEvent:function(){this.onFocusNewsTextHandler=this.onFocusNewsText.bind(this);this.newsText&&this.newsText.observe("focus",this.onFocusNewsTextHandler);this.onBlurNewsTextHandler=this.onBlurNewsText.bind(this);this.newsText&&this.newsText.observe("blur",this.onBlurNewsTextHandler);this.onKeydownTextHandler=this.onKeydownText.bind(this);this.newsText&&this.newsText.observe("keydown",this.onKeydownTextHandler);this.onClickNewSearchHandler=this.onClickNewSearch.bind(this);this.newSearch&&this.newSearch.observe("click",this.onClickNewSearchHandler);this.onClickLoadingBtnHandler=this.onClickLoadingNews.bind(this);this.loadingBtn&&this.loadingBtn.observe("click",this.onClickLoadingBtnHandler);if(this.industryRegion){this.onClickEaboxBtnHandler=this.onClickEaboxBtn.bind(this);this.eaboxBtn&&this.eaboxBtn.observe("click",this.onClickEaboxBtnHandler);this.onClickCnboxBtnHandler=this.onClickCnboxBtn.bind(this);this.cnboxBtn&&this.cnboxBtn.observe("click",this.onClickCnboxBtnHandler)}this.onMouseoverWeekHotHandler=this.onMouseoverWeekHot.bind(this);this.weekHotRegion&&Event.observe(this.weekHotRegion,"mouseover",this.onMouseoverWeekHotHandler);Event.observe(window,"unload",this.close.bind(this))},destroyEvent:function(){this.newsText&&this.newsText.stopObserving("focus",this.onFocusNewsTextHandler);this.newsText&&this.newsText.stopObserving("blur",this.onBlurNewsTextHandler);this.newsText&&this.newsText.stopObserving("keydown",this.onKeydownTextHandler);this.newSearch&&this.newSearch.stopObserving("click",this.onClickNewSearchHandler);this.loadingBtn&&this.loadingBtn.stopObserving("click",this.onClickLoadingBtnHandler);this.weekHotRegion&&this.weekHotRegion.stopObserving("mouseover",this.onMouseoverWeekHotHandler)},initializeControl:function(){this.loadShareTools();if($("headImgUl")){this.headimgSlide=new Widgets.IndexTopSlidesControl({slidesRegion:"headImgDl",dotSlidesRegion:"headImgUl",backSlidesRegion:"",txtSlidesRegion:"newsHeadImgSlidesRegion",prev:"preLink",next:"nextLink",autoTimeout:7})}},destroyControl:function(){if(this.headimgSlide){this.headimgSlide.close();this.headimgSlide=null}if(this.ShareControlList){this.ShareControlList.each(function(b){b.close();b=null})}if(this.rightCtrl){this.rightCtrl.close();this.rightCtrl=null}},load:function(){this.NavigationMark();if(typeof recommendNewsSlidesControl=="undefined"){this.recommendNewsSlidesControlInit()}this.renderPager();this.intizeNewsPubTime();this.industryRenderInit();this.weekHotReginInit()},loadShareTools:function(){var c=$$('div[type="ableShare"]');var d=siteMcUrl+"/member/signin";this.ShareControlList=[];if(typeof(c)!="undefined"){c.each(function(h){var j=h.readAttribute("newsId");var a=h.readAttribute("imageId");if(typeof a!="undefined"&&a!=""&&a!=null){var b=new CrosswiseTools({slidesRegionEl:h,shareRelatedObjType:5102,relatedId:a,isLogin:false,signInUrl:d,relatedObjId:j,relatedObjType:51,hasFavorited:false});this.ShareControlList.push(b)}else{var k=new CrosswiseTools({slidesRegionEl:h,shareRelatedObjType:5101,relatedId:j,isLogin:false,signInUrl:d,relatedObjId:j,relatedObjType:51,hasFavorited:false});this.ShareControlList.push(k)}}.bind(this))}if(typeof RightFloatToolsControl!="undefined"){this.rightCtrl=new RightFloatToolsControl({hasShareButton:false,hasFavoriteButton:false,hasMessageButton:false,hasCodeButton:false})}},onFocusNewsText:function(){var b;setWidth=function(){var a=this.spanSearch.clientWidth;if(a<160){a+=5;this.spanSearch.style.width=a+"px";b=setTimeout("setWidth()",20)}else{this.spanSearch.addClassName("focus");clearTimeout(b)}};setWidth()},onBlurNewsText:function(){var b;setWidth=function(){var a=this.spanSearch.clientWidth;if(a>85){a-=10;this.spanSearch.style.width=a+"px";b=setTimeout("setWidth()",20)}else{this.spanSearch.removeClassName("focus");clearTimeout(b)}};setWidth()},onKeydownText:function(b){if(b&&b.keyCode&&b.keyCode===13){this.onClickNewSearch()}},onClickNewSearch:function(){var b=this.newsText.value.trim();if(b.length>0){location="http://news.mtime.com/search/tag/index.html?t="+b;return}},onClickLoadingNews:function(){if(this.loadingBtn){var b=this.loadingBtn.up("div");b.hide();if(b.next("ul")){b.next("ul").show();if(b.next("ul").next("ul")){this.newsRegion.insertBefore(b,b.next("ul").next("ul"));b.show()}else{if(this.totalCount>this.pageSize){if(this.pagerDiv){this.pagerDiv.show()}}}}}},weekHotReginInit:function(){if(this.weekHotRegion){var b=this.weekHotRegion.down("dl").down("dd");if(b){b.addClassName("on")}}},onMouseoverWeekHot:function(b){this.thumbTipShowTimeout&&clearTimeout(this.thumbTipShowTimeout);this.thumbTipShowTimeout=FunctionExt.defer(function(){var e=this.weekHotRegion.down("dl").down("dd.on");if(e){$(e).removeClassName("on")}var a=Event.findElement(b,"dd");if(a!=document){var f=$(a).down("div");if(f&&!a.hasClassName("on")){a.addClassName("on")}}}.bind(this),100)},renderPager:function(){var c=$("pagerDiv");if(c&&typeof Pager!=="undefined"){var d=new Pager({pageRegionId:c,pageIndex:this.pageIndex,pageSize:this.pageSize,totalRecord:this.totalCount,callback:this.pagerCallback.bind(this)});d.render(this.pageIndex,this.totalCount)}},pagerCallback:function(b){if(b==1){$redirect(String.format("index.html",b))}else{$redirect(String.format(this.pageUrl,b))}},NavigationMark:function(){this.pageUrl=location.pathname.substring(0,location.pathname.lastIndexOf("/")+1)+"index-{0}.html";if(this.viewType===0){this.currentNav="全部"}else{if(this.viewType===1||this.viewType===7||this.viewType===8||this.viewType===9||this.viewType===10){this.currentNav="热读"}else{if(this.viewType===2||this.viewType===16||this.viewType===17||this.viewType===18||this.viewType===19||this.viewType===20){this.currentNav="电影"}else{if(this.viewType===3||this.viewType===21||this.viewType===22||this.viewType===23||this.viewType===24||this.viewType===25){this.currentNav="电视"}else{if(this.viewType===4){this.currentNav="产业"}else{if(this.viewType===5||this.viewType===26||this.viewType===27||this.viewType===28||this.viewType===29||this.viewType===30){this.currentNav="人物"}else{if(this.viewType===6){this.currentNav="生活"}else{if(this.viewType===33){this.currentNav="头条"}else{}}}}}}}}var g=document.getElementsByClassName("news_tagnav")[0].down("ul");if(g){var h=g.getElementsByTagName("li");if(typeof h!="undefined"&&h.length>0){for(var e=0;e<h.length;e++){var f=h[e];if(f.down("a").innerHTML==this.currentNav){f.addClassName("on")}else{f.removeClassName("on")}}}}},industryRenderInit:function(){if(this.industryRegion){var c=this.industryRegion.getElementsBySelector('table[data-selector="cnbox"]');var d=this.industryRegion.getElementsBySelector('table[data-selector="eabox"]');if(c.length>0&&d.length>0){this.cnboxBtn.show();this.eaboxBtn.show()}else{if(c.length>0){this.cnboxBtn.show()}else{if(d.length>0){this.eaboxBtn.show()}else{}}}}},onClickEaboxBtn:function(){if(this.industryRegion){this.cnboxBtn.removeClassName("on");this.eaboxBtn.addClassName("on");this.industryRegion.getElementsBySelector('[data-selector="cnbox"]').each(function(b){b.hide()}.bind(this));this.industryRegion.getElementsBySelector('[data-selector="eabox"]').each(function(b){b.show()}.bind(this))}},onClickCnboxBtn:function(){if(this.industryRegion){this.eaboxBtn.removeClassName("on");this.cnboxBtn.addClassName("on");this.industryRegion.getElementsBySelector('[data-selector="eabox"]').each(function(b){b.hide()}.bind(this));this.industryRegion.getElementsBySelector('[data-selector="cnbox"]').each(function(b){b.show()}.bind(this))}},recommendNewsSlidesControlInit:function(){if(typeof recommendNewsScriptVariables!="undefined"&&recommendNewsScriptVariables.length>0){this.recommendNewsSlidesControl=new Widgets.LoopSlidesControl({slidesRegion:"recommendNewsRegion",prev:"pre_recommend",next:"next_recommend",items:recommendNewsScriptVariables,autoTimeout:10,showLength:3,duration:0.6,itemWidth:333,imageTemplate:'<dd><table><tr><td valign="middle"><a href="#{href}" title="#{title1}" target="_blank"><img src="#{imageUrl}" width="175" height="85" alt="#{title1}" /></a></td></tr></table><div class="tag">#{tag}</div><h3><a href="#{href}" target="_blank">#{title1}</a></h3><p>#{title2}</p></dd>',callback:null})}},intizeNewsPubTime:function(){var h=$$("span[pubtime]");if(typeof h!="undefined"&&h.length>0){for(var f=0;f<h.length;f++){var g=h[f];var j=g.readAttribute("pubtime");if(!Mtime.isEmpty(j)){var k=this.getNewsPubTime(j);g.innerHTML=k}}}},getNewsPubTime:function(d){var c=Mtime.parseDate(d);if(!c){c=new Date()}return Mtime.dateToFormatedString(c)},close:function(){this.destroyControl();this.destroyEvent();this.destroyDOM()}});